{
  "hash": "f8a2e0a21f9d78994c1bf72420adcd60",
  "result": {
    "markdown": "---\ntitle: \"Summarizing default output BAM methylation\"\nauthor: \"Kathleen Durkin\"\ndate: \"2025-10-27\"\ncategories: [\"SIFP-2025\"]\nformat:\n  html:\n    toc: true\nexecute: \n  eval: FALSE\nengine: knitr\nbibliography: ../../../references.bib\n---\n\n\nBefore I get to the (very time-consuming) process of re-basecalling and aligning all of my Nanopore data, I want to get a quick sense of how much methylation is in my samples.\n\nI output and saved base-called BAM files during sequencing for all runs, so I can use these to get a quick-and-dirty methylation summary.\n\nNOTE: There is variation in both **sequencer** and **basecalling software** used during my sequencing reruns (by necessity), and the default-output BAM files are **unaligned**. This means the default BAMs were not generated using consistent methods, some include a more reduced set of modification calls, and likely include contaminant reads. All of this means the below summaries are just a sanity check, and *should not be used as conclusive/reliable results*.\n\n[Code](https://github.com/shedurkin/SIFP-nanopore/blob/main/M-multi-group/code/02-methylation-summaries.Rmd)\n\n# 1 Create a Bash variables file\n\nThis allows usage of Bash variables (e.g.Â paths to common directories) across R Markdown chunks.\n\n``` bash\n{\necho \"#### Assign Variables ####\"\necho \"\"\n\necho \"# Data directories\"\necho 'export nanopore_dir=/home/shared/8TB_HDD_02/shedurkin/SIFP-nanopore'\necho 'export output_dir_top=${nanopore_dir}/M-multi-group/output/02-methylation-summaries'\necho 'export data_dir_top=${nanopore_dir}/M-multi-group/data/02-methylation-summaries'\n\necho \"# Paths to programs\"\necho 'export modkit=/home/shared/dist_modkit_v0.5.1_8fa79e3/modkit'\necho 'export samtools=/home/shared/samtools-1.12/samtools'\necho 'export conda=/home/shared/8TB_HDD_02/shedurkin/.local/share/r-miniconda/bin/conda'\necho \"\"\n\necho \"# Set number of CPUs to use\"\necho 'export threads=20'\necho \"\"\n\necho \"# Input/output files\"\necho 'export raw_checksums=checksums.md5'\necho 'export trimmed_checksums=trimmed_fastq_checksums.md5'\necho \"\"\n} > .bashvars\n\ncat .bashvars\n```\n\n```         \n#### Assign Variables ####\n\n# Data directories\nexport nanopore_dir=/home/shared/8TB_HDD_02/shedurkin/SIFP-nanopore\nexport output_dir_top=${nanopore_dir}/M-multi-group/output/02-methylation-summaries\nexport data_dir_top=${nanopore_dir}/M-multi-group/data/02-methylation-summaries\n# Paths to programs\nexport modkit=/home/shared/dist_modkit_v0.5.1_8fa79e3/modkit\nexport samtools=/home/shared/samtools-1.12/samtools\nexport conda=/home/shared/8TB_HDD_02/shedurkin/.local/share/r-miniconda/bin/conda\n\n# Set number of CPUs to use\nexport threads=20\n\n# Input/output files\nexport raw_checksums=checksums.md5\nexport trimmed_checksums=trimmed_fastq_checksums.md5\n```\n\n# 2 Download BAM files\n\n### 2.0.1 Group 1, Library 4, MinION\n\nBarcodes 12, 13, and 14\n\n``` bash\nsource .bashvars\n\nwget \\\n--directory-prefix ${data_dir_top}/bam_pass/G1L4_MinION \\\n--recursive \\\n--no-check-certificate \\\n--continue \\\n--cut-dirs 6 \\\n--no-host-directories \\\n--no-parent \\\n--quiet \\\n--accept *.bam \\\nhttps://gannet.fish.washington.edu/kdurkin1/SIFP_2025/Group1_MinION/Library4/20250819_1337_MD-101223_FBD09922_51407a5d/bam_pass\n```\n\n### 2.0.2 Group 4, Library 1, MinION\n\nBarcodes 27, 28, 29\n\nNote that G4L1 MinION ended up split into 2 nanopore runs, due to erroring out between washes\n\n``` bash\nsource .bashvars\n\nwget \\\n--directory-prefix ${data_dir_top}/bam_pass/G4L1_MinION \\\n--recursive \\\n--no-check-certificate \\\n--continue \\\n--cut-dirs 6 \\\n--no-host-directories \\\n--no-parent \\\n--quiet \\\n--accept *.bam \\\nhttps://gannet.fish.washington.edu/kdurkin1/SIFP_2025/Group4_MinION/Library1/20250905_1158_MD-101223_FBD08455_b87a1f92/bam_pass\n\nwget \\\n--directory-prefix ${data_dir_top}/bam_pass/G4L1_MinION_wash3 \\\n--recursive \\\n--no-check-certificate \\\n--continue \\\n--cut-dirs 6 \\\n--no-host-directories \\\n--no-parent \\\n--quiet \\\n--accept *.bam \\\nhttps://gannet.fish.washington.edu/kdurkin1/SIFP_2025/Group4_MinION/Library1_wash3/20250907_1505_MD-101223_FBD08455_50a8f15e/bam_pass\n```\n\n### 2.0.3 Group 4, Library 2, MinION\n\nBarcodes 30, 31, 32\n\n``` bash\nsource .bashvars\n\nwget \\\n--directory-prefix ${data_dir_top}/bam_pass/G4L2_MinION \\\n--recursive \\\n--no-check-certificate \\\n--continue \\\n--cut-dirs 6 \\\n--no-host-directories \\\n--no-parent \\\n--quiet \\\n--accept *.bam \\\nhttps://gannet.fish.washington.edu/kdurkin1/SIFP_2025/Group4_MinION/Library2/20250909_1146_MN47571_FBD36396_e03e7ede/bam_pass\n```\n\n# 3 Methylation summaries from original BAM files\n\nUsing BAM files output from sequencing runs, *not* from recalling the pod5 files\n\n## 3.1 modkit\n\n### 3.1.1 Group 1, Library 4, MinION\n\nTry merging all bam files for each barcode to obtain unified summaries\n\n``` bash\nsource .bashvars\n\n### Barcode 12 ###\nmergedbam=${output_dir_top}/G1L4_MinION_barcode12_merged.bam\n# Merge all bam files from the given barcode into one\n$samtools merge -u $mergedbam ${data_dir_top}/bam_pass/G1L4_MinION/barcode12/*.bam\n# Total number of reads included in the merged file\n$samtools view -c $mergedbam\n# Sample reads and summarize methylation\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G1L4_MinION_barcode12_modkit_summary.txt\n# Delete merged bam file (space-saving)\nrm $mergedbam\n\n### Barcode 13 ###\nmergedbam=${output_dir_top}/G1L4_MinION_barcode13_merged.bam\n$samtools merge -u $mergedbam ${data_dir_top}/bam_pass/G1L4_MinION/barcode13/*.bam\n$samtools view -c $mergedbam\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G1L4_MinION_barcode13_modkit_summary.txt\nrm $mergedbam\n\n### Barcode 14 ###\nmergedbam=${output_dir_top}/G1L4_MinION_barcode14_merged.bam\n$samtools merge -u $mergedbam ${data_dir_top}/bam_pass/G1L4_MinION/barcode14/*.bam\n$samtools view -c $mergedbam\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G1L4_MinION_barcode14_modkit_summary.txt\nrm $mergedbam\n```\n\n```         \n2065657\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: C: 0.8046875\n2489352\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: C: 0.8125\n4090390\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: C: 0.82421875\n```\n\n``` bash\nsource .bashvars\n\ncat ${output_dir_top}/G1L4_MinION_barcode12_modkit_summary.txt\ncat ${output_dir_top}/G1L4_MinION_barcode13_modkit_summary.txt\ncat ${output_dir_top}/G1L4_MinION_barcode14_modkit_summary.txt\n```\n\n```         \n# bases             C \n# total_reads_used  100000 \n# count_reads_C     100000 \n# pass_threshold_C  0.8046875 \n base  code  pass_count  pass_frac    all_count  all_frac \n C     -     1556909     0.92845637   1664842    0.8941322 \n C     h     18106       0.01079744   58699      0.031525314 \n C     m     101864      0.060746185  138423     0.07434247 \n# bases             C \n# total_reads_used  100000 \n# count_reads_C     100000 \n# pass_threshold_C  0.8125 \n base  code  pass_count  pass_frac     all_count  all_frac \n C     -     1471527     0.92578214    1573397    0.8910261 \n C     h     16036       0.0100887325  54004      0.030582855 \n C     m     101933      0.06412913    138425     0.078391075 \n# bases             C \n# total_reads_used  100000 \n# count_reads_C     100000 \n# pass_threshold_C  0.82421875 \n base  code  pass_count  pass_frac    all_count  all_frac \n C     -     1621732     0.93584156   1733758    0.9014899 \n C     h     14749       0.008511103  53815      0.027981805 \n C     m     96432       0.05564734   135641     0.07052829 \n```\n\n### 3.1.2 Group 4, Library 1, MinION\n\nTry merging all bam files for each barcode to obtain unified summaries\n\n``` bash\nsource .bashvars\n\n### Barcode 27 ###\nmergedbam1=${output_dir_top}/prewash3_G4L1_MinION_barcode27_merged.bam\nmergedbam2=${output_dir_top}/wash3_G4L1_MinION_barcode27_merged.bam\nmergedbam=${output_dir_top}/G4L1_MinION_barcode27_merged.bam\n# Merge all bam files from the given barcode into one\n$samtools merge -u $mergedbam1 ${data_dir_top}/bam_pass/G4L1_MinION/barcode27/*.bam\n$samtools merge -u $mergedbam2 ${data_dir_top}/bam_pass/G4L1_MinION_wash3/barcode27/*.bam\n$samtools merge -u $mergedbam ${output_dir_top}/*G4L1_MinION_barcode27_merged.bam\n# Total number of reads included in the merged file\n$samtools view -c $mergedbam\n# Sample reads and summarize methylation\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G4L1_MinION_barcode27_modkit_summary.txt\n# Delete merged bam file (space-saving)\nrm $mergedbam1\nrm $mergedbam2\nrm $mergedbam\n\n### Barcode 28 ###\nmergedbam1=${output_dir_top}/prewash3_G4L1_MinION_barcode28_merged.bam\nmergedbam2=${output_dir_top}/wash3_G4L1_MinION_barcode28_merged.bam\nmergedbam=${output_dir_top}/G4L1_MinION_barcode28_merged.bam\n$samtools merge -u $mergedbam1 ${data_dir_top}/bam_pass/G4L1_MinION/barcode28/*.bam\n$samtools merge -u $mergedbam2 ${data_dir_top}/bam_pass/G4L1_MinION_wash3/barcode28/*.bam\n$samtools merge -u $mergedbam ${output_dir_top}/*G4L1_MinION_barcode28_merged.bam\n$samtools view -c $mergedbam\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G4L1_MinION_barcode28_modkit_summary.txt\nrm $mergedbam1\nrm $mergedbam2\nrm $mergedbam\n\n### Barcode 29 ###\nmergedbam1=${output_dir_top}/prewash3_G4L1_MinION_barcode29_merged.bam\nmergedbam2=${output_dir_top}/wash3_G4L1_MinION_barcode29_merged.bam\nmergedbam=${output_dir_top}/G4L1_MinION_barcode29_merged.bam\n$samtools merge -u $mergedbam1 ${data_dir_top}/bam_pass/G4L1_MinION/barcode29/*.bam\n$samtools merge -u $mergedbam2 ${data_dir_top}/bam_pass/G4L1_MinION_wash3/barcode29/*.bam\n$samtools merge -u $mergedbam ${output_dir_top}/*G4L1_MinION_barcode29_merged.bam\n$samtools view -c $mergedbam\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G4L1_MinION_barcode29_modkit_summary.txt\nrm $mergedbam1\nrm $mergedbam2\nrm $mergedbam\n```\n\n```         \n484845\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: C: 0.6171875 A: 0.7324219\n385251\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: A: 0.7324219 C: 0.6113281\n943264\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: A: 0.7363281 C: 0.6015625\n```\n\n``` bash\nsource .bashvars\n\ncat ${output_dir_top}/G4L1_MinION_barcode27_modkit_summary.txt\ncat ${output_dir_top}/G4L1_MinION_barcode28_modkit_summary.txt\ncat ${output_dir_top}/G4L1_MinION_barcode29_modkit_summary.txt\n```\n\n```         \n# bases             A,C \n# total_reads_used  100000 \n# count_reads_A     100000 \n# count_reads_C     100000 \n# pass_threshold_C  0.6171875 \n# pass_threshold_A  0.7324219 \n base  code   pass_count  pass_frac    all_count  all_frac \n C     -      4709514     0.9370899    5037398    0.90344435 \n C     m      183430      0.036498543  288506     0.051742807 \n C     21839  132736      0.02641155   249866     0.044812825 \n A     -      6998666     0.9448404    7497537    0.91100186 \n A     a      408581      0.05515963   732454     0.088998154 \n# bases             C,A \n# total_reads_used  100000 \n# count_reads_C     100000 \n# count_reads_A     100000 \n# pass_threshold_C  0.6113281 \n# pass_threshold_A  0.7324219 \n base  code   pass_count  pass_frac    all_count  all_frac \n C     -      4599511     0.9394284    4927496    0.90604055 \n C     m      149560      0.030546924  244914     0.04503342 \n C     21839  147003      0.030024668  266084     0.048926044 \n A     -      7187994     0.9458192    7701594    0.912195 \n A     a      411761      0.054180827  741331     0.087804995 \n# bases             A,C \n# total_reads_used  100000 \n# count_reads_A     100000 \n# count_reads_C     100000 \n# pass_threshold_A  0.7363281 \n# pass_threshold_C  0.6015625 \n base  code   pass_count  pass_frac    all_count  all_frac \n A     -      7643002     0.94833636   8188903    0.91499233 \n A     a      416377      0.05166366   760793     0.08500769 \n C     -      5183410     0.9336648    5546190    0.90081483 \n C     m      207997      0.037465584  321663     0.05224466 \n C     21839  160275      0.028869629  289006     0.046940494 \n```\n\n### 3.1.3 Group 4, Library 2, MinION\n\nTry merging all bam files for each barcode to obtain unified summaries\n\n``` bash\nsource .bashvars\n\n### Barcode 30 ###\nmergedbam=${output_dir_top}/G4L2_MinION_barcode30_merged.bam\n# Merge all bam files from the given barcode into one\n$samtools merge -u $mergedbam ${data_dir_top}/bam_pass/G4L2_MinION/barcode30/*.bam\n# Total number of reads included in the merged file\n$samtools view -c $mergedbam\n# Sample reads and summarize methylation\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G4L2_MinION_barcode30_modkit_summary.txt\n# Delete merged bam file (space-saving)\nrm $mergedbam\n\n### Barcode 31 ###\nmergedbam=${output_dir_top}/G4L2_MinION_barcode31_merged.bam\n$samtools merge -u $mergedbam ${data_dir_top}/bam_pass/G4L2_MinION/barcode31/*.bam\n$samtools view -c $mergedbam\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G4L2_MinION_barcode31_modkit_summary.txt\nrm $mergedbam\n\n### Barcode 32 ###\nmergedbam=${output_dir_top}/G4L2_MinION_barcode32_merged.bam\n$samtools merge -u $mergedbam ${data_dir_top}/bam_pass/G4L2_MinION/barcode32/*.bam\n$samtools view -c $mergedbam\n$modkit summary --num-reads 100000 $mergedbam > ${output_dir_top}/G4L2_MinION_barcode32_modkit_summary.txt\nrm $mergedbam\n```\n\n```         \n274217\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: A: 0.7402344 C: 0.59375\n[E::bgzf_read_block] Invalid BGZF header at offset 7768473\n[E::bgzf_read] Read block operation failed with error 2 after 0 of 4 bytes\nsamtools merge: \"/home/shared/8TB_HDD_02/shedurkin/SIFP-nanopore/M-multi-group/data/02-methylation-summaries/bam_pass/G4L2_MinION/barcode31/FBD36396_pass_barcode31_e03e7ede_3381b7e8_0.bam\" is truncated\n[W::bam_hdr_read] EOF marker is absent. The input is probably truncated\n8117\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: A: 0.7480469 C: 0.6308594\n[E::bgzf_read_block] Invalid BGZF header at offset 17718219\n[E::bgzf_read] Read block operation failed with error 2 after 0 of 4 bytes\nsamtools merge: \"/home/shared/8TB_HDD_02/shedurkin/SIFP-nanopore/M-multi-group/data/02-methylation-summaries/bam_pass/G4L2_MinION/barcode32/FBD36396_pass_barcode32_e03e7ede_3381b7e8_0.bam\" is truncated\n[W::bam_hdr_read] EOF marker is absent. The input is probably truncated\n17282\n[0;32m>[0m sampling 100000 reads from BAM\n[0;32m>[0m calculating threshold at 10(th) percentile\n[0;32m>[0m calculated thresholds: C: 0.625 A: 0.7519531\n```\n\n``` bash\nsource .bashvars\n\ncat ${output_dir_top}/G4L2_MinION_barcode30_modkit_summary.txt\ncat ${output_dir_top}/G4L2_MinION_barcode31_modkit_summary.txt\ncat ${output_dir_top}/G4L2_MinION_barcode32_modkit_summary.txt\n```\n\n```         \n# bases             A,C \n# total_reads_used  100000 \n# count_reads_A     100000 \n# count_reads_C     100000 \n# pass_threshold_C  0.59375 \n# pass_threshold_A  0.7402344 \n base  code   pass_count  pass_frac    all_count  all_frac \n A     -      7663789     0.9469944    8207808    0.9136961 \n A     a      428961      0.05300559   775275     0.08630389 \n C     -      5260505     0.9280016    5633731    0.8956567 \n C     m      233652      0.041218366  354310     0.05632859 \n C     21839  174481      0.030780056  302015     0.048014674 \n# bases             A,C \n# total_reads_used  8117 \n# count_reads_A     8117 \n# count_reads_C     8117 \n# pass_threshold_A  0.7480469 \n# pass_threshold_C  0.6308594 \n base  code   pass_count  pass_frac    all_count  all_frac \n A     -      604043      0.95120835   646373     0.91786575 \n A     a      30984       0.048791625  57840      0.08213424 \n C     -      387650      0.9449186    415593     0.9117501 \n C     m      11550       0.028153772  19071      0.041838974 \n C     21839  11047       0.02692768   21155      0.046410967 \n# bases             C,A \n# total_reads_used  17282 \n# count_reads_A     17282 \n# count_reads_C     17282 \n# pass_threshold_C  0.625 \n# pass_threshold_A  0.7519531 \n base  code   pass_count  pass_frac    all_count  all_frac \n C     -      941964      0.93773484   1009393    0.9045421 \n C     m      35732       0.03557157   54957      0.04924833 \n C     21839  26814       0.026693612  51566      0.04620957 \n A     -      1434663     0.95336837   1538782    0.92035663 \n A     a      70173       0.04663166   133159     0.07964336 \n```\n\n# 4 Summary\n\nThese are super interesting! In the Group 4 (oldest) sequences, there are notable levels of 6mA methylation (indicated by base A with code a), in fact the 6mA methylation level (`pass_frac`) is higher than the 5mC cytosine methylation (base C, code m). I'm very skeptical of this, since 6mA is very uncommon in eukaryotes, but it hasn't been evaluated much in Cnidarians.\n\nIt seems most likely that the high 6mA levels are the result of either contamination (eg. present in contaminant fungi) or an artifact of age-related degradation. I can't actually tell right now whether the modern samples (Group 1) have any 6mA methylation, because that sequencing was done before the MinKnow software update that allowed for real-time 6mA modification calling during sequencing. The Group 1 stuff was only sequenced with 5mC modification calling.\n\nI'm also curious why Group 1 shows notable 5hmC levels, but 5hmC is *not* present in either of the Group 4 runs. I believe all of the sequencing runs were performed with softare that is 5hmC-sensitive, so if its present in one run I'd expect to find it in others...\n\nFinally, in the Group 4 runs, which used the updated basecaller software, there are also codes for Cytosine with the `21839` modification code. According to the Nanopore `Dorado` basecaller [documentation](https://software-docs.nanoporetech.com/dorado/latest/basecaller/mods/), this modification code indicates 4mC (N(4)-methylcytosine). 4mC is believed to be essentially absent outside of prokaryotes (with a few very rare exceptions, associated with horizontal gene transfer from a prokaryote). As such, it seems *extremely* likely that the occurance of 4mC in the older samples is spurious.\n\nI'll have to re-basecall everything with the updated models, including adapter/barcode trimming and and genome alignment, before proceeding with methylation summaries.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}