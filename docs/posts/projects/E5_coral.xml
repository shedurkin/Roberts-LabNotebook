<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Kathleen&#39;s Lab Notebook</title>
<link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral.html</link>
<atom:link href="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.433</generator>
<lastBuildDate>Tue, 11 Mar 2025 07:00:00 GMT</lastBuildDate>
<item>
  <title>Timeseries molecular: A.pul WGCNA, mRNA and miRNA</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_03_11_timeseries_WGCNA.html</link>
  <description><![CDATA[ 




<p>Working with the <em>A. pulchra</em> timeseries gene expression (RNA + sRNA) data from E5 Coral project.</p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA.md">Code</a></p>
<p>I ran a Weighted Gene Correlation Network Analysis (WGCNA) with both gene and miRNA expression to a) group similarly-expressed sets of genes and/or miRNAs into “modules” of coexpression, and b) evaluate correlation of gene expression modules with different physiological and environmental variables.</p>
<p>Note that, unlike my original trials with WGCNA, I variance stabilized the gene counts and miRNA counts <em>separately</em> this time, after talking w Ariana about how to prep data appropriately. This didn’t have a huge impact on overall trends (which were already driven by the genes, not miRNA), but it really impacted miRNA module placement. When I VST’d everything together almost all miRNA ended up placed in the same module, likely because all the miRNA have relatively low counts. After performing VST separately, WGCNA now places the miRNA across ~15 modules.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-31-1.png?raw=true" class="img-fluid"></p>
<p>WGCNA identified a total of 54 modules of coexpressed genes/miRNA, 19 of which contain miRNA. Roughly half of the miRNA are contained within a single module, one of the larger modules that likely represents housekeeping function. The remaining miRNA are spread out, generally the only miRNA in their modules.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-34-1.png?raw=true" class="img-fluid"></p>
<p>In the above interaction network plot, each module is shown as a node. Modules that contain miRNA are black nodes, while gene-only modules are in grey. A line between two modules indicates the module eigengenes are significantly correlated, with a correlation coefficient magnitude of at least 0.7. Blue shading indicates positive correlation and red indicates negative correlation.</p>
<p>To look for potential miRNA-target mRNA interactions we’re looking for negative correlations where at least one module contains miRNA. I count roughly 20 of these!</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Module-trait-relationship-heatmap.jpg" class="img-fluid"></p>
<p>Ran correlation of modules with physiological and environmental variables, and some interesting stuff popped out! Interestingly, timepoints 2 and 3 have significantly correlated modules, but timepoints 1 and 4 don’t. This suggests the influence of timepoint stems largely from the temperature conditions, since a) timepoints 2 and 3 have the most “extreme” temperatures (in comparison to annual mean), and b) many of their correlated modules are also significantly correlated with temperature. Interestingly, timepoints 2 and 3 (March and September 2020) are actually extreme in opposite directions. March 2020 was the warmest timepoint and September was the coolest. If the two are correlated with very similar sets of gene modules, that suggests very similar expression pathways are used in response to both heat stress and cold stress in A.pulchra!</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-48-1.png?raw=true" class="img-fluid"></p>
<p>We can also plot out the eigengene expression of modules of interest across variables. Above are all the modules significantly correlated withe temperature, plotted across standardized temperature.</p>
<p>Code:</p>
<p>Running Weighted Gene Correlation Network Analysis (WGCNA) to assess patterns of miRNA-mRNA coexpression in A.pulchra.</p>
<section id="install-and-load-packages" class="level1">
<h1>Install and load packages</h1>
<div class="cell" data-inlcude="true">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WGCNA)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(magrittr)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(genefilter)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DESeq2)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggfortify)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RColorBrewer)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pheatmap)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(factoextra)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(vegan)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dendsort)</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ComplexHeatmap)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(psych)</span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span></code></pre></div>
</div>
</section>
<section id="load-and-prep-data" class="level1">
<h1>Load and prep data</h1>
<p>Load in count matrices for RNAseq.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw gene counts data (will filter and variance stabilize)</span></span>
<span id="cb2-2">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span>
<span id="cb2-3">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format gene IDs as rownames (instead of a column)</span></span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb2-7">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>gene_id)</span>
<span id="cb2-8"></span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load and format metadata</span></span>
<span id="cb2-11">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../M-multi-species/data/rna_metadata.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(AzentaSampleName, ColonyID, Timepoint)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACR"</span>, ColonyID))</span>
<span id="cb2-13">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb2-14"></span>
<span id="cb2-15">colonies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID)</span>
<span id="cb2-16"></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load physiological data</span></span>
<span id="cb2-18">phys<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/master_timeseries.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(colony_id_corr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> colonies)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(colony_id_corr, species, timepoint, site, Host_AFDW.mg.cm2, Sym_AFDW.mg.cm2, Am, AQY, Rd, Ik, Ic, calc.umol.cm2.hr, cells.mgAFDW, prot_mg.mgafdw, Ratio_AFDW.mg.cm2, Total_Chl, Total_Chl_cell, cre.umol.mgafdw)</span>
<span id="cb2-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format timepoint</span></span>
<span id="cb2-21">phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP"</span>, phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint)</span>
<span id="cb2-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#add column with full sample info</span></span>
<span id="cb2-23">phys <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(phys, metadata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"colony_id_corr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ColonyID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Timepoint"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AzentaSampleName)</span>
<span id="cb2-25">  </span>
<span id="cb2-26"></span>
<span id="cb2-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#add site information into metadata </span></span>
<span id="cb2-28">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Site<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>site[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colony_id_corr)]</span>
<span id="cb2-29"></span>
<span id="cb2-30"></span>
<span id="cb2-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename gene column names to include full sample info (as in miRNA table)</span></span>
<span id="cb2-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb2-33"></span>
<span id="cb2-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw miRNA counts (will filter and variance stabilize)</span></span>
<span id="cb2-35">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<p>Ensure there are no genes or miRNAs with 0 counts across all samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes)</span>
<span id="cb3-2"></span>
<span id="cb3-3">Apul_genes<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-4">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-6">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes)</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNAs</span></span>
<span id="cb3-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA)</span>
<span id="cb3-12"></span>
<span id="cb3-13">Apul_miRNA<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-14">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-16">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA)</span></code></pre></div>
</div>
<p>Removing genes with only 0 counts reduced number from 44371 to 35869. Retained all 51 miRNAs.</p>
<section id="physiology-filtering" class="level2">
<h2 class="anchored" data-anchor-id="physiology-filtering">Physiology filtering</h2>
<p>Run PCA on physiology data to see if there are phys outliers</p>
<p>Export data for PERMANOVA test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">test<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(phys)</span>
<span id="cb4-2">test<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>test[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(test), ]</span></code></pre></div>
</div>
<p>Build PERMANOVA model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">scaled_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fviz_eig</span>(scaled_test)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale data</span></span>
<span id="cb5-5">vegan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric)))</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PerMANOVA </span></span>
<span id="cb5-8">permanova<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">adonis2</span>(vegan <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>site, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'eu'</span>)</span>
<span id="cb5-9">permanova</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">pca1<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoplot</span>(scaled_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frame.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"site"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frame=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PC2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(colony_id_corr, timepoint)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-4">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>), </span>
<span id="cb6-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span id="cb6-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb6-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>), </span>
<span id="cb6-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>), </span>
<span id="cb6-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>));pca1</span></code></pre></div>
</div>
<p>Remove ACR-173, timepoint 3 sample from analysis. This is Azenta sample 1B2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B2_ACR-173_TP3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb7-3"></span>
<span id="cb7-4">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B2_ACR-173_TP3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb7-6"></span>
<span id="cb7-7">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B2_ACR-173_TP3"</span>)</span></code></pre></div>
</div>
<p>We also do not have phys data for colony 1B9 ACR-265 at TP4, so I’ll remove that here as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B9_ACR-265_TP4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B9_ACR-265_TP4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B9_ACR-265_TP4"</span>)</span></code></pre></div>
</div>
</section>
<section id="povera-filtering" class="level2">
<h2 class="anchored" data-anchor-id="povera-filtering">pOverA filtering</h2>
<p><em>pOverA</em>: Specifying the minimum count for a proportion of samples for each gene. Here, we are using a pOverA of 0.1. This is because we have 40 samples with a minimum of n=4 samples per timepoint per site. Therefore, we will accept genes that are present in 4/40 = 0.1 of the samples because we expect different expression by life stage. We are further setting the minimum count of genes and miRNA to 10, such that 12.5% of the samples must have a gene count of &gt;10 in order for the gene to remain in the data set.</p>
<p>Filter in the package “genefilter”. Pre-filtering our dataset to reduce the memory size dataframe, increase the speed of the transformation and testing functions, and improve quality of statistical analysis by removing low-coverage counts. Removed counts could represent outliers in the data and removing these improves sensitivity of statistical tests.</p>
<p>genes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb9-4">gfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_genes, filt)</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb9-7">gkeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes[gfilt,]</span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb9-10">gkeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes[gfilt,]</span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify gene lists</span></span>
<span id="cb9-13">gn.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(gkeep)</span>
<span id="cb9-14"></span>
<span id="cb9-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#gene count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb9-16">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> gn.keep),])</span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb9-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Before</span></span>
<span id="cb9-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_filt) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#After</span></span></code></pre></div>
</div>
<p>We had 35869 genes before, and 23459 genes after filtering.</p>
<p>miRNA:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb10-4">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_miRNA, mifilt)</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb10-7">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA[mifilt,]</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb10-10">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA[mifilt,]</span>
<span id="cb10-11"></span>
<span id="cb10-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify gene lists</span></span>
<span id="cb10-13">mi.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(mikeep)</span>
<span id="cb10-14"></span>
<span id="cb10-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#gene count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb10-16">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_miRNA[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> mi.keep),])</span>
<span id="cb10-17"></span>
<span id="cb10-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb10-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Before</span></span>
<span id="cb10-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_filt) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#After</span></span></code></pre></div>
</div>
<p>Of our original 51 miRNAs, 43 are retained.</p>
</section>
<section id="assign-metadata-and-arrange-order-of-columns" class="level2">
<h2 class="anchored" data-anchor-id="assign-metadata-and-arrange-order-of-columns">Assign metadata and arrange order of columns</h2>
<p>Order metadata the same as the column order in the gene matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)</span>
<span id="cb11-2">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(list)</span>
<span id="cb11-3"></span>
<span id="cb11-4">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample)</span>
<span id="cb11-5"></span>
<span id="cb11-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the levels</span></span>
<span id="cb11-7">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span>list)</span>
<span id="cb11-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the data.frame</span></span>
<span id="cb11-9">metadata_ordered <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample),]</span>
<span id="cb11-10">metadata_ordered<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span>
<span id="cb11-11"></span>
<span id="cb11-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sure the miRNA colnames are also in the same order as the gene colnames</span></span>
<span id="cb11-13">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)]</span></code></pre></div>
</div>
<p>Metadata and gene count matrix are now ordered the same.</p>
</section>
<section id="conduct-variance-stabilized-transformation" class="level2">
<h2 class="anchored" data-anchor-id="conduct-variance-stabilized-transformation">Conduct variance stabilized transformation</h2>
<p>VST should be performed on our two input datasets (gene counts and miRNA counts) separately</p>
<section id="genes" class="level3">
<h3 class="anchored" data-anchor-id="genes">Genes:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb12-2">dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_genes_filt,</span>
<span id="cb12-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb12-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
</div>
<p>Check size factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">SF.dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_genes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
</div>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_genes), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.  </span></span></code></pre></div>
</div>
<section id="pca" class="level4">
<h4 class="anchored" data-anchor-id="pca">PCA</h4>
<p>Keep in mind this is of both the genes and miRNAs. since there are vastly more genes than miRNAs, the PCA will be dictated by genes. for miRNas alone, see <code>03.10</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotPCA</span>(vsd_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intgroup =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ColonyID"</span>))</span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotPCA</span>(vsd_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intgroup =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Timepoint"</span>))</span></code></pre></div>
</div>
</section>
<section id="sample-clustering" class="level4">
<h4 class="anchored" data-anchor-id="sample-clustering">Sample clustering</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">sampleDists_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_genes))) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#calculate distance matrix</span></span>
<span id="cb16-2">sampleDistMatrix_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(sampleDists_genes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#distance matrix</span></span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(sampleDistMatrix_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_genes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign row names</span></span>
<span id="cb16-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(sampleDistMatrix_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign col names</span></span>
<span id="cb16-5">colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blues"</span>)) )(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign colors</span></span>
<span id="cb16-6"></span>
<span id="cb16-7">pht_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(sampleDistMatrix_genes, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#plot matrix</span></span>
<span id="cb16-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clustering_distance_rows=</span>sampleDists_genes, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#cluster rows</span></span>
<span id="cb16-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clustering_distance_cols=</span>sampleDists_genes, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#cluster columns</span></span>
<span id="cb16-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>colors) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set colors</span></span>
<span id="cb16-11"></span>
<span id="cb16-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(pht_genes)</span></code></pre></div>
</div>
</section>
</section>
<section id="mirna" class="level3">
<h3 class="anchored" data-anchor-id="mirna">miRNA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb17-2">dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_miRNA_filt,</span>
<span id="cb17-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb17-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
</div>
<p>Check size factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">SF.dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_miRNA) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
</div>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size. Using varianceStabilizingTransformation() instead of vst() because few input genes</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.  </span></span></code></pre></div>
</div>
<section id="pca-1" class="level4">
<h4 class="anchored" data-anchor-id="pca-1">PCA</h4>
<p>Keep in mind this is of both the genes and miRNAs. since there are vastly more genes than miRNAs, the PCA will be dictated by genes. for miRNas alone, see <code>03.10</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotPCA</span>(vsd_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intgroup =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ColonyID"</span>))</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotPCA</span>(vsd_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intgroup =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Timepoint"</span>))</span></code></pre></div>
</div>
</section>
<section id="sample-clustering-1" class="level4">
<h4 class="anchored" data-anchor-id="sample-clustering-1">Sample clustering</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">sampleDists_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA))) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#calculate distance matrix</span></span>
<span id="cb21-2">sampleDistMatrix_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(sampleDists_miRNA) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#distance matrix</span></span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(sampleDistMatrix_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_miRNA) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign row names</span></span>
<span id="cb21-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(sampleDistMatrix_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign col names</span></span>
<span id="cb21-5">colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blues"</span>)) )(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign colors</span></span>
<span id="cb21-6"></span>
<span id="cb21-7">pht_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(sampleDistMatrix_miRNA, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#plot matrix</span></span>
<span id="cb21-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clustering_distance_rows=</span>sampleDists_miRNA, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#cluster rows</span></span>
<span id="cb21-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clustering_distance_cols=</span>sampleDists_miRNA, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#cluster columns</span></span>
<span id="cb21-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>colors) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set colors</span></span>
<span id="cb21-11"></span>
<span id="cb21-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(pht_miRNA)</span></code></pre></div>
</div>
</section>
</section>
</section>
<section id="combine-counts-data" class="level2">
<h2 class="anchored" data-anchor-id="combine-counts-data">Combine counts data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract variance stabilized counts as dataframes</span></span>
<span id="cb22-2">datExpr_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_genes)))</span>
<span id="cb22-3">datExpr_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA)))</span>
<span id="cb22-4"></span>
<span id="cb22-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Double check the row names (sample names) are in same order</span></span>
<span id="cb22-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(datExpr_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(datExpr_miRNA)</span>
<span id="cb22-7"></span>
<span id="cb22-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine vst gene counts and vst miRNA counts by rows (sample names)</span></span>
<span id="cb22-9">datExpr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(datExpr_genes, datExpr_miRNA)</span></code></pre></div>
</div>
</section>
</section>
<section id="outlier-checks" class="level1">
<h1>Outlier checks</h1>
<p>Look for outliers by examining tree of samples</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">sampleTree <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hclust</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dist</span>(datExpr), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"average"</span>);</span>
<span id="cb23-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(sampleTree, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample clustering to detect outliers: genes"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex.lab =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex.axis =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex.main =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</div>
<p>Soft threshold selection. The soft thresholding power (β) is the number to which the co-expression similarity is raised to calculate adjacency. The function pickSoftThreshold performs a network topology analysis. The user chooses a set of candidate powers, however the default parameters are suitable values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">allowWGCNAThreads</span>()</span>
<span id="cb24-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Choose a set of soft-thresholding powers</span></span>
<span id="cb24-3">powers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Create a string of numbers from 1 through 10, and even numbers from 10 through 20</span></span>
<span id="cb24-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb24-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Call the network topology analysis function</span></span>
<span id="cb24-6">sft <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pickSoftThreshold</span>(datExpr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">powerVector =</span> powers, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
</div>
<p>Plot the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeGrWindow</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb25-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>));</span>
<span id="cb25-3">cex1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>;</span>
<span id="cb25-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # # Scale-free topology fit index as a function of the soft-thresholding power</span></span>
<span id="cb25-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sign</span>(sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb25-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Soft Threshold (power)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scale Free Topology Model Fit,signed R^2"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb25-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scale independence"</span>));</span>
<span id="cb25-8"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sign</span>(sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb25-9">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span>powers,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span>cex1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>);</span>
<span id="cb25-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # # this line corresponds to using an R^2 cut-off</span></span>
<span id="cb25-11"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb25-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # # Mean connectivity as a function of the soft-thresholding power</span></span>
<span id="cb25-13"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],</span>
<span id="cb25-14">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Soft Threshold (power)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Connectivity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb25-15">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean connectivity"</span>))</span>
<span id="cb25-16"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], sft<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitIndices[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span>powers, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span>cex1,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
</div>
<p>I used a scale-free topology fit index <strong>R^2 of 0.9</strong>. The lowest recommended R^2 by Langfelder and Horvath is 0.8. I chose 0.9 because we want to use the smallest soft thresholding power that maximizes with model fit. It appears that our <strong>soft thresholding power is 5</strong> because it is the lowest power above the R^2=0.9 threshold that maximizes with model fit. I will use a <strong>signed network</strong>.</p>
</section>
<section id="wgcna" class="level1">
<h1>WGCNA</h1>
<p>Now we’re ready to run WGCNA!</p>
<div class="cell" data-hash="2025_03_11_timeseries_WGCNA_cache/html/unnamed-chunk-24_53cac8f40db9ed20ae4a24d8b305d189">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">picked_power <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb26-2">temp_cor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cor       </span>
<span id="cb26-3">cor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WGCNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>cor         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Force it to use WGCNA cor function (fix a namespace conflict issue)</span></span>
<span id="cb26-4">netwk_Apul <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">blockwiseModules</span>(datExpr,                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;= input here</span></span>
<span id="cb26-5"></span>
<span id="cb26-6">                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># == Adjacency Function ==</span></span>
<span id="cb26-7">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">power =</span> picked_power,                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;= power here</span></span>
<span id="cb26-8">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">networkType =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"signed"</span>,</span>
<span id="cb26-9"></span>
<span id="cb26-10">                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># == Tree and Block Options ==</span></span>
<span id="cb26-11">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">deepSplit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb26-12">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pamRespectsDendro =</span> F,</span>
<span id="cb26-13">                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># detectCutHeight = 0.75,</span></span>
<span id="cb26-14">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">minModuleSize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb26-15">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxBlockSize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>,</span>
<span id="cb26-16"></span>
<span id="cb26-17">                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># == Module Adjustments ==</span></span>
<span id="cb26-18">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reassignThreshold =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>,</span>
<span id="cb26-19">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mergeCutHeight =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>,</span>
<span id="cb26-20"></span>
<span id="cb26-21">                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># == TOM == Archive the run results in TOM file (saves time)</span></span>
<span id="cb26-22">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveTOMs =</span> F,</span>
<span id="cb26-23">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveTOMFileBase =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ER"</span>,</span>
<span id="cb26-24"></span>
<span id="cb26-25">                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># == Output Options</span></span>
<span id="cb26-26">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numericLabels =</span> T,</span>
<span id="cb26-27">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb26-28"></span>
<span id="cb26-29"></span>
<span id="cb26-30">cor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> temp_cor     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return cor function to original namespace</span></span></code></pre></div>
</div>
<p>Take a look at dendrogram.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert labels to colors for plotting</span></span>
<span id="cb27-2">mergedColors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels2colors</span>(netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colors)</span>
<span id="cb27-3">labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colors)</span>
<span id="cb27-4">labels</span>
<span id="cb27-5"></span>
<span id="cb27-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the dendrogram and the module colors underneath</span></span>
<span id="cb27-7"></span>
<span id="cb27-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotDendroAndColors</span>(</span>
<span id="cb27-9">  netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dendrograms[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],</span>
<span id="cb27-10">  mergedColors[netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>blockGenes[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]],</span>
<span id="cb27-11">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Module colors"</span>,</span>
<span id="cb27-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dendroLabels =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb27-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hang =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>,</span>
<span id="cb27-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">addGuide =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb27-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guideHang =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span> )</span></code></pre></div>
</div>
<p>Show module number before and after merging.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>unmergedColors))</span>
<span id="cb28-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colors))</span></code></pre></div>
</div>
<p>There are 56 modules before merging to 85% similarity and 54 after.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">MEs<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MEs</span>
<span id="cb29-2">moduleLabels<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colors</span>
<span id="cb29-3">moduleColors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels2colors</span>(netwk_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colors)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get Module Eigengenes per cluster</span></span>
<span id="cb30-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># MEs0_Apul &lt;- moduleEigengenes(datExpr, mergedColors)$eigengenes</span></span>
<span id="cb30-3">mME_Apul <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moduleEigengenes</span>(datExpr, mergedColors)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>eigengenes</span>
<span id="cb30-4"></span>
<span id="cb30-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add treatment names</span></span>
<span id="cb30-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># MEs0_Apul$sample = row.names(MEs0_Apul)</span></span>
<span id="cb30-7">mME_Apul<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row.names</span>(mME_Apul)</span>
<span id="cb30-8"></span>
<span id="cb30-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join metadata to add timepoint to mME_Apul</span></span>
<span id="cb30-10">mME_Apul <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mME_Apul <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(metadata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample"</span>))</span>
<span id="cb30-12"></span>
<span id="cb30-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Order samples by timepoint</span></span>
<span id="cb30-14">timepoint_order <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP4"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Specify the desired order of timepoints</span></span>
<span id="cb30-15">mME_Apul <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mME_Apul <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(sample, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint, timepoint_order))]))</span>
<span id="cb30-17"></span>
<span id="cb30-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb30-19">mME_Apul <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb30-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sample, Timepoint), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure only eigengenes are reshaped</span></span>
<span id="cb30-21">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span>,</span>
<span id="cb30-22">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(., <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> sample, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradient2</span>(</span>
<span id="cb30-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>,</span>
<span id="cb30-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,</span>
<span id="cb30-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mid =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb30-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midpoint =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb30-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limit =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb30-32">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Module-trait Relationships"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Modules"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"corr"</span>)</span></code></pre></div>
</div>
</section>
<section id="characterize-genemirna-composition-of-modules" class="level1">
<h1>Characterize gene/miRNA composition of modules</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grab gene names and corresponding module colors</span></span>
<span id="cb31-2">module_info <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb31-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(datExpr),</span>
<span id="cb31-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">module =</span> moduleLabels</span>
<span id="cb31-5">)</span>
<span id="cb31-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Add ME to all the names</span></span>
<span id="cb31-7">module_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ME"</span>, module_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module)</span>
<span id="cb31-8"></span>
<span id="cb31-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(module_info)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to calculate the proportion of mRNAs (genes with "FUN" in ID)</span></span>
<span id="cb32-2">calculate_mRNA_proportion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(genes) {</span>
<span id="cb32-3">  total_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(genes)</span>
<span id="cb32-4">  mRNA_count <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, genes))</span>
<span id="cb32-5">  </span>
<span id="cb32-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Proportion of mRNAs</span></span>
<span id="cb32-7">  proportion_mRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mRNA_count <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_genes</span>
<span id="cb32-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(proportion_mRNA)</span>
<span id="cb32-9">}</span>
<span id="cb32-10"></span>
<span id="cb32-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Since there are so few miRNA, it may be more appropriate to calculate # of miRNA contained in a given module</span></span>
<span id="cb32-12">calculate_miRNA_num <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(genes) {</span>
<span id="cb32-13">  total_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(genes)</span>
<span id="cb32-14">  miRNA_count <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, genes))</span>
<span id="cb32-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(miRNA_count)</span>
<span id="cb32-16">}</span>
<span id="cb32-17"></span>
<span id="cb32-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply the functions to each module</span></span>
<span id="cb32-19">module_mRNA_proportion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tapply</span>(module_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene, </span>
<span id="cb32-20">                                 module_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module, </span>
<span id="cb32-21">                                 calculate_mRNA_proportion)</span>
<span id="cb32-22"></span>
<span id="cb32-23">module_miRNA_count <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tapply</span>(module_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene,</span>
<span id="cb32-24">                             module_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module,</span>
<span id="cb32-25">                             calculate_miRNA_num)</span>
<span id="cb32-26"></span>
<span id="cb32-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View the proportions</span></span>
<span id="cb32-28"></span>
<span id="cb32-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(module_miRNA_count[module_miRNA_count <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb32-30"></span>
<span id="cb32-31">module_miRNA_count</span></code></pre></div>
</div>
<p>19 of the 54 modules contain miRNA.</p>
<p>Module 0 contains almost half of the miRNA that were retained post-filtering (18/43). Keep in mind that the smaller the module number, the more genes it contains, so ME0 is one of the largest modules of coexpressed genes, and likely represents housekeeping function. It’s thus not surprising that many miRNAs also grouped there!</p>
<p>The remaining 25 miRNA were quite spread out, most were the only miRNA in their module, with a handful of modules containing 2-3 coexpressed miRNA.</p>
<p>Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make df of module sizes</span></span>
<span id="cb33-2">module_sizes_df<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(labels)</span>
<span id="cb33-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(module_sizes_df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>)</span>
<span id="cb33-4">module_sizes_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ME"</span>, module_sizes_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module)</span>
<span id="cb33-5"></span>
<span id="cb33-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># df of num. miRNA in each module</span></span>
<span id="cb33-7">module_miRNA_count_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(module_miRNA_count)</span>
<span id="cb33-8">module_miRNA_count_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(module_miRNA_count_df)</span>
<span id="cb33-9"></span>
<span id="cb33-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine and add column for num of genes in each module</span></span>
<span id="cb33-11">module_composition <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(module_sizes_df, module_miRNA_count_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span>)</span>
<span id="cb33-12">module_composition<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module_gene_count <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_composition<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>size <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> module_composition<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module_miRNA_count</span>
<span id="cb33-13"></span>
<span id="cb33-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># order by module size</span></span>
<span id="cb33-15">module_composition <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_composition <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(size)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">module =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(module, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> module))</span>
<span id="cb33-18"></span>
<span id="cb33-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to long format for stacking</span></span>
<span id="cb33-20">module_composition_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_composition <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(module_gene_count, module_miRNA_count), </span>
<span id="cb33-22">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>, </span>
<span id="cb33-23">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(type, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module_gene_count"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module_miRNA_count"</span>)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Order for stacking</span></span>
<span id="cb33-25">module_composition<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb33-26"></span>
<span id="cb33-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb33-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(module_composition_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> module, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> count, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> type)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> module_composition, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> module, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> size <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, </span>
<span id="cb33-31">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> module_miRNA_count), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Label miRNA count</span></span>
<span id="cb33-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module_gene_count"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module_miRNA_count"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>),</span>
<span id="cb33-33">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Genes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNAs"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Module"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Module Size"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stacked Barplot of Genes and miRNAs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
</div>
<p>Larger modules seem to be more likely to contain miRNA, which makes sense intuitively. However, the low number of total miRNA in comparison to the number of genes present means that miRNA don’t make up an appreciable proportion of any module.</p>
</section>
<section id="correlate-modules-to-each-other" class="level1">
<h1>Correlate modules to each other</h1>
<p>miRNAs are expected to either facilitate mRNA degradation or repress mRNA translation, both of which would result in a negative miRNA-mRNA relationship (more of an miRNA means less of its target mRNA(s)). WGCNA modules only group genes with similar expression patterns, so these inverse relationships would not be present within a single module. Instead, we need to find modules that are inversely related (have a strong, negative correlation).</p>
<p>Compute correlations between modules</p>
<ul>
<li>which correlation coefficient to use? I think WGCNA is based off of Pearson’s correlation coefficient…</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">btwn_module_cor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">corr.test</span>(MEs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adjust =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BH"</span>)</span>
<span id="cb34-2"></span>
<span id="cb34-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract correlation values and p-values</span></span>
<span id="cb34-4">btwn_module_cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> btwn_module_cor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Correlation coefficients</span></span>
<span id="cb34-5">btwn_module_p_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> btwn_module_cor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adjusted p-values</span></span></code></pre></div>
</div>
<p>Construct network</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set correlation and significance thresholds</span></span>
<span id="cb35-2">cor_threshold <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adjust based on desired stringency</span></span>
<span id="cb35-3">p_threshold <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb35-4"></span>
<span id="cb35-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert correlation matrix into an edge list</span></span>
<span id="cb35-6">significant_edges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(btwn_module_cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cor_threshold <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> btwn_module_p_matrix <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> p_threshold, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arr.ind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb35-7"></span>
<span id="cb35-8">edge_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb35-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">module_A =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(btwn_module_cor_matrix)[significant_edges[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],</span>
<span id="cb35-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">module_B =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(btwn_module_cor_matrix)[significant_edges[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]],</span>
<span id="cb35-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">correlation =</span> btwn_module_cor_matrix[significant_edges]</span>
<span id="cb35-12">)</span>
<span id="cb35-13"></span>
<span id="cb35-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Construct network graph</span></span>
<span id="cb35-15">network <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">graph_from_data_frame</span>(edge_list, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">directed =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb35-16"></span>
<span id="cb35-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># module_mRNA_proportion&lt;-as.data.frame(module_mRNA_proportion)</span></span>
<span id="cb35-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb35-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># V(apul_network)$prop_mrna &lt;- module_mRNA_proportion$module_mRNA_proportion[match(V(apul_network)$name, rownames(module_mRNA_proportion))]</span></span>
<span id="cb35-20"></span>
<span id="cb35-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add miRNA presence/absence to the network nodes</span></span>
<span id="cb35-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(network)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>has_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb35-23">  module_miRNA_count_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(network)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> module_miRNA_count_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module_miRNA_count <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb35-24">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No"</span></span>
<span id="cb35-25">)</span></code></pre></div>
</div>
<p>Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">plot1<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span>(network, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Force-directed layout</span></span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_link</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_color =</span> correlation), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_edge_link(aes(edge_alpha = correlation), show.legend = TRUE, width=2) +</span></span>
<span id="cb36-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_node_point(aes(colour=prop_mrna), size = 5) +</span></span>
<span id="cb36-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#scale_colour_gradient(name="Prop. mRNA", low = "purple", high = "cyan3")+</span></span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> has_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Color nodes based on miRNA presence</span></span>
<span id="cb36-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_edge_color_gradient2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mid =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yellow"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midpoint =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span id="cb36-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA Present"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> name), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repel =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A. pulchra mRNA-CpG Network"</span>);plot1</span></code></pre></div>
</div>
<p>Cool! In the above interaction network plot, each module is shown as a node. Modules that contain miRNA are black nodes, while gene-only modules are in grey. A line between two modules indicates the module eigengenes are significantly correlated, with a correlation coefficient magnitude of at least 0.7. Blue shading indicates positive correlation and red indicates negative correlation.</p>
<p>To look for potential miRNA-target mRNA interactions we’re looking for negative correlations where at least one module contains miRNA. I count roughly 20 of these!</p>
</section>
<section id="correlate-to-traits" class="level1">
<h1>Correlate to traits</h1>
<p>Ensure we’ve removed sample from expression data that is not present in physiological data. 1B9</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">phys<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Sample<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B2_ACR-173_TP3"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Sample<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B9_ACR-265_TP4"</span>)</span>
<span id="cb37-4"></span>
<span id="cb37-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(metadata_ordered<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample, phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample)</span>
<span id="cb37-6"></span>
<span id="cb37-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#all have 38 observations </span></span></code></pre></div>
</div>
<p>Create a physiological/factor dataset with sample in rows and phys data in columns (row name = Azenta sample name)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># phys$AzentaSampleName&lt;-metadata_ordered$AzentaSampleName[match(phys$Sample, metadata_ordered$Sample)]</span></span>
<span id="cb38-2"></span>
<span id="cb38-3">traits<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Sample, timepoint, site, Host_AFDW.mg.cm2, Sym_AFDW.mg.cm2, Am, Rd, Ik, Ic, AQY, cells.mgAFDW, Total_Chl, Ratio_AFDW.mg.cm2, Total_Chl_cell)</span>
<span id="cb38-5"></span>
<span id="cb38-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#time point</span></span>
<span id="cb38-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#site</span></span>
<span id="cb38-8">traits<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">site=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mahana"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, site)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">site=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Manava"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>, site))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timepoint=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, timepoint))</span>
<span id="cb38-12"></span>
<span id="cb38-13">traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint)</span>
<span id="cb38-14">traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>site<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>site)</span>
<span id="cb38-15"></span>
<span id="cb38-16">traits<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(traits)</span>
<span id="cb38-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(traits)<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span>
<span id="cb38-18"></span>
<span id="cb38-19">datTraits<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Sample)</span>
<span id="cb38-20"></span>
<span id="cb38-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#datTraits&lt;-datTraits%&gt;%select(!Timepoint)</span></span></code></pre></div>
</div>
<p>Add in temperature and light information for each time point from physiology manuscript. Note these have already been standardized for use in WGCNA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">env<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/environment_characteristics_RDA.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb39-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(mean_Temp_mean, mean_solar_rad_kwpm2_mean, cumulative_rainfall_mm_mean, timepoint) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb39-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timepoint=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>,</span>
<span id="cb39-4">                           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>,</span>
<span id="cb39-5">                                   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb39-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timepoint=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(timepoint))</span>
<span id="cb39-7"></span>
<span id="cb39-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#merge into datTraits</span></span>
<span id="cb39-9"></span>
<span id="cb39-10">datTraits<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(datTraits, env)</span>
<span id="cb39-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(datTraits)<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>traits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span>
<span id="cb39-12"></span>
<span id="cb39-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(datTraits)</span></code></pre></div>
</div>
<p>Finally, we want to identify modules that are significantly correlated with timepoint. Since correlation analysis wouldn’t identify non-linear relationships, we need to encode timepoint as 4 separate binomial variables (timepoint1 – yes/no?, timepoint2 – yes/no?, etc.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">datTraits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> datTraits <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb40-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timepoint1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(timepoint <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb40-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timepoint2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(timepoint <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb40-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timepoint3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(timepoint <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb40-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timepoint4 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(timepoint <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb40-7">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>timepoint)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">nGenes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(datExpr)</span>
<span id="cb41-2">nSamples <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(datExpr)</span>
<span id="cb41-3"></span>
<span id="cb41-4">nGenes</span>
<span id="cb41-5">nSamples</span></code></pre></div>
</div>
<p>Generate labels for module eigengenes as numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">MEs0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moduleEigengenes</span>(datExpr, moduleLabels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">softPower=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>eigengenes</span>
<span id="cb42-2">MEs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">orderMEs</span>(MEs0)</span>
<span id="cb42-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(MEs)</span></code></pre></div>
</div>
<p>Correlations of traits with eigengenes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">moduleTraitCor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(MEs, datTraits, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>);</span>
<span id="cb43-2">moduleTraitPvalue <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">corPvalueStudent</span>(moduleTraitCor, nSamples);</span>
<span id="cb43-3">Colors<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ME"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(MEs))</span>
<span id="cb43-4"></span>
<span id="cb43-5">moduleTraitTree <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hclust</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(moduleTraitCor)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"average"</span>)</span>
<span id="cb43-6"></span>
<span id="cb43-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pdf(file="D-Apul/output/11.00-Apul-WGCNA/ModuleTraitClusterTree.pdf")</span></span>
<span id="cb43-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(moduleTraitTree)</span>
<span id="cb43-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>
<p>Correlations of genes with eigengenes. Calculate correlations between ME’s and physiology/environmental variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">moduleGeneCor<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(MEs,datExpr)</span>
<span id="cb44-2">moduleGenePvalue <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">corPvalueStudent</span>(moduleGeneCor, nSamples);</span></code></pre></div>
</div>
<p>Calculate kME values (module membership).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">datKME <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">signedKME</span>(datExpr, MEs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">outputColumnName =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kME"</span>)</span>
<span id="cb45-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(datKME)</span></code></pre></div>
</div>
<p>Generate a complex heatmap of module-trait relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#bold sig p-values</span></span>
<span id="cb46-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#dendrogram with WGCNA MEtree cut-off</span></span>
<span id="cb46-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#colored y-axis</span></span>
<span id="cb46-4"></span>
<span id="cb46-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Create list of pvalues for eigengene correlation with specific physiology traits or environmental conditions</span></span>
<span id="cb46-6">heatmappval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">signif</span>(moduleTraitPvalue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb46-7"></span>
<span id="cb46-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Make list of heatmap row colors</span></span>
<span id="cb46-9">htmap.colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(MEs)</span>
<span id="cb46-10">htmap.colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ME"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, htmap.colors)</span>
<span id="cb46-11"></span>
<span id="cb46-12">row_dend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dendsort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hclust</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dist</span>(moduleTraitCor)))</span>
<span id="cb46-13">col_dend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dendsort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hclust</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(moduleTraitCor))))</span>
<span id="cb46-14"></span>
<span id="cb46-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pdf(file = "../output/12-Apul-miRNA-mRNA-WGCNA/Module-trait-relationship-heatmap.pdf", height = 14, width = 8)</span></span>
<span id="cb46-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Heatmap</span>(moduleTraitCor, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eigengene"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Module"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">column_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Module-Trait Eigengene Correlation"</span>, </span>
<span id="cb46-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">blueWhiteRed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>), </span>
<span id="cb46-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row_names_side =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, </span>
<span id="cb46-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#row_dend_side = "left",</span></span>
<span id="cb46-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"in"</span>), </span>
<span id="cb46-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"in"</span>), </span>
<span id="cb46-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#column_dend_reorder = TRUE, </span></span>
<span id="cb46-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#cluster_columns = col_dend,</span></span>
<span id="cb46-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row_dend_reorder =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb46-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#column_split = 6,</span></span>
<span id="cb46-26">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row_split=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb46-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#column_dend_height = unit(.5, "in"),</span></span>
<span id="cb46-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#column_order = lifestage_order, </span></span>
<span id="cb46-29">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> row_dend, </span>
<span id="cb46-30">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row_gap =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>), </span>
<span id="cb46-31">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb46-32">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cell_fun =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(j, i, x, y, w, h, col) {</span>
<span id="cb46-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(heatmappval[i, j] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) {</span>
<span id="cb46-34">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid.text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%s"</span>, heatmappval[i, j]), x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span>
<span id="cb46-35">        }</span>
<span id="cb46-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb46-37">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid.text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%s"</span>, heatmappval[i, j]), x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plain"</span>))</span>
<span id="cb46-38">        }},</span>
<span id="cb46-39">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">column_names_gp =</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb46-40">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">column_names_rot =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>,</span>
<span id="cb46-41">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row_names_gp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb46-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#draw(ht)</span></span>
<span id="cb46-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#dev.off()</span></span></code></pre></div>
</div>
<p>This plot is cool, but I’m a little skeptical of the results. No modules show significant relationship with timepoint, despite the PCAs showing a pretty clear clustering by timepoint…</p>
<p>Update 3/5/25: Cleared up why timepoint isn’t showing significant relationship, has to do with timepoint being a categorical variable that is encoded numerically (1-4) and this correlation analysis not picking up non-linear relationships. However, incorporation of environmental variables (temp, solar, etc.) for each timepoint essentially provides a set of time-dependent continuous variables, and these <em>are</em> showing significant relationships! mean temperature in particular shows significant correlation with <em>10</em> modules, including several <em>highly</em> significant correlations! Super cool!</p>
<p>Update 3/11/25: Encoded timepoints as 4 separate binomial columns, so that should take care of the original issue with numerically encoding timepoint. Interestingly, timepoints 2 and 3 have significantly correlated modules, but timepoints 1 and 4 don’t. This suggests the influence of timepoint stems largely from the temperature conditions, since a) timepoints 2 and 3 have the most “extreme” temperatures (in comparison to annual mean), and b) many of their correlated modules are also significantly correlated with temperature. Interestingly, timepoints 2 and 3 (March and September 2020) are actually extreme in opposite directions. March 2020 was the warmest timepoint and September was the coolest. If the two are correlated with very similar sets of gene modules, that suggests very similar expression pathways are used in response to both heat stress and cold stress in A.pulchra!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract modules with significant correlations</span></span>
<span id="cb47-2">heatmappval_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(heatmappval) </span>
<span id="cb47-3"></span>
<span id="cb47-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For mean temp</span></span>
<span id="cb47-5">MEs_signif_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(heatmappval_df[heatmappval_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mean_Temp_mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,])</span></code></pre></div>
</div>
<p>We can also compare to our module interaction plot to find modules that are both correlated with temperature and potentially involved in miRNA-mRNA interactions! Modules 19, 42, 1, 6, 15, 7, 2, are both significantly correlated with temperature <em>and</em> have negative module-module interactions that involve at least 1 module that contains miRNA.</p>
</section>
<section id="plot-eigengene-values" class="level1">
<h1>Plot eigengene values</h1>
<p>View module eigengene data and make dataframe for Strader plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(MEs)</span>
<span id="cb48-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(MEs)</span>
<span id="cb48-3">Eigen_MEs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MEs</span>
<span id="cb48-4">Eigen_MEs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Eigen_MEs)</span>
<span id="cb48-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(Eigen_MEs)</span>
<span id="cb48-6"></span>
<span id="cb48-7">plotTraits<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>datTraits</span>
<span id="cb48-8">plotTraits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(plotTraits)</span>
<span id="cb48-9"></span>
<span id="cb48-10">Eigen_MEs<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Eigen_MEs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb48-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">droplevels</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#drop unused level</span></span>
<span id="cb48-12"></span>
<span id="cb48-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(Eigen_MEs)</span>
<span id="cb48-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(Eigen_MEs)</span></code></pre></div>
</div>
<p>Plot mean module eigengene for each module.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#convert wide format to long format for plotting  </span></span>
<span id="cb49-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(Eigen_MEs)</span>
<span id="cb49-3"></span>
<span id="cb49-4">plot_MEs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Eigen_MEs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb49-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb49-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select only numeric columns</span></span>
<span id="cb49-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Module"</span>,       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Name for the new column containing the column names</span></span>
<span id="cb49-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean"</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Name for the new column containing the values</span></span>
<span id="cb49-9">  )</span>
<span id="cb49-10"></span>
<span id="cb49-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(plot_MEs)</span>
<span id="cb49-12"></span>
<span id="cb49-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#join with phys data </span></span>
<span id="cb49-14">plot_MEs<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(plot_MEs, plotTraits)</span>
<span id="cb49-15"></span>
<span id="cb49-16">expression_plots<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>plot_MEs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb49-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Module) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb49-18">  </span>
<span id="cb49-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>mean_Temp_mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Mean)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb49-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Module)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb49-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb49-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_smooth(method="lm")+</span></span>
<span id="cb49-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The loess method can capture nonlinear trends</span></span>
<span id="cb49-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb49-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(-0.5,1) +</span></span>
<span id="cb49-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb49-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb49-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set x-axis label size</span></span>
<span id="cb49-29">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set x-axis title size</span></span>
<span id="cb49-30">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#No x-label ticks</span></span>
<span id="cb49-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#axis.title.y=element_blank(), #No y-axis title</span></span>
<span id="cb49-32">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set y-axis label size, </span></span>
<span id="cb49-33">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set border</span></span>
<span id="cb49-34">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set major gridlines</span></span>
<span id="cb49-35">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set minor gridlines</span></span>
<span id="cb49-36">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set axes color</span></span>
<span id="cb49-37">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb49-38">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>)); expression_plots</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now just plot the modules that are significantly correlated with temp</span></span>
<span id="cb50-2">plot_MEs_signif_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> plot_MEs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb50-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> MEs_signif_temp)</span>
<span id="cb50-4"></span>
<span id="cb50-5"></span>
<span id="cb50-6">expression_plots<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>plot_MEs_signif_temp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb50-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Module) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb50-8">  </span>
<span id="cb50-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>mean_Temp_mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Mean)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Module)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_smooth(method="lm")+</span></span>
<span id="cb50-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the loess method can capture nonlinear trends</span></span>
<span id="cb50-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(-0.5,1) +</span></span>
<span id="cb50-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb50-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb50-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set x-axis label size</span></span>
<span id="cb50-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set x-axis title size</span></span>
<span id="cb50-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#No x-label ticks</span></span>
<span id="cb50-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#axis.title.y=element_blank(), #No y-axis title</span></span>
<span id="cb50-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set y-axis label size, </span></span>
<span id="cb50-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#set border</span></span>
<span id="cb50-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set major gridlines</span></span>
<span id="cb50-25">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set minor gridlines</span></span>
<span id="cb50-26">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set axes color</span></span>
<span id="cb50-27">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb50-28">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>)); expression_plots</span></code></pre></div>
</div>
</section>
<section id="export-to-cytoscape" class="level1">
<h1>Export to Cytoscape</h1>
<p>Export modules of interest for network visualization</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1">MEs_signif_temp</span></code></pre></div>
</div>
<p>Note that, due to the size of many modules, it’s probably most practical to export modules individually (unless interested in in connections between modules)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Recalculate topological overlap if needed</span></span>
<span id="cb52-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># TOM = TOMsimilarityFromExpr(datExpr, power = 5);</span></span>
<span id="cb52-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   # Read in the annotation file</span></span>
<span id="cb52-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># annot = datTraits;</span></span>
<span id="cb52-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for(i in seq_along(MEs_signif_temp)) {</span></span>
<span id="cb52-6"></span>
<span id="cb52-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   # Select modules</span></span>
<span id="cb52-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   modules = MEs_signif_temp[i];</span></span>
<span id="cb52-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   # Select module probes</span></span>
<span id="cb52-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   probes = names(datExpr)</span></span>
<span id="cb52-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   inModule = is.finite(match(moduleLabels, modules));</span></span>
<span id="cb52-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   modProbes = probes[inModule];</span></span>
<span id="cb52-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   # modGenes = annot$gene_symbol[match(modProbes, annot$substanceBXH)];</span></span>
<span id="cb52-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   # Select the corresponding Topological Overlap</span></span>
<span id="cb52-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   modTOM = TOM[inModule, inModule];</span></span>
<span id="cb52-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   dimnames(modTOM) = list(modProbes, modProbes)</span></span>
<span id="cb52-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   # Export the network into edge and node list files Cytoscape can read</span></span>
<span id="cb52-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   cyt = exportNetworkToCytoscape(modTOM,</span></span>
<span id="cb52-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     edgeFile = paste("CytoscapeInput-edges-", paste(modules, collapse="-"), ".txt", sep=""),</span></span>
<span id="cb52-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     nodeFile = paste("CytoscapeInput-nodes-", paste(modules, collapse="-"), ".txt", sep=""),</span></span>
<span id="cb52-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     weighted = TRUE,</span></span>
<span id="cb52-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     threshold = 0.02,</span></span>
<span id="cb52-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     nodeNames = modProbes,</span></span>
<span id="cb52-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     # altNodeNames = modGenes,</span></span>
<span id="cb52-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     nodeAttr = moduleLabels[inModule]);</span></span>
<span id="cb52-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># }</span></span>
<span id="cb52-27"></span>
<span id="cb52-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recalculate topological overlap if needed</span></span>
<span id="cb52-29">  TOM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">TOMsimilarityFromExpr</span>(datExpr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">power =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>);</span>
<span id="cb52-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in the annotation file</span></span>
<span id="cb52-31">  annot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> datTraits;</span>
<span id="cb52-32">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select modules</span></span>
<span id="cb52-33">  modules <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"45"</span>;</span>
<span id="cb52-34">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select module probes</span></span>
<span id="cb52-35">  probes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(datExpr)</span>
<span id="cb52-36">  inModule <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.finite</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(moduleLabels, modules));</span>
<span id="cb52-37">  modProbes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> probes[inModule];</span>
<span id="cb52-38">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># modGenes = annot$gene_symbol[match(modProbes, annot$substanceBXH)];</span></span>
<span id="cb52-39">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select the corresponding Topological Overlap</span></span>
<span id="cb52-40">  modTOM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> TOM[inModule, inModule];</span>
<span id="cb52-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dimnames</span>(modTOM) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(modProbes, modProbes)</span>
<span id="cb52-42">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Export the network into edge and node list files Cytoscape can read</span></span>
<span id="cb52-43">  cyt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exportNetworkToCytoscape</span>(modTOM,</span>
<span id="cb52-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edgeFile =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CytoscapeInput-edges-"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(modules, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb52-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nodeFile =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CytoscapeInput-nodes-"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(modules, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb52-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weighted =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb52-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshold =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,</span>
<span id="cb52-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nodeNames =</span> modProbes,</span>
<span id="cb52-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># altNodeNames = modGenes,</span></span>
<span id="cb52-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nodeAttr =</span> moduleLabels[inModule]);</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb53-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Move cytoscape files to output directory</span></span>
<span id="cb53-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mv</span> ./CytoscapeInput<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> ../output/12-Apul-miRNA-mRNA-WGCNA</span></code></pre></div>
</div>
<p>To load network to Cytoscape:</p>
<ol type="1">
<li><p>File -&gt; Import -&gt; Network from File…</p></li>
<li><p>Select Edges file (created above)</p></li>
<li><p>Assign fromNode to “Source Node,” toNode to “Target Node,” weight to “Edge Attribute,” and direction to “Interaction Type”</p></li>
<li><p>Once netwrok is loaded, can manipulate/style as desired.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print session info</span></span>
<span id="cb54-2">sessioninfo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">session_info</span>()</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_03_11_timeseries_WGCNA.html</guid>
  <pubDate>Tue, 11 Mar 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-dive expression: A.pul miRanda comparisons</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_13_deepdive_miRanda_comparisons.html</link>
  <description><![CDATA[ 




<p>Up to this point, our miRNA target prediction has been primarily performed using the tool miRanda, which requires only seed binding, with 3’UTR regions as input. However, there is growing evidence that cnidarian miRNA binding functions similarly to plants, requiring near-full complementarity and to act primarily through target cleavage, which can occur at any location in the mRNA sequence (not just the 3’UTR). This would mean our current miRanda target predictions are both a) not sufficiently restricted to fll complementarity, and b) incorrectly limited to the 3’UTR.</p>
<p>I check what happens when we adjust those parameters</p>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>How does different input and/or complementarity filtering affect # putative interactions:</p>
<table class="table">
<thead>
<tr class="header">
<th>Input</th>
<th>unfiltered</th>
<th>filtered for complementarity</th>
<th>% retained</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3'UTR</td>
<td>6109</td>
<td>13</td>
<td>0.213 %</td>
</tr>
<tr class="even">
<td>full mRNA</td>
<td>19133057</td>
<td>143</td>
<td>0.000747 %</td>
</tr>
</tbody>
</table>
<p>For different filters, how many putative interactions <em>also show significant coexpression</em>?</p>
<table class="table">
<thead>
<tr class="header">
<th>Input</th>
<th>21bp</th>
<th>21bp, &gt;=3 mismatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3'UTR</td>
<td>58 (3.4% of all 21bp)</td>
<td>0</td>
</tr>
<tr class="even">
<td>full mRNA</td>
<td>3767 (3.7% of all 21bp)</td>
<td>6 (4.2% of all 21bp,&gt;=3mis)</td>
</tr>
</tbody>
</table>
<p>Note that, in general, only ~1/3 of significant coexpressions have a <em>negative</em> relationship (which would support functional target cleavage)</p>
<p>Note also that some putative interactions examined above weren't included in the PCC table</p>
<p>Next steps:</p>
<ul>
<li><p>discuss w team – should we look for both miRNAs that function through target cleavage (full complementary, full coding sequence) <em>and</em> miRNAs that function through "canonical" translational silencing (seed complementarity, 3'UTR)?</p></li>
<li><p>Run same comparison using BLAST and/or RNAhybrid as the tool. I'm still not 100% clear on what sequence features miRanda takes into consideration, and any that <em>are</em> included will have been based on mammalian miRNAs. It may be more appropriate to use a different tool</p></li>
<li><p>if we decide to shift target prediction requirements, need to rerun all target prediction done thus far :(</p></li>
</ul>
<p>Code included below</p>
</section>
<section id="apul-miranda-input-comparisons" class="level1">
<h1><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/24-Apul-miRanda-input-comparisons.md">24-Apul-miRanda-input-comparisons</a></h1>
</section>
<section id="mirna-and-full-mrna-coding-sequences" class="level1">
<h1>1 miRNA and full mRNA coding sequences</h1>
<p>Inputs:</p>
<ul>
<li><p>FASTA of A.pulchra mRNA coding sequences</p></li>
<li><p>FASTA of A.pulchra mature miRNAs</p></li>
</ul>
<section id="get-mrna-fasta" class="level2">
<h2 class="anchored" data-anchor-id="get-mrna-fasta">1.1 Get mRNA fasta</h2>
<pre><code>/home/shared/bedtools2/bin/bedtools getfasta \ -fi "../data/Apulchra-genome.fa" \ -bed "../data/Apulcra-genome-mRNA_only.gff" \ -fo "../data/24-Apul-miRanda-input-comparisons/Apul_mRNA_full.fa"</code></pre>
</section>
<section id="run-miranda" class="level2">
<h2 class="anchored" data-anchor-id="run-miranda">1.2 Run miRanda</h2>
<pre><code># Same settings we've been using:  # score cutoff &gt;100 # energy cutoff &lt;-10 # strict binding  /home/shared/miRanda-3.3a/src/miranda \ ../output/17-Apul-miRNA-lncRNA-BLASTs-RNAhybrid/Apul_ShortStack_4.1.0_mature.fasta \ ../data/24-Apul-miRanda-input-comparisons/Apul_mRNA_full.fa \ -sc 100 \ -en -10 \ -strict \ -out ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab</code></pre>
</section>
<section id="summarize-results" class="level2">
<h2 class="anchored" data-anchor-id="summarize-results">1.3 Summarize results</h2>
<p>Let's look at the output</p>
<pre><code>echo "miranda run finished!" echo "Counting number of interacting miRNA-lncRNA pairs"  zgrep -c "Performing Scan" ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab  echo "Parsing output" grep -A 1 "Scores for this hit:" ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab | sort | grep '&gt;' &gt; ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt  echo "counting number of putative interactions predicted (can include multiple interactions between single miRNA-lncRNA pair)" wc -l ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab</code></pre>
<pre><code>## miranda run finished! ## Counting number of interacting miRNA-lncRNA pairs ## 1421433 ## Parsing output ## counting number of putative interactions predicted (can include multiple interactions between single miRNA-lncRNA pair) ## 19133057 ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab </code></pre>
<p>This is a lot of putative interactions! Note though, that miRanda only requires complementarity of a 8bp seed region of the miRNA. We instead want to look for binding with full or near-full complementarity. Let's look at how many putative interactions are predicted for a binding length of at least 21 nucleotides (the length of our smallest mature miRNA).</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides ## 101744 ##  ## check some: ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10104556-10114024  154.00  -19.94  2 21    1466 1493   25  68.00%  72.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10104556-10114024  155.00  -21.12  2 21    8084 8107   21  66.67%  76.19% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10351674-10369781  147.00  -17.81  2 21    2265 2289   22  59.09%  72.73% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10392093-10402892  157.00  -20.28  2 21    4608 4632   22  77.27%  77.27% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10597160-10611657  159.00  -19.58  2 21    7110 7133   21  71.43%  76.19% </code></pre>
<p>The header for this output is formatted as:</p>
<p>mirna Target Score Energy-Kcal/Mol Query-Aln(start-end) Subject-Al(Start-End) Al-Len Subject-Identity Query-Identity</p>
<p>We can see from the percent identities (last 2 entries) that this number includes alignments with multiple mismatches. Let's filter again to reduce the number of permissible mismatches. Let's say we want no more than 3 mismatches (a gap is counted as a mismatch). For an alignment of 21 nucleotides, this would be an percent identity of (21-3)/21 = 85.7%. The miRNA is our "subject", so we will filter by column 8.</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides, with at most 3 mismatches" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | awk -F'\t' '$8 &gt;= 85' | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | awk -F'\t' '$8 &gt;= 85' | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides, with at most 3 mismatches ## 143 ##  ## check some: ## &gt;Cluster_10057.mature::ptg000016l:8599884-8599905(-) ptg000017l:7171736-7192592  174.00  -21.36  2 21    13035 13058 21  85.71%  85.71% ## &gt;Cluster_10093.mature::ptg000016l:11751407-11751428(-)   ptg000007l:5326404-5332924  179.00  -25.97  2 21    658 681 21  85.71%  85.71% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) ntLink_8:9921794-9928534    179.00  -26.55  2 22    872 896 22  86.36%  86.36% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) ptg000019l:1503591-1507594  188.00  -31.70  2 22    3554 3577   21  85.71%  95.24% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) ptg000039l:790628-797014    188.00  -25.92  2 22    5693 5716   21  90.48%  90.48% </code></pre>
<p>So filtering for full or near-full complementarity reduced the number of putative interactions between miRNA and full mRNA sequences from 19133057 to 143.</p>
</section>
</section>
<section id="mirna-and-mrna-3utrs" class="level1">
<h1>2 miRNA and mRNA 3'UTRs</h1>
<p>Now let's see how filtering changes the outputs of miRanda run with only the 3'UTR mRNA region (the input we have been using up till now)</p>
<p>Unfiltered:</p>
<pre><code>wc -l ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt</code></pre>
<pre><code>## 6109 ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt </code></pre>
<p>Filter for alignment &gt;=21 nucleotides:</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides ## 1699 ##  ## check some: ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_002849::ntLink_8:6882212-6883212    158.00  -21.97  2 21    278 301 21  66.67%  85.71% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_018974::ptg000012l:15854445-15855445    155.00  -23.11  2 21    894 920 24  62.50%  75.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_019124::ptg000012l:17452953-17453953    147.00  -22.09  2 21    783 810 25  60.00%  68.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_023335::ptg000017l:6446983-6447355  150.00  -22.25  2 21    171 197 24  62.50%  75.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_024352::ptg000018l:5339775-5340775  162.00  -20.97  2 21    96 122  24  75.00%  75.00% </code></pre>
<p>Filter again for &lt;=3 mismatches:</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides, with at most 3 mismatches" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | awk -F'\t' '$8 &gt;= 85' | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | awk -F'\t' '$8 &gt;= 85' | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides, with at most 3 mismatches ## 13 ##  ## check some: ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) FUN_022919::ptg000017l:1483036-1484036  183.00  -28.35  2 22    69 94   23  86.96%  86.96% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) FUN_027647::ptg000021l:8285525-8286525  174.00  -25.86  2 21    101 125 21  85.71%  85.71% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) FUN_040282::ptg000031l:6265207-6266207  183.00  -30.15  2 21    525 550 22  86.36%  86.36% ## &gt;Cluster_10419.mature::ptg000018l:2286829-2286850(+) FUN_016674::ptg000011l:6193740-6194740  174.00  -21.33  2 21    904 927 21  85.71%  85.71% ## &gt;Cluster_15775.mature::ptg000025l:7472581-7472603(-) FUN_022318::ptg000016l:7511874-7512874  180.00  -21.41  2 22    573 596 21  85.71%  85.71% </code></pre>
<p>When only mRNA 3'UTR regions are used as input, filtering for full/near-full complementarity reduces the number of putative interactions from 6109 to 13.</p>
</section>
<section id="examine-coexpression" class="level1">
<h1>3 Examine coexpression</h1>
<p>Now that we've found putative interactions with high complementarity, we need to validate miRNA function by examining patterns of coexpression. We'd expect a putatively-interacting miRNA-mRNA pair to be highly coexpressed, and we'd expect a negative relationship to indicate target cleavage.</p>
<section id="full-mrna" class="level2">
<h2 class="anchored" data-anchor-id="full-mrna">3.1 full mRNA</h2>
<pre><code>library(readr) library(dplyr)</code></pre>
<pre><code>##  ## Attaching package: 'dplyr'  ## The following objects are masked from 'package:stats': ##  ##     filter, lag  ## The following objects are masked from 'package:base': ##  ##     intersect, setdiff, setequal, union </code></pre>
<pre><code># Read in data  # miRNA-mRNA Pearsons correlation coefficients miRNA_mRNA_PCC &lt;- read.csv("../output/09-Apul-mRNA-miRNA-interactions/Apul-PCC_miRNA_mRNA.csv")  # miRNA-mRNA_full miRanda output miRNA_mRNA_miRanda &lt;- read_delim("../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt", col_names=FALSE)</code></pre>
<pre><code>## Rows: 617982 Columns: 9  ## ── Column specification ──────────────────────────────────────────────────────── ## Delimiter: "\t" ## chr (6): X1, X2, X5, X6, X8, X9 ## dbl (3): X3, X4, X7 ##  ## ℹ Use `spec()` to retrieve the full column specification for this data. ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. </code></pre>
<pre><code>colnames(miRNA_mRNA_miRanda) &lt;- c("mirna", "Target", "Score", "Energy_Kcal_Mol", "Query_Aln", "Subject_Aln", "Al_Len", "Subject_Identity", "Query_Identity")  # format miRNA and mRNA names geneIDs &lt;- read_delim("../output/15-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt", col_names=FALSE)</code></pre>
<pre><code>## Rows: 36447 Columns: 5 ## ── Column specification ──────────────────────────────────────────────────────── ## Delimiter: "\t" ## chr (5): X1, X2, X3, X4, X5 ##  ## ℹ Use `spec()` to retrieve the full column specification for this data. ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. </code></pre>
<pre><code>geneIDs$X4 &lt;- gsub("Parent=", "", geneIDs$X4)  miRNA_mRNA_miRanda$mirna &lt;- gsub("&gt;", "", miRNA_mRNA_miRanda$mirna) miRNA_mRNA_miRanda$mirna &lt;- gsub("\\..*", "", miRNA_mRNA_miRanda$mirna)  miRNA_mRNA_miRanda &lt;- left_join(miRNA_mRNA_miRanda, geneIDs, by=c("Target" = "X1")) miRNA_mRNA_miRanda &lt;- select(miRNA_mRNA_miRanda, -X2,-X3,-X5)  # Finally, create a column that conatins both the miRNA and interacting mRNA miRNA_mRNA_PCC$interaction &lt;- paste(miRNA_mRNA_PCC$miRNA, "_", miRNA_mRNA_PCC$mRNA) miRNA_mRNA_miRanda$interaction &lt;- paste(miRNA_mRNA_miRanda$mirna, "_", miRNA_mRNA_miRanda$X4)  # Annotate w PCC info  miRNA_mRNA_miRanda &lt;- left_join(miRNA_mRNA_miRanda, miRNA_mRNA_PCC, by="interaction")</code></pre>
<pre><code># Filter to high complementarity putative targets target_21bp &lt;- miRNA_mRNA_miRanda[miRNA_mRNA_miRanda$Al_Len &gt; 20,] target_21bp_3mis &lt;- target_21bp[target_21bp$Subject_Identity&gt;85,]  # How many w significant correlation? nrow(target_21bp %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 3787 </code></pre>
<pre><code>nrow(target_21bp %&gt;% filter(p_value &lt; 0.05))/nrow(target_21bp)</code></pre>
<pre><code>## [1] 0.03722087 </code></pre>
<pre><code>nrow(target_21bp_3mis %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 6 </code></pre>
<pre><code>nrow(target_21bp_3mis %&gt;% filter(p_value &lt; 0.05))/nrow(target_21bp_3mis)</code></pre>
<pre><code>## [1] 0.04195804 </code></pre>
<pre><code># Plot correlation values hist(target_21bp$PCC.cor)</code></pre>
<pre><code>hist(target_21bp[target_21bp$p_value &lt; 0.05,]$PCC.cor)</code></pre>
<pre><code>hist(target_21bp_3mis$PCC.cor)</code></pre>
<pre><code>hist(target_21bp_3mis[target_21bp_3mis$p_value &lt; 0.05,]$PCC.cor)</code></pre>
</section>
<section id="utr" class="level2">
<h2 class="anchored" data-anchor-id="utr">3.2 3'UTR</h2>
<pre><code># Read in data  # miRNA-mRNA_full miRanda output miRNA_3UTR_miRanda &lt;- read_delim("../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt", col_names=FALSE)</code></pre>
<pre><code>## Rows: 6109 Columns: 9 ## ── Column specification ──────────────────────────────────────────────────────── ## Delimiter: "\t" ## chr (6): X1, X2, X5, X6, X8, X9 ## dbl (3): X3, X4, X7 ##  ## ℹ Use `spec()` to retrieve the full column specification for this data. ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. </code></pre>
<pre><code>colnames(miRNA_3UTR_miRanda) &lt;- c("mirna", "Target", "Score", "Energy_Kcal_Mol", "Query_Aln", "Subject_Aln", "Al_Len", "Subject_Identity", "Query_Identity")  miRNA_3UTR_miRanda$mirna &lt;- gsub("&gt;", "", miRNA_3UTR_miRanda$mirna) miRNA_3UTR_miRanda$mirna &lt;- gsub("\\..*", "", miRNA_3UTR_miRanda$mirna) miRNA_3UTR_miRanda$Target &lt;- gsub("::.*", "", miRNA_3UTR_miRanda$Target)  # Finally, create a column that conatins both the miRNA and interacting mRNA miRNA_3UTR_miRanda$interaction &lt;- paste(miRNA_3UTR_miRanda$mirna, "_", miRNA_3UTR_miRanda$Target)  # Annotate w PCC info  miRNA_3UTR_miRanda &lt;- left_join(miRNA_3UTR_miRanda, miRNA_mRNA_PCC, by="interaction")</code></pre>
<pre><code># Filter to high complementarity putative targets target_3UTR_21bp &lt;- miRNA_3UTR_miRanda[miRNA_3UTR_miRanda$Al_Len &gt; 20,] target_3UTR_21bp_3mis &lt;- target_3UTR_21bp[target_3UTR_21bp$Subject_Identity&gt;85,]  # How many w significant correlation? nrow(target_3UTR_21bp %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 58 </code></pre>
<pre><code>nrow(target_3UTR_21bp %&gt;% filter(p_value &lt; 0.05))/nrow(target_3UTR_21bp)</code></pre>
<pre><code>## [1] 0.03413773 </code></pre>
<pre><code>nrow(target_3UTR_21bp_3mis %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 0 </code></pre>
<pre><code>nrow(target_3UTR_21bp_3mis %&gt;% filter(p_value &lt; 0.05))/nrow(target_3UTR_21bp_3mis)</code></pre>
<pre><code>## [1] 0 </code></pre>
<pre><code># Plot correlation values hist(target_3UTR_21bp$PCC.cor)</code></pre>
<pre><code>hist(target_3UTR_21bp[target_3UTR_21bp$p_value &lt; 0.05,]$PCC.cor)</code></pre>
<pre><code># hist(target_3UTR_21bp_3mis$PCC.cor) # hist(target_3UTR_21bp_3mis[target_3UTR_21bp_3mis$p_value &lt; 0.05,]$PCC.cor)</code></pre>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_13_deepdive_miRanda_comparisons.html</guid>
  <pubDate>Thu, 13 Feb 2025 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-dive expression: Gene expression summary (for Hisat gene counts)</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_07_deepdive_Apul_Hisat_RNAsummary.html</link>
  <description><![CDATA[ 




<p>Generating update summary of Apul gene expression using counts generated through Hisat with the <em>A.pulchra</em> genome. (Existing summary used counts summarized using kallisto and the <em>A.millipora</em> transcriptome)</p>
<p>Code recorded below in case github links change.</p>
<p><strong>Total gene counts (normalized):</strong></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.01-Apul-RNA-summary-Hisat_files/figure-gfm/norm-transcript-counts-plot-1.png" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.01-Apul-RNA-summary-Hisat_files/figure-gfm/norm-expression-level-histograms-1.png" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.01-Apul-RNA-summary-Hisat_files/figure-gfm/PCA-1.png" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.01-Apul-RNA-summary-Hisat_files/figure-gfm/sample-clustering-1.png" class="img-fluid"></p>
<section id="apul-rna-summary-hisat" class="level1">
<h1><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/03.01-Apul-RNA-summary-Hisat.md#15-most-common-biological-processes">03.01-Apul-RNA-summary-Hisat</a></h1>
<p>Gene expression summary for <em>Acropora pulchra</em> RNA-seq data.</p>
<ul>
<li><p>trimmed reads generated in <code>deep-dive</code> project, trimming and QC details in <code>01-Apul-RNA-trimming-FastQC</code></p></li>
<li><p>Reads aligned to <em>Acropora pulchra</em> genome (unpub)</p></li>
<li><p>Count matrix generated in <code>07-Apul-Hisat</code></p></li>
</ul>
<section id="install-and-load-packages" class="level3">
<h3 class="anchored" data-anchor-id="install-and-load-packages">0.0.1 Install and load packages</h3>
<pre><code>library(tidyverse) library(ggplot2) library(reshape2) library(magrittr) library(DESeq2) library(RColorBrewer) library(pheatmap)</code></pre>
</section>
</section>
<section id="unnormalized-data" class="level1">
<h1>1 Unnormalized data</h1>
<section id="load-count-data" class="level2">
<h2 class="anchored" data-anchor-id="load-count-data">1.1 Load count data</h2>
<p>Load in and format the count matrix.</p>
<pre><code># Read in counts data. This is a gene-level counts matrix generated from kallisto transcript abundances using Trinity Apul_counts_RNA_OG &lt;- read_delim("../output/07-Apul-Hisat/Apul-gene_count_matrix.csv")  head(Apul_counts_RNA_OG)</code></pre>
<pre><code># A tibble: 6 × 6   gene_id  `RNA-ACR-140` `RNA-ACR-145` `RNA-ACR-150` `RNA-ACR-173` `RNA-ACR-178`   &lt;chr&gt;            &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt; 1 FUN_035…           553           340           256           485           510 2 FUN_035…          2486           775           743          1250          1092 3 FUN_035…            46             6            25            41            29 4 FUN_035…           183           252            48            78            73 5 FUN_035…          1519           311           555           990           370 6 FUN_035…          1764          1297          1035          1763          1360 </code></pre>
<pre><code># Read in ID mapping of A.pulchra mRNA and associated functional annotations Apul_IDmapping &lt;- read_delim("../output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab") %&gt;%   select(-...1) head(Apul_IDmapping)</code></pre>
<pre><code># A tibble: 6 × 7   V1                V3         V13 Protein.names Organism Gene.Ontology..biolo…¹   &lt;chr&gt;             &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;                  1 ntLink_4:1155-15… P350… 4.96e-86 Histone H2A   Acropor… &lt;NA&gt;                   2 ntLink_4:2660-34… P842… 5.03e-93 Histone H3    Urechis… &lt;NA&gt;                   3 ntLink_4:4515-68… P350… 6.65e-78 Histone H2A   Acropor… &lt;NA&gt;                   4 ntLink_4:7096-78… P842… 4.03e-93 Histone H3    Urechis… &lt;NA&gt;                   5 ntLink_4:8474-96… P350… 7.49e-82 Histone H2A   Acropor… &lt;NA&gt;                   6 ntLink_4:11162-1… P842… 4.03e-93 Histone H3    Urechis… &lt;NA&gt;                   # ℹ abbreviated name: ¹​Gene.Ontology..biological.process. # ℹ 1 more variable: Gene.Ontology.IDs &lt;chr&gt; </code></pre>
<pre><code># Read in table that associates each mRNA genomic location with it's gene ID Apul_geneIDs &lt;- read_delim("../output/15-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt", col_names = FALSE) %&gt;%   select(X1,X4) Apul_geneIDs$X4 &lt;- gsub("Parent=","",Apul_geneIDs$X4) head(Apul_geneIDs)</code></pre>
<pre><code># A tibble: 6 × 2   X1                   X4           &lt;chr&gt;                &lt;chr&gt;      1 ntLink_0:1104-7056   FUN_000001 2 ntLink_0:10214-15286 FUN_000002 3 ntLink_0:32056-33275 FUN_000003 4 ntLink_0:34823-42794 FUN_000004 5 ntLink_0:45952-51024 FUN_000005 6 ntLink_0:61628-78213 FUN_000006 </code></pre>
</section>
<section id="count-data-munging" class="level2">
<h2 class="anchored" data-anchor-id="count-data-munging">1.2 Count data munging</h2>
<pre><code># We need to modify this data frame so that the row names are actually row names, instead of comprising the first column Apul_counts_RNA &lt;- Apul_counts_RNA_OG %&gt;%   column_to_rownames(var = "gene_id")  # Additional formatting # Round all estimated counts to integers Apul_counts_RNA &lt;- round(Apul_counts_RNA, digits = 0)  # Remove all transcripts with 5 or fewer counts in all samples Apul_counts_RNA &lt;- Apul_counts_RNA[!apply(Apul_counts_RNA, 1, function(row) all(row &lt; 6)), ]  # Remove the "RNA-" portion of the column names, to leave just the sample names colnames(Apul_counts_RNA) &lt;- sub("RNA-", "", colnames(Apul_counts_RNA))  # Reorder the columns into alphabetical order (to make it easier to create an associated metadata spreadsheet) Apul_counts_RNA &lt;- Apul_counts_RNA[, order(colnames(Apul_counts_RNA))]  write.table(Apul_counts_RNA, file = "../output/03.01-Apul-RNA-summary-Hisat/Apul_RNA_Hisat_counts_formatted.txt", row.names = TRUE, col.names = TRUE)  Apul_sample_names &lt;- names(Apul_counts_RNA)  head(Apul_counts_RNA)</code></pre>
<pre><code>           ACR-140 ACR-145 ACR-150 ACR-173 ACR-178 FUN_035039     553     340     256     485     510 FUN_035038    2486     775     743    1250    1092 FUN_035031      46       6      25      41      29 FUN_035030     183     252      48      78      73 FUN_035033    1519     311     555     990     370 FUN_035032    1764    1297    1035    1763    1360 </code></pre>
<pre><code>Apul_sample_names</code></pre>
<pre><code>[1] "ACR-140" "ACR-145" "ACR-150" "ACR-173" "ACR-178" </code></pre>
<pre><code># Add gene IDs to the IDmapping Apul_IDmapping &lt;- left_join(Apul_IDmapping, Apul_geneIDs, by = c("V1" = "X1"))  Apul_counts_GO &lt;- Apul_counts_RNA %&gt;%   rownames_to_column(var = "geneID") %&gt;%   left_join(Apul_IDmapping, by = c("geneID" = "X4"))  write.table(Apul_counts_GO, "../output/03.01-Apul-RNA-summary-Hisat/Apul_RNA_Hisat_counts_formatted.txt", sep = '\t', row.names = TRUE, col.names = TRUE, quote = FALSE)  head(Apul_counts_GO)</code></pre>
<pre><code>      geneID ACR-140 ACR-145 ACR-150 ACR-173 ACR-178                         V1 1 FUN_035039     553     340     256     485     510                       &lt;NA&gt; 2 FUN_035038    2486     775     743    1250    1092                       &lt;NA&gt; 3 FUN_035031      46       6      25      41      29                       &lt;NA&gt; 4 FUN_035030     183     252      48      78      73 ptg000025l:3084856-3086902 5 FUN_035033    1519     311     555     990     370                       &lt;NA&gt; 6 FUN_035032    1764    1297    1035    1763    1360                       &lt;NA&gt;           V3      V13 Protein.names Organism Gene.Ontology..biological.process. 1       &lt;NA&gt;       NA          &lt;NA&gt;     &lt;NA&gt;                               &lt;NA&gt; 2       &lt;NA&gt;       NA          &lt;NA&gt;     &lt;NA&gt;                               &lt;NA&gt; 3       &lt;NA&gt;       NA          &lt;NA&gt;     &lt;NA&gt;                               &lt;NA&gt; 4 A0A2B4RNI3 2.04e-25          &lt;NA&gt;     &lt;NA&gt;                               &lt;NA&gt; 5       &lt;NA&gt;       NA          &lt;NA&gt;     &lt;NA&gt;                               &lt;NA&gt; 6       &lt;NA&gt;       NA          &lt;NA&gt;     &lt;NA&gt;                               &lt;NA&gt;   Gene.Ontology.IDs 1              &lt;NA&gt; 2              &lt;NA&gt; 3              &lt;NA&gt; 4              &lt;NA&gt; 5              &lt;NA&gt; 6              &lt;NA&gt; </code></pre>
</section>
<section id="expression-levels" class="level2">
<h2 class="anchored" data-anchor-id="expression-levels">1.3 Expression levels</h2>
<p>Plot histograms of the expression levels in each sample</p>
<pre><code># Melt the count matrix into long format Apul_counts_melted &lt;- melt(Apul_counts_RNA, variable.name = "sample", value.name = "counts")  # Plot the expression level histograms for each sample ggplot(Apul_counts_melted, aes(x = counts)) +   geom_histogram(binwidth = 1, fill = "#408EC6", color = "black") +   scale_x_log10() +  # Optional: Log-transform the x-axis for better visualization   facet_wrap(~sample, scales = "free_y") +   labs(title = "Gene Expression Level Histogram for Each Sample",        x = "Expression Level (Counts)",        y = "Frequency") +   theme_minimal()</code></pre>
</section>
<section id="transcript-counts" class="level2">
<h2 class="anchored" data-anchor-id="transcript-counts">1.4 Transcript counts</h2>
<p>First let’s check the total number of transcripts in each sample – keep in mind this expression data has <em>not</em> been normalized yet, so there may be different totals for each sample</p>
<pre><code># Calculate the total number of transcripts for each sample total_transcripts &lt;- colSums(Apul_counts_RNA)  # Create a data frame for plotting total_transcripts_df &lt;- data.frame(sample = names(total_transcripts),                                    totals = total_transcripts)  # Plot the total number of transcripts for each sample ggplot(total_transcripts_df, aes(x = sample, y = totals)) +   geom_bar(stat = "identity", fill = "#408EC6", color = "black") +   labs(title = "Total Number of Transcripts per Sample",        x = "Sample",        y = "Total Transcripts") +   theme_minimal() +   theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for readability</code></pre>
<p>Now let’s check the number of unique transcripts in each sample – that is, how many genes are expressed in each sample? This should be pretty much the same across samples, even without normalization.</p>
<pre><code># Calculate the number of unique transcripts (non-zero counts) for each sample unique_transcripts &lt;- colSums(Apul_counts_RNA &gt; 0)  # Create a data frame for plotting unique_transcripts_df &lt;- data.frame(sample = names(unique_transcripts),                                     uniques = unique_transcripts)  # Plot the total number of unique transcripts for each sample ggplot(unique_transcripts_df, aes(x = sample, y = uniques)) +   geom_bar(stat = "identity", fill = "#408EC6", color = "black") +   labs(title = "Total Number of Unique Expressed Transcripts per Sample",        x = "Sample",        y = "Unique Transcripts") +   theme_minimal() +   theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for readability</code></pre>
</section>
<section id="most-common-biological-processes" class="level2">
<h2 class="anchored" data-anchor-id="most-common-biological-processes">1.5 Most common biological processes</h2>
<p>Similar to the plot generated in <code>02-Apul-reference-annotation</code>, let’s plot the biological processes most represented in these samples’ expression</p>
<pre><code># Rename the `Gene.Ontology..biological.process.` column to `Biological_Process` colnames(Apul_counts_GO)[colnames(Apul_counts_GO) == "Gene.Ontology..biological.process."] &lt;- "Biological_Process"  # Separate the `Biological_Process` column into individual biological processes data_separated &lt;- unlist(strsplit(Apul_counts_GO$Biological_Process, split = ";"))  # Trim whitespace from the biological processes data_separated &lt;- gsub("^\\s+|\\s+$", "", data_separated)  # Count the occurrences of each biological process process_counts &lt;- table(data_separated) process_counts &lt;- data.frame(Biological_Process = names(process_counts), Count = as.integer(process_counts)) process_counts &lt;- process_counts[order(-process_counts$Count), ]  # Select the 20 most predominant biological processes top_20_processes &lt;- process_counts[1:20, ]  # Create a color palette for the bars bar_colors &lt;- rainbow(nrow(top_20_processes))  # Create a staggered vertical bar plot with different colors for each bar barplot(top_20_processes$Count, names.arg = rep("", nrow(top_20_processes)), col = bar_colors,         ylim = c(0, max(top_20_processes$Count) * 1.25),         main = "Occurrences of the 20 Most Predominant Biological Processes", xlab = "Biological Process", ylab = "Count")</code></pre>
<pre><code># Create a separate plot for the legend png("../output/03.01-Apul-RNA-summary-Hisat/GOlegend.png", width = 800, height = 600) par(mar = c(0, 0, 0, 0)) plot.new() legend("center", legend = top_20_processes$Biological_Process, fill = bar_colors, cex = 1, title = "Biological Processes") dev.off()</code></pre>
<pre><code>png    2  </code></pre>
<pre><code>knitr::include_graphics("../output/03.01-Apul-RNA-summary-Hisat/GOlegend.png")</code></pre>
<pre><code>rm ../output/03.01-Apul-RNA-summary-Hisat/GOlegend.png</code></pre>
</section>
</section>
<section id="normalized-counts" class="level1">
<h1>2 Normalized counts</h1>
<section id="normalize-counts-with-deseq2" class="level2">
<h2 class="anchored" data-anchor-id="normalize-counts-with-deseq2">2.1 Normalize counts with DESeq2</h2>
<section id="plot-unnormalized-data" class="level3">
<h3 class="anchored" data-anchor-id="plot-unnormalized-data">2.1.1 Plot unnormalized data</h3>
<pre><code>Apul_counts_RNA %&gt;%   pivot_longer( cols = everything(), names_to = "sample", values_to = "count") %&gt;%   ggplot(., aes(x = sample, y = count)) +   geom_violin() +    geom_point(alpha = 0.2) +   theme_minimal() +   labs(title = "Unnormalized transcript counts",        x = "Sample",        y = "count")</code></pre>
<p>We definitely need to normalize this data!</p>
</section>
<section id="metadata" class="level3">
<h3 class="anchored" data-anchor-id="metadata">2.1.2 Metadata</h3>
<p>DESeq2 requires a metadata data frame as input. I don’t have sample metadata though so, since we’re just doing DESeq2 for normalization purposes (not analysis purposes), I’m just going to create a dummy sheet</p>
<pre><code>Apul_sample_names &lt;- colnames(Apul_counts_RNA)  Apul_metadata_RNA &lt;- data.frame(Sample = Apul_sample_names,                             Species = rep("A.pulchra", 5)) rownames(Apul_metadata_RNA) &lt;- Apul_sample_names  head(Apul_metadata_RNA)</code></pre>
<pre><code>         Sample   Species ACR-140 ACR-140 A.pulchra ACR-145 ACR-145 A.pulchra ACR-150 ACR-150 A.pulchra ACR-173 ACR-173 A.pulchra ACR-178 ACR-178 A.pulchra </code></pre>
</section>
<section id="deseq-object" class="level3">
<h3 class="anchored" data-anchor-id="deseq-object">2.1.3 DESeq object</h3>
<pre><code># Calculate DESeq object dds_Apul_RNA &lt;- DESeqDataSetFromMatrix(countData = Apul_counts_RNA,                               colData = Apul_metadata_RNA,                               design = ~ 1)   # Run differential expression analysis  # (Note that this DESeq() function runs all necessary steps, including data normalization,  # estimating size factors, estimating dispersions, gene-wise dispersion estimates, mean-dispersion  # relationship, final dispersion estimates, fitting model, and testing) # Using design = ~1 because we don't have treatment groups  dds_Apul_RNA &lt;- DESeq(dds_Apul_RNA)</code></pre>
<p>It’s worth noting here that I’m actually going to be doing two different types of transformation on the counts data, which serve different purposes.</p>
<ul>
<li><p>First is <strong>normalizing</strong> the transcript counts, which adjusts for differences in library size or sequencing depth, but retains count-like properties. Normalized counts are most useful for things like visualizing expression levels and differential expression analysis.</p></li>
<li><p>Second is <strong>variance stabilizing</strong> the counts data, which aims to make the variance of the transformed data approximately independent of the mean, reducing heteroscedasticity (the relationship between variance and mean) and “smoothing” out the variance at low counts. Notably, the transformed data is <em>no longer on the original count scale</em>. The transformation makes the variance roughly constant across the range of counts, which makes it easier to interpret patterns in the data visually. Variance stabilized data is most useful for exploratory data analysis, like PCA, clustering, and heatmaps, and is also the transformation we’ll want to use before WGCNA.</p></li>
</ul>
<pre><code># extract normalized counts # (normalization is automatically performed by deseq2) Apul_counts_RNA_norm &lt;- counts(dds_Apul_RNA, normalized=TRUE) %&gt;% data.frame()  write.table(Apul_counts_RNA_norm, file = "../output/03.01-Apul-RNA-summary-Hisat/Apul_counts_RNA_normalized.txt", sep = "\t", row.names = TRUE, col.names = TRUE, quote = FALSE)   # variance stabilized data vsd_Apul_RNA &lt;- varianceStabilizingTransformation(dds_Apul_RNA, blind=TRUE) wpn_vsd_Apul_RNA &lt;- getVarianceStabilizedData(dds_Apul_RNA) rv_wpn_Apul_RNA &lt;- rowVars(wpn_vsd_Apul_RNA, useNames=TRUE)  Apul_counts_RNA_vsd &lt;- data.frame(wpn_vsd_Apul_RNA) write.table(Apul_counts_RNA_vsd, file = "../output/03.01-Apul-RNA-summary-Hisat/Apul_counts_RNA_variancestabilized.txt", sep = "\t", row.names = TRUE, col.names = TRUE,quote = FALSE)  q75_wpn_Apul_RNA &lt;- quantile(rowVars(wpn_vsd_Apul_RNA, useNames=TRUE), .75)  # 75th quantile variability Apul_counts_RNA_vsd_q75 &lt;- wpn_vsd_Apul_RNA[ rv_wpn_Apul_RNA &gt; q75_wpn_Apul_RNA, ] %&gt;% data.frame # filter to retain only the most variable genes write.table(Apul_counts_RNA_vsd_q75, file = "../output/03.01-Apul-RNA-summary-Hisat/Apul_counts_RNA_variancestabilized_q75.txt", sep = "\t", row.names = TRUE, col.names = TRUE,quote = FALSE)  q95_wpn_Apul_RNA &lt;- quantile(rowVars(wpn_vsd_Apul_RNA, useNames=TRUE), .95)  # 95th quantile variability Apul_counts_RNA_vsd_q95 &lt;- wpn_vsd_Apul_RNA[ rv_wpn_Apul_RNA &gt; q95_wpn_Apul_RNA, ] %&gt;% data.frame # filter to retain only the most variable genes write.table(Apul_counts_RNA_vsd_q95, file = "../output/03.01-Apul-RNA-summary-Hisat/Apul_counts_RNA_variancestabilized_q95.txt", sep = "\t", row.names = TRUE, col.names = TRUE,quote = FALSE)</code></pre>
</section>
</section>
<section id="plot-normalized-data" class="level2">
<h2 class="anchored" data-anchor-id="plot-normalized-data">2.2 Plot normalized data</h2>
<pre><code>Apul_counts_RNA_norm_long &lt;- Apul_counts_RNA_norm %&gt;%   mutate(     Gene_id = row.names(Apul_counts_RNA_norm)   ) %&gt;%   pivot_longer(-Gene_id)  Apul_counts_RNA_norm_long %&gt;%   ggplot(., aes(x = name, y = value)) +   geom_violin() +   geom_point() +   theme_bw() +   theme(     axis.text.x = element_text( angle = 90)   ) +   ylim(0, NA) +   labs(     title = "Normalized Expression",     x = "Sample",     y = "Normalized counts"   )</code></pre>
</section>
<section id="plot-variance-stabilized-data" class="level2">
<h2 class="anchored" data-anchor-id="plot-variance-stabilized-data">2.3 Plot variance stabilized data</h2>
<pre><code>Apul_counts_RNA_vsd_long &lt;- Apul_counts_RNA_vsd %&gt;%   mutate(     Gene_id = row.names(Apul_counts_RNA_vsd)   ) %&gt;%   pivot_longer(-Gene_id)  Apul_counts_RNA_vsd_long %&gt;%   ggplot(., aes(x = name, y = value)) +   geom_violin() +   geom_point() +   theme_bw() +   theme(     axis.text.x = element_text( angle = 90)   ) +   ylim(0, NA) +   labs(     title = "Variance Stabilized Expression",     x = "Sample",     y = "Variance stabilized data"   )</code></pre>
</section>
<section id="normalized-expression-levels" class="level2">
<h2 class="anchored" data-anchor-id="normalized-expression-levels">2.4 Normalized expression levels</h2>
<p>Plot histograms of the normalized expression levels in each sample</p>
<pre><code># Melt the count matrix into long format Apul_counts_norm_melted &lt;- melt(Apul_counts_RNA_norm, variable.name = "sample", value.name = "counts")  # Plot the expression level histograms for each sample ggplot(Apul_counts_norm_melted, aes(x = counts)) +   geom_histogram(binwidth = 1, fill = "#408EC6", color = "black") +   scale_x_log10() +  # Optional: Log-transform the x-axis for better visualization   facet_wrap(~sample, scales = "free_y") +   labs(title = "Gene Expression Level Histogram for Each Sample",        x = "Expression Level (Counts)",        y = "Frequency") +   theme_minimal()</code></pre>
</section>
<section id="normalized-transcript-counts" class="level2">
<h2 class="anchored" data-anchor-id="normalized-transcript-counts">2.5 Normalized transcript counts</h2>
<p>Check the total number of transcripts in each sample – now that we’ve normalized the data these totals should be similar</p>
<pre><code># Calculate the total number of transcripts for each sample total_transcripts_norm &lt;- colSums(Apul_counts_RNA_norm)  # Create a data frame for plotting total_transcripts_norm_df &lt;- data.frame(sample = names(total_transcripts_norm),                                    totals = total_transcripts_norm)  # Plot the total number of transcripts for each sample ggplot(total_transcripts_norm_df, aes(x = sample, y = totals)) +   geom_bar(stat = "identity", fill = "#408EC6", color = "black") +   labs(title = "Total Number of Transcripts per Sample",        x = "Sample",        y = "Total Transcripts") +   theme_minimal() +   theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for readability</code></pre>
</section>
<section id="pca-of-variance-stabilized-data" class="level2">
<h2 class="anchored" data-anchor-id="pca-of-variance-stabilized-data">2.6 PCA of variance stabilized data</h2>
<pre><code>plotPCA(vsd_Apul_RNA, intgroup="Sample")</code></pre>
</section>
<section id="sample-clustering" class="level2">
<h2 class="anchored" data-anchor-id="sample-clustering">2.7 Sample clustering</h2>
<pre><code>sample_dists &lt;- dist(t(assay(vsd_Apul_RNA))) pheatmap(as.matrix(sample_dists), clustering_distance_rows = "euclidean",           clustering_distance_cols = "euclidean", main="Sample Clustering")</code></pre>
</section>
<section id="heatmaps" class="level2">
<h2 class="anchored" data-anchor-id="heatmaps">2.8 Heatmaps</h2>
<p>Of most variable variance stabilized genes</p>
<pre><code># 75th quantile heat_colors &lt;- rev(brewer.pal(12, "RdYlBu")) pheatmap(Apul_counts_RNA_vsd_q75,           cluster_rows = TRUE,          cluster_cols = TRUE,          show_rownames = TRUE,          show_colnames = TRUE,          color = heat_colors,          scale="row")</code></pre>
<pre><code># 95th quantile pheatmap(Apul_counts_RNA_vsd_q95,           cluster_rows = TRUE,          cluster_cols = TRUE,          show_rownames = TRUE,          show_colnames = TRUE,          color = heat_colors,          scale="row")</code></pre>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_07_deepdive_Apul_Hisat_RNAsummary.html</guid>
  <pubDate>Fri, 07 Feb 2025 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-dive expression: A.pul miRNA methylation machinery</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_07_deepdive_methyl_machinery.html</link>
  <description><![CDATA[ 




<section id="apul-mirna-methylation-machinery" class="level1">
<h1><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/23-Apul-miRNA-methylation-machinery.md"><strong>23-Apul-miRNA-methylation-machinery</strong></a></h1>
<p>One way miRNAs and DNA methylation can interact to influence expression is through miRNAs influencing the transcription/translation of protein machinery involved in DNA methylation. In humans, this has been identified as a potential mechanism of carcinogenisis! (Reviewed in Karimzadeh et al.&nbsp;(2021))</p>
<section id="which-genes-are-involved-in-dna-methylation" class="level2">
<h2 class="anchored" data-anchor-id="which-genes-are-involved-in-dna-methylation"><strong>Which genes are involved in DNA methylation?</strong></h2>
<p>“DNA methylation machinery is composed of several enzymes to accurately regulate the gene expression together. The main enzyme-encoding genes comprise a small family of DNA cytosine-5 methyltransferase, which are involved in established (DNA methyltransferase 3 alpha (DNMT3A) and DNA methyltransferase 3 beta (DNMT3B)) and maintenance (DNMT1) of methylation patterns. The other genes are methyl-CpG-binding proteins (MBPs; methyl-CpG-binding domain (MBD)1–4, methyl-CpG-binding protein 2 (MECP2), UHRF1/2, ZBTB33, ZBTB4, and ZBTB38) that assist in expression repression and 10–11 translocation (TET) enzymes (TET1, TET2, and TET3); seemingly, are implicated in DNA demethylation10,11. Some experiments demonstrated that, based on the importance of oncogenes and/or tumor suppressor genes alterations in the development of each type of cancer, DNA methylation regulator genes may enhance or suppress cancer development in each specific type of cancer12,13,14,15,16.” Karimzadeh et al.&nbsp;(2021)</p>
<p>So we’re looking for miRNAs that target genes encoding: - DNA methyltransferases (DNMTs) - methyl-CpG-binding proteins - 10–11 translocation (TET) enzymes</p>
<p>First let’s see what a quick search of our annotated A.pulchra genome turns up. I want to find any annotations related to DNA methyltransferase</p>
<pre><code> awk -F'\t' '$5 ~ /methyltransferase/ {print $2, $5}' OFS='\t' \ ../output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab \ | grep "DNA"</code></pre>
<pre><code>## "ntLink_8:23126215-23133100" "DNA methyltransferase 1-associated protein 1 (DNMAP1) (DNMT1-associated protein 1)" ## "ptg000001l:8684194-8690468" "Alkylated DNA repair protein alkB homolog 8 (Probable alpha-ketoglutarate-dependent dioxygenase ABH8) (S-adenosyl-L-methionine-dependent tRNA methyltransferase ABH8) (tRNA (carboxymethyluridine(34)-5-O)-methyltransferase ABH8) (EC 2.1.1.-, EC 2.1.1.229)" ## "ptg000001l:8684194-8690468" "Alkylated DNA repair protein alkB homolog 8 (Probable alpha-ketoglutarate-dependent dioxygenase ABH8) (S-adenosyl-L-methionine-dependent tRNA methyltransferase ABH8) (tRNA (carboxymethyluridine(34)-5-O)-methyltransferase ABH8) (EC 2.1.1.-, EC 2.1.1.229)" ## "ptg000023l:4341384-4351489" "N(6)-adenine-specific methyltransferase METTL4 (Methyltransferase-like protein 4) (N(6)-adenine-specific DNA methyltransferase METTL4) (EC 2.1.1.72) (snRNA (2'-O-methyladenosine-N(6)-)-methyltransferase METTL4) (EC 2.1.1.-)" ## "ptg000023l:30502755-30503307"   "Methylated-DNA--protein-cysteine methyltransferase (EC 2.1.1.63) (6-O-methylguanine-DNA methyltransferase) (MGMT) (O-6-methylguanine-DNA-alkyltransferase)" ## "ptg000047l:7043865-7069644" "DNA (cytosine-5)-methyltransferase 1 (Dnmt1) (EC 2.1.1.37) (DNA methyltransferase GgaI) (DNA MTase GgaI) (M.GgaI) (MCMT)" ## "ptg000047l:7043865-7069644" "DNA (cytosine-5)-methyltransferase 1 (Dnmt1) (EC 2.1.1.37) (DNA methyltransferase GgaI) (DNA MTase GgaI) (M.GgaI) (MCMT)" ## "ptg000047l:7043865-7069644" "DNA (cytosine-5)-methyltransferase 1 (Dnmt1) (EC 2.1.1.37) (DNA methyltransferase GgaI) (DNA MTase GgaI) (M.GgaI) (MCMT)"</code></pre>
<p>There’s definitely DNMT machinery genes anontated in our A.pulchra genome (as expected)! Now let’s create a data frame that associated each annotated mRNA with it’s gene ID (i.e.&nbsp;FUN######) and do a more broad search for different machinery involved in methylation</p>
<pre><code># Read in data mRNA_annot &lt;- read.table("../output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab", header=TRUE, sep='\t') %&gt;% select(-X) mRNA_geneIDs &lt;- read.table("../output/15-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt", header=FALSE, sep='\t')  # Join mRNA_annot_geneID &lt;- left_join(mRNA_annot, mRNA_geneIDs, by="V1") mRNA_annot_geneID$V4 &lt;- gsub("Parent=", "", mRNA_annot_geneID$V4)  # To double-check that this worked correctly, check for NAs in the column containing gene IDs # Every mRNA has a gene ID, so this should return FALSE any(is.na(mRNA_annot_geneID$V3.y))</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>Now let’s select genes that encode different protein machinery relevant to DNA methylation</p>
<pre><code>methyl_machinery &lt;- subset(mRNA_annot_geneID,                             (grepl("methyltransferase", mRNA_annot_geneID$Protein.names)                              &amp; grepl("DNA", mRNA_annot_geneID$Protein.names))                            | grepl("DNMT", mRNA_annot_geneID$Protein.names)                            | grepl("Dnmt", mRNA_annot_geneID$Protein.names)                            | grepl("MBP", mRNA_annot_geneID$Protein.names)                            | grepl("MBD", mRNA_annot_geneID$Protein.names)                            | grepl("MECP", mRNA_annot_geneID$Protein.names)                            | grepl("UHRF", mRNA_annot_geneID$Protein.names)                            | grepl("ZBTB", mRNA_annot_geneID$Protein.names)                            | grepl("TET", mRNA_annot_geneID$Protein.names)                            )  nrow(methyl_machinery)</code></pre>
<pre><code>## [1] 23</code></pre>
<p>We find 23 mRNAs in our A.pulchra genome that encode known DNA methylation machinery!</p>
<p>Note that I stipulated the term “methyltransferase” must be accompanied by “DNA” also present in the Protein.names column. I imposed this restriction because, when I searched for “methyltransferase” alone, methyltransferases related to histone modification and modification with nucleotides other than cytosine came up.</p>
<p>Now let’s see whether any of these methylation machinery genes are putative miRNA targets, using the output from our target-prediction software, miRanda.</p>
<pre><code>miranda_apul &lt;- read.table("../output/18-Apul-interactions-functional-annotation/miRanda_miRNA_mRNA.txt", header=TRUE, sep='\t')  miranda_methyl_machinery &lt;- left_join(methyl_machinery, miranda_apul, by=c("V4" = "mRNA_FUNid"))  length(na.omit(miranda_apul$miRNA_cluster))</code></pre>
<pre><code>## [1] 6109</code></pre>
<pre><code>length(unique(na.omit(miranda_apul$miRNA_cluster)))</code></pre>
<pre><code>## [1] 39</code></pre>
<pre><code>length(na.omit(miranda_methyl_machinery$miRNA_cluster))</code></pre>
<pre><code>## [1] 0</code></pre>
<pre><code>length(unique(na.omit(miranda_methyl_machinery$miRNA_cluster)))</code></pre>
<pre><code>## [1] 0</code></pre>
<p>Miranda originally identified 6109 putative targets of 39 of our miRNAs, but none of these targets are included in our list of DNA methylation machinery mRNA. :(</p>
<p>So this means that our <strong>A.pulchra miRNAs do not putatively bind to any methylation machinery mRNA</strong> and/or I’m missing some genes in my search.</p>
<p>Karimzadeh, Mohammad Reza, Peyman Pourdavoud, Naeim Ehtesham, Mohaddese Qadbeigi, Masood Movahedi Asl, Behrang Alani, Meysam Mosallaei, and Bahram Pakzad. 2021. “Regulation of DNA Methylation Machinery by Epi-miRNAs in Human Cancer: Emerging New Targets in Cancer Therapy.” <em>Cancer Gene Therapy</em> 28 (3): 157–74. <a href="https://doi.org/10.1038/s41417-020-00210-7" class="uri">https://doi.org/10.1038/s41417-020-00210-7</a>.</p>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_07_deepdive_methyl_machinery.html</guid>
  <pubDate>Fri, 07 Feb 2025 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-dive Expression Project Planning</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_01_30_project_planning.html</link>
  <description><![CDATA[ 




<p>Now that we’ve completed a lot of the foundational work for the E5 deep-dive expression project (e.g.&nbsp;sRNA &amp; lncRNA ID, RNA and sRNA expression summaries, preliminary target prediction and coexpression work, etc.), I want to clarify our focus for project completion.</p>
<p><a href="https://github.com/urol-e5/deep-dive-expression">deep-dive-expression repo</a><br>
<a href="https://docs.google.com/document/d/1vlWJiuaxKuh6q6XOBVBrGsZkmf6R_JpJMO6wDIGzdx0/edit?tab=t.0#heading=h.gxujq2yyuafv">manuscript</a><br>
<a href="https://docs.google.com/document/d/1Fdd6xC9tJmAf9Iydcf3er-YwabKmwK3jGVw4ppfxfhM/edit?tab=t.0#heading=h.5xpib71go7rb">project meeting notes</a><br>
<a href="https://docs.google.com/document/d/14WayiHQLe3_5_aS_d4dEZj5mt1DuHvV21JpR4a96uhg/edit?tab=t.0">hypotheses brainstorming document</a></p>
<section id="hypotheses" class="level3">
<h3 class="anchored" data-anchor-id="hypotheses"><strong>Hypotheses:</strong></h3>
<section id="gene-expression-and-srna" class="level4">
<h4 class="anchored" data-anchor-id="gene-expression-and-srna"><strong>Gene expression and sRNA</strong></h4>
<ul>
<li><p>sRNA that bind to genes and are inversely correlated with expression - regulate those genes</p></li>
<li><p>There will be a suite of genes that a sRNA regulates that have similar function</p></li>
<li><p>Some lncRNAs that act as sponges (bind) sRNA will impact gene expression sRNA regulate</p></li>
<li><p>A subset of lncRNAs will regulate mRNA as evident by correlation</p></li>
<li><p>some lncRNAs may act as miRNA precursors – expect they will contain the full pre-miRNA</p></li>
<li><p>Lack of DNA methylation in a given will result in increased alternative isoforms</p></li>
</ul>
</section>
<section id="gene-expression-and-dna-methylation" class="level4">
<h4 class="anchored" data-anchor-id="gene-expression-and-dna-methylation"><strong>Gene expression and DNA methylation</strong></h4>
<ul>
<li><p>Housekeeping genes: positive relationship between expression and GBM</p></li>
<li><p>plastic/environmentally responsive genes: negative relationship between expression and GBM</p></li>
</ul>
</section>
<section id="srna-and-dna-methylation" class="level4">
<h4 class="anchored" data-anchor-id="srna-and-dna-methylation"><strong>sRNA and DNA methylation</strong></h4>
<ul>
<li><p>miRNAs modulate DNA methylation by binding to the mRNA encoding methylation machinery (e.g., DNMTs)</p>
<ul>
<li>For miRNA that target methylation machinery, expect negative relationship miRNA expression and global methylation</li>
</ul></li>
<li><p>siRNA modulate DNA methylation through RNA-directed DNA methylation by binding to genomic region and recruiting protein machinery to direct methylation</p>
<ul>
<li>Expect positive relationship between siRNA binding in a genomic region and methylation of that region</li>
</ul></li>
<li><p>siRNAs could also play a role in guiding DNA methylation to silence transposable elements</p>
<ul>
<li>Expect siRNA binding to TEs</li>
</ul></li>
</ul>
</section>
<section id="gene-expression-and-histones" class="level4">
<h4 class="anchored" data-anchor-id="gene-expression-and-histones"><strong>Gene expression and histones</strong></h4>
</section>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data"><strong>Data:</strong></h3>
<p><u>RNA sequencing</u></p>
<ul>
<li><p>gene expression</p></li>
<li><p>lncRNA ID &amp; expression</p></li>
</ul>
<p><u>sRNA sequencing</u></p>
<ul>
<li><p>miRNA ID &amp; expression</p></li>
<li><p>siRNA ID &amp; expression</p></li>
<li><p>piRNA ID &amp; expression (if desired)</p></li>
</ul>
<p><u>WGBS (in progress)</u></p>
<ul>
<li>DNA methylation mapping</li>
</ul>
<p>Some H4 data</p>
</section>
<section id="completed-work" class="level3">
<h3 class="anchored" data-anchor-id="completed-work"><strong>Completed work:</strong></h3>
<p>The below summary is for A.pulchra only.</p>
<p>All data processing for RNAseq and sRNAseq (including filtering, trimming, lncRNA ID, sRNA ID, summarizing to count matrices, and functional annotation) has been completed.</p>
<p><strong>genes-ncRNA:</strong></p>
<p>Two methods of miRNA-mRNA target prediction (miRanda and RNAhybrid) have been performed, and the miRanda results have been used in combination with Pearson’s Correlation to generate coexpression/interaction network. This interaction network has also been functionally annotated.</p>
<p><strong>genes-WGBS:</strong></p>
<p>none</p>
<p><strong>ncRNA-WGBS:</strong></p>
<p>I’ve looked for miRNA binding to genes that encode DNA methylation machinery (none found).</p>
<p><strong>other:</strong></p>
<p>Zoe has also run Orthofinder to facilitate cross-species comparisons</p>
</section>
<section id="goalsto-do-general" class="level3">
<h3 class="anchored" data-anchor-id="goalsto-do-general"><strong>Goals/To-Do (general):</strong></h3>
<p><em>Ensure I’m using the SMART framework (SMART: Specific, Measurable, Attainable, Relevant, and Time-bound)</em></p>
<p>Some goals are formulated to directly address one of the hypotheses listed above, and (for now) should be performed on A.pulchra data only.</p>
<ol type="1">
<li><p><em>“sRNA that bind to genes and are inversely correlated with expression - regulate those genes”</em><br>
Use gene-miRNA interaction network to create some basic figures summarizing nature and extent of interactions (e.g.&nbsp;how many genes with how many miRNAs, how many genes does a single RNA usually interact with and vice versa, how many positive vs.&nbsp;negative relationships are there)</p></li>
<li><p><em>“There will be a suite of genes that a sRNA regulates that have similar function”</em><br>
Use functional annotation of the gene-miRNA interaction network to identify putative function of each miRNA based on function of associated genes.</p></li>
<li><p>For predicted miRNA targets, compare functional composition of targets to functional composition of full reference.<br>
(Basically, I want to see whether miRNAs preferentially regulate any functional classes).</p></li>
<li><p>Formally name each miRNA, matching the names assigned during deep-dive when possible.</p></li>
<li><p>If an miRNA is formally described (e.g.&nbsp;mir-100), compare/contrast its described function with the putative function determined during (2)</p></li>
<li><p><em>“Some lncRNAs that act as sponges (bind) sRNA will impact gene expression sRNA regulate”<br>
</em>Use miRanda to predict miRNA-lncRNA binding and evaluate correlated expression of putative binding pairs to generate miRNA-lncRNA interaction network.</p></li>
<li><p><em>“A subset of lncRNAs will regulate mRNA as evident by correlation”</em><br>
Evaluate correlated expression of lncRNA and mRNA.</p></li>
<li><p><em>“some lncRNAs may act as miRNA precursors – expect they will contain the full pre-miRNA”</em><br>
Use BLAST to search for lncRNAs that fully contain pre-miRNA sequences.</p></li>
<li><p>Using simulated WGBS data, prep pipeline to summarize methylation (whole genome methylation levels, GBM/distribution across genome features, etc.)</p></li>
<li><p><em>“Housekeeping genes: positive relationship between expression and GBM”</em> and <em>“plastic/environmentally responsive genes: negative relationship between expression and GBM”</em><br>
Using simulated WGBS data, prep pipeline to delimit genes by function (housekeeping vs.&nbsp;responsive) evaluate relationship of both classes with gene body methylation.</p></li>
<li><p><em>“siRNA modulate DNA methylation through RNA-directed DNA methylation by binding to genomic region and recruiting protein machinery to direct methylation”</em><br>
Use miRanda/RNAhybrid to predict siRNA binding to the genome. Using simulated WGBS data, prep pipeline to test whether siRNA binding is significantly associated with methylation</p></li>
<li><p>siRNAs could also play a role in guiding DNA methylation to silence transposable elements</p>
<p>Use miRanda/RNAhybrid to predict siRNA binding to TEs. Evaluate correlated expression of siRNAs and TEs (expecting a negative relationship).</p></li>
</ol>
<p>Multiomics?</p>
<p>At some point we’ll need to a) replicate these analyses on Peve and Ptuh, and b) run some cross species comparisons</p>
</section>
<section id="goalsplan-for-friday-131-meeting" class="level3">
<h3 class="anchored" data-anchor-id="goalsplan-for-friday-131-meeting"><strong>Goals/Plan for Friday (1/31) meeting:</strong></h3>
<ul>
<li><p>Clarify involvement/role of E5 molecular group members – ensure everyone who is/would like to be involved in deep-dive expression manuscript has something to be working on. Assign out goals/tasks if people</p></li>
<li><p>Define the overarching lens/focus of the manuscript</p></li>
<li><p>Once tasks are assigned to individuals and a rough timeline is selected, add tasks as Github issues</p></li>
<li><p>Add current progress to manuscript?</p></li>
</ul>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_01_30_project_planning.html</guid>
  <pubDate>Thu, 30 Jan 2025 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Rerunning ShortStack for deep-dive-expression</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_10_22_shortstack_4.1.0_reruns.html</link>
  <description><![CDATA[ 




<p>We performed sRNA discovery for <em>A. pulchra</em>, <em>P. evermanni</em>, and <em>P. tuahiniensis</em> (formerly identified as <em>P. meandrina</em>) as part of the E5 <code>deep-dive</code> initiative. Notably, we used the <em>A. millipora</em> genome as an alignment reference during <em>A. pulchra</em> sRNA discovery because no <em>A. pulchra</em> genome was available at the time. However, collaborators are have now assembled an <em>A. pulchra</em> genome, so we can rerun sRNA discovery with a better reference for use in the <code>deep-dive-expression</code> project. Additionally, the sRNA discovery tool we decided to use, <a href="https://github.com/MikeAxtell/ShortStack">ShortStack</a> <span class="citation" data-cites="axtell2013">Axtell (2013)</span>, has a new update (v.4.1.0) with functionality for visualizing miRNA hairpin structures and generating genome-browser-ready quantitative coverage tracks of aligned small RNAs. These new features could prove useful, so I’m just rerunning ShortStack for all three species, using the <em>pulchra</em> genome for <em>A. pulchra</em> discovery and ShortStack 4.1.0 for all three.</p>
<p><u><strong>Original <code>deep-dive</code> sRNA discovery, using ShortStack 4.0.3 (for reference):</strong></u></p>
<p>A. pulchra (using A. millipora genome)</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive/blob/main/D-Apul/code/13.2.1-Apul-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase.Rmd">code</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive/blob/main/D-Apul/code/13.2.1-Apul-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase.md">knitted .md</a></p></li>
</ul>
<p>P. evermanni</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/08.2-Peve-sRNAseq-ShortStack-31bp-fastp-merged.Rmd">code</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/08.2-Peve-sRNAseq-ShortStack-31bp-fastp-merged.md">knitted .md</a></p></li>
</ul>
<p>P. tuahiniensis (identified here as P. meandrina, using P. meandrina genome)</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/13.2.1-Pmea-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase.Rmd">code</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/13.2.1-Pmea-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase.md">knitted .md</a></p></li>
</ul>
<p><u><strong><code>deep-dive-expression</code> reruns with ShortStack 4.1.0:</strong></u></p>
<p>A. pulchra (using A. pulchra genome)</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/11-Apul-sRNA-ShortStack_4.1.0-pulchra_genome.Rmd">code</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/11-Apul-sRNA-ShortStack_4.1.0-pulchra_genome.md">knitted .md</a></p></li>
</ul>
<p>P. evermanni</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/E-Peve/code/05-Peve-sRNA-ShortStack_4.1.0.Rmd">code</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/E-Peve/code/05-Peve-sRNA-ShortStack_4.1.0.md">knitted .md</a></p></li>
</ul>
<p>P. tuahiniensis (using P. meandrina genome)</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/F-Ptuh/code/05-Ptuh-sRNA-ShortStack_4.1.0.Rmd">code</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/F-Ptuh/code/05-Ptuh-sRNA-ShortStack_4.1.0.md">knitted .md</a></p></li>
</ul>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<section id="comparing-original-srna-discovery-to-reruns" class="level3">
<h3 class="anchored" data-anchor-id="comparing-original-srna-discovery-to-reruns">Comparing original sRNA discovery to reruns</h3>
<table class="table">
<caption>A. pulchra</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 27%">
<col style="width: 25%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">ShortStack 4.0.3<br>
(A. millipora genome)</th>
<th style="text-align: right;">ShortStack 4.1.0<br>
(A. pulchra genome)</th>
<th style="text-align: right;">𝚫</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Potential miRNA loci</td>
<td style="text-align: right;">18895</td>
<td style="text-align: right;">20789</td>
<td style="text-align: right;">+1894 (10%)</td>
</tr>
<tr class="even">
<td>Identified miRNA</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">+1 (2.6%)</td>
</tr>
<tr class="odd">
<td>Database matches</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">131</td>
<td style="text-align: right;">+62 (90%)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>P. evermanni</caption>
<colgroup>
<col style="width: 29%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">ShortStack 4.0.3</th>
<th style="text-align: right;">ShortStack 4.1.0</th>
<th style="text-align: right;">𝚫</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Potential miRNA loci</td>
<td style="text-align: right;">16736</td>
<td style="text-align: right;">16893</td>
<td style="text-align: right;">+157 (0.9%)</td>
</tr>
<tr class="even">
<td>Identified miRNA</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">-1 (2.2%)</td>
</tr>
<tr class="odd">
<td>Database matches</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">+1 (2.7%)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>P. tuahniensis</caption>
<colgroup>
<col style="width: 29%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">ShortStack 4.0.3</th>
<th style="text-align: right;">ShortStack 4.1.0</th>
<th style="text-align: right;">𝚫</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Potential miRNA loci</td>
<td style="text-align: right;">7220</td>
<td style="text-align: right;">7189</td>
<td style="text-align: right;">-31 (0.4%)</td>
</tr>
<tr class="even">
<td>Identified miRNA</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">none</td>
</tr>
<tr class="odd">
<td>Database matches</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">117</td>
<td style="text-align: right;">+21 (22%)</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load necessary library</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the data frame for all species</span></span>
<span id="cb5-2">miRNA_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Species =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Apul*"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Peve"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ptuh"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ShortStack_Version =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4.0.3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4.1.0"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb5-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Potential_miRNA_loci =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18895</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20789</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16736</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16893</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7220</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7189</span>),</span>
<span id="cb5-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Identified_miRNA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">37</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">37</span>),</span>
<span id="cb5-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Database_matches =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">69</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">131</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">37</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">117</span>)</span>
<span id="cb5-8">)</span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape the data to long format for facetting</span></span>
<span id="cb5-11">miRNA_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(miRNA_data,</span>
<span id="cb5-12">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Potential_miRNA_loci"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Identified_miRNA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Database_matches"</span>),</span>
<span id="cb5-13">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Metric"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>)</span>
<span id="cb5-14">miRNA_long<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Metric <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(miRNA_long<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Metric, </span>
<span id="cb5-15">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Potential_miRNA_loci"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Identified_miRNA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Database_matches"</span>))</span>
<span id="cb5-16"></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Facet-wrapped plot for all three metrics</span></span>
<span id="cb5-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(miRNA_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Species, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> ShortStack_Version)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodge"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Metric, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Facet by Metric and allow different y-axis scales</span></span>
<span id="cb5-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA Metrics by Species and ShortStack Version"</span>,</span>
<span id="cb5-22">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Species"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-23"> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale_fill_manual(values = c("4.0.3" = "blue", "4.1.0" = "red")) +</span></span>
<span id="cb5-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_10_22_shortstack_4.1.0_reruns_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>*Note, Apul also used a different genome for the v.4.1.0 run</p>
</section>
<section id="structural-visualizations" class="level3">
<h3 class="anchored" data-anchor-id="structural-visualizations">Structural visualizations</h3>
<p>ShortStack 4.1.0 also automatically generates visualizations of the hairpin structure of each identified miRNA, stored as a pdf. As an example, below is the <a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/output/11-Apul-sRNA-ShortStack_4.1.0-pulchra_genome/ShortStack_out/strucVis/Cluster_18728.ps.pdf">visualization for A. pulchra Cluster 18728</a>, which was annotated as a valid miRNA and database matched the well-studied miRNA miR-100.<br>
</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Cluster_18728.ps.jpg" class="img-fluid"></p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-axtell2013" class="csl-entry">
Axtell, Michael J. 2013. <span>“ShortStack: Comprehensive Annotation and Quantification of Small RNA Genes.”</span> <em>RNA</em> 19 (6): 740–51. <a href="https://doi.org/10.1261/rna.035279.112">https://doi.org/10.1261/rna.035279.112</a>.
</div>
</div></section></div> ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_10_22_shortstack_4.1.0_reruns.html</guid>
  <pubDate>Tue, 19 Nov 2024 00:20:55 GMT</pubDate>
</item>
<item>
  <title>sRNA expression summaries</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_11_11_updated_sRNA_summaries.html</link>
  <description><![CDATA[ 




<p>I summarized sRNA expression for all three E5 species. This includes summary of both raw and normalized counts of all sRNAs, miRNAs, and siRNAs. sRNA, miRNA, and siRNA identification performed using ShortStack 4.1.0.</p>
<p><a href="https://github.com/urol-e5/deep-dive-expression/tree/main"><code>deep-dive-expression</code> repo</a></p>
<p>Rendered code files:</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/03.1-Apul-sRNA-summary.md">Apul</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/E-Peve/code/03.1-Peve-sRNA-summary.md">Peve</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary.md">Ptuh</a></p></li>
</ul>
<p>This also included generating count matrices for raw, normalized, and variance stabilized counts of all sRNA, just miRNA, and just siRNA.</p>
<p>count matrices:</p>
<ul>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/tree/main/D-Apul/output/03.1-Apul-sRNA-summary">Apul</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/tree/main/E-Peve/output/03.1-Peve-sRNA-summary">Peve</a></p></li>
<li><p><a href="https://github.com/urol-e5/deep-dive-expression/tree/main/F-Ptuh/output/03.1-Ptuh-sRNA-summary">Ptuh</a></p></li>
</ul>
<p>As a reminder, normalization and variance stabilization are two different transformations that serve different purposes.</p>
<p><strong>Normalizing</strong> the transcript counts <strong>adjusts for differences in library size</strong> or sequencing depth, but <strong>retains count-like properties</strong>. Normalized counts are most useful for things like visualizing expression levels and differential expression analysis.</p>
<p><strong>Variance stabilization</strong> aims to make the variance of the transformed data approximately independent of the mean, <strong>reducing heteroscedasticity</strong> (the relationship between variance and mean) and “smoothing” out the variance at low counts. Notably, the transformed data is <strong>no longer on the original count scale</strong>. The transformation makes the variance roughly constant across the range of counts, which makes it easier to interpret patterns in the data visually. Variance stabilized data is most useful for exploratory data analysis, like PCA, clustering, and heatmaps, and is also the transformation we’ll want to use before WGCNA.</p>
<p>Here’s some of the figures generated in these summary docs</p>
<section id="total-transcripts-raw" class="level2">
<h2 class="anchored" data-anchor-id="total-transcripts-raw">Total transcripts (raw)</h2>
<p>All sRNA:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/transcript-counts-plot-1.png" class="img-fluid figure-img" width="400"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/transcript-counts-plot-1.png" class="img-fluid figure-img" width="400"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/transcript-counts-plot-1.png" class="img-fluid figure-img" width="400"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>miRNA:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/miRNA-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/miRNA-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/miRNA-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>siRNA:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/siRNA-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/siRNA-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/siRNA-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="total-transcripts-normalized" class="level2">
<h2 class="anchored" data-anchor-id="total-transcripts-normalized">Total transcripts (normalized)</h2>
<p>All sRNA:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>miRNA:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/miRNA-norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/miRNA-norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/miRNA-norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>siRNA:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/siRNA-norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/siRNA-norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/siRNA-norm-transcript-counts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="unique-transcripts" class="level2">
<h2 class="anchored" data-anchor-id="unique-transcripts">Unique transcripts</h2>
<p>All sRNA:</p>
<p>Little variation within a species, but quite a large difference among species. Apul specimens expressed ~19,000 unique sRNA transcripts, Peve expressed ~15,700, and Ptuh specimens expressed dramatically fewer at ~6700 unique sRNA transcripts.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/total-unique-transcripts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/total-unique-transcripts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/total-unique-transcripts-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>miRNA:</p>
<p>Despite the differences in total unique sRNA transcripts, all three species have <strong>similar numbers of unique miRNAs</strong> (though, note our deep-dive exploration showed there is little miRNA overlap among species).</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/total-unique-miRNA-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/total-unique-miRNA-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/total-unique-miRNA-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>siRNA:</p>
<p>There is again a more noticable difference in numbers of unique siRNAs. <strong>Apul have ~120, Peve ~155, and Ptuh ~90</strong>.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/D-Apul/code/03.1-Apul-sRNA-summary_files/figure-gfm/total-unique-siRNA-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Apul</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/E-Peve/code/03.1-Peve-sRNA-summary_files/figure-gfm/total-unique-siRNA-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Peve</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive-expression/raw/main/F-Ptuh/code/03.1-Ptuh-sRNA-summary_files/figure-gfm/total-unique-siRNA-plot-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ptuh</figcaption>
</figure>
</div>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_11_11_updated_sRNA_summaries.html</guid>
  <pubDate>Mon, 11 Nov 2024 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Lit Review: Understanding interactions of sRNA and DNA methylation</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_10_01_sRNA_DNA_methylation_interactions.html</link>
  <description><![CDATA[ 







 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_10_01_sRNA_DNA_methylation_interactions.html</guid>
  <pubDate>Mon, 28 Oct 2024 22:19:43 GMT</pubDate>
</item>
<item>
  <title>Programs for identifying miRNA targets</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_07_19_mRNA_targetID_programs.html</link>
  <description><![CDATA[ 




<p><a href="https://www.sciencedirect.com/science/article/pii/S0888754322001495#s0055">miRanda</a></p>
<p>Seems like a solid option, seen it cited in <a href="https://www.sciencedirect.com/science/article/pii/S0888754322001495#s0055">coral miRNA paper</a>, and listed in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3927079/">review paper</a> <span class="citation" data-cites="peterson_common_2014">Peterson et al. (2014)</span> as one of the OG, more regularly maintained miRNA target prediction programs that takes user sequence input. Most recently updated 2010. Also, available as downloadable software run on linux/unix, so more reproducible than the other main miRNA target prediction softwares which are web based. Only problem is that the miRanda site (<a href="http://www.microrna.org/">www.microrna.org</a>) doesn’t seem to be functional… This is extra weird because the coral miRNA paper that used it was from 2022, which is quite recent.<br>
<br>
<a href="https://bioinformaticsworkbook.org/dataAnalysis/SmallRNA/Miranda_miRNA_Target_Prediction.html#gsc.tab=0">miRanda tutorial</a></p>
<p>Found a <a href="https://regendbase.org/tools/miranda">site</a> that appears to use the miRanda algorithm in a web based tool, and it seems to be functioning normally</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Screenshot 2024-07-19 165134.png" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Screenshot 2024-07-19 165241.png" class="img-fluid"></p>
<p>I tried emailing the corresponding authors of the miRanda papers, but I’m not confident I’ll hear back. In the meantime I should also look into R package options, which weren’t really covered in the 2014 review I’ve been referencing.</p>
<section id="mirtarrnaseq" class="level3">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">mirTarRnaSeq</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-peterson_common_2014" class="csl-entry">
Peterson, Sarah M., Jeffrey A. Thompson, Melanie L. Ufkin, Pradeep Sathyanarayana, Lucy Liaw, and Clare Bates Congdon. 2014. <span>“Common Features of <span class="nocase">microRNA</span> Target Prediction Tools.”</span> <em>Frontiers in Genetics</em> 5 (February): 23. <a href="https://doi.org/10.3389/fgene.2014.00023">https://doi.org/10.3389/fgene.2014.00023</a>.
</div>
</div></section></div> ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_07_19_mRNA_targetID_programs.html</guid>
  <pubDate>Fri, 19 Jul 2024 07:00:00 GMT</pubDate>
</item>
<item>
  <title>ShortStack: mature vs. star sequences incorrect?</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_06_04_ShortStack_mature_v_star.html</link>
  <description><![CDATA[ 




<p>See <a href="https://github.com/urol-e5/deep-dive/issues/49">E5 deep-dive Github issue #49</a></p>
<p>While looking at ShortStack database matches, for the three species I realized that all three have matches to multiple published sequences of miR-2030, but miR-2030 was not one of the miRNAs identified as conserved between the three species. After poking around I realized that the Apul miR-2030 miRNA and Peve miR-2030 have identical mature miRNA sequences, but the Pmea miR-2030 has a totally different mature sequence. Instead, the <em>star</em> sequence of Pmea miR-2030 matches the mature sequences for Apul miR-2030 and Peve miR-2030. This raises the possibility that ShortStack is incorrectly distinguishing between mature and star sequences, which would throw a bit of a wrench in the current workflow to identify conserved miRNAs. I also noted something similar when <a href="../../../posts/projects/E5_coral/2024_05_17_shortstack_mirdeep2_comparisons.html">comparing ShortStack outputs to the miRdeep2 output</a>.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Screenshot (248).png" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Screenshot (249).png" class="img-fluid"></p>
<p>As a reminder, miRNAs originate as primary miRNA transcripts (“pri-miRNAs”) transcribed from genes, which are characteristically folded in a “hairpin” structure. These pri-miRNAs are then cleaved at their base to form precursor miRNAs (“pre-miRNAs”). The pre-miRNA loop is then removed by Dicer, leaving a mature miRNA duplex. Both of these strands (5’ and 3’) can be loaded into an Argonaute (AGO) protein complex to form an RNA-induced silencing complex (RISC), which then guides gene expression. However, one strand is usually preferentially loaded, in part based on its thermodynamic stability. Strands that are not loaded are unwound from their complement and generally degraded by cellular machinery. The preferentially-loaded strand is commonly titled the “mature miRNA,” while the unloaded strand is commonly called the “miRNA*” or “miRNA star”. Since the AGO-loaded strand (mature miRNA) is the one that actually influences gene expression, this is the strand that is considered important during miRNA identification and analysis. (Summarized from <span class="citation" data-cites="obrien_overview_2018">(O’Brien et al. 2018)</span>)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/miRNA-biogenisis.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">miRNA biogenisis <span class="citation" data-cites="tomari_microrna_2005">(Tomari and Zamore 2005)</span></figcaption>
</figure>
</div>
<p>It isn’t entirely clear from the ShortStack documentation how it distinguishes between mature and star sequences. What sequence features would indicate one strand is more likely to be loaded on to the RISC complex than the other? In addition, O’Brien et al.&nbsp;(2018) seem to suggest that both the mature and star miRNA molecules could play some role in gene expression – does that mean we should be considering both to be important?</p>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-obrien_overview_2018" class="csl-entry">
O’Brien, Jacob, Heyam Hayder, Yara Zayed, and Chun Peng. 2018. <span>“Overview of <span>MicroRNA</span> <span>Biogenesis</span>, <span>Mechanisms</span> of <span>Actions</span>, and <span>Circulation</span>.”</span> <em>Frontiers in Endocrinology</em> 9 (August): 402. <a href="https://doi.org/10.3389/fendo.2018.00402">https://doi.org/10.3389/fendo.2018.00402</a>.
</div>
<div id="ref-tomari_microrna_2005" class="csl-entry">
Tomari, Yukihide, and Phillip D. Zamore. 2005. <span>“<span>MicroRNA</span> <span>Biogenesis</span>: <span>Drosha</span> <span>Can</span>’t <span>Cut</span> <span>It</span> Without a <span>Partner</span>.”</span> <em>Current Biology</em> 15 (2): R61–64. <a href="https://doi.org/10.1016/j.cub.2004.12.057">https://doi.org/10.1016/j.cub.2004.12.057</a>.
</div>
</div></section></div> ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_06_04_ShortStack_mature_v_star.html</guid>
  <pubDate>Mon, 03 Jun 2024 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Comparing ShortStack outputs to miRdeep2</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_05_17_shortstack_mirdeep2_comparisons.html</link>
  <description><![CDATA[ 




<p>Both ShortStack and miRdeep2 are programs for identifying both known and novel miRNAs from a dataset based on an input database of known miRNAs and on expected miRNA size and precursor structures. However, they’re giving pretty different output counts. Today I want to look at how much overlap there is in identified miRNAs between the two.</p>
<p>Rendered code:</p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/D-Apul/code/17-Apul-ShortStack-miRdeep2-comparison.md">A. pulchra</a></p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/17-Peve-ShortStack-miRdeep2-comparison.md">P. evermanni</a></p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/17-Pmea-ShortStack-miRdeep2-comparison.md">P. meandrina</a></p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 23%">
<col style="width: 21%">
<col style="width: 28%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Species</strong></td>
<td><strong>Identified miRNAs</strong></td>
<td><strong>miRNAs with database match</strong></td>
<td><strong>Database matches *not* classified as miRNA</strong></td>
<td><strong># of ShortStack miRNAs that are also classified as miRNA by miRdeep2</strong></td>
</tr>
<tr class="even">
<td>A.pulchra</td>
<td>38</td>
<td>24</td>
<td>44</td>
<td>36</td>
</tr>
<tr class="odd">
<td>P.evermanni</td>
<td>46</td>
<td>9</td>
<td>27</td>
<td>30</td>
</tr>
<tr class="even">
<td>P.meandrina</td>
<td>36</td>
<td>9</td>
<td>20</td>
<td>27</td>
</tr>
</tbody>
</table>
<p>I used bedtools intersectBed to find shared sequences in the ShortStack and miRdeep2 mature miRNA output files.</p>
</section>
<section id="notes" class="level2">
<h2 class="anchored" data-anchor-id="notes">Notes</h2>
<p>Interestingly, in all three of the species I saw an example of an miRNA identified by ShortStack that matched <em>two</em> loci identified as miRNAs by miRdeep2.</p>
<p>In one of these examples (A.pulchra), the mature miRNA sequences for both the miRdeep2 miRNAs were identical, but the <em>precursor</em> sequences were different – could this be an example of two different precursors that are processed into the same miRNA?</p>
<pre><code>NC_058072.1_Acropora_millepora_isolate_JS-1_chromosome_7_Amil_v2.1_whole_genome_shotgun_sequence_295614 12623.6     -   24755   24435   0   320 no  -   tca-miR-11646-3p_MIMAT0045620_Tribolium_castaneum_miR-11646-3p  -   -   ugggugucaucuauuauguuuu  aacauaaaagauggcacc  ugggugucaucuauuauguuuuugcuuguuaaaacauaaaagauggcacc  NC_058072.1_Acropora_millepora_isolate_JS-1_chromosome_7_Amil_v2.1_whole_genome_shotgun_sequence:19030617..19030667:+

NC_058072.1_Acropora_millepora_isolate_JS-1_chromosome_7_Amil_v2.1_whole_genome_shotgun_sequence_295613 1.1     -   24449   24435   14  0   no  -   tca-miR-11646-3p_MIMAT0045620_Tribolium_castaneum_miR-11646-3p  -   -   ugggugucaucuauuauguuuu  aauguaacaaaauugacggccaga    aauguaacaaaauugacggccagaagccguacguauguagaaaauguggggugagugccugggugucaucuauuauguuuu   NC_058072.1_Acropora_millepora_isolate_JS-1_chromosome_7_Amil_v2.1_whole_genome_shotgun_sequence:19030558..19030639:+


mature miRNA sequences for these two loci:
ugggugucaucuauuauguuuu
ugggugucaucuauuauguuuu


precursor miRNA sequences for these two loci:
ugggugucaucuauuauguuuuugcuuguuaaaacauaaaagauggcacc
aauguaacaaaauugacggccagaagccguacguauguagaaaauguggggugagugccugggugucaucuauuauguuuu</code></pre>
<p>In the other two cases (P.evermanni and P.meandrina) the pairs of loci had very similar precursor sequences and <em>reversed</em> mature and star sequences! In other words, the mature miRNA sequence for one is almost identical to the miRNA* sequence of the other, and vice versa!</p>
<p>P. evermanni:</p>
<pre><code>Porites_evermani_scaffold_334_234019    5.6     -   969 686 0   283 yes -   gga-miR-12259-5p_MIMAT0050009_Gallus_gallus_miR-12259-5p    -   -   ugcagguacaguuauaaggu    accuuauaacuguaccugccaa  ugcagguacaguuauaagguccccuugguggaccuuauaacuguaccugccaa   Porites_evermani_scaffold_334:153573..153626:-

Porites_evermani_scaffold_334_233889    5.5     -   111 96  0   15  yes -   cpi-miR-9592-5p_MIMAT0037980_Chrysemys_picta_miR-9592-5p    -   -   gaccuuauaacuguaccugc    gcagguacaguuauaaggucc   gcagguacaguuauaagguccaccaaggggaccuuauaacuguaccugc   Porites_evermani_scaffold_334:153576..153625:+


mature miRNA sequences for these two loci:
ugcagguacaguuauaaggu
gaccuuauaacuguaccugc


miRNA* sequences for these two loci:
accuuauaacuguaccugccaa
gcagguacaguuauaaggucc


precursor miRNA sequences for these two loci:
ugcagguacaguuauaagguccccuugguggaccuuauaacuguaccugccaa
gcagguacaguuauaagguccaccaaggggaccuuauaacuguaccugc</code></pre>
<p>P. meandrina:</p>
<pre><code>Pocillopora_meandrina_HIv1___Sc0000000_1750 6153        -   12060   11275   0   785 yes -   hsa-miR-2117_MIMAT0011162_Homo_sapiens_miR-2117 -   -   uguucucucugcaguaagcaugu augcuugcuguaaagagaacuug uguucucucugcaguaagcauguuuugacaugcuugcuguaaagagaacuug    Pocillopora_meandrina_HIv1___Sc0000000:818048..818100:+

Pocillopora_meandrina_HIv1___Sc0000000_34562    10      -   11  9   0   2   yes -   egr-miR-153-5p_MIMAT0037428_Echinococcus_granulosus_miR-153-5p  -   -   augcuuacugcagagagaacaug aaguucucuuuacagcaagcaugucaaa    aaguucucuuuacagcaagcaugucaaaacaugcuuacugcagagagaacaug   Pocillopora_meandrina_HIv1___Sc0000000:818046..818099:-


mature miRNA sequences for these two loci:
uguucucucugcaguaagcaugu
augcuuacugcagagagaacaug


miRNA* sequences for these two loci:
augcuugcuguaaagagaacuug
aaguucucuuuacagcaagcaugucaaa


precursor miRNA sequences for these two loci:
uguucucucugcaguaagcauguuuugacaugcuugcuguaaagagaacuug
aaguucucuuuacagcaagcaugucaaaacaugcuuacugcagagagaacaug</code></pre>
<p>Could this just be a case of miRdeep2 incorrectly distinguishing the mature and star sequences for one of these loci?</p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_05_17_shortstack_mirdeep2_comparisons.html</guid>
  <pubDate>Fri, 17 May 2024 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Summarizing and visualizing ShortStack outputs</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_05_16_shortstack_visualizations.html</link>
  <description><![CDATA[ 




<p>Rendered code:</p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/D-Apul/code/13.2.1-Apul-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase.md">A. pulchra</a></p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/08.2-Peve-sRNAseq-ShortStack-31bp-fastp-merged.md">P. evermanni</a></p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/13.2.1-Pmea-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase.md">P. meandrina</a></p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<table class="table">
<tbody>
<tr class="odd">
<td></td>
<td><strong>ShortStack</strong></td>
<td><strong>miRdeep2</strong></td>
</tr>
<tr class="even">
<td><strong>Species</strong></td>
<td><strong>Identified miRNAs</strong></td>
<td><strong>miRNAs with database match</strong></td>
</tr>
<tr class="odd">
<td>A.pulchra</td>
<td>38</td>
<td>24</td>
</tr>
<tr class="even">
<td>P.evermanni</td>
<td>46</td>
<td>9</td>
</tr>
<tr class="odd">
<td>P.meandrina</td>
<td>36</td>
<td>9</td>
</tr>
</tbody>
</table>
<p>It looks like all of the ShortStack miRNAs with database matches are matching the annoated cnidarian miRNAs curated by Jill, not standard miRBase entries. These curated cnidarian known miRNAs are almost exclusively from <em>Acropora</em> and <em>Stylophora</em> species, so it makes sense that <em>Acropora pulchra</em> has many more database matches than the other species.</p>
</section>
<section id="a.-pulchra" class="level2">
<h2 class="anchored" data-anchor-id="a.-pulchra">A. pulchra</h2>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/D-Apul/output/13.2.1-Apul-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase/figures/Apul_ShortStack_miRNA_histogram.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/D-Apul/output/13.2.1-Apul-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase/figures/Apul_ShortStack_dbmatch_histogram.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/D-Apul/output/13.2.1-Apul-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase/figures/Apul_ShortStack_venn.png?raw=true" class="img-fluid"></p>
</section>
<section id="p.-meandrina" class="level2">
<h2 class="anchored" data-anchor-id="p.-meandrina">P. meandrina</h2>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/E-Peve/output/08.2-Peve-sRNAseq-ShortStack-31bp-fastp-merged/figures/Peve_ShortStack_miRNA_histogram.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/E-Peve/output/08.2-Peve-sRNAseq-ShortStack-31bp-fastp-merged/figures/Peve_ShortStack_dbmatch_histogram.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/E-Peve/output/08.2-Peve-sRNAseq-ShortStack-31bp-fastp-merged/figures/Peve_ShortStack_venn.png?raw=true" class="img-fluid"></p>
</section>
<section id="p.-evermanni" class="level2">
<h2 class="anchored" data-anchor-id="p.-evermanni">P. evermanni</h2>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/F-Pmea/output/13.2.1-Pmea-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase/figures/Pmea_ShortStack_miRNA_histogram.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/F-Pmea/output/13.2.1-Pmea-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase/figures/Pmea_ShortStack_dbmatch_histogram.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/deep-dive/blob/main/F-Pmea/output/13.2.1-Pmea-sRNAseq-ShortStack-31bp-fastp-merged-cnidarian_miRBase/figures/Pmea_ShortStack_venn.png?raw=true" class="img-fluid"></p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_05_16_shortstack_visualizations.html</guid>
  <pubDate>Thu, 16 May 2024 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Generating a genes fasta for P. evermanni</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_02_07_Peve_transcriptome.html</link>
  <description><![CDATA[ 




<p>In the process of running <a href="../../../posts/projects/E5_coral/2024_02_06_RNAseq_kallisto.html">kallisto on the three E5 deep dive species</a>, we realized that there’s no transcriptome FASTA available for <em>P. evermanni</em>. That means we need to generate one!</p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/12-Peve-RNAseq-kallisto.md">Rendered code</a></p>
<p><u>Related posts:</u><br>
<a href="\posts\projects\E5_coral\2024_02_06_RNAseq_kallisto.qmd">RNAseq abundance quantification (A.Pulchra, P.evermanni, P.meandrina)</a><br>
<a href="\posts\projects\E5_coral\2024_01_31_Peve_kallisto.qmd">P.evermanni RNAseq kallisto debugging</a><br>
<a href="\posts\projects\misc\2024_02_08_bedtools_gffvbed.qmd">Testing bedtools: gff vs bed input file</a></p>
<section id="starter-files" class="level3">
<h3 class="anchored" data-anchor-id="starter-files">Starter files</h3>
<p>The closest file to a <em>P. evermanni</em> transcriptome that we have is a <em>P.evermanni</em> coding sequence (CDS) gff file, and a corresponding genome scaffolds FASTA.</p>
<p>head of gff:</p>
<pre><code>Porites_evermani_scaffold_1 Gmove mRNA 3107 4488 543 - . ID=Peve_00000001;Name=Peve_00000001;start=0;stop=1;cds_size=543 Porites_evermani_scaffold_1 Gmove CDS 3107 3444 . - . Parent=Peve_00000001 
Porites_evermani_scaffold_1 Gmove CDS 4284 4488 . - . Parent=Peve_00000001</code></pre>
<p>A gff file lists information that can be used to identify and retrieve specific sequences. The first column lists the region or scaffold of a reference genome in which the sequence can be found; the third identifies which genomic feature (e.g., mRNA, CDS, UTR) the sequence is; and the fourth and fifth are genomic coordinates for the beginning and end of the sequence. Since we have both the coding sequences gff and a reference fasta, we should be able to extract FASTA sequences for all of the relevant sequences in the gff!</p>
</section>
<section id="extract-cds-sequences" class="level3">
<h3 class="anchored" data-anchor-id="extract-cds-sequences">Extract CDS sequences</h3>
<p>First, it looks like the gff has features labelled a little weirdly. Normally we’d want all of the mRNA sequences, but it looks like this file lists mRNA sequences that include introns. Instead, we want all of the CDS sequences associated with each mRNA (association is denoted in the final column with a parent mRNA ID, e.g.&nbsp;“Parent=Peve_00000001”). That means the first step is to extract all of the CDS sequences from our gff file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract only the CDS sequence lines from the gff</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'CDS'</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_gff}</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_gff_filtered}</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> 5 <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_gff_filtered}</span></span></code></pre></div>
</div>
<pre><code>Porites_evermani_scaffold_1 Gmove   CDS 3107    3444    .   -   .   Parent=Peve_00000001
Porites_evermani_scaffold_1 Gmove   CDS 4284    4488    .   -   .   Parent=Peve_00000001
Porites_evermani_scaffold_1 Gmove   CDS 424479  425361  .   -   .   Parent=Peve_00000002
Porites_evermani_scaffold_1 Gmove   CDS 426181  426735  .   -   .   Parent=Peve_00000002
Porites_evermani_scaffold_1 Gmove   CDS 427013  427140  .   -   .   Parent=Peve_00000002</code></pre>
</section>
<section id="convert-gff-to-bed" class="level3">
<h3 class="anchored" data-anchor-id="convert-gff-to-bed">Convert gff to bed</h3>
<p>Then we convert this filtered CDS gff file to a bed file, which has slightly different formatting. We’re doing this because we’ll be using a tool called bedtools getfasta, which can take both gff and bed files, but which I trust more to appropriately parse bed files (though, see post on whether it can handle gff files correctly as well).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure bedops can find its dependencies when running</span></span>
<span id="cb4-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">PATH</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>/home/shared/bedops_linux_x86_64-v2.4.41/bin:<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PATH</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${bedops}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/gff2bed</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb4-5">--do-not-sort <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb4-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_gff_filtered}</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb4-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_bed}</span></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> 3 <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_gff_filtered}</span></span>
<span id="cb4-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> 3 <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_bed}</span></span></code></pre></div>
</div>
<pre><code>Porites_evermani_scaffold_1 Gmove   CDS 3107    3444    .   -   .   Parent=Peve_00000001
Porites_evermani_scaffold_1 Gmove   CDS 4284    4488    .   -   .   Parent=Peve_00000001
Porites_evermani_scaffold_1 Gmove   CDS 424479  425361  .   -   .   Parent=Peve_00000002

Porites_evermani_scaffold_1 3106    3444    .   .   -   Gmove   CDS .   Parent=Peve_00000001
Porites_evermani_scaffold_1 4283    4488    .   .   -   Gmove   CDS .   Parent=Peve_00000001
Porites_evermani_scaffold_1 424478  425361  .   .   -   Gmove   CDS .   Parent=Peve_00000002</code></pre>
</section>
<section id="generating-a-transcriptome-fasta" class="level3">
<h3 class="anchored" data-anchor-id="generating-a-transcriptome-fasta">Generating a transcriptome FASTA</h3>
<p>The basic approach to generating this transcriptome makes use of the fact that each CDS sequence in our bed file is assigned a “parent” mRNA, denoted by a parent Id in the last column (e.g., “Parent=Peve_00000001”). Each sequence with the same parent ID should be used to a) retrieve a FASTA for that sequence, and b) concatenate all of the FASTAs with the same parent ID into a single, labelled gene FASTA. The below code will iterate through our entire bed file and do this for each parent ID and its associated sequences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load bash variables into memory</span></span>
<span id="cb6-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">source</span> .bashvars</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Navigate to correct directory and make output file</span></span>
<span id="cb6-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_dir}</span></span>
<span id="cb6-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_fasta_name}</span></span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helper list for processing all parent IDs</span></span>
<span id="cb6-9"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">processed_ids</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################################################</span></span>
<span id="cb6-12"></span>
<span id="cb6-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helper function to concatenate and format several bedtools output sequences </span></span>
<span id="cb6-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># into a single, appropriately named contig</span></span>
<span id="cb6-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">concatenate_helper()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-16">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input_bedtools_fastas</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-17">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">parent_ID</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-18">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">reference_name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb6-19">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">positions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb6-20">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">concatenated_sequences</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb6-21"></span>
<span id="cb6-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the input line by line</span></span>
<span id="cb6-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">IFS</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">read</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">line</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">do</span></span>
<span id="cb6-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if the line starts with "&gt;"</span></span>
<span id="cb6-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[[</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$line</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]];</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">then</span></span>
<span id="cb6-26">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract reference name and position from the line</span></span>
<span id="cb6-27">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">reference_position</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${line</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove "&gt;"</span></span>
<span id="cb6-28">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">reference_name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$reference_position</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d:</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f1</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-29">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">position</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$reference_position</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d:</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f2</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-30"></span>
<span id="cb6-31">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Append position to the positions variable</span></span>
<span id="cb6-32">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">positions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$position</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,"</span></span>
<span id="cb6-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span></span>
<span id="cb6-34">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Concatenate sequences</span></span>
<span id="cb6-35">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">concatenated_sequences</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$line</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">fi</span></span>
<span id="cb6-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">done</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$input_bedtools_fastas</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-38"></span>
<span id="cb6-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove trailing comma from positions</span></span>
<span id="cb6-40">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">positions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${positions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-41"></span>
<span id="cb6-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Output the reformatted result</span></span>
<span id="cb6-43">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$parent_ID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$reference_name</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$positions</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-44">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$concatenated_sequences</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-46"></span>
<span id="cb6-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################################################</span></span>
<span id="cb6-48"></span>
<span id="cb6-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Process your input bed file</span></span>
<span id="cb6-50"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">IFS</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">read</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">line</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">do</span></span>
<span id="cb6-51"></span>
<span id="cb6-52">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pull the parent ID number for the current line of the bed</span></span>
<span id="cb6-53">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">parentID</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$line</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Parent=Peve_[0-9]\+'</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-54">    </span>
<span id="cb6-55">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only continue if you haven't already processed the CDS sequences associated with this parent ID</span></span>
<span id="cb6-56">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[[</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">!</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${processed_ids</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[@]</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> "</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$parentID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> "</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]];</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">then</span></span>
<span id="cb6-57"> </span>
<span id="cb6-58">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the current parentID to the processed list</span></span>
<span id="cb6-59">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">processed_ids</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$parentID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-60"></span>
<span id="cb6-61">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create temporary files to store intermediate results</span></span>
<span id="cb6-62">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">temp_CDS_bed_file</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mktemp</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-63">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">temp_bedtools_fasta_file</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mktemp</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-64"></span>
<span id="cb6-65">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grab all of the CDS sequences with the same parent ID and write to temporary file</span></span>
<span id="cb6-66">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$parentID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_bed}</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$temp_CDS_bed_file</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-67"></span>
<span id="cb6-68">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use bedtools to extract corresponding FASTAs and write to temporary file</span></span>
<span id="cb6-69">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${programs_array</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>bedtools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span> getfasta <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fi</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${genome_fasta}</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-bed</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$temp_CDS_bed_file</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$temp_bedtools_fasta_file</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-70"></span>
<span id="cb6-71">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use our helper function to concatenate and format all of these CDS fastas into a single contig</span></span>
<span id="cb6-72">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">concatenated_fasta</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">concatenate_helper</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$temp_bedtools_fasta_file</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$parentID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-73"> </span>
<span id="cb6-74">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the concatenated CDS fasta to our output file on a new line</span></span>
<span id="cb6-75">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$concatenated_fasta</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_fasta}</span></span>
<span id="cb6-76"></span>
<span id="cb6-77">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove the temporary files</span></span>
<span id="cb6-78">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$temp_CDS_bed_file</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$temp_bedtools_fasta_file</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-79">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">fi</span></span>
<span id="cb6-80"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">done</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_bed}</span></span>
<span id="cb6-81"></span>
<span id="cb6-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The output file ends up having a blank first line before the data, so delete that unwanted empty first line</span></span>
<span id="cb6-83"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1{/^$/d}'</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${transcriptome_fasta}</span></span></code></pre></div>
</div>
<p>Now we have a transcriptome FASTA the can be used for kallisto abundance quantification!</p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_02_07_Peve_transcriptome.html</guid>
  <pubDate>Wed, 07 Feb 2024 08:00:00 GMT</pubDate>
</item>
<item>
  <title>RNAseq abundance quantification (A.Pulchra, P.evermanni, P.meandrina)</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_02_06_RNAseq_kallisto.html</link>
  <description><![CDATA[ 




<p>I’m currently working on trying a few types of gene expression analysis with the E5 RNAseq and sRNAseq data we have for <em>A. Pulchra</em>, <em>P. evermanni</em>, and <em>P. meandrina,</em> but before I can do any analysis work we need abundance count matrices for the RNAseq data from each of the three species. This notebook post is a write up of the steps involved in quantifying transcript abundances using kallisto. I’ll only be going step-by-step through the code used for <em>P. meandrina</em>, but the workflow is the same for all three species, and the rendered code for all three species is linked below.<br>
</p>
<p><u>Rendered code (.md files):</u><br>
- <a href="https://github.com/urol-e5/deep-dive/blob/main/D-Apul/code/14-Apul-RNAseq-kallisto.md">A. pulchra</a><br>
- <a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/12-Peve-RNAseq-kallisto.md">P. evermanni</a><br>
- <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/14-Pmea-RNAseq-kallisto.md">P. meandrina</a></p>
<p><u>Required Inputs:</u><br>
- Trimmed RNAseq reads (e.g.&nbsp;<code>.fastq.gz</code>)<br>
- Transcriptome fasta (e.g.&nbsp;<code>*.fasta</code>, <code>*.fna</code>, <code>*.fa</code>)</p>
<p><u>Output:</u><br>
- Counts matrix representing the abundance of sequenced transcripts</p>
<p><u>Tools/software:</u><br>
- kallisto v.0.50.1<br>
- TrinityRNASeq v.2.12.0<br>
</p>
<section id="kallisto-workflow" class="level2">
<h2 class="anchored" data-anchor-id="kallisto-workflow">Kallisto Workflow</h2>
<section id="download-trimmed-reads-and-transcriptome" class="level3">
<h3 class="anchored" data-anchor-id="download-trimmed-reads-and-transcriptome">Download <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/14-Pmea-RNAseq-kallisto.md#download-trimmed-rnaseq-reads">trimmed reads</a> and <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/14-Pmea-RNAseq-kallisto.md#retrieve-the-reference-transcriptome">transcriptome</a></h3>
<p>If you don’t already have them in an accessible directory, download the trimmed RNAseq reads and transcriptome file you’ll be using</p>
</section>
<section id="build-kallisto-index" class="level3">
<h3 class="anchored" data-anchor-id="build-kallisto-index">Build <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/14-Pmea-RNAseq-kallisto.md#building-index">kallisto index</a></h3>
<p>The first step is to build a kallisto index. In this step, kallisto takes your reference transcriptome as input and breaks each transcript into “k-mers,” or shorter sequences that are k nucleotides long. It then “indexes” these k-mers, storing each k-mer and its transcript association in a data structure for more efficient retrieval during the pseudoalignment step.</p>
</section>
<section id="sample-quantification" class="level3">
<h3 class="anchored" data-anchor-id="sample-quantification">Sample <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/14-Pmea-RNAseq-kallisto.md#sample-quantification">quantification</a></h3>
<p>Next is quantification, which take both the index you just constructed and your trimmed RNAseq read, and makes use of pseudoalignment, a process that is much faster and more efficient than aligning each full read to a full transcript. Briefly, each read is broken up into k-mers, which are then mapped to the index to see which indexed transcript k-mers may match the read k-mers. Kallisto then calculates a probability score for each read/transcript pair, evaluating the likelihood that a given read originated from each transcript. These scores are then used to estimate transcript abundance.</p>
</section>
<section id="build-count-matrix-for-all-samples" class="level3">
<h3 class="anchored" data-anchor-id="build-count-matrix-for-all-samples">Build <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/14-Pmea-RNAseq-kallisto.md#trinity-matrix-with-kallisto-output">count matrix</a> for all samples</h3>
<p>The kallisto quantification process can only take one sample (i.e., one pair of reads) at a time, so as a last step we build a counts matrix that lists the transcript abundances for all of our samples in a single file.</p>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p><u>A. pulchra:</u><br>
sample 140 – 47M reads processed (61.4% mapped)<br>
sample 145 – 42M reads processed (65.3% mapped)<br>
sample 150 – 43M reads processed (47.0% mapped)<br>
sample 173 – 47M reads processed (60.7% mapped)<br>
sample 178 – 42M reads processed (59.3% mapped)<br>
</p>
<p><u>P. evermanni:</u><br>
sample 71 – 50M reads processed (35.3% mapped)<br>
sample 73 – 51M reads processed (29.8% mapped)<br>
sample 76 – 49M reads processed (35.6% mapped)<br>
sample 79 – 49M reads processed (31.9% mapped)<br>
sample 82 – 48M reads processed (37.3% mapped)</p>
<p><u>P. meandrina:</u><br>
sample 47 – 54M reads processed (26.1% mapped)<br>
sample 48 – 51M reads processed (25.3% mapped)<br>
sample 50 – 55M reads processed (31.1% mapped)<br>
sample 53 – 53M reads processed (31.8% mapped)<br>
sample 57 – 42M reads processed (21.7% mapped)</p>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_02_06_RNAseq_kallisto.html</guid>
  <pubDate>Tue, 06 Feb 2024 08:00:00 GMT</pubDate>
</item>
<item>
  <title>P.evermanni RNAseq kallisto debugging</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_01_31_Peve_kallisto.html</link>
  <description><![CDATA[ 




<p>I’m currently trying to quantify RNA abundances using RNAseq data from the three E5 deep dive species, and I’m running into some issues for <em>P. evermanni</em>.</p>
<p>Links:</p>
<ul>
<li><a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/12-Peve-RNAseq-kallisto.Rmd">code (.Rmd)</a></li>
<li><a href="https://github.com/urol-e5/deep-dive/blob/main/E-Peve/code/12-Peve-RNAseq-kallisto.md">knitted file (.md)</a></li>
<li><a href="https://github.com/RobertsLab/resources/issues/1793">github issue</a></li>
</ul>
<p>There’s no published transcriptome fasta for <em>P. evermanni</em>, so instead I’m using a published CDS gff file and associated scaffold genome fasta to assemble a de novo reference transcriptome fasta.</p>
<p>I first used bedtools getfasta to extract fasta sequences for everything listed in the original CDS gff file, but ended up with duplicate sequences, which interferes with kallisto indexing. While trying (and failing) to remove duplicates with the fastx_toolkit fastx_collapser, Steven pointed out that the gff file (image below) I’m using contains sequences labeled as both CDS and mRNA sequences, and suggested I use only those labeled as mRNA.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Screenshot (228).png" class="img-fluid"></p>
<p>I selected only sequecnes labelled as “mRNA” in the gff, extracted those sequences fastas from the scaffold reference, and was able to successfully build a kallisto index, however I was given a warning that kallisto index had identified 10,722,052 non-ACGUT characters in the 40,389 input sequences (or ~265 non-ACGUT characters per sequence!). Quickly looking through some of the extracted sequence fastas, I found some of them contain long internal stretches of N characters.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Screenshot (229).png" class="img-fluid"></p>
<p>Sam was able to inform me that this is due to the reference fasta I’m using to extract mRNA fastas. The reference is a scaffold, which characteristically contains arbitrary stretches of Ns connecting known sequences to others in the same region. Steven then also noticed that the gff file seems to be improperly labeled, with mRNA sequences that actually contain several CDS regions <em>and introns</em>, which could interfere with pseudoalignment. Instead, of using the labelled mRNAs, I may need to extract all the sequences labelled as CDS from the gff, obtain sequences fastas, group and concatenate by “Parent” (source mRNA) to exclude all of the introns, and then use those concatenated CDS fasta sequences as a reference for kallisto.</p>
<p>Some pseudo code for doing this:</p>
<p>start with original.gff, which contains CDS, mRNA, UTR, etc. sequences</p>
<p><code>grep -w "CDS" original.gff &gt; filtered.gff</code></p>
<p>now I have a filtered gff that only contains info for CDS sequences in a format that looks like:</p>
<p>blahblahblahblahblahblahblah Parent=Peve_00000001<br>
blahblahblahblahblahblahblah Parent=Peve_00000001<br>
blahblahblahblahblahblahblah Parent=Peve_00000001<br>
blahblahblahblahblahblahblah Parent=Peve_00000002<br>
blahblahblahblahblahblahblah Parent=Peve_00000002<br>
…</p>
<p>where each Parent ID (“Parent=Peve_00000001”) groups together CDS sequences that originate from the same mRNA. To get full concatenated fasta sequences for each mRNA I’ll do:</p>
<pre><code>for i in #LinesInFiltered.gff:

  get parentID of filtered.gff line i

  if parentID not already in final.fasta:

    extract all lines in filtered.gff with parentID
    bedtools to get each lines' fasta sequence
    concatenate all of these fastas
    assign appropriate ID that includes parentID to concatenated fasta
    add this parentID.fasta to final.fasta</code></pre>
<p>this final.fasta should contain the same number of sequence fastas as unique parentIDs in filtered.gff</p>



 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2024_01_31_Peve_kallisto.html</guid>
  <pubDate>Wed, 31 Jan 2024 08:00:00 GMT</pubDate>
</item>
<item>
  <title>P.meandrina sRNA: miRdeep2 and 3 species sRNA comparison</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2023_12_05_E5_coral.html</link>
  <description><![CDATA[ 




<p>The <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/11-Pmea-sRNAseq-miRdeep2.md"><em>P.meandrina</em> miRdeep2</a> finished running!</p>
<p>A quick comparison of the different miRNA ID approaches for the three species we’ve been looking at:</p>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 21%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>miRTrace</th>
<th>MirMachine</th>
<th>BLASTn<br>
(E-val=10)</th>
<th>miRdeep2</th>
<th>ShortStack</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>A. pulchra<br>
</em>(<em>A.millepora</em> for genome-based)</td>
<td>lophotrochozoa, rodents, primates,</td>
<td><p>Predicted loci: <strong>109</strong></p>
<p>Unique families: <strong>11</strong></p></td>
<td><p>miRBase: <strong>19,120,159</strong></p>
<p>MirGene: <strong>19,037,617</strong></p></td>
<td><p>Predicted miRNAs: <strong>4,553</strong></p>
<p>Matches to known miRNAs: <strong>4,137</strong></p>
<p>Novel miRNAs: <strong>416</strong></p></td>
<td><p>Potential loci: <strong>18,772</strong></p>
<p>miRBase matches: <strong>46</strong></p>
<p># characterized as miRNA: <strong>0</strong></p></td>
</tr>
<tr class="even">
<td><em>P. evermanni</em></td>
<td>insects</td>
<td><p>Predicted loci: <strong>83</strong></p>
<p>Unique familes: <strong>15</strong></p></td>
<td><p>miRBase: <strong>8,824,359</strong></p>
<p>MirGene: <strong>8,783,659</strong></p></td>
<td><p>Predicted miRNAs: <strong>5,812</strong></p>
<p>Matches to known miRNAS: <strong>5,096</strong></p>
<p>Novel miRNAs: <strong>716</strong></p></td>
<td><p>Potential loci: <strong>15,040</strong></p>
<p>miRBase matches: <strong>25</strong></p>
<p># characterized as miRNA: <strong>0</strong></p></td>
</tr>
<tr class="odd">
<td><em>P. meandrina</em></td>
<td>nematode, insects, lophotrochozoa, primates</td>
<td><p>Predicted loci: <strong>40</strong></p>
<p>Unique families: <strong>7</strong></p></td>
<td><p>miRBase: <strong>13,708,946</strong></p>
<p>MirGene: <strong>13,614,786</strong></p></td>
<td><p>Predicted miRNAs: <strong>2,429</strong></p>
<p>Matches to known miRNAs: <strong>2,143</strong></p>
<p>Novel miRNAs: <strong>286</strong></p></td>
<td><p>Potential loci: <strong>7,306</strong></p>
<p>miRBase matches: <strong>86</strong></p>
<p># characterized as miRNA: <strong>0</strong></p></td>
</tr>
</tbody>
</table>



 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2023_12_05_E5_coral.html</guid>
  <pubDate>Tue, 05 Dec 2023 08:00:00 GMT</pubDate>
</item>
<item>
  <title>P.meandrina sRNA: MirMachine, ShortStack</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2023_11_30_E5_coral.html</link>
  <description><![CDATA[ 




<p>More on P.meandrina sRNA investigation</p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/12-Pmea-sRNAseq-MirMachine.html"><em>P.meandrina</em> MirMachine</a></p>
<p><a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/13-Pmea-sRNAseq-ShortStack.md"><em>P.meandrina</em> ShortStack</a></p>
<p><em>P.meandrina</em> miRdeep2 (incomplete)</p>



 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2023_11_30_E5_coral.html</guid>
  <pubDate>Thu, 30 Nov 2023 08:00:00 GMT</pubDate>
</item>
<item>
  <title>P.meandrina sRNA: trimming, miRTrace, BLASTn</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2023_11_14_E5_coral.html</link>
  <description><![CDATA[ 




<p>Modified Sam’s code for <em>P.meandrina</em> sRNA <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/08-Pmea-sRNAseq-trimming.md">trimming</a>, <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/09-Pmea-sRNAseq-miRTrace.md">miRTrace</a>, and <a href="https://github.com/urol-e5/deep-dive/blob/main/F-Pmea/code/10-Pmea-sRNAseq-BLASTn.md">BLASTn</a>.</p>



 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2023_11_14_E5_coral.html</guid>
  <pubDate>Tue, 14 Nov 2023 08:00:00 GMT</pubDate>
</item>
</channel>
</rss>
