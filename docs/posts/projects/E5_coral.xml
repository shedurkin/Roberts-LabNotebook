<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Kathleen&#39;s Lab Notebook</title>
<link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral.html</link>
<atom:link href="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.433</generator>
<lastBuildDate>Sun, 25 May 2025 07:00:00 GMT</lastBuildDate>
<item>
  <title>Timeseries molecular: A.pul, multiomic features to predict expression. Machine learning â€“ Feature Proximity WGBS UPDATE</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_25_timeseries_ML_feature_proximity_2.html</link>
  <description><![CDATA[ 




<p>Steven realized that one of the A.pulchra samples had very poor WGBS data, which was limiting the number of CpG sites retained for analysis. I removed that sample from consideration and reran the model. This code builds BED files for the top features associated with each gene, for IGV visualization.</p>
<p>Load libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<section id="load" class="level1">
<h1>Load</h1>
<p>Load feature gtfs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra genome gtf</span></span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/02.20-D-Apul-RNAseq-alignment-HiSat2/Apulchra-genome.stringtie.gtf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2/Apulchra-genome.stringtie.gtf</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra lncRNA gtf</span></span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/08-Apul-lncRNA/lncRNAs.gtf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2/lncRNA.gtf</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra sRNA gff3 (contains all sRNA with notations -- will need to filter to retain only valid miRNA)</span></span>
<span id="cb2-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/04-Apul-sRNA-discovery-ShortStack/ShortStack_out/Results.gff3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2/sRNA.gff3</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra CpG gtf (DNA methylation)</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prohibitively large number of total CpGs, so will only load CpGs we retained for ML model</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note that this is a counts table, but CpG coordinates are stored in their names</span></span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://raw.githubusercontent.com/urol-e5/timeseries_molecular/refs/heads/main/D-Apul/output/22.6-Apul-multiomic-machine-learning-updatedWGBS/filtered-WGBS-CpG-counts.csv <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2/filtered-WGBS-CpG-counts.csv</span></code></pre></div>
</div>
<p>Load df of well-predicted energetic state genes and their respective top predictors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/22.6-Apul-multiomic-machine-learning-updatedWGBS/top_predictors.csv <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2/top_predictors.csv</span></code></pre></div>
</div>
<p>Convert the predictor csv to a tab-delimited file (easier to use with the gtf/gffs in bash)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">awk</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{</span></span>
<span id="cb5-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    for (i = 1; i &lt;= NF; i++) {</span></span>
<span id="cb5-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        gsub(/^"|"$/, "", $i)  # remove surrounding double quotes</span></span>
<span id="cb5-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        gsub(/""/, "\"", $i)   # handle escaped quotes if needed</span></span>
<span id="cb5-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb5-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    OFS = "\t"</span></span>
<span id="cb5-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    print $0</span></span>
<span id="cb5-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}'</span> top_predictors.csv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> top_predictors.tab</span></code></pre></div>
</div>
</section>
<section id="isolate" class="level1">
<h1>Isolate</h1>
<p>Filter genome gtf to obtain gtf of well-predicted genes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will only keep genome gtf entries that contain one of the genes listed in top_predictors.tab</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 3 values (well-predicted genes) from the reference file, skipping the header</span></span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f3</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> well_predicted.txt</span>
<span id="cb6-7"></span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter the GTF file using grep</span></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Ff</span> well_predicted.txt Apulchra-genome.stringtie.gtf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> well-predicted-genes.gtf</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb6-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> well_predicted.txt</span></code></pre></div>
</div>
<p>Filter lncRNA gtf to isolate those that are top predictors of our genes of interest</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will only keep genome gtf entries that contain one of the lncRNA listed in top_predictors.tab</span></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 1 (predictors), skip the header, and filter for entries containing 'lncRNA'</span></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lncRNA'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_lncRNA.txt</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use grep to filter the GTF file based on these patterns</span></span>
<span id="cb7-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Fwf</span> predictive_lncRNA.txt lncRNA.gtf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_lncRNA.gtf</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb7-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> predictive_lncRNA.txt</span></code></pre></div>
</div>
<p>Filter miRNA gff3 to obtain a gff of all miRNA and a gff of our predicitve miRNA</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep sRNA entries that are valid miRNA (MIRNA=Y)</span></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MIRNA=Y'</span> sRNA.gff3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> mirna.gff3</span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract miRNA that are top predictors</span></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 1 (predictors), skip the header, and filter for entries containing 'Cluster'</span></span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cluster'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_miRNA.txt</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use grep to filter the GTF file based on these patterns</span></span>
<span id="cb8-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Fwf</span> predictive_miRNA.txt sRNA.gff3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_miRNA.gff3</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb8-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> predictive_miRNA.txt</span></code></pre></div>
</div>
<p>From the CpG counts matrix, obtain a bed file of all considered CpGs and a bed file of predictive CpGs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in csv and isolate the CpG names</span></span>
<span id="cb9-2">CpG_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/filtered-WGBS-CpG-counts.csv"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">all_CpGs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CpG_counts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract chromosome and position using regex</span></span>
<span id="cb9-7">chrom <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^CpG_(.+)_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d+$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1"</span>, all_CpGs)</span>
<span id="cb9-8">pos   <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".*_(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d+)$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1"</span>, all_CpGs))</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Construct BED-format data frame</span></span>
<span id="cb9-11">bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb9-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chrom =</span> chrom,</span>
<span id="cb9-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> pos <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BED is 0-based</span></span>
<span id="cb9-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end   =</span> pos,</span>
<span id="cb9-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name  =</span> all_CpGs         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># name column</span></span>
<span id="cb9-16">)</span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write to BED file</span></span>
<span id="cb9-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(bed, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/CpGs.bed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_25_timeseries_ML_feature_proximity_2</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will only keep CpG bed entries that contain one of the CpGs listed in top_predictors.tab</span></span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 1 (predictors), skip the header, and filter for entries containing 'lncRNA'</span></span>
<span id="cb10-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'CpG'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_CpGs.txt</span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use grep to filter the GTF file based on these patterns</span></span>
<span id="cb10-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Fwf</span> predictive_CpGs.txt CpGs.bed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_CpGs.bed</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb10-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> predictive_CpGs.txt</span></code></pre></div>
</div>
</section>
<section id="gene-feature-files" class="level1">
<h1>Gene feature files</h1>
<p>I also want a feature file for each gene, that contains coordinate information for that gene and its top predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Load predictor table</span></span>
<span id="cb11-2">preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/top_predictors.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Load annotations</span></span>
<span id="cb12-2">all_genes_gtf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/Apulchra-genome.stringtie.gtf"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-3">all_lncrna_gtf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/lncrna.gtf"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-4">all_mirna_gff3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/miRNA.gff3"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-5">all_cpg_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/CpGs.bed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#For non-bed files, need to convert 1-start positions to 0-start positions</span></span>
<span id="cb12-8">all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-9">all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-10">all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-11">all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start</span>
<span id="cb12-12"></span>
<span id="cb12-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Column with just the feature ID</span></span>
<span id="cb12-14">all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=ref_gene_id )[^;]+"</span>)</span>
<span id="cb12-15">all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=gene_id )[^;]+"</span>)</span>
<span id="cb12-16">all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=ID=)[^;]+"</span>)</span>
<span id="cb12-17">all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info</span>
<span id="cb12-18"></span>
<span id="cb12-19"></span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove superfluous features (e.g. gene exon notes, miRNA star and precursor) and save bed style columns</span></span>
<span id="cb12-21">all_genes_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes_gtf[all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript"</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb12-22">all_lncrna_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_lncrna_gtf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb12-23">all_mirna_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb12-24">all_cpg_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_cpg_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each unique feature</span></span>
<span id="cb13-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feat <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(preds<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)) {</span>
<span id="cb13-3"></span>
<span id="cb13-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get predictors for this feature</span></span>
<span id="cb13-5">  pred_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> preds <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Feature <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> feat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rank =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>(),</span>
<span id="cb13-8">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_ID =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(Predictor, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, rank, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(MeanImportance, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)))</span>
<span id="cb13-9"></span>
<span id="cb13-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract IDs grouped by type</span></span>
<span id="cb13-11">  lnc_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred_ids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^lncRNA_"</span>, Predictor))</span>
<span id="cb13-12">  mir_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred_ids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Cluster_"</span>, Predictor))</span>
<span id="cb13-13">  cpg_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred_ids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^CpG_"</span>, Predictor))</span>
<span id="cb13-14"></span>
<span id="cb13-15">  feat_range <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> feat)</span>
<span id="cb13-16">  </span>
<span id="cb13-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Match and update lncRNA predictors</span></span>
<span id="cb13-18">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(lnc_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb13-19">    lnc_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_lncrna_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(lnc_ids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ID"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predictor"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-21">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ID =</span> new_ID) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb13-23">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb13-24">    lnc_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb13-25">  }</span>
<span id="cb13-26"></span>
<span id="cb13-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Match and update miRNA predictors</span></span>
<span id="cb13-28">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(mir_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb13-29">    mirna_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_mirna_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(mir_ids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ID"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predictor"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-31">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ID =</span> new_ID) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-32">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb13-33">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb13-34">    mirna_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb13-35">  }</span>
<span id="cb13-36">  </span>
<span id="cb13-37">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Match and update CpG predictors</span></span>
<span id="cb13-38">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(cpg_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb13-39">    cpg_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_cpg_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-40">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(cpg_ids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ID"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predictor"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-41">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ID =</span> new_ID) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-42">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb13-43">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb13-44">    cpg_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb13-45">  }</span>
<span id="cb13-46"></span>
<span id="cb13-47">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all into one BED-like table</span></span>
<span id="cb13-48">  bed_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb13-49">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(feat_range) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID),</span>
<span id="cb13-50">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(lnc_ranges),</span>
<span id="cb13-51">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(mirna_ranges),</span>
<span id="cb13-52">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(cpg_ranges)</span>
<span id="cb13-53">  )</span>
<span id="cb13-54"></span>
<span id="cb13-55">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write to BED</span></span>
<span id="cb13-56">  out_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_25_timeseries_ML_feature_proximity_2/"</span>, feat, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_with_predictors.bed"</span>)</span>
<span id="cb13-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(bed_df, out_file, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb13-58">}</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_25_timeseries_ML_feature_proximity_2.html</guid>
  <pubDate>Sun, 25 May 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul, multiomic features to predict expression. Machine learning â€“ Feature Proximity</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_16_timeseries_ML_feature_proximity.html</link>
  <description><![CDATA[ 




<p>Load libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<section id="load" class="level1">
<h1>Load</h1>
<p>Load feature gtfs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra genome gtf</span></span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/02.20-D-Apul-RNAseq-alignment-HiSat2/Apulchra-genome.stringtie.gtf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_16_timeseries_ML_feature_proximity/Apulchra-genome.stringtie.gtf</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra lncRNA gtf</span></span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/08-Apul-lncRNA/lncRNAs.gtf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_16_timeseries_ML_feature_proximity/lncRNA.gtf</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra sRNA gff3 (contains all sRNA with notations -- will need to filter to retain only valid miRNA)</span></span>
<span id="cb2-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/04-Apul-sRNA-discovery-ShortStack/ShortStack_out/Results.gff3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_16_timeseries_ML_feature_proximity/sRNA.gff3</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A.pulchra CpG gtf (DNA methylation)</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prohibitively large number of total CpGs, so will only load CpGs we retained for ML model</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note that this is a counts table, but CpG coordinates are stored in their names</span></span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/22.2-Apul-multiomic-machine-learning/filtered-WGBS-CpG-counts.csv <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_16_timeseries_ML_feature_proximity/filtered-WGBS-CpG-counts.csv</span></code></pre></div>
</div>
<p>Load df of well-predicted energetic state genes and their respective top predictors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/22.3-Apul-multiomic-machine-learning-byTP/top_predictors.csv <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> ./output/2025_05_16_timeseries_ML_feature_proximity/top_predictors.csv</span></code></pre></div>
</div>
<p>Convert the predictor csv to a tab-delimited file (easier to use with the gtf/gffs in bash)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_16_timeseries_ML_feature_proximity</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">awk</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{</span></span>
<span id="cb5-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    for (i = 1; i &lt;= NF; i++) {</span></span>
<span id="cb5-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        gsub(/^"|"$/, "", $i)  # remove surrounding double quotes</span></span>
<span id="cb5-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        gsub(/""/, "\"", $i)   # handle escaped quotes if needed</span></span>
<span id="cb5-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb5-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    OFS = "\t"</span></span>
<span id="cb5-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    print $0</span></span>
<span id="cb5-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}'</span> top_predictors.csv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> top_predictors.tab</span></code></pre></div>
</div>
</section>
<section id="isolate" class="level1">
<h1>Isolate</h1>
<p>Filter genome gtf to obtain gtf of well-predicted genes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_16_timeseries_ML_feature_proximity</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will only keep genome gtf entries that contain one of the genes listed in top_predictors.tab</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 3 values (well-predicted genes) from the reference file, skipping the header</span></span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f3</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> well_predicted.txt</span>
<span id="cb6-7"></span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter the GTF file using grep</span></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Ff</span> well_predicted.txt Apulchra-genome.stringtie.gtf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> well-predicted-genes.gtf</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb6-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> well_predicted.txt</span></code></pre></div>
</div>
<p>Filter lncRNA gtf to isolate those that are top predictors of our genes of interest</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_16_timeseries_ML_feature_proximity</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will only keep genome gtf entries that contain one of the lncRNA listed in top_predictors.tab</span></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 1 (predictors), skip the header, and filter for entries containing 'lncRNA'</span></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lncRNA'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_lncRNA.txt</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use grep to filter the GTF file based on these patterns</span></span>
<span id="cb7-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Fwf</span> predictive_lncRNA.txt lncRNA.gtf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_lncRNA.gtf</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb7-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> predictive_lncRNA.txt</span></code></pre></div>
</div>
<p>Filter miRNA gff3 to obtain a gff of all miRNA and a gff of our predicitve miRNA</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_16_timeseries_ML_feature_proximity</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep sRNA entries that are valid miRNA (MIRNA=Y)</span></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MIRNA=Y'</span> sRNA.gff3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> mirna.gff3</span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract miRNA that are top predictors</span></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 1 (predictors), skip the header, and filter for entries containing 'Cluster'</span></span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cluster'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_miRNA.txt</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use grep to filter the GTF file based on these patterns</span></span>
<span id="cb8-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Fwf</span> predictive_miRNA.txt sRNA.gff3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_miRNA.gff3</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb8-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> predictive_miRNA.txt</span></code></pre></div>
</div>
<p>From the CpG counts matrix, obtain a bed file of all considered CpGs and a bed file of predictive CpGs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in csv and isolate the CpG names</span></span>
<span id="cb9-2">CpG_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/filtered-WGBS-CpG-counts.csv"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">all_CpGs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CpG_counts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract chromosome and position using regex</span></span>
<span id="cb9-7">chrom <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^CpG_(.+)_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d+$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1"</span>, all_CpGs)</span>
<span id="cb9-8">pos   <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".*_(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d+)$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1"</span>, all_CpGs))</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Construct BED-format data frame</span></span>
<span id="cb9-11">bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb9-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chrom =</span> chrom,</span>
<span id="cb9-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> pos <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BED is 0-based</span></span>
<span id="cb9-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end   =</span> pos,</span>
<span id="cb9-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name  =</span> all_CpGs         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># name column</span></span>
<span id="cb9-16">)</span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write to BED file</span></span>
<span id="cb9-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(bed, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/CpGs.bed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ./output/2025_05_16_timeseries_ML_feature_proximity</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will only keep CpG bed entries that contain one of the CpGs listed in top_predictors.tab</span></span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract column 1 (predictors), skip the header, and filter for entries containing 'lncRNA'</span></span>
<span id="cb10-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> +2 top_predictors.tab <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'CpG'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_CpGs.txt</span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use grep to filter the GTF file based on these patterns</span></span>
<span id="cb10-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Fwf</span> predictive_CpGs.txt CpGs.bed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> predictive_CpGs.bed</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intermediate file</span></span>
<span id="cb10-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> predictive_CpGs.txt</span></code></pre></div>
</div>
</section>
<section id="gene-feature-files" class="level1">
<h1>Gene feature files</h1>
<p>I also want a feature file for each gene, that contains coordinate information for that gene and its top predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Load predictor table</span></span>
<span id="cb11-2">preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/top_predictors.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Load annotations</span></span>
<span id="cb12-2">all_genes_gtf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/Apulchra-genome.stringtie.gtf"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-3">all_lncrna_gtf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/lncrna.gtf"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-4">all_mirna_gff3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/miRNA.gff3"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-5">all_cpg_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/CpGs.bed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaffold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info"</span>))</span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#For non-bed files, need to convert 1-start positions to 0-start positions</span></span>
<span id="cb12-8">all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-9">all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-10">all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-11">all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>start</span>
<span id="cb12-12"></span>
<span id="cb12-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Column with just the feature ID</span></span>
<span id="cb12-14">all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=ref_gene_id )[^;]+"</span>)</span>
<span id="cb12-15">all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(all_lncrna_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=gene_id )[^;]+"</span>)</span>
<span id="cb12-16">all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=ID=)[^;]+"</span>)</span>
<span id="cb12-17">all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_cpg_bed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>info</span>
<span id="cb12-18"></span>
<span id="cb12-19"></span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove superfluous features (e.g. gene exon notes, miRNA star and precursor) and save bed style columns</span></span>
<span id="cb12-21">all_genes_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes_gtf[all_genes_gtf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transcript"</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb12-22">all_lncrna_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_lncrna_gtf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb12-23">all_mirna_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_mirna_gff3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span>
<span id="cb12-24">all_cpg_bed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_cpg_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each unique feature</span></span>
<span id="cb13-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feat <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(preds<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)) {</span>
<span id="cb13-3"></span>
<span id="cb13-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get predictors for this feature</span></span>
<span id="cb13-5">  pred_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> preds <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Feature <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> feat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Predictor)</span>
<span id="cb13-6"></span>
<span id="cb13-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Group predictors by type using pattern matching (still grepl for this part)</span></span>
<span id="cb13-8">  lnc_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred_ids[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^lncRNA_"</span>, pred_ids)]</span>
<span id="cb13-9">  mir_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred_ids[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Cluster_"</span>, pred_ids)]</span>
<span id="cb13-10">  cpg_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pred_ids[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^CpG_"</span>, pred_ids)]</span>
<span id="cb13-11"></span>
<span id="cb13-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get ranges for feature and its predictors using exact ID matching</span></span>
<span id="cb13-13">  feat_range <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> feat)</span>
<span id="cb13-14">  lnc_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(lnc_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) all_lncrna_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> lnc_ids) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb13-15">  mirna_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(mir_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) all_mirna_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> mir_ids) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb13-16">  cpg_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(cpg_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) all_cpg_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> cpg_ids) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb13-17"></span>
<span id="cb13-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all into one BED-like table</span></span>
<span id="cb13-19">  bed_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb13-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(feat_range) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(scaffold, start_bed, end, ID),</span>
<span id="cb13-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(lnc_ranges),</span>
<span id="cb13-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(mirna_ranges),</span>
<span id="cb13-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(cpg_ranges)</span>
<span id="cb13-24">  )</span>
<span id="cb13-25"></span>
<span id="cb13-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write to BED</span></span>
<span id="cb13-27">  out_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/"</span>, feat, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_with_predictors.bed"</span>)</span>
<span id="cb13-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(bed_df, out_file, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb13-29">}</span></code></pre></div>
</div>
</section>
<section id="feature-files-for-binding-based-interactions" class="level1">
<h1>Feature files for binding-based interactions</h1>
<p>Read in cytoscape edges file, which shows all miRNA interactions with binding and PCC information</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">interactions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(source, target, PCC.cor) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (mirna <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(interactions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>source)) {</span>
<span id="cb15-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get interactions for this feature</span></span>
<span id="cb15-3">  inter_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> interactions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(source <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> mirna) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(target)</span>
<span id="cb15-4"></span>
<span id="cb15-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Group interactions by type</span></span>
<span id="cb15-6">  lnc_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> inter_ids[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^lncRNA_"</span>, inter_ids)]</span>
<span id="cb15-7">  gene_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> inter_ids[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FUN_"</span>, inter_ids)]</span>
<span id="cb15-8"></span>
<span id="cb15-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get ranges for feature and its predictors using exact matches</span></span>
<span id="cb15-10">  mirna_range <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_mirna_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> mirna)</span>
<span id="cb15-11">  </span>
<span id="cb15-12">  lnc_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(lnc_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) lncrna_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> lnc_ids) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb15-13">  gene_ranges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(gene_ids) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) all_genes_bed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> gene_ids) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb15-14"></span>
<span id="cb15-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all into one BED-like table</span></span>
<span id="cb15-16">  bed_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb15-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(mirna_range),</span>
<span id="cb15-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(lnc_ranges),</span>
<span id="cb15-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(gene_ranges)</span>
<span id="cb15-20">  )</span>
<span id="cb15-21"></span>
<span id="cb15-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write to BED</span></span>
<span id="cb15-23">  out_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_16_timeseries_ML_feature_proximity/"</span>, mirna, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_with_interactions.bed"</span>)</span>
<span id="cb15-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(bed_df, out_file, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb15-25">}</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_16_timeseries_ML_feature_proximity.html</guid>
  <pubDate>Fri, 16 May 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul, multiomic features to predict expression. Machine learning â€“ Lit Review</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_13_timeseries_multiomic_ML_lit_review.html</link>
  <description><![CDATA[ 




<p>Now that I have a set of consistently well-predicted genes related to energetic state (see relevant posts <a href="../../../posts/projects/E5_coral/2025_05_08_timeseries_multiomic_ML_3.html">here</a> and <a href="../../../posts/projects/E5_coral/2025_05_12_timeseries_multiomic_ML_4.html">here</a>), I want to identify genes/predictive networks that may be of particular interest.</p>
<p>To facilitate that Iâ€™ll do a literature search for each of the protein products of my gene set.</p>
<p>Grab the 28 consistently well-predicted energetic state genes and their annotations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DT)</span>
<span id="cb5-3"></span>
<span id="cb5-4">highperf_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/22.3-Apul-multiomic-machine-learning-byTP/energetic_state_highperf_FA.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>X)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">datatable</span>(highperf_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(gene, Protein.names), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">options =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scrollX =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-e7a026a04a25277627ae" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e7a026a04a25277627ae">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"],["FUN_002433","FUN_004083","FUN_001160","FUN_001326","FUN_001396","FUN_007022","FUN_008296","FUN_008934","FUN_011908","FUN_012474","FUN_015434","FUN_023367","FUN_023596","FUN_025232","FUN_027948","FUN_028200","FUN_032220","FUN_034872","FUN_035467","FUN_035468","FUN_037573","FUN_039293","FUN_040784","FUN_041710","FUN_041721","FUN_042950","FUN_042949","FUN_042982"],["Methylglutaconyl-CoA hydratase, mitochondrial (3-MG-CoA hydratase) (EC 4.2.1.18) (AU-specific RNA-binding enoyl-CoA hydratase) (AU-binding enoyl-CoA hydratase) (Itaconyl-CoA hydratase) (EC 4.2.1.56)","Dipeptidyl peptidase 2 (EC 3.4.14.2) (Dipeptidyl aminopeptidase II) (Dipeptidyl peptidase 7) (Dipeptidyl peptidase II) (DPP II) (Quiescent cell proline dipeptidase)","Carnitine O-palmitoyltransferase 1, liver isoform (CPT1-L) (EC 2.3.1.21) (Carnitine O-palmitoyltransferase I, liver isoform) (CPT I) (CPTI-L) (Carnitine palmitoyltransferase 1A)","Lysosomal acid lipase/cholesteryl ester hydrolase (Acid cholesteryl ester hydrolase) (LAL) (EC 3.1.1.13) (Cholesteryl esterase) (Lipase A) (Sterol esterase)","Dicarboxylate carrier SLC25A8 (Mitochondrial uncoupling protein 2) (UCP 2) (Solute carrier family 25 member 8)","Cryptochrome-1","E3 ubiquitin-protein ligase synoviolin (EC 2.3.2.27) (RING-type E3 ubiquitin transferase synoviolin) (Synovial apoptosis inhibitor 1)","Exostosin-1 (EC 2.4.1.224) (EC 2.4.1.225) (Glucuronosyl-N-acetylglucosaminyl-proteoglycan/N-acetylglucosaminyl-proteoglycan 4-alpha-N-acetylglucosaminyltransferase) (Multiple exostoses protein 1 homolog)","Platelet-activating factor acetylhydrolase IB subunit alpha2 (EC 3.1.1.47) (PAF acetylhydrolase 30 kDa subunit) (PAF-AH 30 kDa subunit) (PAF-AH subunit beta) (PAFAH subunit beta)","Lipase ZK262.3 (EC 3.1.1.-)","Fructose-bisphosphate aldolase C (EC 4.1.2.13) (Brain-type aldolase)","Hexokinase-4 (HK4) (EC 2.7.1.1) (Glucokinase) (Hexokinase type IV) (HK IV) (Hexokinase-D)","Suppressor of tumorigenicity 14 protein (EC 3.4.21.109) (Matriptase) (Membrane-type serine protease 1) (MT-SP1) (Prostamin) (Serine protease 14) (Serine protease TADG-15) (Tumor-associated differentially-expressed gene 15 protein)","Glyceraldehyde-3-phosphate dehydrogenase (GAPDH) (EC 1.2.1.12)","PI-PLC X domain-containing protein 3","26S proteasome regulatory subunit 6B (26S proteasome AAA-ATPase subunit RPT3) (Proteasome 26S subunit ATPase 4)","Dihydrolipoyllysine-residue acetyltransferase component of pyruvate dehydrogenase complex, mitochondrial (EC 2.3.1.12) (Dihydrolipoamide acetyltransferase component of pyruvate dehydrogenase complex) (Pyruvate dehydrogenase complex component E2) (PDC-E2) (PDCE2)","Lipase ZK262.3 (EC 3.1.1.-)","Phosphoenolpyruvate carboxykinase [GTP], mitochondrial (PEPCK-M) (EC 4.1.1.32)","Phosphoenolpyruvate carboxykinase [GTP], mitochondrial (PEPCK-M) (EC 4.1.1.32)","26S proteasome regulatory subunit 6A-B (26S proteasome AAA-ATPase subunit RPT5-B) (Proteasome 26S subunit ATPase 3-B) (Tat-binding protein 10) (TBP-10)","Glyceraldehyde-3-phosphate dehydrogenase (GAPDH) (EC 1.2.1.12)","Acyl-coenzyme A oxidase 2, peroxisomal (AOX 2) (EC 1.3.3.6) (Long-chain acyl-CoA oxidase) (AtCX2)","Propionyl-CoA carboxylase alpha chain (EC 6.4.1.3)","Platelet-activating factor acetylhydrolase IB subunit alpha2 (EC 3.1.1.47) (PAF acetylhydrolase 30 kDa subunit) (PAF-AH 30 kDa subunit) (PAF-AH subunit beta) (PAFAH subunit beta)","TNF receptor-associated factor 2 (EC 2.3.2.27) (E3 ubiquitin-protein ligase TRAF2) (RING-type E3 ubiquitin transferase TRAF2) (Tumor necrosis factor type 2 receptor-associated protein 3)","TNF receptor-associated factor 2 (EC 2.3.2.27) (E3 ubiquitin-protein ligase TRAF2) (RING-type E3 ubiquitin transferase TRAF2) (Tumor necrosis factor type 2 receptor-associated protein 3)","Alkylglycerol monooxygenase (EC 1.14.16.5) (Transmembrane protein 195)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>gene<\/th>\n      <th>Protein.names<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"gene","targets":1},{"name":"Protein.names","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Hereâ€™s a concise summary of the functions of the listed genes, focusing on their roles in energy production, utilization, and storage (AI-assisted):</p>
<hr>
<section id="fun_002433-methylglutaconyl-coa-hydratase-auh" class="level3">
<h3 class="anchored" data-anchor-id="fun_002433-methylglutaconyl-coa-hydratase-auh">1. <strong>FUN_002433 â€“ Methylglutaconyl-CoA Hydratase (AUH)</strong></h3>
<ul>
<li><strong>Function:</strong> Catalyzes a step in leucine degradation, converting 3-methylglutaconyl-CoA to 3-hydroxy-3-methylglutaryl-CoA.</li>
<li><strong>Energy Role:</strong> Essential for mitochondrial energy metabolism; deficiencies can lead to accumulation of metabolic intermediates and impaired mitochondrial function. (<a href="https://en.wikipedia.org/wiki/Methylglutaconyl-CoA_hydratase?utm_source=chatgpt.com" title="Methylglutaconyl-CoA hydratase">Wikipedia</a>)</li>
</ul>
<p>Its disregulation has been previously associated with a lncRNA (https://www.genecards.org/cgi-bin/carddisp.pl?gene=LINC00484)</p>
<hr>
</section>
<section id="fun_004083-dipeptidyl-peptidase-ii-dpp-ii" class="level3">
<h3 class="anchored" data-anchor-id="fun_004083-dipeptidyl-peptidase-ii-dpp-ii">2. <strong>FUN_004083 â€“ Dipeptidyl Peptidase II (DPP II)</strong></h3>
<ul>
<li><strong>Function:</strong> Removes N-terminal dipeptides from polypeptides.</li>
<li><strong>Energy Role:</strong> Involved in protein turnover, indirectly influencing energy homeostasis. (<a href="https://www.sciencedirect.com/topics/biochemistry-genetics-and-molecular-biology/dipeptidyl-peptidase-ii?utm_source=chatgpt.com" title="Dipeptidyl-Peptidase II - an overview | ScienceDirect Topics">ScienceDirect</a>)</li>
</ul>
<p>In <em>Aptasia</em>, Dipeptidyl peptidase 2 proteins are less abundant in anemones colonized by symbionts (Sproles et al.&nbsp;2019)</p>
<p>Various ncRNAs have been implicated in the regulation of dipeptidyl peptidase genes (though not DPP2 specifically)</p>
<hr>
</section>
<section id="fun_001160-carnitine-o-palmitoyltransferase-1a-cpt1a" class="level3">
<h3 class="anchored" data-anchor-id="fun_001160-carnitine-o-palmitoyltransferase-1a-cpt1a">3. <strong>FUN_001160 â€“ Carnitine O-palmitoyltransferase 1A (CPT1A)</strong></h3>
<ul>
<li><strong>Function:</strong> Facilitates the transport of long-chain fatty acids into mitochondria for Î²-oxidation.</li>
<li><strong>Energy Role:</strong> Crucial for fatty acid metabolism and energy production, especially during fasting. (<a href="https://www.uniprot.org/uniprotkb/P50416/entry?utm_source=chatgpt.com" title="CPT1A - Carnitine O-palmitoyltransferase 1, liver isoform - UniProt">UniProt</a>)</li>
</ul>
<p>In aposymbiotic morphotypes of the coral <em>Fimbriaphyllia paradivisa</em>, CPT1A was rhythmically transcribed over 12-hour day/night cycles, suggesting its expression is influenced by symbiont interactions and daily light cycles (Aslett 2024) (https://reefranch.co.uk/wp-content/uploads/2024/11/Coral-Rhythms-Part-II.pdf)</p>
<hr>
</section>
<section id="fun_001326-lysosomal-acid-lipase-lal" class="level3">
<h3 class="anchored" data-anchor-id="fun_001326-lysosomal-acid-lipase-lal">4. <strong>FUN_001326 â€“ Lysosomal Acid Lipase (LAL)</strong></h3>
<ul>
<li><strong>Function:</strong> Hydrolyzes cholesteryl esters and triglycerides in lysosomes.</li>
<li><strong>Energy Role:</strong> Releases free cholesterol and fatty acids for cellular energy use and storage. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC6215475/?utm_source=chatgpt.com" title="Lysosomal acid lipase and lipid metabolism: new mechanisms, new ...">PMC</a>)</li>
</ul>
<p>LALs have also been identified as in the tentacle transcriptomes of several hydrozoan and scyphozoan jellyfish, as well as in the venom glands of snakes, though their function in venom toxicity remains unclear (Doonan et al.&nbsp;2019, Ponce et al.&nbsp;2016)</p>
<hr>
</section>
<section id="fun_001396-uncoupling-protein-2-ucp2" class="level3">
<h3 class="anchored" data-anchor-id="fun_001396-uncoupling-protein-2-ucp2">5. <strong>FUN_001396 â€“ Uncoupling Protein 2 (UCP2)</strong></h3>
<ul>
<li><strong>Function:</strong> Mediates proton leak across the mitochondrial inner membrane, reducing membrane potential.</li>
<li><strong>Energy Role:</strong> Regulates energy efficiency and thermogenesis, impacting glucose metabolism. (<a href="https://www.ncbi.nlm.nih.gov/gene/7351?utm_source=chatgpt.com" title="7351 - Gene ResultUCP2 uncoupling protein 2 [ (human)] - NCBI">NCBI</a>)</li>
</ul>
<p>A mitochondrial uncoupling protein that functions in decreasing mitochondrial membrane potential and ROS production. Participates in the Krebs cycle.</p>
<p>Upregulated in <em>Montastraea cavernosa</em> in the healthy tissues of colonies afflicted by stony coral tissue loss disease (SCTLD) (Beavers et al.&nbsp;2024)</p>
<hr>
</section>
<section id="fun_007022-cryptochrome-1-cry1" class="level3">
<h3 class="anchored" data-anchor-id="fun_007022-cryptochrome-1-cry1">6. <strong>FUN_007022 â€“ Cryptochrome-1 (CRY1)</strong></h3>
<ul>
<li><strong>Function:</strong> Core component of the circadian clock.</li>
<li><strong>Energy Role:</strong> Modulates metabolic pathways in a time-dependent manner, influencing energy metabolism. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC7648728/?utm_source=chatgpt.com" title="CRY1-CBS binding regulates circadian clock function and metabolism">PMC</a>)</li>
</ul>
<p>In vertebrates and insects, cryptochromes are involved in regulation fo the circadian rhythm.</p>
<p>In corals, cryptochromes are likely involved in photoreception. For example, in <em>Acropora millepora</em>, cryptochromes have been reported to be preferentially expressed in light, including some types showing differential expression based on lunar cycle, suggesting a potential role in behavior synchronization, such as mass spawning (Levy et al.&nbsp;2007).</p>
<p>In plants, cryptochrome expression is linked to expression of miRNA and lncRNA. For example, in the algae <em>Saccharina japonica</em>, expression of a type of cryptochrome is regulated by an miRNA and several lncRNA (Yang et al.&nbsp;2020) (the implicated miRNA does not match Cluster_17173)</p>
<hr>
</section>
<section id="fun_008296-e3-ubiquitin-protein-ligase-synoviolin-syvn1" class="level3">
<h3 class="anchored" data-anchor-id="fun_008296-e3-ubiquitin-protein-ligase-synoviolin-syvn1">7. <strong>FUN_008296 â€“ E3 Ubiquitin-Protein Ligase Synoviolin (SYVN1)</strong></h3>
<ul>
<li><strong>Function:</strong> Tags proteins for degradation via the ubiquitin-proteasome system.</li>
<li><strong>Energy Role:</strong> Regulates mitochondrial biogenesis and energy metabolism through modulation of PGC-1Î². (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC4406651/?utm_source=chatgpt.com" title="The E3 ligase synoviolin controls body weight and mitochondrial ...">PMC</a>)</li>
</ul>
<hr>
</section>
<section id="fun_008934-exostosin-1-ext1" class="level3">
<h3 class="anchored" data-anchor-id="fun_008934-exostosin-1-ext1">8. <strong>FUN_008934 â€“ Exostosin-1 (EXT1)</strong></h3>
<ul>
<li><strong>Function:</strong> Involved in heparan sulfate biosynthesis.</li>
<li><strong>Energy Role:</strong> Influences glycosylation processes that can affect energy metabolism. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10801894/?utm_source=chatgpt.com" title="The exostosin glycosyltransferase 1/STAT3 axis is a driver of breast ...">PMC</a>, <a href="https://www.biorxiv.org/content/10.1101/2020.09.02.275925.full?utm_source=chatgpt.com" title="Exostosin-1 Glycosyltransferase Regulates Endoplasmic Reticulum ...">BioRxiv</a>)</li>
</ul>
<hr>
</section>
<section id="fun_011908-platelet-activating-factor-acetylhydrolase-ib-subunit-alpha2-pafah1b2" class="level3">
<h3 class="anchored" data-anchor-id="fun_011908-platelet-activating-factor-acetylhydrolase-ib-subunit-alpha2-pafah1b2">9. <strong>FUN_011908 â€“ Platelet-Activating Factor Acetylhydrolase IB Subunit Alpha2 (PAFAH1B2)</strong></h3>
<ul>
<li><strong>Function:</strong> Hydrolyzes platelet-activating factor, modulating inflammatory responses.</li>
<li><strong>Energy Role:</strong> May influence lipid signaling pathways related to energy metabolism. </li>
</ul>
<hr>
</section>
<section id="fun_012474-lipase-zk262.3" class="level3">
<h3 class="anchored" data-anchor-id="fun_012474-lipase-zk262.3">10. <strong>FUN_012474 â€“ Lipase ZK262.3</strong></h3>
<ul>
<li><strong>Function:</strong> Presumed to hydrolyze triglycerides into free fatty acids and glycerol.</li>
<li><strong>Energy Role:</strong> Facilitates mobilization of stored fats for energy production. (<a href="https://www.ncbi.nlm.nih.gov/books/NBK537346/?utm_source=chatgpt.com" title="Biochemistry, Lipase - StatPearls - NCBI Bookshelf">NCBI</a>)</li>
</ul>
<hr>
</section>
<section id="fun_015434-fructose-bisphosphate-aldolase-c-aldoc" class="level3">
<h3 class="anchored" data-anchor-id="fun_015434-fructose-bisphosphate-aldolase-c-aldoc">11. <strong>FUN_015434 â€“ Fructose-Bisphosphate Aldolase C (ALDOC)</strong></h3>
<ul>
<li><strong>Function:</strong> Catalyzes a key step in glycolysis, splitting fructose 1,6-bisphosphate into two three-carbon sugars.</li>
<li><strong>Energy Role:</strong> Essential for glucose metabolism and energy production in the brain. (<a href="https://en.wikipedia.org/wiki/Glyceraldehyde_3-phosphate_dehydrogenase?utm_source=chatgpt.com" title="Glyceraldehyde 3-phosphate dehydrogenase">Wikipedia</a>, <a href="https://en.wikipedia.org/wiki/Fructose-bisphosphate_aldolase?utm_source=chatgpt.com" title="Fructose-bisphosphate aldolase - Wikipedia">Wikipedia</a>)</li>
</ul>
<hr>
</section>
<section id="fun_023367-hexokinase-4-glucokinase" class="level3">
<h3 class="anchored" data-anchor-id="fun_023367-hexokinase-4-glucokinase">12. <strong>FUN_023367 â€“ Hexokinase-4 (Glucokinase)</strong></h3>
<ul>
<li><strong>Function:</strong> Phosphorylates glucose to glucose-6-phosphate, the first step in glycolysis.</li>
<li><strong>Energy Role:</strong> Acts as a glucose sensor in the liver and pancreas, regulating glucose utilization and storage. </li>
</ul>
<hr>
</section>
<section id="fun_023596-suppressor-of-tumorigenicity-14-protein-matriptase" class="level3">
<h3 class="anchored" data-anchor-id="fun_023596-suppressor-of-tumorigenicity-14-protein-matriptase">13. <strong>FUN_023596 â€“ Suppressor of Tumorigenicity 14 Protein (Matriptase)</strong></h3>
<ul>
<li><strong>Function:</strong> Serine protease involved in epithelial cell regulation.</li>
<li><strong>Energy Role:</strong> May influence energy metabolism through its role in cell proliferation and differentiation. (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5085182/?utm_source=chatgpt.com" title="Impact of suppression of tumorigenicity 14 (ST14)/serine protease ...">PMC</a>)</li>
</ul>
<hr>
</section>
<section id="fun_025232-glyceraldehyde-3-phosphate-dehydrogenase-gapdh" class="level3">
<h3 class="anchored" data-anchor-id="fun_025232-glyceraldehyde-3-phosphate-dehydrogenase-gapdh">14. <strong>FUN_025232 â€“ Glyceraldehyde-3-Phosphate Dehydrogenase (GAPDH)</strong></h3>
<ul>
<li><strong>Function:</strong> Catalyzes a step in glycolysis, converting glyceraldehyde-3-phosphate to 1,3-bisphosphoglycerate.</li>
<li><strong>Energy Role:</strong> Central to glycolytic energy production; also involved in other cellular processes. (<a href="https://en.wikipedia.org/wiki/Glyceraldehyde_3-phosphate_dehydrogenase?utm_source=chatgpt.com" title="Glyceraldehyde 3-phosphate dehydrogenase">Wikipedia</a>)</li>
</ul>
<hr>
</section>
<section id="fun_027948-pi-plc-x-domain-containing-protein-3-plcxd3" class="level3">
<h3 class="anchored" data-anchor-id="fun_027948-pi-plc-x-domain-containing-protein-3-plcxd3">15. <strong>FUN_027948 â€“ PI-PLC X Domain-Containing Protein 3 (PLCXD3)</strong></h3>
<ul>
<li><strong>Function:</strong> Predicted to have phospholipase activity, involved in lipid signaling.</li>
<li><strong>Energy Role:</strong> May participate in lipid metabolism and signal transduction pathways affecting energy homeostasis. (<a href="https://www.ncbi.nlm.nih.gov/gene/12894?utm_source=chatgpt.com" title="Cpt1a carnitine palmitoyltransferase 1a, liver [ (house mouse)] - NCBI">NCBI</a>)</li>
</ul>
<hr>
</section>
<section id="fun_028200-26s-proteasome-regulatory-subunit-6b-rpt3" class="level3">
<h3 class="anchored" data-anchor-id="fun_028200-26s-proteasome-regulatory-subunit-6b-rpt3">16. <strong>FUN_028200 â€“ 26S Proteasome Regulatory Subunit 6B (RPT3)</strong></h3>
<ul>
<li><strong>Function:</strong> Part of the 26S proteasome complex, involved in protein degradation.</li>
<li><strong>Energy Role:</strong> Regulates protein turnover, influencing energy metabolism and cellular homeostasis.</li>
</ul>
<p>26S proteasome regulatory subunit 6B is part of the multiprotein 26S proteasome complex, which removes misfolded or damaged proteins.</p>
<p>In Aptasia-associated symbionts, 26S proteasome regulatory subunit 6B is upregulated in response to both heat and salinity stress (and their interaction), as are many other types of proteasome subunits (Giovagnoli 2023)</p>
<hr>
</section>
<section id="fun_032220-dihydrolipoyllysine-residue-acetyltransferase-pdce2" class="level3">
<h3 class="anchored" data-anchor-id="fun_032220-dihydrolipoyllysine-residue-acetyltransferase-pdce2">17. <strong>FUN_032220 â€“ Dihydrolipoyllysine-Residue Acetyltransferase (PDCE2)</strong></h3>
<ul>
<li><strong>Function:</strong> Core component of the pyruvate dehydrogenase complex, converting pyruvate to acetyl-CoA.</li>
<li><strong>Energy Role:</strong> Links glycolysis to the citric acid cycle, central to aerobic energy production.</li>
</ul>
<p>Differentially expressed in corals under heat stress (e.g., Zhang et al.&nbsp;2024, Sun et al.&nbsp;2025)</p>
<p>Putatively targeted by miRNA in plants (http://isyslab.info/OPP-ncRBASE/search/mirna/31056)</p>
<hr>
</section>
<section id="fun_034872-lipase-zk262.3" class="level3">
<h3 class="anchored" data-anchor-id="fun_034872-lipase-zk262.3">18. <strong>FUN_034872 â€“ Lipase ZK262.3</strong></h3>
<ul>
<li><strong>Function:</strong> Similar to FUN_012474; presumed to hydrolyze triglycerides.</li>
<li><strong>Energy Role:</strong> Involved in lipid mobilization for energy production. </li>
</ul>
<hr>
</section>
<section id="fun_035467-fun_035468-phosphoenolpyruvate-carboxykinase-gtp-mitochondrial-pepck-m" class="level3">
<h3 class="anchored" data-anchor-id="fun_035467-fun_035468-phosphoenolpyruvate-carboxykinase-gtp-mitochondrial-pepck-m">19 &amp; 20. <strong>FUN_035467 &amp; FUN_035468 â€“ Phosphoenolpyruvate Carboxykinase [GTP], Mitochondrial (PEPCK-M)</strong></h3>
<ul>
<li><strong>Function:</strong> A rate-limiting enzyme that catalyzes the conversion of oxaloacetate to phosphoenolpyruvate in gluconeogenesis.</li>
<li><strong>Energy Role:</strong> Key enzyme in glucose production from non-carbohydrate sources, maintaining blood glucose levels during fasting.</li>
</ul>
<p>In corals, the PEPCK pathway has been identified as a potential carbon fixation pathway within coral hosts to supplement other CO2 concentrating mechanisms, used to accumulate dissolved organic carbon in service of their symbionts. (Zhang et al., 2024)</p>
<p>PEPCK is also differentially expressed under heat stress and bleaching (e.g., Kenkel et al.&nbsp;2013, Lee et al.&nbsp;2018, Kenkel et al.&nbsp;2014), which suggests its involvement in compensating for loss of symbiont-derived nutrients.</p>
<p>Multiple classes of ncRNA have recently been identified as putative regulators of glucose metabolism, in which phosphoenolpyruvate carboxykinase plays a key role (e.g., Lai et al., 2020)</p>
<hr>
</section>
<section id="fun_037573-26s-proteasome-regulatory-subunit-6a-b-rpt5-b" class="level3">
<h3 class="anchored" data-anchor-id="fun_037573-26s-proteasome-regulatory-subunit-6a-b-rpt5-b">21. <strong>FUN_037573 â€“ 26S Proteasome Regulatory Subunit 6A-B (RPT5-B)</strong></h3>
<ul>
<li><strong>Function:</strong> Component of the 26S proteasome, involved in ATP-dependent protein degradation.</li>
<li><strong>Energy Role:</strong> Maintains protein quality control, indirectly affecting energy metabolism.</li>
</ul>
<hr>
</section>
<section id="fun_039293-glyceraldehyde-3-phosphate-dehydrogenase-gapdh" class="level3">
<h3 class="anchored" data-anchor-id="fun_039293-glyceraldehyde-3-phosphate-dehydrogenase-gapdh">22. <strong>FUN_039293 â€“ Glyceraldehyde-3-Phosphate Dehydrogenase (GAPDH)</strong></h3>
<ul>
<li><strong>Function:</strong> Same as FUN_025232; involved in glycolysis.</li>
<li><strong>Energy Role:</strong> Central to energy production through glycolysis. </li>
</ul>
<p>Differentially expressed in a jellyfish under short term temperature exposure (Gamero-Mora et al.&nbsp;2024)</p>
<hr>
</section>
<section id="fun_040784-acyl-coenzyme-a-oxidase-2-peroxisomal-aox2" class="level3">
<h3 class="anchored" data-anchor-id="fun_040784-acyl-coenzyme-a-oxidase-2-peroxisomal-aox2">23. <strong>FUN_040784 â€“ Acyl-Coenzyme A Oxidase 2, Peroxisomal (AOX2)</strong></h3>
<ul>
<li><strong>Function:</strong> Catalyzes the first step in the peroxisomal Î²-oxidation of long-chain fatty acids.</li>
<li><strong>Energy Role:</strong> Contributes to lipid metabolism and energy production.</li>
</ul>
<hr>
</section>
<section id="fun_041710-propionyl-coa-carboxylase-alpha-chain" class="level3">
<h3 class="anchored" data-anchor-id="fun_041710-propionyl-coa-carboxylase-alpha-chain">24. <strong>FUN_041710 â€“ Propionyl-CoA Carboxylase Alpha Chain</strong></h3>
<ul>
<li><strong>Function:</strong> Converts propionyl-CoA to methylmalonyl-CoA, a step in the metabolism of certain amino acids and fatty acids.</li>
<li><strong>Energy Role:</strong> Facilitates the entry of odd-chain fatty acids into the citric acid cycle for energy production.</li>
</ul>
<p>In the teleost fish <em>Paralichthys olivaceus</em>, Propionyl-CoA carboxylase alpha chain gene expression is putatively regulated via a network of miRNA and lncRNA that is differentially expressed based on fertility status (Mang et al.&nbsp;2021)</p>
<hr>
</section>
<section id="fun_041721-platelet-activating-factor-acetylhydrolase-ib-subunit-alpha2" class="level3">
<h3 class="anchored" data-anchor-id="fun_041721-platelet-activating-factor-acetylhydrolase-ib-subunit-alpha2">25. <strong>FUN_041721 â€“ Platelet-Activating Factor Acetylhydrolase IB Subunit Alpha2</strong></h3>
<ul>
<li><strong>Function:</strong> Same as FUN_011908; hydrolyzes platelet-activating factor.</li>
<li><strong>Energy Role:</strong> Involved in lipid signaling pathways related</li>
</ul>
<hr>
</section>
<section id="fun_042950-tnf-receptor-associated-factor-2-traf2" class="level3">
<h3 class="anchored" data-anchor-id="fun_042950-tnf-receptor-associated-factor-2-traf2">26 &amp; 27. <strong>FUN_042950 â€“ TNF Receptor-Associated Factor 2 (TRAF2)</strong></h3>
<ul>
<li><strong>Function</strong>: E3 ubiquitin ligase and adaptor protein involved in TNF receptor signaling, activating NF-ÎºB and MAPK pathways, crucial for inflammation, cell survival, and apoptosis.</li>
<li><strong>Energy Role</strong>: Regulates cellular stress responses, which can influence mitochondrial function, cell metabolism, and energy balance, especially under inflammatory or oxidative stress. (<a href="https://www.ncbi.nlm.nih.gov/gene/7186">NCBI Gene: TRAF2</a>)</li>
</ul>
<p>In general, tumor necrosis factors (TNFs) play a role in apoptosis, and are associated with immune response. TRAF2, specifically, suppresses apoptosis and necroptosis (Petersen et al.&nbsp;2015) In humans, dysregulation of TNFs and TRAFs is implicated in several cancer types. TRAF2 has also been implicated as part of an immune regulation network that is modulated by both miRNA and lncRNA (Ebrahimi &amp; Golestani 2021).</p>
<p>In <em>Acropora hyacinthus</em>, TNF receptor-associated factor 2 is downregulated in response to bleaching (Barshis et al., 2013).</p>
<hr>
</section>
<section id="fun_042982-alkylglycerol-monooxygenase-agmo" class="level3">
<h3 class="anchored" data-anchor-id="fun_042982-alkylglycerol-monooxygenase-agmo">28. <strong>FUN_042982 â€“ Alkylglycerol Monooxygenase (AGMO)</strong></h3>
<ul>
<li><strong>Function</strong>: Catalyzes the cleavage of ether lipids such as alkylglycerols, using tetrahydrobiopterin as a cofactor. Plays a role in lipid remodeling and degradation.</li>
<li><strong>Energy Role</strong>: Participates in lipid catabolism, indirectly affecting energy storage, membrane composition, and lipid-based signaling involved in metabolic regulation. (<a href="https://www.uniprot.org/uniprotkb/Q6IA69/entry">UniProt: AGMO</a>)</li>
</ul>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_13_timeseries_multiomic_ML_lit_review.html</guid>
  <pubDate>Tue, 13 May 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul, multiomic features to predict expression. Machine learning â€“ Part 4</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_12_timeseries_multiomic_ML_4.html</link>
  <description><![CDATA[ 




<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.3-Apul-multiomic-machine-learning-byTP.Rmd">Code</a></p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.3-Apul-multiomic-machine-learning-byTP.md">Rendered Code</a></p>
<p>For each of the consistently well-predicted genes identified in <a href="../../../posts/projects/E5_coral/2025_05_08_timeseries_multiomic_ML_3.html">my last post</a>, I plotted thegeneâ€™s expression with that of its top 5 most important predictors.</p>
<section id="plot-expression-of-genes-and-their-predictors" class="level1">
<h1>10 Plot expression of genes and their predictors</h1>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Put predictor expression in format with samples in columns</span></span>
<span id="cb1-2">full_pred_counts_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(full_pred_counts)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loop over each feature in the list</span></span>
<span id="cb1-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(top_predictors)) {</span>
<span id="cb1-6">  </span>
<span id="cb1-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 predictors for this feature</span></span>
<span id="cb1-8">  top_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_predictors[[feature]]</span>
<span id="cb1-9">  predictors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Predictor</span>
<span id="cb1-10">  </span>
<span id="cb1-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature and predictors</span></span>
<span id="cb1-12">  all_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(feature, predictors)</span>
<span id="cb1-13">  </span>
<span id="cb1-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check which genes are actually present</span></span>
<span id="cb1-15">  present_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes[all_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts_t) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> all_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_energetic_state_GO)]</span>
<span id="cb1-16">  </span>
<span id="cb1-17">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(feature <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_energetic_state_GO))) {</span>
<span id="cb1-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">warning</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>, feature, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"not found in vsd_energetic_state_GO Skipping..."</span>))</span>
<span id="cb1-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">next</span></span>
<span id="cb1-20">  }</span>
<span id="cb1-21"></span>
<span id="cb1-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract predictor expression (only those present)</span></span>
<span id="cb1-23">  predictor_expr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred_counts_t[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(predictors, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts_t)), , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()</span>
<span id="cb1-24"></span>
<span id="cb1-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the feature expression</span></span>
<span id="cb1-26">  feature_expr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO[feature, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()</span>
<span id="cb1-27">  </span>
<span id="cb1-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine into one data frame</span></span>
<span id="cb1-29">  combined_expr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(predictor_expr, feature_expr)</span>
<span id="cb1-30">  combined_expr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(combined_expr)</span>
<span id="cb1-31">  </span>
<span id="cb1-32">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to long format</span></span>
<span id="cb1-33">  expr_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> combined_expr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-34">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expression"</span>)</span>
<span id="cb1-35">  </span>
<span id="cb1-36">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join with sample metadata</span></span>
<span id="cb1-37">  expr_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> expr_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-38">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(metadata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample"</span>)</span>
<span id="cb1-39">  </span>
<span id="cb1-40">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot, with colonies aggregated by timepoint</span></span>
<span id="cb1-41">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># p &lt;- ggplot(expr_long, aes(x = interaction(Timepoint), y = Expression, color = Gene, group = Gene)) +</span></span>
<span id="cb1-42">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   geom_point(alpha = 0.7) +</span></span>
<span id="cb1-43">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   geom_smooth(se = FALSE, method = "loess") +</span></span>
<span id="cb1-44">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   labs(title = paste("Expression of", feature, "and Top 5 Predictors"),</span></span>
<span id="cb1-45">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#        x = "Colony-Timepoint",</span></span>
<span id="cb1-46">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#        y = "Expression") +</span></span>
<span id="cb1-47">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   theme_minimal() +</span></span>
<span id="cb1-48">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb1-49">  </span>
<span id="cb1-50">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot, faceted by colony</span></span>
<span id="cb1-51">  p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(expr_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Timepoint, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Expression, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> Gene)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>ColonyID) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expression of"</span>, feature, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"and Top 5 Predictors by Colony"</span>),</span>
<span id="cb1-56">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Timepoint"</span>,</span>
<span id="cb1-57">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expression"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-60"></span>
<span id="cb1-61">  </span>
<span id="cb1-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(p)</span>
<span id="cb1-63">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-1.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-2.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-3.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-4.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-5.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-6.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-7.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-8.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-9.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-10.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-11.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-12.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-13.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-14.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-15.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-16.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-17.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-18.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-19.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-20.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-21.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-22.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-23.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-24.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-25.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-26.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-27.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-28.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-29.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-30.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-31.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-32.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-33.png" class="img-fluid"><!-- --></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-34.png" class="img-fluid"><!-- --></p>
<section id="notes" class="level4">
<h4 class="anchored" data-anchor-id="notes">Notes</h4>
<p>This gene stood out to me before because one of its primary predictors is an miRNA.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-7.png" class="img-fluid"></p>
<p>The miRNA Cluster_17173 both putatively binds to FUN_00702 (with several possible binding configurations) and is strongly negatively correlated based on pairwise PCC (PCC = -0.676).</p>
<p>Cluster_17173 <em>also</em> putatively binds to and is strongly positively a correlated with lncRNA_5655, which is the most highly predictive feature for FUN_007022 expression (several possible binding configurations, PCC = 0.522).</p>
<p>Cluster_17173 doesnâ€™t match any previously described miRNA (see ShortStack results <a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/output/04-Apul-sRNA-discovery-ShortStack/ShortStack_out/Results.txt">here</a>).</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-7.png" class="img-fluid"></p>
<p>This is also a useful sanity check in general, because we see some â€œhighly predictedâ€ genes are actually just invariant. For example, FUN_026128 was well-predicted by just a couple of lncRNA, which was potentially very interesting.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-19.png" class="img-fluid"></p>
<p>However, upon plotting the expression, we see the gene is just invariant over time, and was â€œpredicted byâ€ other largely invariant features.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files_2/unnamed-chunk-73-19.png" class="img-fluid"><!-- --></p>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_12_timeseries_multiomic_ML_4.html</guid>
  <pubDate>Mon, 12 May 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul, multiomic features to predict expression. Machine learning â€“ Part 3</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_08_timeseries_multiomic_ML_3.html</link>
  <description><![CDATA[ 




<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.3-Apul-multiomic-machine-learning-byTP.Rmd">Code</a></p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.3-Apul-multiomic-machine-learning-byTP.md">Rendered Code</a></p>
<p>Applying ML model using multiomic predictors â€“ miRNA + lncRNA + methylation as predictors of gene expression. I also want to see whether predictors/drivers of expression differ with seasonality (by timepoint).</p>
<p>After seeing almost no agreement between seasons, I incorporated a train/test split and bootstrapping, and identified a subset of the genes of interest which are consistently well-predicted accross many iterations of training and testing.</p>
<p>Inputs:</p>
<ul>
<li><p>RNA counts matrix (raw): <code>../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv</code></p></li>
<li><p>Gene sets of interest: <code>../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/</code></p></li>
<li><p>sRNA/miRNA counts matrix (raw): <code>../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt</code></p></li>
<li><p>lncRNA counts matrix (raw): <code>../output/08-Apul-lncNRA/counts.txt</code></p></li>
<li><p>WGBS data (processed): Performed in <code>/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/</code>, data in <a href="https://gannet.fish.washington.edu/seashell/bu-github/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/">large-file storage</a>.</p></li>
<li><p>sample metadata: <code>../../M-multi-species/data/rna_metadata.csv</code></p></li>
</ul>
<p>Will be predicting expression for a subset of genes related to energetic state (those annotated for the below GO terms)</p>
<ul>
<li><p>Glycolysis <a href="GO:0006096" class="uri">GO:0006096</a></p></li>
<li><p>Gluconeogenesis <a href="GO:0006094" class="uri">GO:0006094</a></p></li>
<li><p>Lipolysis/lipid catabolism <a href="GO:0016042" class="uri">GO:0016042</a></p></li>
<li><p>Fatty acid beta oxidation <a href="GO:0006635" class="uri">GO:0006635</a></p></li>
<li><p>Starvation <a href="GO:0042594" class="uri">GO:0042594</a></p></li>
<li><p>Lipid biosynthesis <a href="GO:000861" class="uri">GO:000861</a></p></li>
<li><p>Protein catabolic process <a href="GO:0030163" class="uri">GO:0030163</a></p></li>
</ul>
<p>Selected GO terms evaluated at <a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/23-Apul-energetic-state.md" class="uri">https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/23-Apul-energetic-state.md</a></p>
<section id="set-up" class="level1">
<h1>1 Set up</h1>
</section>
<section id="load-libraries" class="level1">
<h1>2 Load libraries</h1>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DESeq2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(psych)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidygraph)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WGCNA)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(edgeR)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reshape2)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggcorrplot)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(corrplot)</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pheatmap)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(factoextra)</span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(vegan)</span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggfortify)</span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(genefilter)</span>
<span id="cb1-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scales)</span></code></pre></div>
<p>The model includes random processes, so set a seed for reproducability. Note: for final results, should we consider bootstrapping to ensure reported results are representative?</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">703</span>)</span></code></pre></div>
</section>
<section id="load-and-format-data" class="level1">
<h1>3 Load and format data</h1>
<section id="rna-seq-data-mrna-mirna-lncrna" class="level2">
<h2 class="anchored" data-anchor-id="rna-seq-data-mrna-mirna-lncrna">3.1 RNA-seq data (mRNA, miRNA, lncRNA)</h2>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### mRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw gene counts data (will filter and variance stabilize)</span></span>
<span id="cb3-3">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span></code></pre></div>
<pre><code>## Rows: 44371 Columns: 41
## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Delimiter: ","
## chr  (1): gene_id
## dbl (40): 1A1, 1A10, 1A12, 1A2, 1A8, 1A9, 1B1, 1B10, 1B2, 1B5, 1B9, 1C10, 1C...
## 
## â„¹ Use `spec()` to retrieve the full column specification for this data.
## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format gene IDs as rownames (instead of a column)</span></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb5-5">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>gene_id)</span>
<span id="cb5-6"></span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### miRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw miRNA counts (will filter and variance stabilize)</span></span>
<span id="cb5-10">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb5-11"></span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### lncRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw lncRNA counts (will filter and variance stabilize)</span></span>
<span id="cb5-15">Apul_lncRNA_full <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/08-Apul-lncRNA/counts.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-16"></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove info on genomic location, set lncRNA IDs as rownames</span></span>
<span id="cb5-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_lncRNA_full) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Geneid</span>
<span id="cb5-19">Apul_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_full <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Geneid, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Chr, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Start, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>End, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Strand, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Length)</span>
<span id="cb5-20"></span>
<span id="cb5-21"></span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### load and format metadata </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-24">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../M-multi-species/data/rna_metadata.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(AzentaSampleName, ColonyID, Timepoint) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACR"</span>, ColonyID))</span></code></pre></div>
<pre><code>## New names:
## Rows: 117 Columns: 19
## â”€â”€ Column specification
## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Delimiter: "," chr
## (13): SampleName, WellNumber, AzentaSampleName, ColonyID, Timepoint, Sam... dbl
## (5): SampleNumber, Plate, TotalAmount-ng, Volume-uL, Conc-ng.uL lgl (1):
## MethodUsedForSpectrophotometry
## â„¹ Use `spec()` to retrieve the full column specification for this data. â„¹
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## â€¢ `` -&gt; `...19`</code></pre>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span></code></pre></div>
<pre><code>## Warning: Setting row names on a tibble is deprecated.</code></pre>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">colonies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID)</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename gene column names to include full sample info</span></span>
<span id="cb9-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename miRNA column names to match formatting</span></span>
<span id="cb9-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_.*"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA))</span>
<span id="cb9-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename lncRNA colin names to include full sample info</span></span>
<span id="cb9-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"...data."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA))</span>
<span id="cb9-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".sorted.bam"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA))</span>
<span id="cb9-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span></code></pre></div>
</section>
<section id="islolate-gene-set" class="level2">
<h2 class="anchored" data-anchor-id="islolate-gene-set">3.2 Islolate gene set</h2>
<p>Read in gene set table</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GO terms related to energetic state</span></span>
<span id="cb10-2">energetic_state_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/energetic_state_GO_terms_genes_FA.csv"</span>)</span></code></pre></div>
<p>Isolate filtered counts by gene set</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">energetic_state_GO_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> energetic_state_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene,]</span></code></pre></div>
</section>
<section id="wgbs-data" class="level2">
<h2 class="anchored" data-anchor-id="wgbs-data">3.3 WGBS data</h2>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pull processed files from Gannet </span></span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note: Unfortunately we can't use the `cache` feature to make this process more time efficient, as it doesn't support long vectors</span></span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the base URL</span></span>
<span id="cb12-5">base_url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://gannet.fish.washington.edu/seashell/bu-github/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/"</span></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the HTML page</span></span>
<span id="cb12-8">page <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(base_url)</span>
<span id="cb12-9"></span>
<span id="cb12-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract links to files</span></span>
<span id="cb12-11">file_links <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> page <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span>)</span>
<span id="cb12-14"></span>
<span id="cb12-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter for files ending in "processed.txt"</span></span>
<span id="cb12-16">processed_files <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> file_links[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"processed</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.txt$"</span>, file_links)]</span>
<span id="cb12-17"></span>
<span id="cb12-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create full URLs</span></span>
<span id="cb12-19">file_urls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(base_url, processed_files)</span>
<span id="cb12-20"></span>
<span id="cb12-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to read a file from URL</span></span>
<span id="cb12-22">read_processed_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(url) {</span>
<span id="cb12-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_table</span>(url, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read as character to avoid parsing issues</span></span>
<span id="cb12-24">}</span>
<span id="cb12-25"></span>
<span id="cb12-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import all processed files into a list</span></span>
<span id="cb12-27">processed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(file_urls, read_processed_file)</span>
<span id="cb12-28"></span>
<span id="cb12-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Name the list elements by file name</span></span>
<span id="cb12-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(processed_data) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> processed_files</span>
<span id="cb12-31"></span>
<span id="cb12-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print structure of imported data</span></span>
<span id="cb12-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(processed_data)</span>
<span id="cb12-34"></span>
<span id="cb12-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a header row that has "CpG" for the first column and "sample" for the second column, which will be populated by the file name </span></span>
<span id="cb12-36"></span>
<span id="cb12-37">processed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Map</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(df, filename) {</span>
<span id="cb12-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CpG"</span>, filename)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename columns</span></span>
<span id="cb12-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(df)</span>
<span id="cb12-40">}, processed_data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(processed_data))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use stored file names</span></span>
<span id="cb12-41"></span>
<span id="cb12-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#merge files together by "CpG"</span></span>
<span id="cb12-43">merged_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>(processed_data, full_join, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CpG"</span>)</span>
<span id="cb12-44"></span>
<span id="cb12-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print structure of final merged data</span></span>
<span id="cb12-46"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(merged_data)</span></code></pre></div>
<p>Replace any NA with 0.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert all columns (except "CpG") to numeric and replace NAs with 0</span></span>
<span id="cb13-2">merged_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, as.numeric)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert all except CpG to numeric</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace_na</span>(.x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA with 0 in numeric columns</span></span></code></pre></div>
</section>
<section id="filter-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="filter-data-sets">3.4 Filter data sets</h2>
<p>Only keep CpGs that have a non-zero value in all samples.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_all</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb14-2"></span>
<span id="cb14-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure it's formatted as a data frame</span></span>
<span id="cb14-4">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(filtered_wgbs)</span>
<span id="cb14-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep the sample information in the column name. </span></span>
<span id="cb14-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^(.*?)_.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs))</span>
<span id="cb14-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set CpG IDs to rownames</span></span>
<span id="cb14-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(filtered_wgbs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CpG</span>
<span id="cb14-9">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG)</span>
<span id="cb14-10"></span>
<span id="cb14-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(merged_data)</span>
<span id="cb14-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(filtered_wgbs)</span></code></pre></div>
<p>We had 12,093,025 CpGs before filtering and have only 507 after filtering. This makes sense because most CpGs were not methylated in all samples.</p>
<p>Save filtered set to make code reruns/knitting quicker</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(filtered_wgbs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/22.3-Apul-multiomic-machine-learning-byTP/filtered-WGBS-CpG-counts.csv"</span>)</span></code></pre></div>
<p>If knitting/rerunning code, we can load in this filtered data here, instead of loading raw counts and reprocessing.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/22.2-Apul-multiomic-machine-learning/filtered-WGBS-CpG-counts.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<p>Only keep genes, miRNA, and lncRNA that are present in at least one sample</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes</span></span>
<span id="cb17-2">energetic_state_GO_genes_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energetic_state_GO_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(energetic_state_GO_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb17-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA</span></span>
<span id="cb17-4">Apul_miRNA_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb17-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lncRNA</span></span>
<span id="cb17-6">Apul_lncRNA_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_lncRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb17-7"></span>
<span id="cb17-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Retained "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(energetic_state_GO_genes_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(energetic_state_GO_genes), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes; "</span>,</span>
<span id="cb17-9">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" miRNA; and "</span>, </span>
<span id="cb17-10">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" lncRNA"</span>)</span></code></pre></div>
<pre><code>## Retained  99  of  99 genes;  51  of  51  miRNA; and  20559  of  24181  lncRNA</code></pre>
<p><em>pOverA</em>: Specifying the minimum count for a proportion of samples for each gene. Setting 3/40 = 0.08. This would retain genes that are only expressed in a single season in a couple of the colonies. Additionally, setting the minimum count so that the minimum number of samples must have a gene count above a certain threshold.</p>
<p>genes:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb19-4">gfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(energetic_state_GO_genes_red, filt)</span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb19-7">gkeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energetic_state_GO_genes_red[gfilt,]</span>
<span id="cb19-8"></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify gene lists</span></span>
<span id="cb19-10">gn.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(gkeep)</span>
<span id="cb19-11"></span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#gene count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb19-13">energetic_state_GO_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(energetic_state_GO_genes_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(energetic_state_GO_genes_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> gn.keep),])</span>
<span id="cb19-14"></span>
<span id="cb19-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb19-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(energetic_state_GO_genes_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(energetic_state_GO_genes_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 99 ; Post-filtering: 99</code></pre>
<p>miRNA:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb21-4">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_miRNA_red, mifilt)</span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA to keep by count filter</span></span>
<span id="cb21-7">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb21-8"></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA to keep by count filter</span></span>
<span id="cb21-10">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb21-11"></span>
<span id="cb21-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA lists</span></span>
<span id="cb21-13">mi.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(mikeep)</span>
<span id="cb21-14"></span>
<span id="cb21-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#miRNA count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb21-16">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_miRNA_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> mi.keep),])</span>
<span id="cb21-17"></span>
<span id="cb21-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb21-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 51 ; Post-filtering: 47</code></pre>
<p>Of the 51 miRNA, 47 were retained. Which were removed?</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## [1] "Cluster_5685"  "Cluster_11565" "Cluster_13647" "Cluster_14633"</code></pre>
<p>lncRNA:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">lncfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb25-2"></span>
<span id="cb25-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb25-4">lncfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_lncRNA_red, lncfilt)</span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA to keep by count filter</span></span>
<span id="cb25-7">lnckeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_red[lncfilt,]</span>
<span id="cb25-8"></span>
<span id="cb25-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA to keep by count filter</span></span>
<span id="cb25-10">lnckeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_red[lncfilt,]</span>
<span id="cb25-11"></span>
<span id="cb25-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA lists</span></span>
<span id="cb25-13">lnc.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(lnckeep)</span>
<span id="cb25-14"></span>
<span id="cb25-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#lncRNA count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb25-16">Apul_lncRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_lncRNA_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_lncRNA_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> lnc.keep),])</span>
<span id="cb25-17"></span>
<span id="cb25-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb25-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 20559 ; Post-filtering: 16006</code></pre>
</section>
<section id="transform-data" class="level2">
<h2 class="anchored" data-anchor-id="transform-data">3.5 Transform data</h2>
<p>Set the order of genes, miRNA, lncRNA, wgbs, and metadata to all be the same.</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure rownames of metadata are used as the desired column order</span></span>
<span id="cb27-2">desired_order <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata)</span>
<span id="cb27-3"></span>
<span id="cb27-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reorder data frame columns</span></span>
<span id="cb27-5">energetic_state_GO_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energetic_state_GO_genes_filt[, desired_order]</span>
<span id="cb27-6">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt[, desired_order]</span>
<span id="cb27-7">Apul_lncRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_filt[, desired_order]</span>
<span id="cb27-8">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs[, desired_order]</span>
<span id="cb27-9"></span>
<span id="cb27-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check they all match</span></span>
<span id="cb27-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(energetic_state_GO_genes_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Use a variance stabilized transformation for all four data sets. Variance stabilization essentially tries to make variance independent of the mean</p>
<p>(Is this the most appropriate design to use?)</p>
<p>genes:</p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">dds_energetic_state_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> energetic_state_GO_genes_filt, </span>
<span id="cb35-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb35-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## converting counts to integer mode

## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb37-2">vsd_energetic_state_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_energetic_state_GO, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Must use varianceStabilizingTransformation() instead of vst() due to few input genes</span></span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">vsd_energetic_state_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_energetic_state_GO)</span></code></pre></div>
<p>miRNA:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_miRNA_filt, </span>
<span id="cb40-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb40-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb42-2">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Must use varianceStabilizingTransformation() instead of vst() due to few input genes</span></span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA)</span></code></pre></div>
<p>lncRNA:</p>
<div class="sourceCode" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">dds_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_lncRNA_filt, </span>
<span id="cb45-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb45-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb47-2">vsd_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_lncRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<p>Must round wgbs data to whole integers for normalization - need to return to this to decide if this is appropriate.</p>
<div class="sourceCode" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#round to integers </span></span>
<span id="cb48-2">filtered_wgbs<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>filtered_wgbs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), round))</span>
<span id="cb48-3"></span>
<span id="cb48-4">dds_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> filtered_wgbs, </span>
<span id="cb48-5">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb48-6">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## converting counts to integer mode

## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb50-2">vsd_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_wgbs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]

## -- note: fitType='parametric', but the dispersion trend was not well captured by the
##    function: y = a/x + b, and a local regression fit was automatically substituted.
##    specify fitType='local' or 'mean' to avoid this message next time.</code></pre>
</section>
<section id="merge-predictor-features" class="level2">
<h2 class="anchored" data-anchor-id="merge-predictor-features">3.6 Merge predictor features</h2>
<p>Create a merged dataset that contains the variance stabilized counts for all miRNA, lncRNA, and CpGs.</p>
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Triple check that all three data frames have sample names in the same order</span></span>
<span id="cb52-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_lncRNA), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_miRNA))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_lncRNA), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_wgbs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind (stack dataframes vertically, so that they match by column/sample)</span></span>
<span id="cb56-2">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(vsd_lncRNA, vsd_miRNA, vsd_wgbs)</span>
<span id="cb56-3"></span>
<span id="cb56-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform so that samples are on rows and features are in columns</span></span>
<span id="cb56-5">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(full_pred_counts)</span>
<span id="cb56-6"></span>
<span id="cb56-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(full_pred_counts)</span></code></pre></div>
<pre><code>## [1]    40 16560</code></pre>
</section>
<section id="format" class="level2">
<h2 class="anchored" data-anchor-id="format">3.7 Format</h2>
<div class="sourceCode" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform the counts matrices so that samples are on the rows and gene IDs on the columns</span></span>
<span id="cb58-2">vsd_energetic_state_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_energetic_state_GO)</span>
<span id="cb58-3"></span>
<span id="cb58-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure both are formatted as data frames</span></span>
<span id="cb58-5">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(full_pred_counts)</span>
<span id="cb58-6">vsd_energetic_state_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(vsd_energetic_state_GO_t)</span>
<span id="cb58-7"></span>
<span id="cb58-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure sample matching between gene and epigenetic dfs</span></span>
<span id="cb58-9">common_samples <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_energetic_state_GO_t), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts))</span>
<span id="cb58-10"></span>
<span id="cb58-11">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred_counts[common_samples, ]</span>
<span id="cb58-12">vsd_energetic_state_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_t[common_samples,]</span></code></pre></div>
</section>
<section id="break-up-response-and-predictors-by-timepoint" class="level2">
<h2 class="anchored" data-anchor-id="break-up-response-and-predictors-by-timepoint">3.8 Break up response and predictors by timepoint</h2>
<div class="sourceCode" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1">vsd_energetic_state_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_t[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP1$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_energetic_state_GO_t)),]</span>
<span id="cb59-2">vsd_energetic_state_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_t[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP2$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_energetic_state_GO_t)),]</span>
<span id="cb59-3">vsd_energetic_state_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_t[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP3$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_energetic_state_GO_t)),]</span>
<span id="cb59-4">vsd_energetic_state_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_t[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP4$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_energetic_state_GO_t)),]</span>
<span id="cb59-5"></span>
<span id="cb59-6">full_pred_counts_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred_counts[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP1$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts)),]</span>
<span id="cb59-7">full_pred_counts_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred_counts[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP2$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts)),]</span>
<span id="cb59-8">full_pred_counts_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred_counts[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP3$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts)),]</span>
<span id="cb59-9">full_pred_counts_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred_counts[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP4$"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts)),]</span></code></pre></div>
</section>
</section>
<section id="define-model-functions" class="level1">
<h1>4 Define model functions</h1>
<div class="sourceCode" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1">train_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_features, predictor_features) {</span>
<span id="cb60-2">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb60-3">  </span>
<span id="cb60-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features)) {</span>
<span id="cb60-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_features[[feature]]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gene expression</span></span>
<span id="cb60-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_features)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA/lncRNA/methylation as predictors</span></span>
<span id="cb60-7">    </span>
<span id="cb60-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train elastic net model (alpha = 0.5 for mix of LASSO &amp; Ridge)</span></span>
<span id="cb60-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reducing nfolds from 10 (default) to 5, since I'm using smaller sample sizes of just 10 samples per timepoint</span></span>
<span id="cb60-10">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nfolds =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb60-11">    </span>
<span id="cb60-12">    models[[feature]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb60-13">  }</span>
<span id="cb60-14">  </span>
<span id="cb60-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(models)</span>
<span id="cb60-16">}</span>
<span id="cb60-17"></span>
<span id="cb60-18">get_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models) {</span>
<span id="cb60-19">  importance_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb60-20">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to regular matrix &amp; remove intercept</span></span>
<span id="cb60-21">    </span>
<span id="cb60-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb60-23">    coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs))</span>
<span id="cb60-24">    </span>
<span id="cb60-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df)</span>
<span id="cb60-26">  })</span>
<span id="cb60-27">  </span>
<span id="cb60-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature importance across all predicted genes</span></span>
<span id="cb60-29">  importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(importance_list) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb60-30">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb60-31">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Importance)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb60-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb60-33">  </span>
<span id="cb60-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(importance_df)</span>
<span id="cb60-35">}</span>
<span id="cb60-36"></span>
<span id="cb60-37">evaluate_model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models, response_features, predictor_features) {</span>
<span id="cb60-38">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb60-39"></span>
<span id="cb60-40">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features)) {</span>
<span id="cb60-41">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_features[[feature]]</span>
<span id="cb60-42">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_features)</span>
<span id="cb60-43"></span>
<span id="cb60-44">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models[[feature]]</span>
<span id="cb60-45">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb60-46"></span>
<span id="cb60-47">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R-squared metric</span></span>
<span id="cb60-48">    results[results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> feature, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb60-49">  }</span>
<span id="cb60-50"></span>
<span id="cb60-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb60-52">}</span></code></pre></div>
</section>
<section id="energetic-state-go-terms" class="level1">
<h1>5 Energetic state (GO terms)</h1>
<section id="tp1" class="level2">
<h2 class="anchored" data-anchor-id="tp1">5.1 TP1</h2>
<section id="the-model" class="level3">
<h3 class="anchored" data-anchor-id="the-model">5.1.1 The model</h3>
<p>Train elastic models to predict gene expression from miRNA/lncRNA/methylation</p>
<div class="sourceCode" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression from miRNA/lncRNA/methylation</span></span>
<span id="cb61-2">models_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_energetic_state_GO_tp1, full_pred_counts_tp1)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1">feature_importance_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_ATP_prod_GO_tp1)</span>
<span id="cb62-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_ATP_prod_GO_tp1, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature                 MeanImportance
##    &lt;chr&gt;                            &lt;dbl&gt;
##  1 CpG_ptg000023l_39796365        0.00560
##  2 CpG_ptg000016l_1654330         0.00529
##  3 CpG_ptg000036l_3087796         0.00453
##  4 lncRNA_8013                    0.00407
##  5 lncRNA_8911                    0.00368
##  6 lncRNA_5073                    0.00332
##  7 CpG_ptg000027l_13568387        0.00318
##  8 lncRNA_16103                   0.00317
##  9 CpG_ptg000024l_4334209         0.00310
## 10 CpG_ptg000011l_1580869         0.00278
## 11 CpG_ptg000018l_13072298        0.00267
## 12 lncRNA_5748                    0.00258
## 13 lncRNA_18268                   0.00258
## 14 lncRNA_6643                    0.00255
## 15 CpG_ptg000004l_4759819         0.00250
## 16 CpG_ptg000024l_4334457         0.00242
## 17 lncRNA_8200                    0.00233
## 18 lncRNA_20453                   0.00228
## 19 lncRNA_638                     0.00228
## 20 lncRNA_2743                    0.00217</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb64" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1">performance_results_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_ATP_prod_GO_tp1, vsd_energetic_state_GO_tp1, full_pred_counts_tp1)</span>
<span id="cb64-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.0000  0.9915  0.9999  0.8758  1.0000  1.0000      21</code></pre>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">5.1.2 Results</h3>
<p>Plot results.</p>
<div class="sourceCode" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb66-2">top_features_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_ATP_prod_GO_tp1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb66-3"></span>
<span id="cb66-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb66-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_ATP_prod_GO_tp1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb66-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb66-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb66-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb66-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb66-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb66-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-27-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_ATP_prod_GO_tp1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb67-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb67-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb67-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb67-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression"</span>,</span>
<span id="cb67-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb67-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb67-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span>
<span id="cb67-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 21 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-28-1.png" class="img-fluid"><!-- --></p>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb69-2">best_feature_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb69-3"></span>
<span id="cb69-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb69-5">actual_values_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_tp1[[best_feature_ATP_prod_GO_tp1]]</span>
<span id="cb69-6">predicted_values_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO_tp1[[best_feature_ATP_prod_GO_tp1]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp1), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb69-7"></span>
<span id="cb69-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb69-9">prediction_df_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb69-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_ATP_prod_GO_tp1,</span>
<span id="cb69-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_ATP_prod_GO_tp1</span>
<span id="cb69-12">)</span>
<span id="cb69-13"></span>
<span id="cb69-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb69-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_ATP_prod_GO_tp1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb69-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb69-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb69-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb69-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_feature_ATP_prod_GO_tp1),</span>
<span id="cb69-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb69-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb69-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_ATP_prod_GO_tp1), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_ATP_prod_GO_tp1), </span>
<span id="cb69-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb69-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-29-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb71" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>We can also look at which miRNA(s) contributed most to predicting gene of interest</p>
<div class="sourceCode" id="cb72" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all with R^2 values above line in plot</span></span>
<span id="cb72-2">all_features_ATP_prod_GO_tp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb72-3"></span>
<span id="cb72-4">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb72-5">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb72-6">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb72-7">  </span>
<span id="cb72-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb72-9">}</span>
<span id="cb72-10"></span>
<span id="cb72-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_ATP_prod_GO_tp1) {</span>
<span id="cb72-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb72-13">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_ATP_prod_GO_tp1[[feature]]</span>
<span id="cb72-14">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb72-15">  </span>
<span id="cb72-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb72-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb72-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb72-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb72-24">  </span>
<span id="cb72-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb72-26">}</span></code></pre></div>
<div class="sourceCode" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation between actual and predicted gene expression</span></span>
<span id="cb73-2">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(models_ATP_prod_GO_tp1, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp1), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))</span>
<span id="cb73-3"></span>
<span id="cb73-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure matrices are the same size</span></span>
<span id="cb73-5">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_energetic_state_GO_tp1), drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align columns</span></span>
<span id="cb73-6"></span>
<span id="cb73-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 0 variance columns</span></span>
<span id="cb73-8">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(predicted_matrix, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(col) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb73-9"></span>
<span id="cb73-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation matrix, handling missing values</span></span>
<span id="cb73-11">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(predicted_matrix, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_energetic_state_GO_tp1), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"complete.obs"</span>)</span>
<span id="cb73-12"></span>
<span id="cb73-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA or Inf values with zero</span></span>
<span id="cb73-14">cor_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.infinite</span>(cor_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb73-15"></span>
<span id="cb73-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb73-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb73-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Between Actual and Predicted Gene Expression"</span>,</span>
<span id="cb73-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb73-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb73-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-31-1.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="tp2" class="level2">
<h2 class="anchored" data-anchor-id="tp2">5.2 TP2</h2>
<section id="the-model-1" class="level3">
<h3 class="anchored" data-anchor-id="the-model-1">5.2.1 The model</h3>
<p>Train elastic models to predict gene expression from miRNA/lncRNA/methylation</p>
<div class="sourceCode" id="cb74" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression from miRNA/lncRNA/methylation</span></span>
<span id="cb74-2">models_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_energetic_state_GO_tp2, full_pred_counts_tp2)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1">feature_importance_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_ATP_prod_GO_tp2)</span>
<span id="cb75-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_ATP_prod_GO_tp2, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature                 MeanImportance
##    &lt;chr&gt;                            &lt;dbl&gt;
##  1 Cluster_9786                   0.00251
##  2 lncRNA_8911                    0.00243
##  3 CpG_ptg000024l_4334914         0.00233
##  4 lncRNA_13099                   0.00223
##  5 lncRNA_3523                    0.00175
##  6 CpG_ptg000027l_13526778        0.00171
##  7 lncRNA_10399                   0.00166
##  8 lncRNA_21300                   0.00165
##  9 lncRNA_11688                   0.00165
## 10 lncRNA_20244                   0.00165
## 11 lncRNA_13942                   0.00162
## 12 lncRNA_11426                   0.00161
## 13 lncRNA_1373                    0.00151
## 14 lncRNA_7949                    0.00146
## 15 lncRNA_11150                   0.00141
## 16 lncRNA_13677                   0.00140
## 17 lncRNA_21189                   0.00139
## 18 lncRNA_8054                    0.00138
## 19 lncRNA_21947                   0.00135
## 20 lncRNA_23254                   0.00134</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1">performance_results_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_ATP_prod_GO_tp2, vsd_energetic_state_GO_tp2, full_pred_counts_tp2)</span>
<span id="cb77-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.0000  0.9593  0.9988  0.8912  1.0000  1.0000      25</code></pre>
</section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">5.2.2 Results</h3>
<p>Plot results.</p>
<div class="sourceCode" id="cb79" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb79-2">top_features_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_ATP_prod_GO_tp2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb79-3"></span>
<span id="cb79-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb79-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_ATP_prod_GO_tp2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb79-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb79-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb79-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb79-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb79-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb79-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-35-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb80" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_ATP_prod_GO_tp2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb80-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb80-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb80-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb80-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression"</span>,</span>
<span id="cb80-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb80-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb80-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span>
<span id="cb80-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 25 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-36-1.png" class="img-fluid"><!-- --></p>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb82-2">best_feature_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb82-3"></span>
<span id="cb82-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb82-5">actual_values_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_tp2[[best_feature_ATP_prod_GO_tp2]]</span>
<span id="cb82-6">predicted_values_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO_tp2[[best_feature_ATP_prod_GO_tp2]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb82-7"></span>
<span id="cb82-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb82-9">prediction_df_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb82-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_ATP_prod_GO_tp2,</span>
<span id="cb82-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_ATP_prod_GO_tp2</span>
<span id="cb82-12">)</span>
<span id="cb82-13"></span>
<span id="cb82-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb82-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_ATP_prod_GO_tp2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_feature_ATP_prod_GO_tp2),</span>
<span id="cb82-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb82-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_ATP_prod_GO_tp2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_ATP_prod_GO_tp2), </span>
<span id="cb82-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb82-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-37-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb84" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>We can also look at which miRNA(s) contributed most to predicting gene of interest</p>
<div class="sourceCode" id="cb85" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all with R^2 values above line in plot</span></span>
<span id="cb85-2">all_features_ATP_prod_GO_tp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb85-3"></span>
<span id="cb85-4">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb85-5">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb85-6">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb85-7">  </span>
<span id="cb85-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb85-9">}</span>
<span id="cb85-10"></span>
<span id="cb85-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_ATP_prod_GO_tp2) {</span>
<span id="cb85-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb85-13">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_ATP_prod_GO_tp2[[feature]]</span>
<span id="cb85-14">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb85-15">  </span>
<span id="cb85-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb85-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb85-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb85-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb85-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb85-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb85-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb85-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb85-24">  </span>
<span id="cb85-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb85-26">}</span></code></pre></div>
<div class="sourceCode" id="cb86" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation between actual and predicted gene expression</span></span>
<span id="cb86-2">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(models_ATP_prod_GO_tp2, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))</span>
<span id="cb86-3"></span>
<span id="cb86-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure matrices are the same size</span></span>
<span id="cb86-5">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_energetic_state_GO_tp2), drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align columns</span></span>
<span id="cb86-6"></span>
<span id="cb86-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 0 variance columns</span></span>
<span id="cb86-8">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(predicted_matrix, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(col) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb86-9"></span>
<span id="cb86-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation matrix, handling missing values</span></span>
<span id="cb86-11">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(predicted_matrix, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_energetic_state_GO_tp2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"complete.obs"</span>)</span>
<span id="cb86-12"></span>
<span id="cb86-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA or Inf values with zero</span></span>
<span id="cb86-14">cor_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.infinite</span>(cor_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb86-15"></span>
<span id="cb86-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb86-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb86-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Between Actual and Predicted Gene Expression"</span>,</span>
<span id="cb86-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb86-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb86-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-39-1.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="tp3" class="level2">
<h2 class="anchored" data-anchor-id="tp3">5.3 TP3</h2>
<section id="the-model-2" class="level3">
<h3 class="anchored" data-anchor-id="the-model-2">5.3.1 The model</h3>
<p>Train elastic models to predict gene expression from miRNA/lncRNA/methylation</p>
<div class="sourceCode" id="cb87" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression from miRNA/lncRNA/methylation</span></span>
<span id="cb87-2">models_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_energetic_state_GO_tp3, full_pred_counts_tp3)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb88" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1">feature_importance_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_ATP_prod_GO_tp3)</span>
<span id="cb88-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_ATP_prod_GO_tp3, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature                 MeanImportance
##    &lt;chr&gt;                            &lt;dbl&gt;
##  1 lncRNA_12200                   0.00817
##  2 CpG_ptg000022l_2985007         0.00816
##  3 lncRNA_1034                    0.00544
##  4 lncRNA_6545                    0.00463
##  5 lncRNA_11321                   0.00451
##  6 CpG_ptg000001l_16528327        0.00440
##  7 lncRNA_6491                    0.00418
##  8 lncRNA_1499                    0.00326
##  9 CpG_ptg000024l_4334221         0.00312
## 10 lncRNA_22323                   0.00291
## 11 lncRNA_22846                   0.00287
## 12 lncRNA_11110                   0.00276
## 13 lncRNA_3700                    0.00258
## 14 lncRNA_13729                   0.00238
## 15 CpG_ptg000027l_13568387        0.00223
## 16 CpG_ptg000025l_13842126        0.00221
## 17 CpG_ptg000017l_11261562        0.00217
## 18 lncRNA_1449                    0.00214
## 19 lncRNA_13040                   0.00213
## 20 CpG_ptg000036l_4603566         0.00211</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb90" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1">performance_results_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_ATP_prod_GO_tp3, vsd_energetic_state_GO_tp3, full_pred_counts_tp3)</span>
<span id="cb90-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.0000  0.9946  1.0000  0.9067  1.0000  1.0000      20</code></pre>
</section>
<section id="results-2" class="level3">
<h3 class="anchored" data-anchor-id="results-2">5.3.2 Results</h3>
<p>Plot results.</p>
<div class="sourceCode" id="cb92" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb92-2">top_features_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_ATP_prod_GO_tp3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb92-3"></span>
<span id="cb92-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb92-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_ATP_prod_GO_tp3, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb92-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb92-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb92-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb92-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb92-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb92-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-43-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb93" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_ATP_prod_GO_tp3, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb93-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb93-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb93-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb93-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression"</span>,</span>
<span id="cb93-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb93-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb93-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span>
<span id="cb93-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 20 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-44-1.png" class="img-fluid"><!-- --></p>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb95" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb95-2">best_feature_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb95-3"></span>
<span id="cb95-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb95-5">actual_values_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_tp3[[best_feature_ATP_prod_GO_tp3]]</span>
<span id="cb95-6">predicted_values_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO_tp3[[best_feature_ATP_prod_GO_tp3]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb95-7"></span>
<span id="cb95-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb95-9">prediction_df_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb95-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_ATP_prod_GO_tp3,</span>
<span id="cb95-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_ATP_prod_GO_tp3</span>
<span id="cb95-12">)</span>
<span id="cb95-13"></span>
<span id="cb95-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb95-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_ATP_prod_GO_tp3, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_feature_ATP_prod_GO_tp3),</span>
<span id="cb95-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb95-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_ATP_prod_GO_tp3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_ATP_prod_GO_tp3), </span>
<span id="cb95-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb95-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-45-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb97" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>We can also look at which miRNA(s) contributed most to predicting gene of interest</p>
<div class="sourceCode" id="cb98" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all with R^2 values above line in plot</span></span>
<span id="cb98-2">all_features_ATP_prod_GO_tp3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb98-3"></span>
<span id="cb98-4">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb98-5">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb98-6">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb98-7">  </span>
<span id="cb98-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb98-9">}</span>
<span id="cb98-10"></span>
<span id="cb98-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_ATP_prod_GO_tp3) {</span>
<span id="cb98-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb98-13">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_ATP_prod_GO_tp3[[feature]]</span>
<span id="cb98-14">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb98-15">  </span>
<span id="cb98-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb98-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb98-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb98-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb98-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb98-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb98-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb98-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb98-24">  </span>
<span id="cb98-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb98-26">}</span></code></pre></div>
<div class="sourceCode" id="cb99" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation between actual and predicted gene expression</span></span>
<span id="cb99-2">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(models_ATP_prod_GO_tp3, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))</span>
<span id="cb99-3"></span>
<span id="cb99-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure matrices are the same size</span></span>
<span id="cb99-5">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_energetic_state_GO_tp3), drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align columns</span></span>
<span id="cb99-6"></span>
<span id="cb99-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 0 variance columns</span></span>
<span id="cb99-8">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(predicted_matrix, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(col) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb99-9"></span>
<span id="cb99-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation matrix, handling missing values</span></span>
<span id="cb99-11">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(predicted_matrix, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_energetic_state_GO_tp3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"complete.obs"</span>)</span>
<span id="cb99-12"></span>
<span id="cb99-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA or Inf values with zero</span></span>
<span id="cb99-14">cor_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.infinite</span>(cor_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb99-15"></span>
<span id="cb99-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb99-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb99-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Between Actual and Predicted Gene Expression"</span>,</span>
<span id="cb99-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb99-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb99-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-47-1.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="tp4" class="level2">
<h2 class="anchored" data-anchor-id="tp4">5.4 TP4</h2>
<section id="the-model-3" class="level3">
<h3 class="anchored" data-anchor-id="the-model-3">5.4.1 The model</h3>
<p>Train elastic models to predict gene expression from miRNA/lncRNA/methylation</p>
<div class="sourceCode" id="cb100" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression from miRNA/lncRNA/methylation</span></span>
<span id="cb100-2">models_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_energetic_state_GO_tp4, full_pred_counts_tp4)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb101" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1">feature_importance_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_ATP_prod_GO_tp4)</span>
<span id="cb101-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_ATP_prod_GO_tp4, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature                MeanImportance
##    &lt;chr&gt;                           &lt;dbl&gt;
##  1 lncRNA_17688                  0.00417
##  2 lncRNA_9386                   0.00405
##  3 lncRNA_19774                  0.00384
##  4 lncRNA_1162                   0.00365
##  5 lncRNA_5418                   0.00349
##  6 lncRNA_8652                   0.00349
##  7 lncRNA_22886                  0.00343
##  8 lncRNA_053                    0.00332
##  9 lncRNA_8067                   0.00327
## 10 lncRNA_23922                  0.00312
## 11 lncRNA_2103                   0.00305
## 12 lncRNA_1662                   0.00304
## 13 CpG_ptg000030l_2148131        0.00290
## 14 CpG_ptg000015l_9303469        0.00268
## 15 lncRNA_8841                   0.00260
## 16 lncRNA_1964                   0.00259
## 17 lncRNA_7373                   0.00255
## 18 lncRNA_3700                   0.00243
## 19 lncRNA_9252                   0.00240
## 20 lncRNA_12533                  0.00229</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb103" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1">performance_results_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_ATP_prod_GO_tp4, vsd_energetic_state_GO_tp4, full_pred_counts_tp4)</span>
<span id="cb103-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.0000  0.9817  1.0000  0.8802  1.0000  1.0000      18</code></pre>
</section>
<section id="results-3" class="level3">
<h3 class="anchored" data-anchor-id="results-3">5.4.2 Results</h3>
<p>Plot results.</p>
<div class="sourceCode" id="cb105" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb105-2">top_features_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_ATP_prod_GO_tp4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb105-3"></span>
<span id="cb105-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb105-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_ATP_prod_GO_tp4, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb105-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb105-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb105-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-51-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb106" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_ATP_prod_GO_tp4, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb106-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb106-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb106-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb106-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression"</span>,</span>
<span id="cb106-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb106-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb106-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span>
<span id="cb106-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 18 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-52-1.png" class="img-fluid"><!-- --></p>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb108" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb108-2">best_feature_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb108-3"></span>
<span id="cb108-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb108-5">actual_values_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_tp4[[best_feature_ATP_prod_GO_tp4]]</span>
<span id="cb108-6">predicted_values_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO_tp4[[best_feature_ATP_prod_GO_tp4]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp4), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb108-7"></span>
<span id="cb108-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb108-9">prediction_df_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb108-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_ATP_prod_GO_tp4,</span>
<span id="cb108-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_ATP_prod_GO_tp4</span>
<span id="cb108-12">)</span>
<span id="cb108-13"></span>
<span id="cb108-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb108-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_ATP_prod_GO_tp4, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_feature_ATP_prod_GO_tp4),</span>
<span id="cb108-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb108-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_ATP_prod_GO_tp4), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_ATP_prod_GO_tp4), </span>
<span id="cb108-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb108-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-53-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb110" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>We can also look at which miRNA(s) contributed most to predicting gene of interest</p>
<div class="sourceCode" id="cb111" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all with R^2 values above line in plot</span></span>
<span id="cb111-2">all_features_ATP_prod_GO_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO_tp4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb111-3"></span>
<span id="cb111-4">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb111-5">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb111-6">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb111-7">  </span>
<span id="cb111-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb111-9">}</span>
<span id="cb111-10"></span>
<span id="cb111-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_ATP_prod_GO_tp4) {</span>
<span id="cb111-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb111-13">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_ATP_prod_GO_tp4[[feature]]</span>
<span id="cb111-14">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb111-15">  </span>
<span id="cb111-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb111-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb111-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb111-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb111-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb111-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb111-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb111-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb111-24">  </span>
<span id="cb111-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb111-26">}</span></code></pre></div>
<div class="sourceCode" id="cb112" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation between actual and predicted gene expression</span></span>
<span id="cb112-2">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(models_ATP_prod_GO_tp4, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts_tp4), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))</span>
<span id="cb112-3"></span>
<span id="cb112-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure matrices are the same size</span></span>
<span id="cb112-5">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_energetic_state_GO_tp4), drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align columns</span></span>
<span id="cb112-6"></span>
<span id="cb112-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 0 variance columns</span></span>
<span id="cb112-8">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(predicted_matrix, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(col) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb112-9"></span>
<span id="cb112-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation matrix, handling missing values</span></span>
<span id="cb112-11">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(predicted_matrix, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_energetic_state_GO_tp4), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"complete.obs"</span>)</span>
<span id="cb112-12"></span>
<span id="cb112-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA or Inf values with zero</span></span>
<span id="cb112-14">cor_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.infinite</span>(cor_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb112-15"></span>
<span id="cb112-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb112-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb112-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Between Actual and Predicted Gene Expression"</span>,</span>
<span id="cb112-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb112-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb112-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-55-1.png" class="img-fluid"><!-- --></p>
</section>
</section>
</section>
<section id="compare-accross-timepoints" class="level1">
<h1>6 Compare accross timepoints</h1>
<p>See, for each pair of timepoints, which features are present in both lists of top 50 most important features</p>
<div class="sourceCode" id="cb113" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(top_features_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature, top_features_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)</span></code></pre></div>
<pre><code>## [1] "CpG_ptg000036l_3087796"</code></pre>
<div class="sourceCode" id="cb115" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(top_features_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature, top_features_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)</span></code></pre></div>
<pre><code>## [1] "lncRNA_8911"</code></pre>
<div class="sourceCode" id="cb117" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(top_features_ATP_prod_GO_tp1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature, top_features_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)</span></code></pre></div>
<pre><code>## [1] "CpG_ptg000027l_13568387"</code></pre>
<div class="sourceCode" id="cb119" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(top_features_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature, top_features_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)</span></code></pre></div>
<pre><code>## [1] "lncRNA_7865"</code></pre>
<div class="sourceCode" id="cb121" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(top_features_ATP_prod_GO_tp2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature, top_features_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)</span></code></pre></div>
<pre><code>## [1] "lncRNA_9386" "lncRNA_7865"</code></pre>
<div class="sourceCode" id="cb123" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(top_features_ATP_prod_GO_tp3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature, top_features_ATP_prod_GO_tp4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature)</span></code></pre></div>
<pre><code>## [1] "lncRNA_3700" "lncRNA_7865"</code></pre>
<p>Basically, there was little-to-no overlap in the most predictive features for each timepoint.</p>
<p>This is all making me pretty suspicious of how accurate the model is, I feel like itâ€™s overfitting. So far Iâ€™ve just been training the model on all of our data. Instead, I need to try training on a subset of our data and then testing the model.</p>
</section>
<section id="split-training-and-test" class="level1">
<h1>7 Split training and test</h1>
<section id="define-model-training-and-testing-function" class="level2">
<h2 class="anchored" data-anchor-id="define-model-training-and-testing-function">7.1 Define model training and testing function</h2>
<div class="sourceCode" id="cb125" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1">train_models_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_features, predictor_features, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">train_frac =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nfolds =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) {</span>
<span id="cb125-2">  </span>
<span id="cb125-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set up storage</span></span>
<span id="cb125-4">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb125-5">  performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb125-6"></span>
<span id="cb125-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select fraction of data</span></span>
<span id="cb125-8">  sample_idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_len</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(predictor_features)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor</span>(train_frac <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(predictor_features)))</span>
<span id="cb125-9"></span>
<span id="cb125-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split predictor data</span></span>
<span id="cb125-11">  X_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predictor_features[sample_idx, ]</span>
<span id="cb125-12">  X_test  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predictor_features[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sample_idx, ]</span>
<span id="cb125-13"></span>
<span id="cb125-14">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features)) {</span>
<span id="cb125-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split response data</span></span>
<span id="cb125-16">    y_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_features[sample_idx, feature]</span>
<span id="cb125-17">    y_test  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_features[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sample_idx, feature]</span>
<span id="cb125-18"></span>
<span id="cb125-19">    </span>
<span id="cb125-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if y_train is constant</span></span>
<span id="cb125-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(y_train)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb125-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">warning</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Skipping feature '%s': y_train is constant"</span>, feature))</span>
<span id="cb125-23">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">next</span></span>
<span id="cb125-24">    }</span>
<span id="cb125-25">    </span>
<span id="cb125-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run model on training data</span></span>
<span id="cb125-27">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(X_train), y_train, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> alpha, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nfolds =</span> nfolds)</span>
<span id="cb125-28">    models[[feature]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb125-29"></span>
<span id="cb125-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now apply the trained model to test data</span></span>
<span id="cb125-31">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newx =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(X_test), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb125-32">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y_test, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb125-33">    performance[performance<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> feature, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb125-34">  }</span>
<span id="cb125-35"></span>
<span id="cb125-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">models =</span> models, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">performance =</span> performance))</span>
<span id="cb125-37">}</span></code></pre></div>
</section>
<section id="run-function" class="level2">
<h2 class="anchored" data-anchor-id="run-function">7.2 Run function</h2>
<div class="sourceCode" id="cb126" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run training/testing function</span></span>
<span id="cb126-2">result_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models_split</span>(vsd_energetic_state_GO_t, full_pred_counts)</span>
<span id="cb126-3"></span>
<span id="cb126-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Results</span></span>
<span id="cb126-5">trained_models_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result_split<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>models</span>
<span id="cb126-6">model_performance_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result_split<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>performance</span>
<span id="cb126-7">feature_importance_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(trained_models_split)</span></code></pre></div>
</section>
<section id="results-4" class="level2">
<h2 class="anchored" data-anchor-id="results-4">7.3 Results</h2>
<p>Plot top predictive features for the test data</p>
<div class="sourceCode" id="cb127" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb127-2">top_features_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_split <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb127-3"></span>
<span id="cb127-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb127-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_split, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb127-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb127-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb127-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb127-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb127-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb127-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-59-1.png" class="img-fluid"><!-- --></p>
<p>Plot performance (R^2) of the model in predicting the test data</p>
<div class="sourceCode" id="cb128" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(model_performance_split, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb128-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb128-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(model_performance_split<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb128-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb128-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression"</span>,</span>
<span id="cb128-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb128-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb128-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span>
<span id="cb128-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 4 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-60-1.png" class="img-fluid"><!-- --></p>
<p>The values for explained variance are all over the place, which suggests the model may not be very generalizable accross all genes.</p>
<p>Letâ€™s double check the R^2 distribution</p>
<div class="sourceCode" id="cb130" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(model_performance_split, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skyblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribution of RÂ² on Test Set"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ²"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 4 rows containing non-finite outside the scale range
## (`stat_bin()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-61-1.png" class="img-fluid"><!-- --></p>
<p>Again, model performance appears essentially random. This could be due to small sample size (though this seems less likely sigen N=40), invariant data, noise, or because expression of some genes is driven by features not included in our predictor set (e.g.&nbsp;transcription factors). The final option seems most likely to me.</p>
<p>There may, however, be a subset of genes whose expression <em>is</em> primarily driven by our epigenetic mechanisms. Bootstrapping should help us identify this subset, if it exists. Iâ€™ll run model training/testing many times and see which genes are consistently well-predicted.</p>
</section>
</section>
<section id="bootstrapping" class="level1">
<h1>8 Bootstrapping</h1>
<div class="sourceCode" id="cb132" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1">n_replicates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of replicates</span></span>
<span id="cb132-2">r2_threshold <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># threshold for "good" prediction</span></span>
<span id="cb132-3">TM_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb132-4">MP_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb132-5">FI_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb132-6"></span>
<span id="cb132-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform bootstrapping</span></span>
<span id="cb132-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_replicates) {</span>
<span id="cb132-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beginning replicate"</span>, i)</span>
<span id="cb132-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb132-11">  result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models_split</span>(vsd_energetic_state_GO_t, full_pred_counts)</span>
<span id="cb132-12">  </span>
<span id="cb132-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Extracting results for replicate"</span>, i)</span>
<span id="cb132-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb132-15">  trained_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>models</span>
<span id="cb132-16">  model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>performance</span>
<span id="cb132-17">  feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(trained_models)</span>
<span id="cb132-18">  </span>
<span id="cb132-19">  TM_list[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> trained_models</span>
<span id="cb132-20">  TM_list[[i]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Replicate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i</span>
<span id="cb132-21">  </span>
<span id="cb132-22">  MP_list[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model_performance</span>
<span id="cb132-23">  MP_list[[i]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Replicate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i</span>
<span id="cb132-24">  </span>
<span id="cb132-25">  FI_list[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance</span>
<span id="cb132-26">  FI_list[[i]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Replicate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i</span>
<span id="cb132-27">}</span></code></pre></div>
<pre><code>## Beginning replicate 1
## Extracting results for replicate 1
## Beginning replicate 2
## Extracting results for replicate 2
## Beginning replicate 3
## Extracting results for replicate 3
## Beginning replicate 4
## Extracting results for replicate 4
## Beginning replicate 5
## Extracting results for replicate 5
## Beginning replicate 6
## Extracting results for replicate 6
## Beginning replicate 7
## Extracting results for replicate 7
## Beginning replicate 8
## Extracting results for replicate 8
## Beginning replicate 9
## Extracting results for replicate 9
## Beginning replicate 10
## Extracting results for replicate 10
## Beginning replicate 11
## Extracting results for replicate 11
## Beginning replicate 12
## Extracting results for replicate 12
## Beginning replicate 13
## Extracting results for replicate 13
## Beginning replicate 14
## Extracting results for replicate 14
## Beginning replicate 15
## Extracting results for replicate 15
## Beginning replicate 16
## Extracting results for replicate 16
## Beginning replicate 17
## Extracting results for replicate 17
## Beginning replicate 18
## Extracting results for replicate 18
## Beginning replicate 19
## Extracting results for replicate 19
## Beginning replicate 20
## Extracting results for replicate 20
## Beginning replicate 21
## Extracting results for replicate 21
## Beginning replicate 22
## Extracting results for replicate 22
## Beginning replicate 23
## Extracting results for replicate 23
## Beginning replicate 24
## Extracting results for replicate 24
## Beginning replicate 25
## Extracting results for replicate 25</code></pre>
<div class="sourceCode" id="cb134" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all results</span></span>
<span id="cb134-2">all_TM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, TM_list)</span>
<span id="cb134-3">all_MP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, MP_list)</span>
<span id="cb134-4">all_FI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, FI_list)</span></code></pre></div>
<div class="sourceCode" id="cb135" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Count how often each feature exceeds the RÂ² threshold</span></span>
<span id="cb135-2"></span>
<span id="cb135-3">MP_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_MP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb135-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb135-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb135-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean_R2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb135-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SD_R2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb135-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">High_Perf_Count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> r2_threshold),</span>
<span id="cb135-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'drop'</span></span>
<span id="cb135-10">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb135-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(High_Perf_Count))</span>
<span id="cb135-12"></span>
<span id="cb135-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top consistently high-performing features</span></span>
<span id="cb135-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(MP_summary)</span></code></pre></div>
<pre><code>## # A tibble: 99 Ã— 4
##    Feature    Mean_R2  SD_R2 High_Perf_Count
##    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;           &lt;int&gt;
##  1 FUN_001160   0.840 0.0826              25
##  2 FUN_001396   0.845 0.0945              25
##  3 FUN_008934   0.920 0.0414              25
##  4 FUN_012474   0.808 0.0918              25
##  5 FUN_028200   0.912 0.0419              25
##  6 FUN_039293   0.846 0.0931              25
##  7 FUN_041721   0.880 0.0542              25
##  8 FUN_002433   0.748 0.120               24
##  9 FUN_011908   0.791 0.115               24
## 10 FUN_015434   0.844 0.131               24
## # â„¹ 89 more rows</code></pre>
<div class="sourceCode" id="cb137" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># How many genes are consistently well-predicted?</span></span>
<span id="cb137-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(MP_summary[MP_summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Mean_R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,])</span></code></pre></div>
<pre><code>## [1] 43</code></pre>
<p>Sort genes by average R^2 across all replicates, then plot R^2 for all replicates</p>
<div class="sourceCode" id="cb139" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Merge mean R2 info into full replicate-level data</span></span>
<span id="cb139-2">all_MP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(all_MP, MP_summary[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean_R2"</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>)</span>
<span id="cb139-3"></span>
<span id="cb139-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reorder Feature factor by Mean_R2</span></span>
<span id="cb139-5">all_MP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(all_MP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature,</span>
<span id="cb139-6">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> MP_summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(MP_summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Mean_R2)])</span>
<span id="cb139-7"></span>
<span id="cb139-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot with features sorted by mean RÂ²</span></span>
<span id="cb139-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(all_MP, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Feature, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb139-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Replicate)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb139-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Mean_R2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb139-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(all_MP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb139-13">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb139-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb139-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression"</span>,</span>
<span id="cb139-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression Feature (Ordered by Mean RÂ²)"</span>,</span>
<span id="cb139-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>,</span>
<span id="cb139-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Replicate"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb139-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb139-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 80 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-64-1.png" class="img-fluid"><!-- --></p>
<p>Average importance of all predictive features and plot those with highest average importance accross all replicates</p>
<div class="sourceCode" id="cb141" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Average importance across replicates</span></span>
<span id="cb141-2">mean_importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_FI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb141-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb141-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(MeanImportance, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb141-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb141-6"></span>
<span id="cb141-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 50 features</span></span>
<span id="cb141-8">top_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mean_importance_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb141-9"></span>
<span id="cb141-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb141-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb141-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb141-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb141-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb141-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top Predictive Features by Mean Importance"</span>,</span>
<span id="cb141-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb141-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-65-1.png" class="img-fluid"><!-- --></p>
</section>
<section id="boostrapping-on-predictable-genes" class="level1">
<h1>9 Boostrapping on predictable genes</h1>
<p>Now I only want to model genes that are well-predicted over many replicates</p>
<p>Isolate well-predicted genes</p>
<div class="sourceCode" id="cb142" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1">well_predicted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MP_summary[MP_summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Mean_R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,]</span>
<span id="cb142-2"></span>
<span id="cb142-3">vsd_high_perf_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energetic_state_GO_t[,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_energetic_state_GO_t) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> well_predicted<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature]</span>
<span id="cb142-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(vsd_high_perf_t)</span></code></pre></div>
<pre><code>## [1] 40 43</code></pre>
<p>Of the original 99 genes annotated for energetic state GO terms, 35 are consistently well-predicted by our model.</p>
<p>Run bootstrapping on isolated genes</p>
<div class="sourceCode" id="cb144" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1">n_replicates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of replicates</span></span>
<span id="cb144-2">r2_threshold <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># threshold for "good" prediction</span></span>
<span id="cb144-3">TM_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb144-4">MP_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb144-5">FI_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb144-6"></span>
<span id="cb144-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform bootstrapping</span></span>
<span id="cb144-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_replicates) {</span>
<span id="cb144-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beginning replicate"</span>, i)</span>
<span id="cb144-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb144-11">  result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models_split</span>(vsd_high_perf_t, full_pred_counts)</span>
<span id="cb144-12">  </span>
<span id="cb144-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Extracting results for replicate"</span>, i)</span>
<span id="cb144-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb144-15">  trained_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>models</span>
<span id="cb144-16">  model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>performance</span>
<span id="cb144-17">  feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(trained_models)</span>
<span id="cb144-18">  </span>
<span id="cb144-19">  TM_list[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Replicate =</span> i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Models =</span> trained_models)</span>
<span id="cb144-20">  </span>
<span id="cb144-21">  MP_list[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model_performance</span>
<span id="cb144-22">  MP_list[[i]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Replicate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i</span>
<span id="cb144-23">  </span>
<span id="cb144-24">  FI_list[[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance</span>
<span id="cb144-25">  FI_list[[i]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Replicate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i</span>
<span id="cb144-26">}</span></code></pre></div>
<pre><code>## Beginning replicate 1
## Extracting results for replicate 1
## Beginning replicate 2
## Extracting results for replicate 2
## Beginning replicate 3
## Extracting results for replicate 3
## Beginning replicate 4
## Extracting results for replicate 4
## Beginning replicate 5
## Extracting results for replicate 5
## Beginning replicate 6
## Extracting results for replicate 6
## Beginning replicate 7
## Extracting results for replicate 7
## Beginning replicate 8
## Extracting results for replicate 8
## Beginning replicate 9
## Extracting results for replicate 9
## Beginning replicate 10
## Extracting results for replicate 10</code></pre>
<div class="sourceCode" id="cb146" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all results</span></span>
<span id="cb146-2">all_TM_highperf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, TM_list)</span>
<span id="cb146-3">all_MP_highperf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, MP_list)</span>
<span id="cb146-4">all_FI_highperf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, FI_list)</span></code></pre></div>
<div class="sourceCode" id="cb147" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Count how often each feature exceeds the RÂ² threshold</span></span>
<span id="cb147-2"></span>
<span id="cb147-3">MP_summary_highperf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_MP_highperf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb147-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb147-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb147-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean_R2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb147-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SD_R2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb147-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">High_Perf_Count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> r2_threshold),</span>
<span id="cb147-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'drop'</span></span>
<span id="cb147-10">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb147-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(High_Perf_Count))</span>
<span id="cb147-12"></span>
<span id="cb147-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top consistently high-performing features</span></span>
<span id="cb147-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(MP_summary_highperf)</span></code></pre></div>
<pre><code>## # A tibble: 43 Ã— 4
##    Feature    Mean_R2  SD_R2 High_Perf_Count
##    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;           &lt;int&gt;
##  1 FUN_008934   0.897 0.0752              10
##  2 FUN_015434   0.826 0.0954              10
##  3 FUN_028200   0.910 0.0418              10
##  4 FUN_037573   0.844 0.0811              10
##  5 FUN_041721   0.849 0.0700              10
##  6 FUN_001160   0.750 0.186                9
##  7 FUN_001396   0.762 0.171                9
##  8 FUN_002433   0.674 0.132                9
##  9 FUN_007022   0.722 0.163                9
## 10 FUN_032220   0.721 0.240                9
## # â„¹ 33 more rows</code></pre>
<div class="sourceCode" id="cb149" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># How many genes are consistently well-predicted?</span></span>
<span id="cb149-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(MP_summary_highperf[MP_summary_highperf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Mean_R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,])</span></code></pre></div>
<pre><code>## [1] 34</code></pre>
<p>When I train the model on only these 35 well-predicted genes, 28 of them are again well-predicted. Thatâ€™s a much higher success rate! This suggests that epigenetic mechanisms may indeed be able to predict expression of these genes</p>
<p>Sort genes by average R^2 across all replicates, then plot R^2 for all replicates</p>
<div class="sourceCode" id="cb151" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Merge mean R2 info into full replicate-level data</span></span>
<span id="cb151-2">all_MP_highperf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(all_MP_highperf, MP_summary_highperf[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean_R2"</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>)</span>
<span id="cb151-3"></span>
<span id="cb151-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reorder Feature factor by Mean_R2</span></span>
<span id="cb151-5">all_MP_highperf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(all_MP_highperf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature,</span>
<span id="cb151-6">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> MP_summary_highperf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(MP_summary_highperf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Mean_R2)])</span></code></pre></div>
<div class="sourceCode" id="cb152" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot with features sorted by mean RÂ²</span></span>
<span id="cb152-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(all_MP_highperf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Feature, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb152-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Replicate)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb152-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Mean_R2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb152-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(all_MP_highperf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb152-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb152-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb152-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression"</span>,</span>
<span id="cb152-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression Feature (Ordered by Mean RÂ²)"</span>,</span>
<span id="cb152-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>,</span>
<span id="cb152-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Replicate"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb152-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb152-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-70-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb154" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Average importance across replicates</span></span>
<span id="cb154-2">mean_importance_df_highperf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_FI_highperf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb154-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb154-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(MeanImportance, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb154-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb154-6"></span>
<span id="cb154-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 50 features</span></span>
<span id="cb154-8">top_features_highperf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mean_importance_df_highperf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb154-9"></span>
<span id="cb154-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb154-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_highperf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb154-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top Predictive Features by Mean Importance"</span>,</span>
<span id="cb154-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb154-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-71-1.png" class="img-fluid"><!-- --></p>
<p>Look at most predictive epigenetic features for these well-predicted genes</p>
<div class="sourceCode" id="cb155" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Define well-predicted features</span></span>
<span id="cb155-2">all_features_highR2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_MP_highperf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb155-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Mean_R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb155-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb155-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>()</span>
<span id="cb155-6"></span>
<span id="cb155-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to extract importance from a single model</span></span>
<span id="cb155-8">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb155-9">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove intercept</span></span>
<span id="cb155-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predictor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb155-11">}</span>
<span id="cb155-12"></span>
<span id="cb155-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loop over features, aggregate importance across replicates, and plot</span></span>
<span id="cb155-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (target_feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_highR2) {</span>
<span id="cb155-15">  </span>
<span id="cb155-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract and combine importance scores across all replicates</span></span>
<span id="cb155-17">  importance_all_reps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(TM_list, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(rep_entry) {</span>
<span id="cb155-18">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rep_entry<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Models[[target_feature]]</span>
<span id="cb155-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.null</span>(model)) {</span>
<span id="cb155-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(model)</span>
<span id="cb155-21">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb155-22">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb155-23">    }</span>
<span id="cb155-24">  }) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>()</span>
<span id="cb155-25"></span>
<span id="cb155-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If no importance data was found, skip</span></span>
<span id="cb155-27">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(importance_all_reps) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">next</span></span>
<span id="cb155-28"></span>
<span id="cb155-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute average importance across replicates</span></span>
<span id="cb155-30">  mean_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> importance_all_reps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb155-31">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Predictor) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb155-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Importance, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb155-33">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb155-34">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb155-35">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb155-36"></span>
<span id="cb155-37">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot once per target feature</span></span>
<span id="cb155-38">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mean_importance, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Predictor, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb155-39">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb155-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb155-41">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb155-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top Predictors for"</span>, target_feature),</span>
<span id="cb155-43">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predictor"</span>,</span>
<span id="cb155-44">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance (across replicates)"</span>)</span>
<span id="cb155-45"></span>
<span id="cb155-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb155-47">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-6.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-7.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-8.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-9.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-10.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-11.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-12.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-13.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-14.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-15.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-16.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-17.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-18.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-19.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-20.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-21.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-22.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-23.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-24.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-25.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-26.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-27.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-28.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-29.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-30.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-31.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-32.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-33.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.3-Apul-multiomic-machine-learning-byTP_files/figure-gfm/unnamed-chunk-72-34.png" class="img-fluid"><!-- --></p>
</section>
<section id="functions-of-well-predicted-genes" class="level1">
<h1>10 Functions of well-predicted genes</h1>
<div class="sourceCode" id="cb156" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1">all_features_highR2_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energetic_state_GO[energetic_state_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> all_features_highR2,]</span>
<span id="cb156-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(all_features_highR2_FA)</span></code></pre></div>
<pre><code>##          gene module                           V1     V3
## 1  FUN_002433    ME2     ntLink_8:1537514-1543906 F1LU71
## 2  FUN_004083    ME2   ntLink_8:18989336-18999141 Q9ET22
## 5  FUN_000632    ME8     ntLink_6:5217131-5219121 O97125
## 6  FUN_000637    ME8     ntLink_6:5244470-5246789 O97125
## 8  FUN_001160    ME1     ntLink_6:9221504-9231233 P97742
## 13 FUN_001396    ME1   ntLink_6:11908587-11910717 O97562
## 19 FUN_007022    ME9 ptg000001l:19386902-19398415 Q8WP19
## 22 FUN_008282    ME3   ptg000002l:9911971-9929166 Q9VCU9
## 23 FUN_008296    ME1 ptg000002l:10054447-10061170 Q9DBY1
## 26 FUN_008660   ME14 ptg000002l:14136576-14138681 Q5R9Y4
## 27 FUN_008934    ME8     ptg000004l:622874-629747 A5D7I4
## 31 FUN_011908   ME14   ptg000008l:2748000-2770398 Q5R4G2
## 39 FUN_012474    ME1   ptg000008l:9228493-9235608 Q9XTR8
## 42 FUN_015352    ME1   ptg000009l:9116551-9124784 Q4R4S5
## 44 FUN_015434   ME14 ptg000009l:10125666-10128350 P53448
## 50 FUN_023367    ME1   ptg000017l:6723553-6730063 P17712
## 52 FUN_023596    ME2   ptg000017l:9699993-9702655 Q9Y5Y6
## 54 FUN_025232    ME2     ptg000019l:257406-264111 P55070
## 58 FUN_026128   ME41   ptg000020l:4918603-4924154 P42574
## 59 FUN_027948   ME32 ptg000021l:13714157-13715126 Q63HM9
## 61 FUN_028200    ME2 ptg000021l:16810807-16815447 Q4R7L3
## 62 FUN_029188    ME0   ptg000022l:9130844-9134575 P70677
## 67 FUN_032220    ME1 ptg000023l:29856466-29862755 Q19749
## 70 FUN_034872    ME3   ptg000025l:1070571-1071703 Q9XTR8
## 74 FUN_035467   ME14   ptg000025l:7690136-7695911 Q16822
## 75 FUN_035468    ME8   ptg000025l:7702781-7707570 Q8BH04
## 79 FUN_037573    ME2 ptg000026l:11925692-11934635 O42586
## 80 FUN_038166   ME14   ptg000027l:3306966-3311323 Q7ZX03
## 83 FUN_039293    ME2     ptg000028l:389925-395432 P55070
## 89 FUN_041710    ME2   ptg000035l:6737981-6752397 Q5LUF3
## 90 FUN_041721    ME5   ptg000035l:6790698-6792011 Q5R4G2
## 93 FUN_042950    ME0   ptg000047l:2301377-2311682 Q12933
## 95 FUN_042949    ME1   ptg000047l:2251447-2263489 Q12933
## 97 FUN_042982   ME12   ptg000047l:2690313-2698318 Q8BS35
##                                                                                                                                                                                                                                                             Protein.names
## 1                                                                  Methylglutaconyl-CoA hydratase, mitochondrial (3-MG-CoA hydratase) (EC 4.2.1.18) (AU-specific RNA-binding enoyl-CoA hydratase) (AU-binding enoyl-CoA hydratase) (Itaconyl-CoA hydratase) (EC 4.2.1.56)
## 2                                                                                                    Dipeptidyl peptidase 2 (EC 3.4.14.2) (Dipeptidyl aminopeptidase II) (Dipeptidyl peptidase 7) (Dipeptidyl peptidase II) (DPP II) (Quiescent cell proline dipeptidase)
## 5                                                                                                                                                                                                                                                   Heat shock protein 68
## 6                                                                                                                                                                                                                                                   Heat shock protein 68
## 8                                                                                       Carnitine O-palmitoyltransferase 1, liver isoform (CPT1-L) (EC 2.3.1.21) (Carnitine O-palmitoyltransferase I, liver isoform) (CPT I) (CPTI-L) (Carnitine palmitoyltransferase 1A)
## 13                                                                                                                                                         Dicarboxylate carrier SLC25A8 (Mitochondrial uncoupling protein 2) (UCP 2) (Solute carrier family 25 member 8)
## 19                                                                                                                                                                                                                                                         Cryptochrome-1
## 22                                                                                                                                                                                                                 Endoribonuclease Dcr-1 (Protein dicer-1) (EC 3.1.26.-)
## 23                                                                                                                                  E3 ubiquitin-protein ligase synoviolin (EC 2.3.2.27) (RING-type E3 ubiquitin transferase synoviolin) (Synovial apoptosis inhibitor 1)
## 26                                                                                                                                                                                                                                Ras-related protein Rab-7a (EC 3.6.5.2)
## 27                                                            Exostosin-1 (EC 2.4.1.224) (EC 2.4.1.225) (Glucuronosyl-N-acetylglucosaminyl-proteoglycan/N-acetylglucosaminyl-proteoglycan 4-alpha-N-acetylglucosaminyltransferase) (Multiple exostoses protein 1 homolog)
## 31                                                                                     Platelet-activating factor acetylhydrolase IB subunit alpha2 (EC 3.1.1.47) (PAF acetylhydrolase 30 kDa subunit) (PAF-AH 30 kDa subunit) (PAF-AH subunit beta) (PAFAH subunit beta)
## 39                                                                                                                                                                                                                                            Lipase ZK262.3 (EC 3.1.1.-)
## 42                                                                                                           Lysosomal acid lipase/cholesteryl ester hydrolase (Acid cholesteryl ester hydrolase) (LAL) (EC 3.1.1.13) (Cholesteryl esterase) (Lipase A) (Sterol esterase)
## 44                                                                                                                                                                                                   Fructose-bisphosphate aldolase C (EC 4.1.2.13) (Brain-type aldolase)
## 50                                                                                                                                                                              Hexokinase-4 (HK4) (EC 2.7.1.1) (Glucokinase) (Hexokinase type IV) (HK IV) (Hexokinase-D)
## 52                                 Suppressor of tumorigenicity 14 protein (EC 3.4.21.109) (Matriptase) (Membrane-type serine protease 1) (MT-SP1) (Prostamin) (Serine protease 14) (Serine protease TADG-15) (Tumor-associated differentially-expressed gene 15 protein)
## 54                                                                                                                                                                                                         Glyceraldehyde-3-phosphate dehydrogenase (GAPDH) (EC 1.2.1.12)
## 58                                                                         Caspase-3 (CASP-3) (EC 3.4.22.56) (Apopain) (Cysteine protease CPP32) (CPP-32) (Protein Yama) (SREBP cleavage activity 1) (SCA-1) [Cleaved into: Caspase-3 subunit p17; Caspase-3 subunit p12]
## 59                                                                                                                                                                                                                                   PI-PLC X domain-containing protein 3
## 61                                                                                                                                                        26S proteasome regulatory subunit 6B (26S proteasome AAA-ATPase subunit RPT3) (Proteasome 26S subunit ATPase 4)
## 62                                                                  Caspase-3 (CASP-3) (EC 3.4.22.56) (Apopain) (Cysteine protease CPP32) (CPP-32) (LICE) (Protein Yama) (SREBP cleavage activity 1) (SCA-1) [Cleaved into: Caspase-3 subunit p17; Caspase-3 subunit p12]
## 67 Dihydrolipoyllysine-residue acetyltransferase component of pyruvate dehydrogenase complex, mitochondrial (EC 2.3.1.12) (Dihydrolipoamide acetyltransferase component of pyruvate dehydrogenase complex) (Pyruvate dehydrogenase complex component E2) (PDC-E2) (PDCE2)
## 70                                                                                                                                                                                                                                            Lipase ZK262.3 (EC 3.1.1.-)
## 74                                                                                                                                                                                         Phosphoenolpyruvate carboxykinase [GTP], mitochondrial (PEPCK-M) (EC 4.1.1.32)
## 75                                                                                                                                                                                         Phosphoenolpyruvate carboxykinase [GTP], mitochondrial (PEPCK-M) (EC 4.1.1.32)
## 79                                                                                                                26S proteasome regulatory subunit 6A-B (26S proteasome AAA-ATPase subunit RPT5-B) (Proteasome 26S subunit ATPase 3-B) (Tat-binding protein 10) (TBP-10)
## 80                                                                                                                                                                                Forkhead box protein K2 (FoxK2) (Interleukin enhancer-binding factor 1) (ILF1) (xFoxK1)
## 83                                                                                                                                                                                                         Glyceraldehyde-3-phosphate dehydrogenase (GAPDH) (EC 1.2.1.12)
## 89                                                                                                                                                                                                                     Propionyl-CoA carboxylase alpha chain (EC 6.4.1.3)
## 90                                                                                     Platelet-activating factor acetylhydrolase IB subunit alpha2 (EC 3.1.1.47) (PAF acetylhydrolase 30 kDa subunit) (PAF-AH 30 kDa subunit) (PAF-AH subunit beta) (PAFAH subunit beta)
## 93                                                                             TNF receptor-associated factor 2 (EC 2.3.2.27) (E3 ubiquitin-protein ligase TRAF2) (RING-type E3 ubiquitin transferase TRAF2) (Tumor necrosis factor type 2 receptor-associated protein 3)
## 95                                                                             TNF receptor-associated factor 2 (EC 2.3.2.27) (E3 ubiquitin-protein ligase TRAF2) (RING-type E3 ubiquitin transferase TRAF2) (Tumor necrosis factor type 2 receptor-associated protein 3)
## 97                                                                                                                                                                                                 Alkylglycerol monooxygenase (EC 1.14.16.5) (Transmembrane protein 195)
##                                                                              Organism
## 1                                                             Rattus norvegicus (Rat)
## 2                                                                Mus musculus (Mouse)
## 5                                                 Drosophila melanogaster (Fruit fly)
## 6                                                 Drosophila melanogaster (Fruit fly)
## 8                                                                Mus musculus (Mouse)
## 13                                                                   Sus scrofa (Pig)
## 19                      Macaca fascicularis (Crab-eating macaque) (Cynomolgus monkey)
## 22                                                Drosophila melanogaster (Fruit fly)
## 23                                                               Mus musculus (Mouse)
## 26                          Pongo abelii (Sumatran orangutan) (Pongo pygmaeus abelii)
## 27                                                                Bos taurus (Bovine)
## 31                          Pongo abelii (Sumatran orangutan) (Pongo pygmaeus abelii)
## 39                                                             Caenorhabditis elegans
## 42                      Macaca fascicularis (Crab-eating macaque) (Cynomolgus monkey)
## 44                                                       Carassius auratus (Goldfish)
## 50                                                            Rattus norvegicus (Rat)
## 52                                                               Homo sapiens (Human)
## 54                                       Lactarius deterrimus (False saffron milkcap)
## 58                                                               Homo sapiens (Human)
## 59                                                               Homo sapiens (Human)
## 61                      Macaca fascicularis (Crab-eating macaque) (Cynomolgus monkey)
## 62                                                               Mus musculus (Mouse)
## 67                                                             Caenorhabditis elegans
## 70                                                             Caenorhabditis elegans
## 74                                                               Homo sapiens (Human)
## 75                                                               Mus musculus (Mouse)
## 79                                               Xenopus laevis (African clawed frog)
## 80                                               Xenopus laevis (African clawed frog)
## 83                                       Lactarius deterrimus (False saffron milkcap)
## 89 Ruegeria pomeroyi (strain ATCC 700808 / DSM 15171 / DSS-3) (Silicibacter pomeroyi)
## 90                          Pongo abelii (Sumatran orangutan) (Pongo pygmaeus abelii)
## 93                                                               Homo sapiens (Human)
## 95                                                               Homo sapiens (Human)
## 97                                                               Mus musculus (Mouse)
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Gene.Ontology..biological.process.
## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            fatty acid beta-oxidation [GO:0006635]; leucine catabolic process [GO:0006552]
## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        lysosomal protein catabolic process [GO:1905146]; protein catabolic process [GO:0030163]; proteolysis [GO:0006508]
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               cellular response to unfolded protein [GO:0034620]; chaperone cofactor-dependent protein refolding [GO:0051085]; determination of adult lifespan [GO:0008340]; protein refolding [GO:0042026]; response to starvation [GO:0042594]; vesicle-mediated transport [GO:0016192]
## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               cellular response to unfolded protein [GO:0034620]; chaperone cofactor-dependent protein refolding [GO:0051085]; determination of adult lifespan [GO:0008340]; protein refolding [GO:0042026]; response to starvation [GO:0042594]; vesicle-mediated transport [GO:0016192]
## 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               carnitine metabolic process [GO:0009437]; cellular response to fatty acid [GO:0071398]; eating behavior [GO:0042755]; epithelial cell differentiation [GO:0030855]; fatty acid beta-oxidation [GO:0006635]; fatty acid metabolic process [GO:0006631]; glucose metabolic process [GO:0006006]; lipid localization [GO:0010876]; liver regeneration [GO:0097421]; long-chain fatty acid metabolic process [GO:0001676]; positive regulation of fatty acid beta-oxidation [GO:0032000]; regulation of fatty acid oxidation [GO:0046320]; regulation of insulin secretion [GO:0050796]; regulation of lipid storage [GO:0010883]; response to alkaloid [GO:0043279]; response to antibiotic [GO:0046677]; response to ethanol [GO:0045471]; response to nutrient levels [GO:0031667]; response to organic cyclic compound [GO:0014070]; response to tetrachloromethane [GO:1904772]; response to xenobiotic stimulus [GO:0009410]; triglyceride metabolic process [GO:0006641]
## 13                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                adaptive thermogenesis [GO:1990845]; C4-dicarboxylate transport [GO:0015740]; cellular response to glucose stimulus [GO:0071333]; glutamine metabolic process [GO:0006541]; glycolytic process [GO:0006096]; macrophage differentiation [GO:0030225]; mitochondrial fission [GO:0000266]; mitochondrial transmembrane transport [GO:1990542]; mitochondrial transport [GO:0006839]; reactive oxygen species metabolic process [GO:0072593]; response to cold [GO:0009409]
## 19                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   circadian regulation of gene expression [GO:0032922]; circadian rhythm [GO:0007623]; entrainment of circadian clock by photoperiod [GO:0043153]; gluconeogenesis [GO:0006094]; glucose homeostasis [GO:0042593]; negative regulation of circadian rhythm [GO:0042754]; negative regulation of DNA-templated transcription [GO:0045892]; negative regulation of G protein-coupled receptor signaling pathway [GO:0045744]; negative regulation of glucocorticoid receptor signaling pathway [GO:2000323]; negative regulation of gluconeogenesis [GO:0045721]; negative regulation of protein ubiquitination [GO:0031397]; negative regulation of transcription by RNA polymerase II [GO:0000122]; positive regulation of protein ubiquitination [GO:0031398]; regulation of circadian rhythm [GO:0042752]; regulation of DNA damage checkpoint [GO:2000001]; response to activity [GO:0014823]; response to glucagon [GO:0033762]; response to light stimulus [GO:0009416]; signal transduction in response to DNA damage [GO:0042770]
## 22                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    apoptotic DNA fragmentation [GO:0006309]; dendrite morphogenesis [GO:0048813]; dsRNA transport [GO:0033227]; germ-line stem cell division [GO:0042078]; germarium-derived female germ-line cyst formation [GO:0030727]; germarium-derived oocyte fate determination [GO:0007294]; miRNA processing [GO:0035196]; mitotic cell cycle, embryonic [GO:0045448]; pole cell formation [GO:0007279]; pre-miRNA processing [GO:0031054]; response to starvation [GO:0042594]; RISC complex assembly [GO:0070922]; RNA phosphodiester bond hydrolysis [GO:0090501]; RNA-mediated post-transcriptional gene silencing [GO:0035194]; segment polarity determination [GO:0007367]; siRNA processing [GO:0030422]
## 23                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ERAD pathway [GO:0036503]; immature B cell differentiation [GO:0002327]; in utero embryonic development [GO:0001701]; intrinsic apoptotic signaling pathway in response to endoplasmic reticulum stress [GO:0070059]; negative regulation of endoplasmic reticulum stress-induced intrinsic apoptotic signaling pathway [GO:1902236]; protein catabolic process [GO:0030163]; protein K48-linked ubiquitination [GO:0070936]; protein stabilization [GO:0050821]; protein ubiquitination [GO:0016567]; response to unfolded protein [GO:0006986]; retrograde protein transport, ER to cytosol [GO:0030970]; ubiquitin-dependent ERAD pathway [GO:0030433]; ubiquitin-dependent protein catabolic process [GO:0006511]
## 26                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           early endosome to late endosome transport [GO:0045022]; endosome to plasma membrane protein transport [GO:0099638]; lipid catabolic process [GO:0016042]; lipophagy [GO:0061724]; phagosome acidification [GO:0090383]; phagosome-lysosome fusion [GO:0090385]
## 27 antigen processing and presentation [GO:0019882]; axon guidance [GO:0007411]; basement membrane organization [GO:0071711]; blood vessel remodeling [GO:0001974]; BMP signaling pathway [GO:0030509]; bone resorption [GO:0045453]; canonical Wnt signaling pathway [GO:0060070]; cartilage development involved in endochondral bone morphogenesis [GO:0060351]; cell adhesion mediated by integrin [GO:0033627]; cell fate commitment [GO:0045165]; cellular response to virus [GO:0098586]; chondrocyte hypertrophy [GO:0003415]; chondrocyte proliferation [GO:0035988]; chondroitin sulfate metabolic process [GO:0030204]; collagen fibril organization [GO:0030199]; cranial skeletal system development [GO:1904888]; dendrite self-avoidance [GO:0070593]; dendritic cell migration [GO:0036336]; developmental growth involved in morphogenesis [GO:0060560]; embryonic skeletal joint development [GO:0072498]; endochondral bone growth [GO:0003416]; endochondral ossification [GO:0001958]; endoderm development [GO:0007492]; epithelial tube branching involved in lung morphogenesis [GO:0060441]; fear response [GO:0042596]; fibroblast growth factor receptor signaling pathway [GO:0008543]; fluid transport [GO:0042044]; gastrulation [GO:0007369]; gene expression [GO:0010467]; glandular epithelial cell differentiation [GO:0002067]; glomerular basement membrane development [GO:0032836]; hair follicle morphogenesis [GO:0031069]; heart contraction [GO:0060047]; heart field specification [GO:0003128]; hematopoietic stem cell differentiation [GO:0060218]; hematopoietic stem cell homeostasis [GO:0061484]; hematopoietic stem cell migration to bone marrow [GO:0097241]; heparan sulfate proteoglycan biosynthetic process, polysaccharide chain biosynthetic process [GO:0015014]; heparin biosynthetic process [GO:0030210]; hypersensitivity [GO:0002524]; leukocyte tethering or rolling [GO:0050901]; limb joint morphogenesis [GO:0036022]; lymphocyte adhesion to endothelial cell of high endothelial venule [GO:0036339]; lymphocyte migration into lymphoid organs [GO:0097021]; mesenchymal cell differentiation involved in bone development [GO:1901706]; mesoderm development [GO:0007498]; motor behavior [GO:0061744]; multicellular organism growth [GO:0035264]; multicellular organismal water homeostasis [GO:0050891]; neural crest cell differentiation [GO:0014033]; olfactory bulb development [GO:0021772]; optic nerve development [GO:0021554]; ossification involved in bone maturation [GO:0043931]; perichondral bone morphogenesis [GO:0061974]; podocyte differentiation [GO:0072112]; protein catabolic process [GO:0030163]; protein glycosylation [GO:0006486]; protein-containing complex assembly [GO:0065003]; regulation of blood pressure [GO:0008217]; response to heparin [GO:0071503]; response to leukemia inhibitory factor [GO:1990823]; response to light intensity [GO:0009642]; sebaceous gland development [GO:0048733]; smoothened signaling pathway involved in lung development [GO:0060506]; social behavior [GO:0035176]; sodium ion homeostasis [GO:0055078]; stem cell division [GO:0017145]; stomach development [GO:0062094]; sulfation [GO:0051923]; sweat gland development [GO:0060792]; synaptic transmission, glutamatergic [GO:0035249]; tight junction organization [GO:0120193]; TNFSF11-mediated signaling pathway [GO:0071847]; vacuole organization [GO:0007033]; vasodilation [GO:0042311]; vocalization behavior [GO:0071625]; wound healing [GO:0042060]
## 31                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   lipid catabolic process [GO:0016042]; positive regulation of macroautophagy [GO:0016239]; spermatogenesis [GO:0007283]
## 39                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     lipid catabolic process [GO:0016042]
## 42                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     lipid catabolic process [GO:0016042]
## 44                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                fructose 1,6-bisphosphate metabolic process [GO:0030388]; glycolytic process [GO:0006096]
## 50                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       calcium ion import [GO:0070509]; carbohydrate phosphorylation [GO:0046835]; cellular glucose homeostasis [GO:0001678]; cellular response to glucose starvation [GO:0042149]; cellular response to insulin stimulus [GO:0032869]; cellular response to leptin stimulus [GO:0044320]; detection of glucose [GO:0051594]; fructose 2,6-bisphosphate metabolic process [GO:0006003]; fructose 6-phosphate metabolic process [GO:0006002]; glucose 6-phosphate metabolic process [GO:0051156]; glucose homeostasis [GO:0042593]; glucose metabolic process [GO:0006006]; glycogen biosynthetic process [GO:0005978]; glycolytic process [GO:0006096]; lipid homeostasis [GO:0055088]; mannose metabolic process [GO:0006013]; NADP metabolic process [GO:0006739]; negative regulation of epinephrine secretion [GO:0032811]; negative regulation of gluconeogenesis [GO:0045721]; positive regulation of cytosolic calcium ion concentration [GO:0007204]; positive regulation of glycogen biosynthetic process [GO:0045725]; positive regulation of glycolytic process [GO:0045821]; positive regulation of insulin secretion [GO:0032024]; positive regulation of phosphorylation [GO:0042327]; regulation of insulin secretion [GO:0050796]; regulation of potassium ion transport [GO:0043266]; response to glucose [GO:0009749]; second-messenger-mediated signaling [GO:0019932]
## 52                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                epithelial cell morphogenesis involved in placental branching [GO:0060672]; keratinocyte differentiation [GO:0030216]; neural tube closure [GO:0001843]; protein catabolic process [GO:0030163]; proteolysis [GO:0006508]
## 54                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          glycolytic process [GO:0006096]
## 58                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         anterior neural tube closure [GO:0061713]; apoptotic process [GO:0006915]; apoptotic signaling pathway [GO:0097190]; axonal fasciculation [GO:0007413]; B cell homeostasis [GO:0001782]; cell fate commitment [GO:0045165]; cellular response to DNA damage stimulus [GO:0006974]; cellular response to staurosporine [GO:0072734]; epithelial cell apoptotic process [GO:1904019]; erythrocyte differentiation [GO:0030218]; execution phase of apoptosis [GO:0097194]; extrinsic apoptotic signaling pathway [GO:0097191]; fibroblast apoptotic process [GO:0044346]; glial cell apoptotic process [GO:0034349]; heart development [GO:0007507]; hippocampus development [GO:0021766]; intrinsic apoptotic signaling pathway [GO:0097193]; intrinsic apoptotic signaling pathway in response to osmotic stress [GO:0008627]; keratinocyte differentiation [GO:0030216]; learning or memory [GO:0007611]; leukocyte apoptotic process [GO:0071887]; luteolysis [GO:0001554]; negative regulation of activated T cell proliferation [GO:0046007]; negative regulation of B cell proliferation [GO:0030889]; neuron apoptotic process [GO:0051402]; neuron differentiation [GO:0030182]; neurotrophin TRK receptor signaling pathway [GO:0048011]; platelet formation [GO:0030220]; positive regulation of amyloid-beta formation [GO:1902004]; positive regulation of apoptotic DNA fragmentation [GO:1902512]; positive regulation of apoptotic process [GO:0043065]; positive regulation of neuron apoptotic process [GO:0043525]; protein catabolic process [GO:0030163]; protein processing [GO:0016485]; proteolysis [GO:0006508]; regulation of macroautophagy [GO:0016241]; regulation of protein stability [GO:0031647]; response to amino acid [GO:0043200]; response to antibiotic [GO:0046677]; response to cobalt ion [GO:0032025]; response to estradiol [GO:0032355]; response to glucocorticoid [GO:0051384]; response to glucose [GO:0009749]; response to hydrogen peroxide [GO:0042542]; response to hypoxia [GO:0001666]; response to lipopolysaccharide [GO:0032496]; response to nicotine [GO:0035094]; response to tumor necrosis factor [GO:0034612]; response to UV [GO:0009411]; response to X-ray [GO:0010165]; response to xenobiotic stimulus [GO:0009410]; sensory perception of sound [GO:0007605]; striated muscle cell differentiation [GO:0051146]; T cell homeostasis [GO:0043029]; wound healing [GO:0042060]
## 59                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   lipid catabolic process [GO:0016042]; signal transduction [GO:0007165]
## 61                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   protein catabolic process [GO:0030163]
## 62                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     anterior neural tube closure [GO:0061713]; apoptotic process [GO:0006915]; axonal fasciculation [GO:0007413]; B cell homeostasis [GO:0001782]; cell fate commitment [GO:0045165]; cellular response to DNA damage stimulus [GO:0006974]; cellular response to organic substance [GO:0071310]; cellular response to staurosporine [GO:0072734]; epithelial cell apoptotic process [GO:1904019]; erythrocyte differentiation [GO:0030218]; execution phase of apoptosis [GO:0097194]; extrinsic apoptotic signaling pathway [GO:0097191]; fibroblast apoptotic process [GO:0044346]; glial cell apoptotic process [GO:0034349]; heart development [GO:0007507]; hippocampus development [GO:0021766]; intracellular signal transduction [GO:0035556]; intrinsic apoptotic signaling pathway [GO:0097193]; intrinsic apoptotic signaling pathway in response to endoplasmic reticulum stress [GO:0070059]; intrinsic apoptotic signaling pathway in response to osmotic stress [GO:0008627]; keratinocyte differentiation [GO:0030216]; learning or memory [GO:0007611]; leukocyte apoptotic process [GO:0071887]; luteolysis [GO:0001554]; negative regulation of activated T cell proliferation [GO:0046007]; negative regulation of apoptotic process [GO:0043066]; negative regulation of B cell proliferation [GO:0030889]; negative regulation of cell cycle [GO:0045786]; negative regulation of cyclin-dependent protein serine/threonine kinase activity [GO:0045736]; neuron apoptotic process [GO:0051402]; neuron differentiation [GO:0030182]; neurotrophin TRK receptor signaling pathway [GO:0048011]; positive regulation of amyloid-beta formation [GO:1902004]; positive regulation of apoptotic DNA fragmentation [GO:1902512]; positive regulation of apoptotic process [GO:0043065]; positive regulation of neuron apoptotic process [GO:0043525]; protein catabolic process [GO:0030163]; protein processing [GO:0016485]; proteolysis [GO:0006508]; regulation of protein stability [GO:0031647]; response to amino acid [GO:0043200]; response to antibiotic [GO:0046677]; response to cobalt ion [GO:0032025]; response to estradiol [GO:0032355]; response to glucocorticoid [GO:0051384]; response to glucose [GO:0009749]; response to hydrogen peroxide [GO:0042542]; response to hypoxia [GO:0001666]; response to lipopolysaccharide [GO:0032496]; response to nicotine [GO:0035094]; response to organic substance [GO:0010033]; response to UV [GO:0009411]; response to wounding [GO:0009611]; response to X-ray [GO:0010165]; response to xenobiotic stimulus [GO:0009410]; sensory perception of sound [GO:0007605]; striated muscle cell differentiation [GO:0051146]; T cell homeostasis [GO:0043029]; wound healing [GO:0042060]
## 67                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              acetyl-CoA biosynthetic process from pyruvate [GO:0006086]; glycolytic process [GO:0006096]
## 70                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     lipid catabolic process [GO:0016042]
## 74                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 cellular response to dexamethasone stimulus [GO:0071549]; cellular response to glucose stimulus [GO:0071333]; cellular response to insulin stimulus [GO:0032869]; cellular response to tumor necrosis factor [GO:0071356]; gluconeogenesis [GO:0006094]; glycerol biosynthetic process from pyruvate [GO:0046327]; hepatocyte differentiation [GO:0070365]; NADH oxidation [GO:0006116]; oxaloacetate metabolic process [GO:0006107]; positive regulation of insulin secretion [GO:0032024]; propionate catabolic process [GO:0019543]; response to lipid [GO:0033993]; response to lipopolysaccharide [GO:0032496]; response to starvation [GO:0042594]
## 75                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cellular response to dexamethasone stimulus [GO:0071549]; cellular response to glucose stimulus [GO:0071333]; cellular response to insulin stimulus [GO:0032869]; gluconeogenesis [GO:0006094]; glycerol biosynthetic process from pyruvate [GO:0046327]; hepatocyte differentiation [GO:0070365]; NADH oxidation [GO:0006116]; oxaloacetate metabolic process [GO:0006107]; positive regulation of insulin secretion [GO:0032024]; propionate catabolic process [GO:0019543]; pyruvate metabolic process [GO:0006090]; response to lipid [GO:0033993]; response to starvation [GO:0042594]
## 79                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   protein catabolic process [GO:0030163]
## 80                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         canonical glycolysis [GO:0061621]; cellular glucose homeostasis [GO:0001678]; negative regulation of autophagy [GO:0010507]; negative regulation of DNA-templated transcription [GO:0045892]; positive regulation of DNA-templated transcription [GO:0045893]; regulation of DNA-templated transcription [GO:0006355]; regulation of glucose metabolic process [GO:0010906]; response to starvation [GO:0042594]
## 83                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          glycolytic process [GO:0006096]
## 89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     lipid catabolic process [GO:0016042]
## 90                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   lipid catabolic process [GO:0016042]; positive regulation of macroautophagy [GO:0016239]; spermatogenesis [GO:0007283]
## 93                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           activation of NF-kappaB-inducing kinase activity [GO:0007250]; cellular response to nitric oxide [GO:0071732]; interleukin-17-mediated signaling pathway [GO:0097400]; intrinsic apoptotic signaling pathway in response to endoplasmic reticulum stress [GO:0070059]; mRNA stabilization [GO:0048255]; negative regulation of glial cell apoptotic process [GO:0034351]; negative regulation of neuron death [GO:1901215]; positive regulation of DNA-binding transcription factor activity [GO:0051091]; positive regulation of extrinsic apoptotic signaling pathway [GO:2001238]; positive regulation of I-kappaB kinase/NF-kappaB signaling [GO:0043123]; positive regulation of I-kappaB phosphorylation [GO:1903721]; positive regulation of interleukin-2 production [GO:0032743]; positive regulation of JNK cascade [GO:0046330]; positive regulation of JUN kinase activity [GO:0043507]; positive regulation of NF-kappaB transcription factor activity [GO:0051092]; positive regulation of T cell cytokine production [GO:0002726]; positive regulation of tumor necrosis factor-mediated signaling pathway [GO:1903265]; programmed necrotic cell death [GO:0097300]; protein autoubiquitination [GO:0051865]; protein catabolic process [GO:0030163]; protein K63-linked ubiquitination [GO:0070534]; protein-containing complex assembly [GO:0065003]; regulation of apoptotic process [GO:0042981]; regulation of I-kappaB kinase/NF-kappaB signaling [GO:0043122]; regulation of immunoglobulin production [GO:0002637]; regulation of protein-containing complex assembly [GO:0043254]; response to endoplasmic reticulum stress [GO:0034976]; signal transduction [GO:0007165]; signal transduction involved in regulation of gene expression [GO:0023019]; tumor necrosis factor-mediated signaling pathway [GO:0033209]
## 95                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           activation of NF-kappaB-inducing kinase activity [GO:0007250]; cellular response to nitric oxide [GO:0071732]; interleukin-17-mediated signaling pathway [GO:0097400]; intrinsic apoptotic signaling pathway in response to endoplasmic reticulum stress [GO:0070059]; mRNA stabilization [GO:0048255]; negative regulation of glial cell apoptotic process [GO:0034351]; negative regulation of neuron death [GO:1901215]; positive regulation of DNA-binding transcription factor activity [GO:0051091]; positive regulation of extrinsic apoptotic signaling pathway [GO:2001238]; positive regulation of I-kappaB kinase/NF-kappaB signaling [GO:0043123]; positive regulation of I-kappaB phosphorylation [GO:1903721]; positive regulation of interleukin-2 production [GO:0032743]; positive regulation of JNK cascade [GO:0046330]; positive regulation of JUN kinase activity [GO:0043507]; positive regulation of NF-kappaB transcription factor activity [GO:0051092]; positive regulation of T cell cytokine production [GO:0002726]; positive regulation of tumor necrosis factor-mediated signaling pathway [GO:1903265]; programmed necrotic cell death [GO:0097300]; protein autoubiquitination [GO:0051865]; protein catabolic process [GO:0030163]; protein K63-linked ubiquitination [GO:0070534]; protein-containing complex assembly [GO:0065003]; regulation of apoptotic process [GO:0042981]; regulation of I-kappaB kinase/NF-kappaB signaling [GO:0043122]; regulation of immunoglobulin production [GO:0002637]; regulation of protein-containing complex assembly [GO:0043254]; response to endoplasmic reticulum stress [GO:0034976]; signal transduction [GO:0007165]; signal transduction involved in regulation of gene expression [GO:0023019]; tumor necrosis factor-mediated signaling pathway [GO:0033209]
## 97                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ether lipid metabolic process [GO:0046485]; lipid biosynthetic process [GO:0008610]; membrane lipid metabolic process [GO:0006643]
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Gene.Ontology.IDs
## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              GO:0003723; GO:0003730; GO:0004300; GO:0004490; GO:0005739; GO:0006552; GO:0006635; GO:0050011
## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  GO:0004177; GO:0005576; GO:0005764; GO:0005794; GO:0005829; GO:0006508; GO:0008236; GO:0008239; GO:0030163; GO:0031410; GO:0031982; GO:0043231; GO:1905146
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  GO:0005524; GO:0005634; GO:0005737; GO:0005829; GO:0005886; GO:0008340; GO:0016192; GO:0016887; GO:0031072; GO:0034620; GO:0042026; GO:0042594; GO:0044183; GO:0051082; GO:0051085; GO:0051787; GO:0140662
## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  GO:0005524; GO:0005634; GO:0005737; GO:0005829; GO:0005886; GO:0008340; GO:0016192; GO:0016887; GO:0031072; GO:0034620; GO:0042026; GO:0042594; GO:0044183; GO:0051082; GO:0051085; GO:0051787; GO:0140662
## 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      GO:0001676; GO:0004095; GO:0005739; GO:0005741; GO:0005743; GO:0006006; GO:0006631; GO:0006635; GO:0006641; GO:0009410; GO:0009437; GO:0010876; GO:0010883; GO:0014070; GO:0016020; GO:0030855; GO:0031667; GO:0032000; GO:0042755; GO:0042802; GO:0043231; GO:0043279; GO:0045471; GO:0046320; GO:0046677; GO:0050796; GO:0071398; GO:0097421; GO:1904772; GO:1990698
## 13                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     GO:0000266; GO:0005743; GO:0006096; GO:0006541; GO:0006839; GO:0008271; GO:0009409; GO:0015078; GO:0015131; GO:0015140; GO:0015183; GO:0015297; GO:0015740; GO:0017077; GO:0022857; GO:0030225; GO:0042803; GO:0071333; GO:0072593; GO:0140787; GO:1990542; GO:1990845
## 19                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0000122; GO:0000166; GO:0005634; GO:0005737; GO:0006094; GO:0007623; GO:0009416; GO:0009881; GO:0014823; GO:0031397; GO:0031398; GO:0032922; GO:0033762; GO:0042593; GO:0042752; GO:0042754; GO:0042770; GO:0043153; GO:0045721; GO:0045744; GO:0045892; GO:2000001; GO:2000323
## 22                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             GO:0003723; GO:0003727; GO:0004386; GO:0004525; GO:0004530; GO:0005524; GO:0005737; GO:0006309; GO:0007279; GO:0007294; GO:0007367; GO:0016442; GO:0016443; GO:0030422; GO:0030727; GO:0031054; GO:0033227; GO:0035194; GO:0035196; GO:0042078; GO:0042594; GO:0045448; GO:0046872; GO:0048813; GO:0070578; GO:0070883; GO:0070922; GO:0090501
## 23                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     GO:0000151; GO:0000839; GO:0001701; GO:0002327; GO:0005654; GO:0005783; GO:0005790; GO:0006511; GO:0006986; GO:0016567; GO:0030163; GO:0030433; GO:0030970; GO:0036503; GO:0036513; GO:0044322; GO:0046872; GO:0050821; GO:0051082; GO:0051087; GO:0051117; GO:0061630; GO:0070059; GO:0070936; GO:1902236; GO:1990381
## 26                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0000421; GO:0003925; GO:0005525; GO:0005739; GO:0005765; GO:0005770; GO:0005811; GO:0005829; GO:0016042; GO:0030670; GO:0031902; GO:0031966; GO:0033162; GO:0045022; GO:0045335; GO:0061724; GO:0090383; GO:0090385; GO:0099638
## 27 GO:0000139; GO:0001958; GO:0001974; GO:0002067; GO:0002524; GO:0003128; GO:0003415; GO:0003416; GO:0005789; GO:0005794; GO:0006486; GO:0007033; GO:0007369; GO:0007411; GO:0007492; GO:0007498; GO:0008217; GO:0008375; GO:0008543; GO:0009642; GO:0010467; GO:0014033; GO:0015014; GO:0015020; GO:0016757; GO:0017145; GO:0019882; GO:0021554; GO:0021772; GO:0030163; GO:0030199; GO:0030204; GO:0030210; GO:0030509; GO:0031069; GO:0032836; GO:0033627; GO:0035176; GO:0035249; GO:0035264; GO:0035988; GO:0036022; GO:0036336; GO:0036339; GO:0042044; GO:0042060; GO:0042311; GO:0042596; GO:0042803; GO:0043931; GO:0045165; GO:0045202; GO:0045453; GO:0046872; GO:0046982; GO:0048733; GO:0050508; GO:0050509; GO:0050891; GO:0050901; GO:0051923; GO:0055078; GO:0060047; GO:0060070; GO:0060218; GO:0060351; GO:0060441; GO:0060506; GO:0060560; GO:0060792; GO:0061484; GO:0061744; GO:0061974; GO:0062094; GO:0065003; GO:0070593; GO:0071503; GO:0071625; GO:0071711; GO:0071847; GO:0072112; GO:0072498; GO:0097021; GO:0097241; GO:0098586; GO:0120193; GO:1901706; GO:1904888; GO:1990823
## 31                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     GO:0001650; GO:0003847; GO:0005829; GO:0005886; GO:0007283; GO:0008247; GO:0016042; GO:0016239; GO:0042803; GO:0046982
## 39                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0005576; GO:0016042; GO:0016787
## 42                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0004771; GO:0005764; GO:0016042
## 44                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0004332; GO:0006096; GO:0030388
## 50                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 GO:0000287; GO:0001678; GO:0004340; GO:0004396; GO:0005524; GO:0005536; GO:0005634; GO:0005654; GO:0005737; GO:0005739; GO:0005829; GO:0005938; GO:0005978; GO:0006002; GO:0006003; GO:0006006; GO:0006013; GO:0006096; GO:0006739; GO:0007204; GO:0008865; GO:0009749; GO:0019158; GO:0019903; GO:0019932; GO:0030141; GO:0032024; GO:0032811; GO:0032869; GO:0042149; GO:0042327; GO:0042593; GO:0043266; GO:0043531; GO:0044320; GO:0045180; GO:0045721; GO:0045725; GO:0045821; GO:0046835; GO:0050796; GO:0051156; GO:0051594; GO:0055088; GO:0070509
## 52                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0001843; GO:0004252; GO:0005615; GO:0005886; GO:0006508; GO:0008236; GO:0009897; GO:0016323; GO:0030163; GO:0030216; GO:0060672
## 54                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             GO:0004365; GO:0005737; GO:0006096; GO:0051287
## 58                                                                                                                                                                                     GO:0001554; GO:0001666; GO:0001782; GO:0002020; GO:0004190; GO:0004197; GO:0004861; GO:0005123; GO:0005634; GO:0005654; GO:0005737; GO:0005829; GO:0006508; GO:0006915; GO:0006974; GO:0007413; GO:0007507; GO:0007605; GO:0007611; GO:0008233; GO:0008303; GO:0008627; GO:0009410; GO:0009411; GO:0009749; GO:0010165; GO:0016005; GO:0016241; GO:0016485; GO:0021766; GO:0030163; GO:0030182; GO:0030216; GO:0030218; GO:0030220; GO:0030889; GO:0031264; GO:0031647; GO:0032025; GO:0032355; GO:0032496; GO:0034349; GO:0034612; GO:0035094; GO:0042060; GO:0042542; GO:0043025; GO:0043029; GO:0043065; GO:0043200; GO:0043525; GO:0044346; GO:0044877; GO:0045121; GO:0045165; GO:0046007; GO:0046677; GO:0048011; GO:0051146; GO:0051384; GO:0051402; GO:0061713; GO:0071887; GO:0072734; GO:0097153; GO:0097190; GO:0097191; GO:0097193; GO:0097194; GO:0097199; GO:0097200; GO:1902004; GO:1902512; GO:1904019
## 59                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 GO:0005737; GO:0007165; GO:0008081; GO:0016042; GO:0045202
## 61                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0005524; GO:0005654; GO:0005829; GO:0016887; GO:0022624; GO:0030163; GO:0036402
## 62                                                                                                                         GO:0001554; GO:0001666; GO:0001782; GO:0002020; GO:0004175; GO:0004190; GO:0004197; GO:0004861; GO:0005123; GO:0005634; GO:0005737; GO:0005829; GO:0006508; GO:0006915; GO:0006974; GO:0007413; GO:0007507; GO:0007605; GO:0007611; GO:0008233; GO:0008234; GO:0008303; GO:0008627; GO:0009410; GO:0009411; GO:0009611; GO:0009749; GO:0010033; GO:0010165; GO:0016005; GO:0016485; GO:0021766; GO:0030163; GO:0030182; GO:0030216; GO:0030218; GO:0030889; GO:0031264; GO:0031647; GO:0032025; GO:0032355; GO:0032496; GO:0034349; GO:0035094; GO:0035556; GO:0042060; GO:0042542; GO:0043025; GO:0043029; GO:0043065; GO:0043066; GO:0043200; GO:0043525; GO:0044346; GO:0044877; GO:0045121; GO:0045165; GO:0045736; GO:0045786; GO:0046007; GO:0046677; GO:0048011; GO:0051146; GO:0051384; GO:0051402; GO:0061713; GO:0070059; GO:0071310; GO:0071887; GO:0072734; GO:0097153; GO:0097191; GO:0097193; GO:0097194; GO:0097199; GO:0097200; GO:1902004; GO:1902512; GO:1904019
## 67                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             GO:0004742; GO:0005967; GO:0006086; GO:0006096
## 70                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0005576; GO:0016042; GO:0016787
## 74                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 GO:0004611; GO:0004613; GO:0005525; GO:0005739; GO:0005759; GO:0005829; GO:0006094; GO:0006107; GO:0006116; GO:0019543; GO:0030145; GO:0032024; GO:0032496; GO:0032869; GO:0033993; GO:0042594; GO:0046327; GO:0070365; GO:0071333; GO:0071356; GO:0071549
## 75                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             GO:0004611; GO:0004613; GO:0005525; GO:0005739; GO:0005759; GO:0005829; GO:0006090; GO:0006094; GO:0006107; GO:0006116; GO:0019543; GO:0030145; GO:0032024; GO:0032869; GO:0033993; GO:0042594; GO:0046327; GO:0070365; GO:0071333; GO:0071549
## 79                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0005524; GO:0005634; GO:0005737; GO:0016887; GO:0022624; GO:0030163; GO:0036402
## 80                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             GO:0000287; GO:0000976; GO:0001227; GO:0001678; GO:0003677; GO:0003700; GO:0005634; GO:0005737; GO:0006355; GO:0010507; GO:0010906; GO:0042594; GO:0043565; GO:0045892; GO:0045893; GO:0061621
## 83                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             GO:0004365; GO:0005737; GO:0006096; GO:0051287
## 89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             GO:0004658; GO:0005524; GO:0016042; GO:0046872
## 90                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     GO:0001650; GO:0003847; GO:0005829; GO:0005886; GO:0007283; GO:0008247; GO:0016042; GO:0016239; GO:0042803; GO:0046982
## 93                                                                                                                                                                                                                                                                                                                                                                                                             GO:0000151; GO:0002637; GO:0002726; GO:0002947; GO:0004842; GO:0005164; GO:0005174; GO:0005654; GO:0005829; GO:0005938; GO:0007165; GO:0007250; GO:0008270; GO:0009898; GO:0012506; GO:0019899; GO:0019901; GO:0019903; GO:0023019; GO:0030163; GO:0030674; GO:0031435; GO:0031625; GO:0031996; GO:0032743; GO:0033209; GO:0034351; GO:0034976; GO:0035631; GO:0042802; GO:0042981; GO:0043120; GO:0043122; GO:0043123; GO:0043254; GO:0043507; GO:0044877; GO:0045121; GO:0046330; GO:0046625; GO:0048255; GO:0051091; GO:0051092; GO:0051865; GO:0065003; GO:0070059; GO:0070534; GO:0071732; GO:0097057; GO:0097300; GO:0097400; GO:1901215; GO:1903265; GO:1903721; GO:1990604; GO:2001238
## 95                                                                                                                                                                                                                                                                                                                                                                                                             GO:0000151; GO:0002637; GO:0002726; GO:0002947; GO:0004842; GO:0005164; GO:0005174; GO:0005654; GO:0005829; GO:0005938; GO:0007165; GO:0007250; GO:0008270; GO:0009898; GO:0012506; GO:0019899; GO:0019901; GO:0019903; GO:0023019; GO:0030163; GO:0030674; GO:0031435; GO:0031625; GO:0031996; GO:0032743; GO:0033209; GO:0034351; GO:0034976; GO:0035631; GO:0042802; GO:0042981; GO:0043120; GO:0043122; GO:0043123; GO:0043254; GO:0043507; GO:0044877; GO:0045121; GO:0046330; GO:0046625; GO:0048255; GO:0051091; GO:0051092; GO:0051865; GO:0065003; GO:0070059; GO:0070534; GO:0071732; GO:0097057; GO:0097300; GO:0097400; GO:1901215; GO:1903265; GO:1903721; GO:1990604; GO:2001238
## 97                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         GO:0005506; GO:0005783; GO:0005789; GO:0006643; GO:0008610; GO:0046485; GO:0050479</code></pre>
<p>Notes:</p>
<p>FUN_001326: Lysosomal acid lipase/cholesteryl ester hydrolase:</p>
<ul>
<li><p>observed to be upregulated in response to temperature stress, low-pH, and combination in the azooxanthellate octocoral <em>Scleronephthya gracillimum</em> (Woo et al.&nbsp;2022).</p></li>
<li><p>Identified as putative venom component in the hydrozoan <em>Olindias sambaquiensis</em> (Doonen et al.&nbsp;2019)</p></li>
</ul>
<p>Super cool! Next steps:</p>
<ul>
<li><p>grab the annotations for each of these genes to see what proteins they code for</p></li>
<li><p>For each gene, plot its expression with the expression of its most predictively important lncRNA/miRNA (group samples by timepoint)</p></li>
<li><p>for each, check to see if in Cytoscape network</p></li>
<li><p>Could/should I add siRNA cluster expression to this?</p></li>
</ul>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_08_timeseries_multiomic_ML_3.html</guid>
  <pubDate>Thu, 08 May 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: Format input files for Cytoscape â€“ pt.2</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_07_timeseries_cytoscape_files_2.html</link>
  <description><![CDATA[ 




<p>Continuation of <a href="../../../posts/projects/E5_coral/2025_04_28_timeseries_cytoscape_files.html">Timeseries molecular: Format input files for Cytoscape</a>. I want to add DEG information to nodes.</p>
<p>Iâ€™m choosing to add annotations for features that are differentially expressed in a comparison of Timepoint 2 to Timepoint 4, as these are seasonally very divergent, and yield the highest number of DEGs.</p>
<p>I only need to add DEG annotations to the â€œNodesâ€ files, which contain metadata for all the features (miRNA, lncRNA, genes) included in my networks.</p>
<p>Input files:</p>
<ul>
<li><p>Cytoscape â€œNodesâ€ file, generated in <a href="../../../posts/projects/E5_coral/2025_04_28_timeseries_cytoscape_files.html">Timeseries molecular: Format input files for Cytoscape</a>: <code>./output/nodes_timeseries_miRNA_lncRNA_genes.csv</code></p></li>
<li><p>genes DEGs for Timepoint 2 v Timepoint 4: https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/output/03.00-D-Apul-RNAseq-gene-expression-DESeq2/tp2.v.tp4.results.table.csv</p></li>
<li><p>miRNA DEGs for Timepoint 2 v Timepoint 4: https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/output/03.10-D-Apul-sRNAseq-expression-DESeq2/miRNA_tp2.v.tp4.results.table.csv</p></li>
<li><p>lncRNA DEGs for Timepoint 2 v Timepoint 4: https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/output/03.20-D-Apul-lncRNA-expression-DESeq2/lncRNA_tp2.v.tp4.results.table.csv</p></li>
</ul>
<section id="load-packages" class="level1">
<h1>Load packages</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
</div>
</section>
<section id="read-in-files" class="level1">
<h1>Read in files</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">nodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/nodes_timeseries_miRNA_lncRNA_genes.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>X)</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Using raw htmls</span></span>
<span id="cb8-4">genes_2v4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/03.00-D-Apul-RNAseq-gene-expression-DESeq2/tp2.v.tp4.results.table.csv"</span>)</span>
<span id="cb8-5"></span>
<span id="cb8-6">miRNA_2v4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/03.10-D-Apul-sRNAseq-expression-DESeq2/miRNA_tp2.v.tp4.results.table.csv"</span>)</span>
<span id="cb8-7"></span>
<span id="cb8-8">lncRNA_2v4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries_molecular/raw/refs/heads/main/D-Apul/output/03.20-D-Apul-lncRNA-expression-DESeq2/lncRNA_tp2.v.tp4.results.table.csv"</span>)</span></code></pre></div>
</div>
<p>Merge DEG files (type will still be denoted by feature name â€“ â€œFUNXXXXâ€ for genes, â€œClusterXXXâ€ for miRNA, â€œlncRNAXXXâ€ for lncRNA)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">merged_2v4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(genes_2v4, miRNA_2v4, lncRNA_2v4)</span></code></pre></div>
</div>
<p>Reduce to significantly differentially expressed features (padj &lt; 0.05)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">merged_2v4_sig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_2v4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(padj <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(merged_2v4_sig[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, merged_2v4_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X),])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 684</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(merged_2v4_sig[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, merged_2v4_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X),])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(merged_2v4_sig[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, merged_2v4_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X),])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 347</code></pre>
</div>
</div>
<p>When comparing expression in Timepoint 2 to Timepoint 4, there are 684 differentially expressed genes, 1 differentially expressed miRNA, and 347 differentially expressed lncRNA</p>
<p>Add to Nodes file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>DEG_tp2_tp4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> merged_2v4_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no"</span>)</span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(nodes[nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>DEG_tp2_tp4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id),])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 360</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(nodes[nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>DEG_tp2_tp4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id),])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(nodes[nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>DEG_tp2_tp4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, nodes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id),])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28</code></pre>
</div>
</div>
<p>OF the nodes in our (unfiltered) interaction network, 360 genes, 1 miRNA, and 28 lncRNA are differentially expressed between TP2 and TP4. The genes number is surprising to me, since that means more than half of all the differentially expressed genes are present in our interaction network!</p>
<p>Save</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_07_timeseries_cytoscape_files_2/nodes_timeseries_miRNA_lncRNA_genes_DEG2v4.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<p>Load edges</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">edges_PCC_0_7<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_PCC_0.7_timeseries_miRNA_lncRNA_genes.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>X)</span></code></pre></div>
</div>
<p>Load functional annotations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/deep-dive-expression/raw/refs/heads/main/D-Apul/output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb24-2">FUNids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/deep-dive-expression/raw/refs/heads/main/D-Apul/output/15-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(V1, V4)</span>
<span id="cb24-3"></span>
<span id="cb24-4">FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parent="</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V4)</span>
<span id="cb24-5">FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(FA, FUNids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span>))</span>
<span id="cb24-6">FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(V4, Gene.Ontology.IDs, Gene.Ontology..biological.process.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb24-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(FA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO_BP"</span>)</span></code></pre></div>
</div>
<p>Join</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">edges_PCC_0_7_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(edges_PCC_0_7, FA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_id"</span>))</span></code></pre></div>
</div>
<p>Format</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>_GOid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> edges_PCC_0_7_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>GO_BP) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(GO_id)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO_id, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; "</span>)</span>
<span id="cb26-5"></span>
<span id="cb26-6">edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>_GOBP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> edges_PCC_0_7_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>GO_id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(GO_BP)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; "</span>)</span></code></pre></div>
</div>
<p>Annotate nodes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">nodes_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(nodes, FA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_id"</span>))</span>
<span id="cb27-2"></span>
<span id="cb27-3">nodes_GOid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>GO_BP) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(GO_id)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO_id, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; "</span>)</span>
<span id="cb27-7"></span>
<span id="cb27-8">nodes_GOBP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>GO_id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(GO_BP)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; "</span>)</span></code></pre></div>
</div>
<p>Save</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>_GOid, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_07_timeseries_cytoscape_files_2/edges_PCC_0.7_timeseries_miRNA_lncRNA_genes_DEG2v4_GOid.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb28-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>_GOBP, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_07_timeseries_cytoscape_files_2/edges_PCC_0.7_timeseries_miRNA_lncRNA_genes_DEG2v4_GOBP.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes_GOid, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_07_timeseries_cytoscape_files_2/nodes_timeseries_miRNA_lncRNA_genes_DEG2v4_GOid.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb28-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes_GOBP, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_05_07_timeseries_cytoscape_files_2/nodes_timeseries_miRNA_lncRNA_genes_DEG2v4_GOBP.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_05_07_timeseries_cytoscape_files_2.html</guid>
  <pubDate>Wed, 07 May 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: Format input files for Cytoscape</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_28_timeseries_cytoscape_files.html</link>
  <description><![CDATA[ 




<p>For Cytoscape I need two inputs, an â€œEdges.csvâ€ and a â€œNodes.csvâ€.</p>
<p>The â€œedgesâ€Edgesâ€ file should associate each node with all other nodes it connects to. It should also contain edge-specific metadata. For example:</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>source</th>
<th>target</th>
<th>correlation</th>
<th>correlation magnitude</th>
<th>correlation direction</th>
<th>correlation pval</th>
<th>binding pval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>miR-100</td>
<td>FUN001</td>
<td>-0.9</td>
<td>0.9</td>
<td>-1</td>
<td>0.001</td>
<td>0.02</td>
</tr>
<tr class="even">
<td>miR-100</td>
<td>FUN002</td>
<td>0.85</td>
<td>0.85</td>
<td>1</td>
<td>0.02</td>
<td>0.03</td>
</tr>
<tr class="odd">
<td>lncRNA01</td>
<td>FUN001</td>
<td>-0.95</td>
<td>0.95</td>
<td>-1</td>
<td>0.01</td>
<td>0.01</td>
</tr>
</tbody>
</table>
<p>Note that there may be duplicates in both the â€œsourceâ€ and â€œtargetâ€ columns, but the combinations of source-target should be unique.</p>
<p>The â€œNodesâ€ file contains metadata for every node included in the plot. Importantly, the set of nodes listed int he â€œNodesâ€ file should match exactly the set of nodes included in the â€œEdgesâ€ document. For example:</p>
<table class="table">
<thead>
<tr class="header">
<th>id</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FUN001</td>
<td>gene</td>
</tr>
<tr class="even">
<td>FUN002</td>
<td>gene</td>
</tr>
<tr class="odd">
<td>miR-100</td>
<td>miRNA</td>
</tr>
<tr class="even">
<td>lncRNA01</td>
<td>lncRNA</td>
</tr>
</tbody>
</table>
<p>Iâ€™ll need the following files to compile the Cytoscape inputs:</p>
<ul>
<li><p>miRNA interaction file (contains binding and coexpression information for miRNA-gene pairs): <code>timeseries_molecular/D-Apul/output/14.1-Apul-miRNA-mRNA-coexpression-additional_inputs/miRanda-PCC-significant-mRNA_3UTR_5UTR.csv</code></p></li>
<li><p>lncRNA interaction file (contains binding and coexpression information for miRNA-lncRNA pairs): <code>timeseries_molecular/D-Apul/output/14.2-Apul-miRNA-lncRNA-coexpression/miRanda-PCC-significant-miRNA_lncRNA.csv</code></p></li>
</ul>
<p>Iâ€™m havenâ€™t predicted lncRNA-gene interactions at this point, but if I decide to I would also need that file.</p>
<p>Load packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
</div>
<p>Load files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">miRNA_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/urol-e5/timeseries_molecular/refs/heads/main/D-Apul/output/14.1-Apul-miRNA-mRNA-coexpression-additional_inputs/miRanda-PCC-significant-mRNA_3UTR_5UTR.csv"</span>)</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove NA rows</span></span>
<span id="cb8-3">miRNA_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_gene <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(mirna))</span>
<span id="cb8-4"></span>
<span id="cb8-5">miRNA_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/urol-e5/timeseries_molecular/refs/heads/main/D-Apul/output/14.2-Apul-miRNA-lncRNA-coexpression/miRanda-PCC-significant-miRNA_lncRNA.csv"</span>)</span></code></pre></div>
</div>
<section id="all-interactions" class="level1">
<h1>All interactions</h1>
<p>Format â€œEdgesâ€ file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add correlation magnitude and direction columns</span></span>
<span id="cb9-2">miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC_magnitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC.cor)</span>
<span id="cb9-3">miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC_direction <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sign</span>(miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC.cor)</span>
<span id="cb9-4">miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Alignment <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Target, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>, miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Query_Aln, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>, miRNA_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Subject_Aln)</span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select columns I want to keep in Edges file</span></span>
<span id="cb9-6">miRNA_gene_edges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_gene <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(mirna, X4, Alignment, Energy_Kcal_Mol, Al_Len, Subject_Identity, Query_Identity, PCC.cor, PCC_magnitude, PCC_direction, p_value)</span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename columns</span></span>
<span id="cb9-8">miRNA_gene_edges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_gene_edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">source =</span> mirna, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">target =</span> X4)</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add correlation magnitude and direction columns</span></span>
<span id="cb9-11">miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC_magnitude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC.cor)</span>
<span id="cb9-12">miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC_direction <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sign</span>(miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PCC.cor)</span>
<span id="cb9-13">miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Alignment <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Target, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>, miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Query_Aln, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>, miRNA_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Subject_Aln)</span>
<span id="cb9-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select columns I want to keep in Edges file (ensure in same order as in the miRNA_gene_edges file)</span></span>
<span id="cb9-15">miRNA_lncRNA_edges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_lncRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(mirna, lncRNA.x, Alignment, Energy_Kcal_Mol, Al_Len, Subject_Identity, Query_Identity, PCC.cor, PCC_magnitude, PCC_direction, p_value)</span>
<span id="cb9-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename columns</span></span>
<span id="cb9-17">miRNA_lncRNA_edges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_lncRNA_edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">source =</span> mirna, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">target =</span> lncRNA.x)</span>
<span id="cb9-18"></span>
<span id="cb9-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine miRNA-gene edges and miRNA-lncRNA edges</span></span>
<span id="cb9-20">edges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(miRNA_gene_edges, miRNA_lncRNA_edges)</span>
<span id="cb9-21"></span>
<span id="cb9-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure we have no duplicate rows</span></span>
<span id="cb9-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(edges)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 131951</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 131951</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check formatting/contents</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(edges)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         source     target                             Alignment
1 Cluster_10452 FUN_000006   ntLink_0:61628-78213;2 19;1286 1308
2 Cluster_10452 FUN_000006 ntLink_0:61628-78213;2 12;13037 13058
3 Cluster_10452 FUN_000113   ntLink_4:151074-152269;2 20;900 920
4 Cluster_10452 FUN_000113   ntLink_4:151074-152269;2 21;211 234
5 Cluster_10452 FUN_000128   ntLink_4:187657-188852;2 20;900 920
6 Cluster_10452 FUN_000128   ntLink_4:187657-188852;2 21;211 234
  Energy_Kcal_Mol Al_Len Subject_Identity Query_Identity   PCC.cor
1          -15.88     19           63.16%         84.21% 0.3314907
2          -16.10     10           90.00%         90.00% 0.3314907
3          -14.47     18           66.67%         77.78% 0.3960556
4          -17.21     21           66.67%         80.95% 0.3960556
5          -14.47     18           66.67%         77.78% 0.3471957
6          -17.21     21           66.67%         80.95% 0.3471957
  PCC_magnitude PCC_direction    p_value
1     0.3314907             1 0.03665931
2     0.3314907             1 0.03665931
3     0.3960556             1 0.01141128
4     0.3960556             1 0.01141128
5     0.3471957             1 0.02816252
6     0.3471957             1 0.02816252</code></pre>
</div>
</div>
<p>Format Nodes file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a df that contains all miRNA, genes, and lncRNA listed in the `source` and `target` columns of `edges`</span></span>
<span id="cb15-2">nodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb15-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The `unique` argument ensures we remove duplicates</span></span>
<span id="cb15-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(edges[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span>)])))</span>
<span id="cb15-5">)</span>
<span id="cb15-6"></span>
<span id="cb15-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add column identifying the type of each node (miRNA, lncRNA, or gene)</span></span>
<span id="cb15-8">nodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb15-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb15-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>,</span>
<span id="cb15-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>,</span>
<span id="cb15-13">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span></span>
<span id="cb15-14">  ))</span>
<span id="cb15-15"></span>
<span id="cb15-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check formatting/contents</span></span>
<span id="cb15-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(nodes)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             id  type
1 Cluster_10452 miRNA
2 Cluster_11565 miRNA
3 Cluster_12081 miRNA
4 Cluster_12083 miRNA
5 Cluster_12087 miRNA
6 Cluster_13327 miRNA</code></pre>
</div>
</div>
</section>
<section id="pval-0.01" class="level1">
<h1>pval &lt; 0.01</h1>
<p>Edges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">edges_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(edges_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 54950</code></pre>
</div>
</div>
<p>Nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a df that contains all miRNA, genes, and lncRNA listed in the `source` and `target` columns of `edges`</span></span>
<span id="cb19-2">nodes_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb19-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The `unique` argument ensures we remove duplicates</span></span>
<span id="cb19-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(edges_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span>[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span>)])))</span>
<span id="cb19-5">)</span>
<span id="cb19-6"></span>
<span id="cb19-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add column identifying the type of each node (miRNA, lncRNA, or gene)</span></span>
<span id="cb19-8">nodes_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb19-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb19-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>,</span>
<span id="cb19-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>,</span>
<span id="cb19-13">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span></span>
<span id="cb19-14">  ))</span></code></pre></div>
</div>
</section>
<section id="pcc-0.5" class="level1">
<h1>|PCC| &gt; 0.5</h1>
<p>Edges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC_magnitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16918</code></pre>
</div>
</div>
<p>Nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a df that contains all miRNA, genes, and lncRNA listed in the `source` and `target` columns of `edges`</span></span>
<span id="cb22-2">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb22-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The `unique` argument ensures we remove duplicates</span></span>
<span id="cb22-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span>)])))</span>
<span id="cb22-5">)</span>
<span id="cb22-6"></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add column identifying the type of each node (miRNA, lncRNA, or gene)</span></span>
<span id="cb22-8">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb22-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb22-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>,</span>
<span id="cb22-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>,</span>
<span id="cb22-13">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span></span>
<span id="cb22-14">  ))</span></code></pre></div>
</div>
</section>
<section id="pcc-0.6" class="level1">
<h1>|PCC| &gt; 0.6</h1>
<p>Edges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC_magnitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb23-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3539</code></pre>
</div>
</div>
<p>Nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a df that contains all miRNA, genes, and lncRNA listed in the `source` and `target` columns of `edges`</span></span>
<span id="cb25-2">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb25-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The `unique` argument ensures we remove duplicates</span></span>
<span id="cb25-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span>[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span>)])))</span>
<span id="cb25-5">)</span>
<span id="cb25-6"></span>
<span id="cb25-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add column identifying the type of each node (miRNA, lncRNA, or gene)</span></span>
<span id="cb25-8">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb25-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb25-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>,</span>
<span id="cb25-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>,</span>
<span id="cb25-13">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span></span>
<span id="cb25-14">  ))</span></code></pre></div>
</div>
</section>
<section id="pcc-0.7" class="level1">
<h1>|PCC| &gt; 0.7</h1>
<p>Edges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC_magnitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>)</span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 541</code></pre>
</div>
</div>
<p>Nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a df that contains all miRNA, genes, and lncRNA listed in the `source` and `target` columns of `edges`</span></span>
<span id="cb28-2">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb28-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The `unique` argument ensures we remove duplicates</span></span>
<span id="cb28-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span>)])))</span>
<span id="cb28-5">)</span>
<span id="cb28-6"></span>
<span id="cb28-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add column identifying the type of each node (miRNA, lncRNA, or gene)</span></span>
<span id="cb28-8">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb28-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb28-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>,</span>
<span id="cb28-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>,</span>
<span id="cb28-13">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span></span>
<span id="cb28-14">  ))</span></code></pre></div>
</div>
</section>
<section id="pcc-0.8" class="level1">
<h1>|PCC| &gt; 0.8</h1>
<p>Edges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> edges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC_magnitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 87</code></pre>
</div>
</div>
<p>Nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a df that contains all miRNA, genes, and lncRNA listed in the `source` and `target` columns of `edges`</span></span>
<span id="cb31-2">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb31-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The `unique` argument ensures we remove duplicates</span></span>
<span id="cb31-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span>[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span>)])))</span>
<span id="cb31-5">)</span>
<span id="cb31-6"></span>
<span id="cb31-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add column identifying the type of each node (miRNA, lncRNA, or gene)</span></span>
<span id="cb31-8">nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb31-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb31-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb31-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>,</span>
<span id="cb31-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>, id) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA"</span>,</span>
<span id="cb31-13">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span></span>
<span id="cb31-14">  ))</span></code></pre></div>
</div>
</section>
<section id="save" class="level1">
<h1>Save</h1>
<p>Save files</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/nodes_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_pval_0.01_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes_pval_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/nodes_pval_0.01_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/nodes_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_PCC_0.6_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.6</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/nodes_PCC_0.6_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_PCC_0.7_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.7</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/nodes_PCC_0.7_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/edges_PCC_0.8_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb32-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes_PCC_0<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./output/2025_04_28_timeseries_cytoscape_files/nodes_PCC_0.8_timeseries_miRNA_lncRNA_genes.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
</section>
<section id="using-cytoscape" class="level1">
<h1>Using Cytoscape</h1>
<p>To load a network into Cytoscape:</p>
<ol type="1">
<li><p>Open Cytoscape and select File &gt; Import &gt; Network from Fileâ€¦</p></li>
<li><p>Select â€œEdgesâ€ file. Ensure The source and target columns are appropriately identified before loading the file.</p></li>
<li><p>To load â€œNodesâ€ file, select File &gt; Import &gt; Table from Fileâ€¦</p></li>
</ol>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>Below is a the network of miRNA-gene and miRNA-lncRNA interactions that are predicted to bind by miRanda, and which have an expression correlation coefficient above 0.5.</p>
<p>The network is displayed using the yFiles Organic Layout, with nodes colored by type (miRNA = orange, lncRNA = dark blue, gene = light blue), and with edges colored by correlation direction (negative = red, positive = green) and weighted by correlation magnitude.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/output/edges_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv.png" class="img-fluid"></p>
<p>We can see some interesting patterns!</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/output/edges_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv-CLUSTER_4752.png" class="img-fluid"></p>
<p>Cluster_4752 stands out because it has many putative interactions (mostly genes), with primarily negatively correlated expression. This suggests the miRNA is reducing expression of its target genes through translational repression or mRNA degradation. Note also that this miRNA matches miR-2023.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/output/edges_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv-CLUSTER_5603.png" class="img-fluid"></p>
<p>Cluster_5603 appears to putatively interact with one of the largest proportions of lncRNA. It matches the previously described miRNA â€œNovel-5_3pâ€.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/output/edges_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv-CLUSTER_17192.png" class="img-fluid"></p>
<p>Cluster_17192 is primarily of interest becasue it matches miR-100, a highly conserved and well described miRNA. It also becomes apparent after isolation that one of the putative gene targets, FUN_014449, has a remarkable number of edges connecting it to Cluster_17192. This indicates that miRanda output a significant likelihood of Cluster_17192 binding to many different location on the mRNA</p>
<p>We can check exactly how many:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">miRNA_gene <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC_magnitude <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> interaction <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster_17192 _ FUN_014449"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 129</code></pre>
</div>
</div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/output/edges_PCC_0.5_timeseries_miRNA_lncRNA_genes.csv-CLUSTER_9532.png" class="img-fluid"></p>
<p>Cluster_9532 matches miR-2022, about which we actually know a fair bit of functional information!</p>
<p>I have a notebook post detailing what functional information we have for previously described miRNA, <a href="../../../posts/projects/E5_coral/2025_04_10_dde_named_miRNA_functions.html">here</a></p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_28_timeseries_cytoscape_files.html</guid>
  <pubDate>Mon, 28 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul, multiomic features to predict expression. Machine learning â€“ Part 2</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_23_timeseries_multiomic_ML_2.html</link>
  <description><![CDATA[ 




<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.2-Apul-multiomic-machine-learning.Rmd">Code</a></p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.2-Apul-multiomic-machine-learning.md">Rendered Code</a></p>
<p>Applying ML model using multiomic predictors â€“ miRNA + lncRNA + methylation as predictors of gene expression. This time, instead of reducing the dimensionality of all sets using PCs, Iâ€™m using vsd-transformed miRNA/lncRNA/CpG counts as predictors, and vsd-transformed gene counts as responses.</p>
<p>Excluding the dimensionality-reduction makes the model training much more computationally intensive, so I only ran it for the smaller gene sets (Host biomass, ATP production GO terms, Energy usage/storage GO terms).</p>
<p>Inputs:</p>
<ul>
<li><p>RNA counts matrix (raw): <code>../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv</code></p></li>
<li><p>Gene sets of interest: <code>../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/</code></p></li>
<li><p>sRNA/miRNA counts matrix (raw): <code>../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt</code></p></li>
<li><p>lncRNA counts matrix (raw): <code>../output/08-Apul-lncNRA/counts.txt</code></p></li>
<li><p>WGBS data (processed): Performed in <code>/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/</code>, data in <a href="https://gannet.fish.washington.edu/seashell/bu-github/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/">large-file storage</a>.</p></li>
<li><p>sample metadata: <code>../../M-multi-species/data/rna_metadata.csv</code></p></li>
</ul>
<section id="set-up" class="level1">
<h1>1 Set up</h1>
</section>
<section id="load-libraries" class="level1">
<h1>2 Load libraries</h1>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DESeq2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(psych)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidygraph)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WGCNA)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(edgeR)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reshape2)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggcorrplot)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(corrplot)</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pheatmap)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(factoextra)</span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(vegan)</span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggfortify)</span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(genefilter)</span>
<span id="cb1-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scales)</span></code></pre></div>
<p>The model includes random processes, so set a seed for reproducability. Note: for final results, should we consider bootstrapping to ensure reported results are representative?</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">703</span>)</span></code></pre></div>
</section>
<section id="load-and-format-data" class="level1">
<h1>3 Load and format data</h1>
<section id="rna-seq-data-mrna-mirna-lncrna" class="level2">
<h2 class="anchored" data-anchor-id="rna-seq-data-mrna-mirna-lncrna">3.1 RNA-seq data (mRNA, miRNA, lncRNA)</h2>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### mRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw gene counts data (will filter and variance stabilize)</span></span>
<span id="cb3-3">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span></code></pre></div>
<pre><code>## Rows: 44371 Columns: 41
## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Delimiter: ","
## chr  (1): gene_id
## dbl (40): 1A1, 1A10, 1A12, 1A2, 1A8, 1A9, 1B1, 1B10, 1B2, 1B5, 1B9, 1C10, 1C...
## 
## â„¹ Use `spec()` to retrieve the full column specification for this data.
## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format gene IDs as rownames (instead of a column)</span></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb5-5">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>gene_id)</span>
<span id="cb5-6"></span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### miRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw miRNA counts (will filter and variance stabilize)</span></span>
<span id="cb5-10">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb5-11"></span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### lncRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw lncRNA counts (will filter and variance stabilize)</span></span>
<span id="cb5-15">Apul_lncRNA_full <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/08-Apul-lncRNA/counts.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-16"></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove info on genomic location, set lncRNA IDs as rownames</span></span>
<span id="cb5-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_lncRNA_full) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Geneid</span>
<span id="cb5-19">Apul_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_full <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Geneid, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Chr, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Start, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>End, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Strand, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Length)</span>
<span id="cb5-20"></span>
<span id="cb5-21"></span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### load and format metadata </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-24">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../M-multi-species/data/rna_metadata.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(AzentaSampleName, ColonyID, Timepoint) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACR"</span>, ColonyID))</span></code></pre></div>
<pre><code>## New names:
## Rows: 117 Columns: 19
## â”€â”€ Column specification
## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Delimiter: "," chr
## (13): SampleName, WellNumber, AzentaSampleName, ColonyID, Timepoint, Sam... dbl
## (5): SampleNumber, Plate, TotalAmount-ng, Volume-uL, Conc-ng.uL lgl (1):
## MethodUsedForSpectrophotometry
## â„¹ Use `spec()` to retrieve the full column specification for this data. â„¹
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## â€¢ `` -&gt; `...19`</code></pre>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span></code></pre></div>
<pre><code>## Warning: Setting row names on a tibble is deprecated.</code></pre>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">colonies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID)</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename gene column names to include full sample info</span></span>
<span id="cb9-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename miRNA column names to match formatting</span></span>
<span id="cb9-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_.*"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA))</span>
<span id="cb9-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename lncRNA colin names to include full sample info</span></span>
<span id="cb9-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"...data."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA))</span>
<span id="cb9-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".sorted.bam"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA))</span>
<span id="cb9-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span></code></pre></div>
</section>
<section id="wgbs-data" class="level2">
<h2 class="anchored" data-anchor-id="wgbs-data">3.2 WGBS data</h2>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pull processed files from Gannet </span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note: Unfortunately we can't use the `cache` feature to make this process more time efficient, as it doesn't support long vectors</span></span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the base URL</span></span>
<span id="cb10-5">base_url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://gannet.fish.washington.edu/seashell/bu-github/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/"</span></span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the HTML page</span></span>
<span id="cb10-8">page <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(base_url)</span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract links to files</span></span>
<span id="cb10-11">file_links <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> page <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span>)</span>
<span id="cb10-14"></span>
<span id="cb10-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter for files ending in "processed.txt"</span></span>
<span id="cb10-16">processed_files <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> file_links[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"processed</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.txt$"</span>, file_links)]</span>
<span id="cb10-17"></span>
<span id="cb10-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create full URLs</span></span>
<span id="cb10-19">file_urls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(base_url, processed_files)</span>
<span id="cb10-20"></span>
<span id="cb10-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to read a file from URL</span></span>
<span id="cb10-22">read_processed_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(url) {</span>
<span id="cb10-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_table</span>(url, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read as character to avoid parsing issues</span></span>
<span id="cb10-24">}</span>
<span id="cb10-25"></span>
<span id="cb10-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import all processed files into a list</span></span>
<span id="cb10-27">processed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(file_urls, read_processed_file)</span>
<span id="cb10-28"></span>
<span id="cb10-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Name the list elements by file name</span></span>
<span id="cb10-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(processed_data) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> processed_files</span>
<span id="cb10-31"></span>
<span id="cb10-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print structure of imported data</span></span>
<span id="cb10-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(processed_data)</span>
<span id="cb10-34"></span>
<span id="cb10-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a header row that has "CpG" for the first column and "sample" for the second column, which will be populated by the file name </span></span>
<span id="cb10-36"></span>
<span id="cb10-37">processed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Map</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(df, filename) {</span>
<span id="cb10-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CpG"</span>, filename)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename columns</span></span>
<span id="cb10-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(df)</span>
<span id="cb10-40">}, processed_data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(processed_data))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use stored file names</span></span>
<span id="cb10-41"></span>
<span id="cb10-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#merge files together by "CpG"</span></span>
<span id="cb10-43">merged_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>(processed_data, full_join, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CpG"</span>)</span>
<span id="cb10-44"></span>
<span id="cb10-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print structure of final merged data</span></span>
<span id="cb10-46"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(merged_data)</span></code></pre></div>
<p>Replace any NA with 0.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert all columns (except "CpG") to numeric and replace NAs with 0</span></span>
<span id="cb11-2">merged_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, as.numeric)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert all except CpG to numeric</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace_na</span>(.x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA with 0 in numeric columns</span></span></code></pre></div>
</section>
<section id="filter-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="filter-data-sets">3.3 Filter data sets</h2>
<p>Only keep CpGs that have a non-zero value in all samples.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_all</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb12-2"></span>
<span id="cb12-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure it's formatted as a data frame</span></span>
<span id="cb12-4">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(filtered_wgbs)</span>
<span id="cb12-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep the sample information in the column name. </span></span>
<span id="cb12-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^(.*?)_.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs))</span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set CpG IDs to rownames</span></span>
<span id="cb12-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(filtered_wgbs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CpG</span>
<span id="cb12-9">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG)</span>
<span id="cb12-10"></span>
<span id="cb12-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(merged_data)</span>
<span id="cb12-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(filtered_wgbs)</span></code></pre></div>
<p>We had 12,093,025 CpGs before filtering and have only 507 after filtering. This makes sense because most CpGs were not methylated in all samples.</p>
<p>Save filtered set to make code reruns/knitting quicker</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(filtered_wgbs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/22.2-Apul-multiomic-machine-learning/filtered-WGBS-CpG-counts.csv"</span>)</span></code></pre></div>
<p>If knitting/rerunning code, we can load in this filtered data here, instead of loading raw counts and reprocessing.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/22.2-Apul-multiomic-machine-learning/filtered-WGBS-CpG-counts.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<p>Only keep genes, miRNA, and lncRNA that are present in at least one sample</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes</span></span>
<span id="cb15-2">Apul_genes_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb15-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA</span></span>
<span id="cb15-4">Apul_miRNA_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb15-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lncRNA</span></span>
<span id="cb15-6">Apul_lncRNA_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_lncRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb15-7"></span>
<span id="cb15-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Retained "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes; "</span>,</span>
<span id="cb15-9">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" miRNA; and "</span>, </span>
<span id="cb15-10">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" lncRNA"</span>)</span></code></pre></div>
<pre><code>## Retained  35869  of  44371 genes;  51  of  51  miRNA; and  20559  of  24181  lncRNA</code></pre>
<p><em>pOverA</em>: Specifying the minimum count for a proportion of samples for each gene. Setting 3/40 = 0.08. This would retain genes that are only expressed in a single season in a couple of the colonies. Additionally, setting the minimum count so that the minimum number of samples must have a gene count above a certain threshold.</p>
<p>genes:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb17-2"></span>
<span id="cb17-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb17-4">gfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_genes_red, filt)</span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb17-7">gkeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_red[gfilt,]</span>
<span id="cb17-8"></span>
<span id="cb17-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify gene lists</span></span>
<span id="cb17-10">gn.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(gkeep)</span>
<span id="cb17-11"></span>
<span id="cb17-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#gene count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb17-13">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> gn.keep),])</span>
<span id="cb17-14"></span>
<span id="cb17-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb17-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 35869 ; Post-filtering: 25730</code></pre>
<p>miRNA:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb19-4">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_miRNA_red, mifilt)</span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA to keep by count filter</span></span>
<span id="cb19-7">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb19-8"></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA to keep by count filter</span></span>
<span id="cb19-10">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb19-11"></span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA lists</span></span>
<span id="cb19-13">mi.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(mikeep)</span>
<span id="cb19-14"></span>
<span id="cb19-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#miRNA count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb19-16">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_miRNA_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> mi.keep),])</span>
<span id="cb19-17"></span>
<span id="cb19-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb19-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 51 ; Post-filtering: 47</code></pre>
<p>Of the 51 miRNA, 47 were retained. Which were removed?</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## [1] "Cluster_5685"  "Cluster_11565" "Cluster_13647" "Cluster_14633"</code></pre>
<p>lncRNA:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">lncfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb23-2"></span>
<span id="cb23-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb23-4">lncfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_lncRNA_red, lncfilt)</span>
<span id="cb23-5"></span>
<span id="cb23-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA to keep by count filter</span></span>
<span id="cb23-7">lnckeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_red[lncfilt,]</span>
<span id="cb23-8"></span>
<span id="cb23-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA to keep by count filter</span></span>
<span id="cb23-10">lnckeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_red[lncfilt,]</span>
<span id="cb23-11"></span>
<span id="cb23-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA lists</span></span>
<span id="cb23-13">lnc.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(lnckeep)</span>
<span id="cb23-14"></span>
<span id="cb23-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#lncRNA count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb23-16">Apul_lncRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_lncRNA_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_lncRNA_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> lnc.keep),])</span>
<span id="cb23-17"></span>
<span id="cb23-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb23-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 20559 ; Post-filtering: 16006</code></pre>
</section>
<section id="transform-data" class="level2">
<h2 class="anchored" data-anchor-id="transform-data">3.4 Transform data</h2>
<p>Set the order of genes, miRNA, lncRNA, wgbs, and metadata to all be the same.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure rownames of metadata are used as the desired column order</span></span>
<span id="cb25-2">desired_order <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata)</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reorder data frame columns</span></span>
<span id="cb25-5">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_filt[, desired_order]</span>
<span id="cb25-6">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt[, desired_order]</span>
<span id="cb25-7">Apul_lncRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_filt[, desired_order]</span>
<span id="cb25-8">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs[, desired_order]</span>
<span id="cb25-9"></span>
<span id="cb25-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check they all match</span></span>
<span id="cb25-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Use a variance stabilized transformation for all four data sets. Variance stabilization essentially tries to make variance independent of the mean</p>
<p>(Is this the most appropriate design to use?)</p>
<p>genes:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_genes_filt, </span>
<span id="cb33-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb33-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## converting counts to integer mode

## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb35-2">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<p>miRNA:</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_miRNA_filt, </span>
<span id="cb36-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb36-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb38-2">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Must use varianceStabilizingTransformation() instead of vst() due to few input genes</span></span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA)</span></code></pre></div>
<p>lncRNA:</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">dds_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_lncRNA_filt, </span>
<span id="cb41-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb41-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb43-2">vsd_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_lncRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<p>Must round wgbs data to whole integers for normalization - need to return to this to decide if this is appropriate.</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#round to integers </span></span>
<span id="cb44-2">filtered_wgbs<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>filtered_wgbs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), round))</span>
<span id="cb44-3"></span>
<span id="cb44-4">dds_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> filtered_wgbs, </span>
<span id="cb44-5">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb44-6">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## converting counts to integer mode

## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb46-2">vsd_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_wgbs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]

## -- note: fitType='parametric', but the dispersion trend was not well captured by the
##    function: y = a/x + b, and a local regression fit was automatically substituted.
##    specify fitType='local' or 'mean' to avoid this message next time.</code></pre>
</section>
<section id="islolate-gene-sets" class="level2">
<h2 class="anchored" data-anchor-id="islolate-gene-sets">3.5 Islolate gene sets</h2>
<p>Read in gene set tables</p>
<div class="sourceCode" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes from WGCNA modules significantly correlated with host biomass</span></span>
<span id="cb48-2">Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/Host_AFDW.mg.cm2_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb48-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes from WGCNA modules significantly correlated with symbiont photosynthesis</span></span>
<span id="cb48-4">Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/Am_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb48-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GO terms related to energy production/usage</span></span>
<span id="cb48-6">ATP_production_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/ATP_production_GO_terms_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb48-7">energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/energy_usage_storage_GO_terms_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<p>Isolate filtered counts by gene set</p>
<div class="sourceCode" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">vsd_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span>
<span id="cb49-2">vsd_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span>
<span id="cb49-3">vsd_ATP_production_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ATP_production_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span>
<span id="cb49-4">vsd_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span></code></pre></div>
</section>
</section>
<section id="merge-predictor-features" class="level1">
<h1>5 Merge predictor features</h1>
<section id="merge-raw-datsets" class="level2">
<h2 class="anchored" data-anchor-id="merge-raw-datsets">5.2 Merge raw datsets</h2>
<p>I also want to try using individiual miRNA/lncRNA/CpGs as predictors, instead of the reduced PCs. Letâ€™s also create a merged dataset that contains the variance stabilized counts for all miRNA, lncRNA, and CpGs.</p>
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Triple check that all three data frames have sample names in the same order</span></span>
<span id="cb50-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_lncRNA), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_miRNA))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_lncRNA), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_wgbs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind (stack dataframes vertically, so that they match by column/sample)</span></span>
<span id="cb54-2">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(vsd_lncRNA, vsd_miRNA, vsd_wgbs)</span>
<span id="cb54-3"></span>
<span id="cb54-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform so that samples are on rows and features are in columns</span></span>
<span id="cb54-5">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(full_pred_counts)</span>
<span id="cb54-6"></span>
<span id="cb54-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(full_pred_counts)</span></code></pre></div>
<pre><code>## [1]    40 16560</code></pre>
<p>Ok, now we can run the model!</p>
<p>The below code uses both predictors (miRNA+lncRNA+CpGs) and responses (genes) that have been <em>not</em> been reduced using PCs.</p>
<div class="sourceCode" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform the counts matrices so that samples are on the rows and gene IDs on the columns</span></span>
<span id="cb56-2">vsd_genes_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_genes)</span>
<span id="cb56-3">vsd_Host_AFDW_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_Host_AFDW)</span>
<span id="cb56-4">vsd_Am_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_Am)</span>
<span id="cb56-5">vsd_ATP_production_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_ATP_production_GO)</span>
<span id="cb56-6">vsd_energy_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_energy_GO)</span>
<span id="cb56-7"></span>
<span id="cb56-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure both are formatted as data frames</span></span>
<span id="cb56-9">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(full_pred_counts)</span>
<span id="cb56-10">vsd_genes_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(vsd_genes_t)</span>
<span id="cb56-11">vsd_Host_AFDW_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(vsd_Host_AFDW_t)</span>
<span id="cb56-12">vsd_Am_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(vsd_Am_t)</span>
<span id="cb56-13">vsd_ATP_production_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(vsd_ATP_production_GO_t)</span>
<span id="cb56-14">vsd_energy_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(vsd_energy_GO_t)</span>
<span id="cb56-15"></span>
<span id="cb56-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure sample matching between gene and epigenetic dfs</span></span>
<span id="cb56-17">common_samples <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes_t), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred_counts))</span>
<span id="cb56-18"></span>
<span id="cb56-19">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred_counts[common_samples, ]</span>
<span id="cb56-20">vsd_genes_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes_t[common_samples, ]</span>
<span id="cb56-21">vsd_Host_AFDW_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_Host_AFDW_t[common_samples,]</span>
<span id="cb56-22">vsd_Am_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_Am_t[common_samples,]</span>
<span id="cb56-23">vsd_ATP_production_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_ATP_production_GO_t[common_samples,]</span>
<span id="cb56-24">vsd_energy_GO_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_energy_GO_t[common_samples,]</span></code></pre></div>
</section>
</section>
<section id="host-biomass-host_afdw" class="level1">
<h1>14 Host biomass (Host_AFDW)</h1>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">14.1 The model</h2>
<p>Train elastic models to predict gene expression from miRNA/lncRNA/methylation.</p>
<div class="sourceCode" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1">train_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_features, predictor_features) {</span>
<span id="cb57-2">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb57-3">  </span>
<span id="cb57-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features)) {</span>
<span id="cb57-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_features[[feature]]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gene expression</span></span>
<span id="cb57-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_features)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA/lncRNA/methylation as predictors</span></span>
<span id="cb57-7">    </span>
<span id="cb57-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train elastic net model (alpha = 0.5 for mix of LASSO &amp; Ridge)</span></span>
<span id="cb57-9">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb57-10">    </span>
<span id="cb57-11">    models[[feature]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb57-12">  }</span>
<span id="cb57-13">  </span>
<span id="cb57-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(models)</span>
<span id="cb57-15">}</span>
<span id="cb57-16"></span>
<span id="cb57-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression from miRNA/lncRNA/methylation</span></span>
<span id="cb57-18">models_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_Host_AFDW_t, full_pred_counts)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1">get_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models) {</span>
<span id="cb58-2">  importance_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb58-3">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to regular matrix &amp; remove intercept</span></span>
<span id="cb58-4">    </span>
<span id="cb58-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb58-6">    coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs))</span>
<span id="cb58-7">    </span>
<span id="cb58-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df)</span>
<span id="cb58-9">  })</span>
<span id="cb58-10">  </span>
<span id="cb58-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature importance across all predicted genes</span></span>
<span id="cb58-12">  importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(importance_list) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb58-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb58-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Importance)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb58-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb58-16">  </span>
<span id="cb58-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(importance_df)</span>
<span id="cb58-18">}</span>
<span id="cb58-19"></span>
<span id="cb58-20">feature_importance_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_Host_AFDW)</span>
<span id="cb58-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_Host_AFDW, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive features</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature    MeanImportance
##    &lt;chr&gt;               &lt;dbl&gt;
##  1 PC20_miRNA         0.0906
##  2 PC18_miRNA         0.0771
##  3 PC17_miRNA         0.0762
##  4 PC19_miRNA         0.0760
##  5 PC16_miRNA         0.0753
##  6 PC8_miRNA          0.0689
##  7 PC3_miRNA          0.0674
##  8 PC13_miRNA         0.0672
##  9 PC11_miRNA         0.0669
## 10 PC7_miRNA          0.0663
## 11 PC9_miRNA          0.0581
## 12 PC27_WGBS          0.0527
## 13 PC26_WGBS          0.0516
## 14 PC2_miRNA          0.0505
## 15 PC14_miRNA         0.0471
## 16 PC5_miRNA          0.0463
## 17 PC12_miRNA         0.0440
## 18 PC21_WGBS          0.0430
## 19 PC13_WGBS          0.0430
## 20 PC11_WGBS          0.0354</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1">evaluate_model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models, response_features, predictor_features) {</span>
<span id="cb60-2">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb60-3"></span>
<span id="cb60-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_features)) {</span>
<span id="cb60-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_features[[feature]]</span>
<span id="cb60-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_features)</span>
<span id="cb60-7"></span>
<span id="cb60-8">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models[[feature]]</span>
<span id="cb60-9">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb60-10"></span>
<span id="cb60-11">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R-squared metric</span></span>
<span id="cb60-12">    results[results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> feature, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb60-13">  }</span>
<span id="cb60-14"></span>
<span id="cb60-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb60-16">}</span>
<span id="cb60-17"></span>
<span id="cb60-18">performance_results_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_Host_AFDW, vsd_Host_AFDW_t, full_pred_counts)</span>
<span id="cb60-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.0000  0.9554  0.9919  0.9498  0.9996  0.9998      14</code></pre>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">14.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb62-2">top_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb62-3"></span>
<span id="cb62-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb62-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb62-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb62-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb62-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb62-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as predictive features"</span>,</span>
<span id="cb62-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Features"</span>,</span>
<span id="cb62-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-90-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Genes"</span>,</span>
<span id="cb63-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene"</span>,</span>
<span id="cb63-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 14 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-91-1.png" class="img-fluid"><!-- --></p>
<p>We can also look at which feature(s) contributed most to predicting genes of interest</p>
<div class="sourceCode" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will keep this unevaluated to reduce size of knitted document</span></span>
<span id="cb65-2">all_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb65-3"></span>
<span id="cb65-4">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb65-5">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb65-6">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb65-7">  </span>
<span id="cb65-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb65-9">}</span>
<span id="cb65-10"></span>
<span id="cb65-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_Host_AFDW) {</span>
<span id="cb65-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable gene</span></span>
<span id="cb65-13">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_Host_AFDW[[feature]]</span>
<span id="cb65-14">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb65-15">  </span>
<span id="cb65-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this gene</span></span>
<span id="cb65-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb65-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb65-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb65-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb65-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb65-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb65-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb65-24">  </span>
<span id="cb65-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb65-26">}</span></code></pre></div>
<div class="sourceCode" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation between actual and predicted genes</span></span>
<span id="cb66-2">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(models_Host_AFDW, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))</span>
<span id="cb66-3"></span>
<span id="cb66-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure matrices are the same size</span></span>
<span id="cb66-5">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_Host_AFDW_t), drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align columns</span></span>
<span id="cb66-6"></span>
<span id="cb66-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 0 variance columns</span></span>
<span id="cb66-8">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(predicted_matrix, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(col) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb66-9"></span>
<span id="cb66-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation matrix, handling missing values</span></span>
<span id="cb66-11">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(predicted_matrix, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_Host_AFDW_t), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"complete.obs"</span>)</span>
<span id="cb66-12"></span>
<span id="cb66-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA or Inf values with zero</span></span>
<span id="cb66-14">cor_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.infinite</span>(cor_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb66-15"></span>
<span id="cb66-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb66-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb66-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Between Actual and Predicted Genes"</span>,</span>
<span id="cb66-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb66-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb66-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-93-1.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="symbiont-photsynthesis-am" class="level1">
<h1>15 Symbiont photsynthesis (Am)</h1>
<section id="the-model-1" class="level2">
<h2 class="anchored" data-anchor-id="the-model-1">15.1 The model</h2>
<p>Train elastic models to predict gene expression from miRNA/lncRNA/methylation</p>
<div class="sourceCode" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression from miRNA/lncRNA/methylation</span></span>
<span id="cb67-2">models_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_Am_t, full_pred_counts)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1">feature_importance_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_Am)</span>
<span id="cb68-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_Am, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive features</span></span></code></pre></div>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1">performance_results_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_Am, vsd_Am_t, full_pred_counts)</span>
<span id="cb69-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
</section>
<section id="results-1" class="level2">
<h2 class="anchored" data-anchor-id="results-1">15.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb70" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb70-2">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb70-3"></span>
<span id="cb70-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb70-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb70-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb70-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb70-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb70-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb70-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb70-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb71" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb71-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb71-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb71-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb71-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb71-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb71-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb71-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb72" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb72-2">best_feature_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb72-3"></span>
<span id="cb72-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb72-5">actual_values_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_Am_t[[best_feature_Am]]</span>
<span id="cb72-6">predicted_values_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Am[[best_feature_Am]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb72-7"></span>
<span id="cb72-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb72-9">prediction_df_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb72-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_Am,</span>
<span id="cb72-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_Am</span>
<span id="cb72-12">)</span>
<span id="cb72-13"></span>
<span id="cb72-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb72-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_feature_Am),</span>
<span id="cb72-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb72-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_Am), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_Am), </span>
<span id="cb72-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb72-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb72-25"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Am_Feature<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_feature_Am))</span></code></pre></div>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb74" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above 0.75</span></span>
<span id="cb74-2">all_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb74-3"></span>
<span id="cb74-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_Am) {</span>
<span id="cb74-5">  </span>
<span id="cb74-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb74-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_Am_t[[feature]]</span>
<span id="cb74-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Am[[feature]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb74-9">  </span>
<span id="cb74-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb74-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb74-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb74-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb74-14">  )</span>
<span id="cb74-15">  </span>
<span id="cb74-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb74-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb74-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb74-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb74-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb74-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, feature),</span>
<span id="cb74-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb74-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb74-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb74-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Am[performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>feature,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb74-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb74-27">  </span>
<span id="cb74-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb74-29">}</span></code></pre></div>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb75-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb75-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb75-4">  </span>
<span id="cb75-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb75-6">}</span>
<span id="cb75-7"></span>
<span id="cb75-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_Am) {</span>
<span id="cb75-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb75-10">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_Am[[feature]]</span>
<span id="cb75-11">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb75-12">  </span>
<span id="cb75-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb75-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb75-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb75-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb75-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb75-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb75-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb75-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb75-21">  </span>
<span id="cb75-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb75-23">}</span></code></pre></div>
</section>
</section>
<section id="atp-production-go-terms" class="level1">
<h1>16 ATP production (GO terms)</h1>
<section id="the-model-2" class="level2">
<h2 class="anchored" data-anchor-id="the-model-2">16.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA/lncRNA/methylation</p>
<div class="sourceCode" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA/lncRNA/methylation</span></span>
<span id="cb76-2">models_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_ATP_production_GO_t, full_pred_counts)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1">feature_importance_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_ATP_prod_GO)</span>
<span id="cb77-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_ATP_prod_GO, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature                MeanImportance
##    &lt;chr&gt;                           &lt;dbl&gt;
##  1 lncRNA_16172                  0.0151 
##  2 lncRNA_19034                  0.0137 
##  3 lncRNA_3645                   0.0125 
##  4 lncRNA_20796                  0.0110 
##  5 lncRNA_4454                   0.00999
##  6 lncRNA_8058                   0.00920
##  7 lncRNA_18277                  0.00918
##  8 CpG_ptg000024l_4334252        0.00893
##  9 lncRNA_9242                   0.00818
## 10 lncRNA_263                    0.00782
## 11 lncRNA_3622                   0.00781
## 12 lncRNA_9252                   0.00773
## 13 CpG_ptg000031l_5273398        0.00716
## 14 lncRNA_19773                  0.00687
## 15 CpG_ptg000022l_2983280        0.00683
## 16 lncRNA_11719                  0.00667
## 17 CpG_ptg000024l_213653         0.00665
## 18 lncRNA_23085                  0.00664
## 19 lncRNA_18158                  0.00655
## 20 lncRNA_7887                   0.00652</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb79" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1">performance_results_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_ATP_prod_GO, vsd_ATP_production_GO_t, full_pred_counts)</span>
<span id="cb79-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.9644  0.9957  0.9366  0.9996  0.9997</code></pre>
</section>
<section id="results-2" class="level2">
<h2 class="anchored" data-anchor-id="results-2">16.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb81" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb81-2">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb81-3"></span>
<span id="cb81-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb81-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb81-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb81-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb81-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-106-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb82-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb82-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-107-1.png" class="img-fluid"><!-- --></p>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb83" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb83-2">best_feature_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb83-3"></span>
<span id="cb83-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb83-5">actual_values_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_ATP_production_GO_t[[best_feature_ATP_prod_GO]]</span>
<span id="cb83-6">predicted_values_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO[[best_feature_ATP_prod_GO]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb83-7"></span>
<span id="cb83-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb83-9">prediction_df_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb83-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_ATP_prod_GO,</span>
<span id="cb83-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_ATP_prod_GO</span>
<span id="cb83-12">)</span>
<span id="cb83-13"></span>
<span id="cb83-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb83-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_feature_ATP_prod_GO),</span>
<span id="cb83-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb83-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_ATP_prod_GO), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_ATP_prod_GO), </span>
<span id="cb83-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb83-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-108-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb85" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb86" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above line in plot</span></span>
<span id="cb86-2">all_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb86-3"></span>
<span id="cb86-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_ATP_prod_GO) {</span>
<span id="cb86-5">  </span>
<span id="cb86-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb86-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_ATP_production_GO_t[[feature]]</span>
<span id="cb86-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO[[feature]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb86-9">  </span>
<span id="cb86-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb86-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb86-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb86-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb86-14">  )</span>
<span id="cb86-15">  </span>
<span id="cb86-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb86-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb86-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb86-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb86-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb86-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, feature),</span>
<span id="cb86-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb86-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb86-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb86-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO[performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>feature,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb86-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb86-27">  </span>
<span id="cb86-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb86-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-6.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-7.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-8.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-9.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-10.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-11.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-12.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-13.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-14.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-15.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-16.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-17.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-18.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-19.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-20.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-109-21.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb108" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb108-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb108-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb108-4">  </span>
<span id="cb108-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb108-6">}</span>
<span id="cb108-7"></span>
<span id="cb108-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_ATP_prod_GO) {</span>
<span id="cb108-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb108-10">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_ATP_prod_GO[[feature]]</span>
<span id="cb108-11">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb108-12">  </span>
<span id="cb108-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb108-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb108-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb108-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb108-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb108-21">  </span>
<span id="cb108-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb108-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-6.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-7.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-8.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-9.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-10.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-11.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-12.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-13.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-14.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-15.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-16.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-17.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-18.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-19.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-20.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-110-21.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb109" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation between actual and predicted gene expression PCs</span></span>
<span id="cb109-2">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(models_ATP_prod_GO, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred_counts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))</span>
<span id="cb109-3"></span>
<span id="cb109-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure matrices are the same size</span></span>
<span id="cb109-5">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_ATP_production_GO_t), drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align columns</span></span>
<span id="cb109-6"></span>
<span id="cb109-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 0 variance columns</span></span>
<span id="cb109-8">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(predicted_matrix, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(col) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb109-9"></span>
<span id="cb109-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation matrix, handling missing values</span></span>
<span id="cb109-11">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(predicted_matrix, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_ATP_production_GO_t), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"complete.obs"</span>)</span>
<span id="cb109-12"></span>
<span id="cb109-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA or Inf values with zero</span></span>
<span id="cb109-14">cor_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.infinite</span>(cor_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb109-15"></span>
<span id="cb109-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb109-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb109-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Between Actual and Predicted Gene Expression PCs"</span>,</span>
<span id="cb109-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb109-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb109-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-111-1.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="energy-usagestorage-go-terms" class="level1">
<h1>17 Energy Usage/Storage (GO terms)</h1>
<section id="the-model-3" class="level2">
<h2 class="anchored" data-anchor-id="the-model-3">17.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA/lncRNA/methylation</p>
<div class="sourceCode" id="cb110" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA/lncRNA/methylation</span></span>
<span id="cb110-2">models_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(vsd_energy_GO_t, full_pred_counts)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb111" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1">feature_importance_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_energy_GO)</span>
<span id="cb111-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_energy_GO, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature                 MeanImportance
##    &lt;chr&gt;                            &lt;dbl&gt;
##  1 lncRNA_19034                   0.00555
##  2 lncRNA_4454                    0.00373
##  3 lncRNA_2998                    0.00302
##  4 lncRNA_12064                   0.00248
##  5 CpG_ptg000025l_18378678        0.00244
##  6 lncRNA_12212                   0.00237
##  7 lncRNA_8086                    0.00221
##  8 lncRNA_20796                   0.00216
##  9 lncRNA_13960                   0.00215
## 10 lncRNA_263                     0.00214
## 11 lncRNA_21989                   0.00210
## 12 lncRNA_15222                   0.00210
## 13 lncRNA_7887                    0.00208
## 14 CpG_ptg000024l_4334565         0.00206
## 15 lncRNA_16584                   0.00205
## 16 lncRNA_6545                    0.00203
## 17 lncRNA_1395                    0.00199
## 18 lncRNA_22939                   0.00199
## 19 lncRNA_16417                   0.00198
## 20 CpG_ptg000021l_8434453         0.00194</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb113" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1">performance_results_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_energy_GO, vsd_energy_GO_t, full_pred_counts)</span>
<span id="cb113-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.3597  0.9565  0.9950  0.9574  0.9996  0.9998       3</code></pre>
</section>
<section id="results-3" class="level2">
<h2 class="anchored" data-anchor-id="results-3">17.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb115" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb115-2">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb115-3"></span>
<span id="cb115-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb115-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb115-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb115-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb115-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb115-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb115-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb115-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-115-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb116" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(Feature), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb116-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb116-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb116-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb116-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb116-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb116-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb116-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-116-1.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb118" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Will keep this unevaluated to reduce size of knitted document</span></span>
<span id="cb118-2">get_feature_importance_for_feature <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb118-3">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb118-4">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb118-5">  </span>
<span id="cb118-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb118-7">}</span>
<span id="cb118-8"></span>
<span id="cb118-9">all_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Feature)</span>
<span id="cb118-10"></span>
<span id="cb118-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (feature <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_features_energy_GO) {</span>
<span id="cb118-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb118-13">  best_feature_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_energy_GO[[feature]]</span>
<span id="cb118-14">  best_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_feature</span>(best_feature_model)</span>
<span id="cb118-15">  </span>
<span id="cb118-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb118-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb118-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb118-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb118-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb118-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, feature),</span>
<span id="cb118-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb118-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb118-24">  </span>
<span id="cb118-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb118-26">}</span></code></pre></div>
</section>
</section>
<section id="compare" class="level1">
<h1>18 Compare</h1>
<p>Visualize the relative importance of miRNA/lncRNA/methylation in predicting expression for these different gene sets:</p>
<div class="sourceCode" id="cb119" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform min-max normalization on the mean importance of miRNA/lncRNA/methylation for each group</span></span>
<span id="cb119-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This will place all along a 0-1 range for comparison purposes</span></span>
<span id="cb119-3">normalize <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb119-4">  (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x))</span>
<span id="cb119-5">}</span>
<span id="cb119-6"></span>
<span id="cb119-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalize</span></span>
<span id="cb119-8">top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb119-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#top_features_Am$MeanImportance_norm &lt;- normalize(top_features_Am$MeanImportance)</span></span>
<span id="cb119-10">top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb119-11">top_features_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb119-12"></span>
<span id="cb119-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add group labels</span></span>
<span id="cb119-14">top_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host_AFDW"</span>)</span>
<span id="cb119-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#top_features_Am &lt;- top_features_Am %&gt;% mutate(group = "Am")</span></span>
<span id="cb119-16">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_prod_GO"</span>)</span>
<span id="cb119-17">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"energy_GO"</span>)</span>
<span id="cb119-18"></span>
<span id="cb119-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set rows in same order</span></span>
<span id="cb119-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#top_features_Am &lt;- top_features_Am[rownames(top_features_Host_AFDW),]</span></span>
<span id="cb119-21">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb119-22">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_energy_GO[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb119-23"></span>
<span id="cb119-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine</span></span>
<span id="cb119-25">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_features_Host_AFDW, </span>
<span id="cb119-26">                           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#top_features_Am, </span></span>
<span id="cb119-27">                           top_features_ATP_prod_GO, top_features_energy_GO)</span>
<span id="cb119-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove raw mean importance</span></span>
<span id="cb119-29">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>MeanImportance)</span>
<span id="cb119-30"></span>
<span id="cb119-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wide format: rows = miRNAs, columns = groups</span></span>
<span id="cb119-32">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb119-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> MeanImportance_norm)</span>
<span id="cb119-34"></span>
<span id="cb119-35">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(heatmap_df)</span>
<span id="cb119-36"></span>
<span id="cb119-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Melt into long format for ggplot</span></span>
<span id="cb119-38">heatmap_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(heatmap_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>)</span>
<span id="cb119-39"></span>
<span id="cb119-40"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(heatmap_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Feature, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-118-1.png" class="img-fluid"><!-- --></p>
<p>Cluster by miRNA/lncRNA/methylation importance</p>
<div class="sourceCode" id="cb120" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make Feature column the rownames and convert to matrix</span></span>
<span id="cb120-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(heatmap_df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> heatmap_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature</span>
<span id="cb120-3">heatmap_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(heatmap_df[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Removes the 'Feature' column</span></span>
<span id="cb120-4"></span>
<span id="cb120-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NAs with 0</span></span>
<span id="cb120-6">heatmap_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(heatmap_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb120-7"></span>
<span id="cb120-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(</span>
<span id="cb120-9">  heatmap_matrix, </span>
<span id="cb120-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering miRNAs (rows) by similarity in importance</span></span>
<span id="cb120-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering groups (columns)</span></span>
<span id="cb120-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># No scaling (since data is already normalized)</span></span>
<span id="cb120-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_rownames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show miRNA/lncRNA/methylation names</span></span>
<span id="cb120-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_colnames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show group names</span></span>
<span id="cb120-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Red gradient for importance</span></span>
<span id="cb120-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNAs Importance Across Groups"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Title of the heatmap</span></span>
<span id="cb120-17">)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-119-1.png" class="img-fluid"><!-- --></p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_23_timeseries_multiomic_ML_2.html</guid>
  <pubDate>Wed, 23 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul, multiomic features to predict expression. Machine learning â€“ Part 1</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_18_timeseries_multiomic_ML_1.html</link>
  <description><![CDATA[ 




<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.2-Apul-multiomic-machine-learning.Rmd">Code</a></p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.2-Apul-multiomic-machine-learning.md">Rendered code</a></p>
<p>Applying ML model using multiomic predictors â€“ miRNA + lncRNA + methylation as predictors of gene expression</p>
<p>Inputs:</p>
<ul>
<li><p>RNA counts matrix (raw): <code>../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv</code></p></li>
<li><p>Gene sets of interest: <code>../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/</code></p></li>
<li><p>sRNA/miRNA counts matrix (raw): <code>../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt</code></p></li>
<li><p>lncRNA counts matrix (raw): <code>../output/08-Apul-lncNRA/counts.txt</code></p></li>
<li><p>WGBS data (processed): Performed in <code>/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/</code>, data in <a href="https://gannet.fish.washington.edu/seashell/bu-github/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/">large-file storage</a>.</p></li>
<li><p>sample metadata: <code>../../M-multi-species/data/rna_metadata.csv</code></p></li>
</ul>
<section id="set-up" class="level1">
<h1>1 Set up</h1>
</section>
<section id="load-libraries" class="level1">
<h1>2 Load libraries</h1>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DESeq2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(psych)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidygraph)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WGCNA)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(edgeR)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reshape2)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggcorrplot)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(corrplot)</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pheatmap)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(factoextra)</span>
<span id="cb1-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(vegan)</span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggfortify)</span>
<span id="cb1-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(genefilter)</span>
<span id="cb1-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scales)</span></code></pre></div>
<p>The model includes random processes, so set a seed for reproducability. Note: for final results, should we consider bootstrapping to ensure reported results are representative?</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">703</span>)</span></code></pre></div>
</section>
<section id="load-and-format-data" class="level1">
<h1>3 Load and format data</h1>
<section id="rna-seq-data-mrna-mirna-lncrna" class="level2">
<h2 class="anchored" data-anchor-id="rna-seq-data-mrna-mirna-lncrna">3.1 RNA-seq data (mRNA, miRNA, lncRNA)</h2>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### mRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw gene counts data (will filter and variance stabilize)</span></span>
<span id="cb3-3">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span></code></pre></div>
<pre><code>## Rows: 44371 Columns: 41
## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Delimiter: ","
## chr  (1): gene_id
## dbl (40): 1A1, 1A10, 1A12, 1A2, 1A8, 1A9, 1B1, 1B10, 1B2, 1B5, 1B9, 1C10, 1C...
## 
## â„¹ Use `spec()` to retrieve the full column specification for this data.
## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format gene IDs as rownames (instead of a column)</span></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb5-5">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>gene_id)</span>
<span id="cb5-6"></span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### miRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw miRNA counts (will filter and variance stabilize)</span></span>
<span id="cb5-10">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb5-11"></span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### lncRNA </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw lncRNA counts (will filter and variance stabilize)</span></span>
<span id="cb5-15">Apul_lncRNA_full <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/08-Apul-lncRNA/counts.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-16"></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove info on genomic location, set lncRNA IDs as rownames</span></span>
<span id="cb5-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_lncRNA_full) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Geneid</span>
<span id="cb5-19">Apul_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_full <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Geneid, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Chr, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Start, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>End, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Strand, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Length)</span>
<span id="cb5-20"></span>
<span id="cb5-21"></span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### load and format metadata </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span></span>
<span id="cb5-24">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../M-multi-species/data/rna_metadata.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(AzentaSampleName, ColonyID, Timepoint) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACR"</span>, ColonyID))</span></code></pre></div>
<pre><code>## New names:
## Rows: 117 Columns: 19
## â”€â”€ Column specification
## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Delimiter: "," chr
## (13): SampleName, WellNumber, AzentaSampleName, ColonyID, Timepoint, Sam... dbl
## (5): SampleNumber, Plate, TotalAmount-ng, Volume-uL, Conc-ng.uL lgl (1):
## MethodUsedForSpectrophotometry
## â„¹ Use `spec()` to retrieve the full column specification for this data. â„¹
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## â€¢ `` -&gt; `...19`</code></pre>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span></code></pre></div>
<pre><code>## Warning: Setting row names on a tibble is deprecated.</code></pre>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">colonies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID)</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename gene column names to include full sample info</span></span>
<span id="cb9-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename miRNA column names to match formatting</span></span>
<span id="cb9-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_.*"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA))</span>
<span id="cb9-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename lncRNA colin names to include full sample info</span></span>
<span id="cb9-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"...data."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA))</span>
<span id="cb9-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".sorted.bam"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA))</span>
<span id="cb9-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span></code></pre></div>
</section>
<section id="wgbs-data" class="level2">
<h2 class="anchored" data-anchor-id="wgbs-data">3.2 WGBS data</h2>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pull processed files from Gannet </span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note: Unfortunately we can't use the `cache` feature to make this process more time efficient, as it doesn't support long vectors</span></span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the base URL</span></span>
<span id="cb10-5">base_url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://gannet.fish.washington.edu/seashell/bu-github/timeseries_molecular/D-Apul/output/15.5-Apul-bismark/"</span></span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the HTML page</span></span>
<span id="cb10-8">page <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(base_url)</span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract links to files</span></span>
<span id="cb10-11">file_links <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> page <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span>)</span>
<span id="cb10-14"></span>
<span id="cb10-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter for files ending in "processed.txt"</span></span>
<span id="cb10-16">processed_files <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> file_links[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"processed</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.txt$"</span>, file_links)]</span>
<span id="cb10-17"></span>
<span id="cb10-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create full URLs</span></span>
<span id="cb10-19">file_urls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(base_url, processed_files)</span>
<span id="cb10-20"></span>
<span id="cb10-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to read a file from URL</span></span>
<span id="cb10-22">read_processed_file <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(url) {</span>
<span id="cb10-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_table</span>(url, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read as character to avoid parsing issues</span></span>
<span id="cb10-24">}</span>
<span id="cb10-25"></span>
<span id="cb10-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import all processed files into a list</span></span>
<span id="cb10-27">processed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(file_urls, read_processed_file)</span>
<span id="cb10-28"></span>
<span id="cb10-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Name the list elements by file name</span></span>
<span id="cb10-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(processed_data) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> processed_files</span>
<span id="cb10-31"></span>
<span id="cb10-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print structure of imported data</span></span>
<span id="cb10-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(processed_data)</span>
<span id="cb10-34"></span>
<span id="cb10-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a header row that has "CpG" for the first column and "sample" for the second column, which will be populated by the file name </span></span>
<span id="cb10-36"></span>
<span id="cb10-37">processed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Map</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(df, filename) {</span>
<span id="cb10-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CpG"</span>, filename)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename columns</span></span>
<span id="cb10-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(df)</span>
<span id="cb10-40">}, processed_data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(processed_data))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use stored file names</span></span>
<span id="cb10-41"></span>
<span id="cb10-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#merge files together by "CpG"</span></span>
<span id="cb10-43">merged_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>(processed_data, full_join, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CpG"</span>)</span>
<span id="cb10-44"></span>
<span id="cb10-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print structure of final merged data</span></span>
<span id="cb10-46"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(merged_data)</span></code></pre></div>
<p>Replace any NA with 0.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert all columns (except "CpG") to numeric and replace NAs with 0</span></span>
<span id="cb11-2">merged_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, as.numeric)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert all except CpG to numeric</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace_na</span>(.x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA with 0 in numeric columns</span></span></code></pre></div>
</section>
<section id="filter-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="filter-data-sets">3.3 Filter data sets</h2>
<p>Only keep CpGs that have a non-zero value in all samples.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_all</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb12-2"></span>
<span id="cb12-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure it's formatted as a data frame</span></span>
<span id="cb12-4">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(filtered_wgbs)</span>
<span id="cb12-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep the sample information in the column name. </span></span>
<span id="cb12-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^(.*?)_.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs))</span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set CpG IDs to rownames</span></span>
<span id="cb12-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(filtered_wgbs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>CpG</span>
<span id="cb12-9">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CpG)</span>
<span id="cb12-10"></span>
<span id="cb12-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(merged_data)</span>
<span id="cb12-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(filtered_wgbs)</span></code></pre></div>
<p>We had 12,093,025 CpGs before filtering and have only 507 after filtering. This makes sense because most CpGs were not methylated in all samples.</p>
<p>Save filtered set to make code reruns/knitting quicker</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(filtered_wgbs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/22.2-Apul-multiomic-machine-learning/filtered-WGBS-CpG-counts.csv"</span>)</span></code></pre></div>
<p>If knitting/rerunning code, we can load in this filtered data here, instead of loading raw counts and reprocessing.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/22.2-Apul-multiomic-machine-learning/filtered-WGBS-CpG-counts.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<p>Only keep genes, miRNA, and lncRNA that are present in at least one sample</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes</span></span>
<span id="cb15-2">Apul_genes_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb15-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA</span></span>
<span id="cb15-4">Apul_miRNA_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb15-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lncRNA</span></span>
<span id="cb15-6">Apul_lncRNA_red <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_lncRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb15-7"></span>
<span id="cb15-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Retained "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes; "</span>,</span>
<span id="cb15-9">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" miRNA; and "</span>, </span>
<span id="cb15-10">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" of "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" lncRNA"</span>)</span></code></pre></div>
<pre><code>## Retained  35869  of  44371 genes;  51  of  51  miRNA; and  20559  of  24181  lncRNA</code></pre>
<p><em>pOverA</em>: Specifying the minimum count for a proportion of samples for each gene. Setting 3/40 = 0.08. This would retain genes that are only expressed in a single season in a couple of the colonies. Additionally, setting the minimum count so that the minimum number of samples must have a gene count above a certain threshold.</p>
<p>genes:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb17-2"></span>
<span id="cb17-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb17-4">gfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_genes_red, filt)</span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb17-7">gkeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_red[gfilt,]</span>
<span id="cb17-8"></span>
<span id="cb17-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify gene lists</span></span>
<span id="cb17-10">gn.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(gkeep)</span>
<span id="cb17-11"></span>
<span id="cb17-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#gene count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb17-13">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> gn.keep),])</span>
<span id="cb17-14"></span>
<span id="cb17-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb17-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 35869 ; Post-filtering: 25730</code></pre>
<p>miRNA:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb19-4">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_miRNA_red, mifilt)</span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA to keep by count filter</span></span>
<span id="cb19-7">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb19-8"></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA to keep by count filter</span></span>
<span id="cb19-10">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb19-11"></span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify miRNA lists</span></span>
<span id="cb19-13">mi.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(mikeep)</span>
<span id="cb19-14"></span>
<span id="cb19-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#miRNA count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb19-16">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_miRNA_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> mi.keep),])</span>
<span id="cb19-17"></span>
<span id="cb19-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb19-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 51 ; Post-filtering: 47</code></pre>
<p>Of the 51 miRNA, 47 were retained. Which were removed?</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## [1] "Cluster_5685"  "Cluster_11565" "Cluster_13647" "Cluster_14633"</code></pre>
<p>lncRNA:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">lncfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb23-2"></span>
<span id="cb23-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb23-4">lncfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_lncRNA_red, lncfilt)</span>
<span id="cb23-5"></span>
<span id="cb23-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA to keep by count filter</span></span>
<span id="cb23-7">lnckeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_red[lncfilt,]</span>
<span id="cb23-8"></span>
<span id="cb23-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA to keep by count filter</span></span>
<span id="cb23-10">lnckeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_red[lncfilt,]</span>
<span id="cb23-11"></span>
<span id="cb23-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify lncRNA lists</span></span>
<span id="cb23-13">lnc.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(lnckeep)</span>
<span id="cb23-14"></span>
<span id="cb23-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#lncRNA count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb23-16">Apul_lncRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_lncRNA_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_lncRNA_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> lnc.keep),])</span>
<span id="cb23-17"></span>
<span id="cb23-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb23-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pre-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_red), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; Post-filtering:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_lncRNA_filt))</span></code></pre></div>
<pre><code>## Pre-filtering: 20559 ; Post-filtering: 16006</code></pre>
</section>
<section id="transform-data" class="level2">
<h2 class="anchored" data-anchor-id="transform-data">3.4 Transform data</h2>
<p>Set the order of genes, miRNA, lncRNA, wgbs, and metadata to all be the same.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure rownames of metadata are used as the desired column order</span></span>
<span id="cb25-2">desired_order <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata)</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reorder data frame columns</span></span>
<span id="cb25-5">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_filt[, desired_order]</span>
<span id="cb25-6">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt[, desired_order]</span>
<span id="cb25-7">Apul_lncRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_lncRNA_filt[, desired_order]</span>
<span id="cb25-8">filtered_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_wgbs[, desired_order]</span>
<span id="cb25-9"></span>
<span id="cb25-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check they all match</span></span>
<span id="cb25-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_lncRNA_filt))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(metadata), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(filtered_wgbs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Use a variance stabilized transformation for all four data sets. Variance stabilization essentially tries to make variance independent of the mean</p>
<p>(Is this the most appropriate design to use?)</p>
<p>genes:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_genes_filt, </span>
<span id="cb33-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb33-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## converting counts to integer mode

## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb35-2">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<p>miRNA:</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_miRNA_filt, </span>
<span id="cb36-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb36-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb38-2">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Must use varianceStabilizingTransformation() instead of vst() due to few input genes</span></span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA)</span></code></pre></div>
<p>lncRNA:</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">dds_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_lncRNA_filt, </span>
<span id="cb41-2">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb41-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb43-2">vsd_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_lncRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<p>Must round wgbs data to whole integers for normalization - need to return to this to decide if this is appropriate.</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#round to integers </span></span>
<span id="cb44-2">filtered_wgbs<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>filtered_wgbs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), round))</span>
<span id="cb44-3"></span>
<span id="cb44-4">dds_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> filtered_wgbs, </span>
<span id="cb44-5">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata, </span>
<span id="cb44-6">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## converting counts to integer mode

## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance Stabilizing Transformation</span></span>
<span id="cb46-2">vsd_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_wgbs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]

## -- note: fitType='parametric', but the dispersion trend was not well captured by the
##    function: y = a/x + b, and a local regression fit was automatically substituted.
##    specify fitType='local' or 'mean' to avoid this message next time.</code></pre>
</section>
<section id="islolate-gene-sets" class="level2">
<h2 class="anchored" data-anchor-id="islolate-gene-sets">3.5 Islolate gene sets</h2>
<p>Read in gene set tables</p>
<div class="sourceCode" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes from WGCNA modules significantly correlated with host biomass</span></span>
<span id="cb48-2">Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/Host_AFDW.mg.cm2_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb48-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes from WGCNA modules significantly correlated with symbiont photosynthesis</span></span>
<span id="cb48-4">Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/Am_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb48-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GO terms related to energy production/usage</span></span>
<span id="cb48-6">ATP_production_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/ATP_production_GO_terms_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb48-7">energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/energy_usage_storage_GO_terms_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<p>Isolate filtered counts by gene set</p>
<div class="sourceCode" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">vsd_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span>
<span id="cb49-2">vsd_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span>
<span id="cb49-3">vsd_ATP_production_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ATP_production_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span>
<span id="cb49-4">vsd_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id,]</span></code></pre></div>
</section>
</section>
<section id="feature-selection" class="level1">
<h1>4 Feature selection</h1>
<p>Reduce dimensionality through feature selection.</p>
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_genes)</span></code></pre></div>
<pre><code>## [1] 25730</code></pre>
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_miRNA)</span></code></pre></div>
<pre><code>## [1] 47</code></pre>
<div class="sourceCode" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_lncRNA)</span></code></pre></div>
<pre><code>## [1] 16006</code></pre>
<div class="sourceCode" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_wgbs)</span></code></pre></div>
<pre><code>## [1] 507</code></pre>
<div class="sourceCode" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_Host_AFDW)</span></code></pre></div>
<pre><code>## [1] 793</code></pre>
<div class="sourceCode" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_Am)</span></code></pre></div>
<pre><code>## [1] 5746</code></pre>
<div class="sourceCode" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_ATP_production_GO)</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<div class="sourceCode" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(vsd_energy_GO)</span></code></pre></div>
<pre><code>## [1] 284</code></pre>
<p>The genes, lncRNA, and WGBS sets are very large, so we need to reduce using dimensionality reduction. Weâ€™ll need to do the same for the gene sets, which are also fairly large.</p>
<section id="all-genes" class="level2">
<h2 class="anchored" data-anchor-id="all-genes">4.1 All genes</h2>
<div class="sourceCode" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene expression matrix</span></span>
<span id="cb67-2">pca_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_genes), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb67-3"></span>
<span id="cb67-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb67-5">explained_var_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_genes)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb67-6">num_pcs_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb67-7"></span>
<span id="cb67-8">genes_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_genes])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb67-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(genes_pcs)</span></code></pre></div>
<pre><code>## [1] 40 30</code></pre>
<p>30 PCs summarize 95% of the explained variance in all gene expression</p>
</section>
<section id="lncrna" class="level2">
<h2 class="anchored" data-anchor-id="lncrna">4.2 lncRNA</h2>
<div class="sourceCode" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on lncRNA expression matrix</span></span>
<span id="cb69-2">pca_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_lncRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb69-3"></span>
<span id="cb69-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb69-5">explained_var_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_lncRNA)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb69-6">num_pcs_lncRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_lncRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb69-7"></span>
<span id="cb69-8">lncRNA_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_lncRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_lncRNA])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb69-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(lncRNA_pcs)</span></code></pre></div>
<pre><code>## [1] 40 31</code></pre>
<p>31 PCs summarize 95% of the explained variance in lncRNA expression</p>
</section>
<section id="mirna" class="level2">
<h2 class="anchored" data-anchor-id="mirna">4.3 miRNA</h2>
<div class="sourceCode" id="cb71" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on miRNA expression matrix</span></span>
<span id="cb71-2">pca_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb71-3"></span>
<span id="cb71-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb71-5">explained_var_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_miRNA)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb71-6">num_pcs_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb71-7"></span>
<span id="cb71-8">miRNA_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_miRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_miRNA])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb71-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(miRNA_pcs)</span></code></pre></div>
<pre><code>## [1] 40 20</code></pre>
<p>20 PCs summarize 95% of the explained variance in miRNA expression</p>
</section>
<section id="wgbs" class="level2">
<h2 class="anchored" data-anchor-id="wgbs">4.4 WGBS</h2>
<div class="sourceCode" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on WGBS CpG matrix</span></span>
<span id="cb73-2">pca_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_wgbs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb73-3"></span>
<span id="cb73-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb73-5">explained_var_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_wgbs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb73-6">num_pcs_wgbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_wgbs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb73-7"></span>
<span id="cb73-8">wgbs_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_wgbs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_wgbs])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb73-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(wgbs_pcs)</span></code></pre></div>
<pre><code>## [1] 40 30</code></pre>
<p>30 PCs summarize 95% of the explained variance in methylation</p>
</section>
<section id="host_afdw" class="level2">
<h2 class="anchored" data-anchor-id="host_afdw">4.5 Host_AFDW</h2>
<div class="sourceCode" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene set matrix</span></span>
<span id="cb75-2">pca_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_Host_AFDW), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb75-3"></span>
<span id="cb75-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb75-5">explained_var_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_Host_AFDW)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb75-6">num_pcs_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_Host_AFDW) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% cumulative variance</span></span>
<span id="cb75-7"></span>
<span id="cb75-8">Host_AFDW_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_Host_AFDW])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb75-9"></span>
<span id="cb75-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(Host_AFDW_pcs)</span></code></pre></div>
<pre><code>## [1] 40 29</code></pre>
<p>29 PCs summarize 95% of the explained variance in genes associated with host biomass (Host AFDW)</p>
</section>
<section id="am" class="level2">
<h2 class="anchored" data-anchor-id="am">4.6 Am</h2>
<p>Reduce dimensionality</p>
<div class="sourceCode" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene set expression matrix</span></span>
<span id="cb77-2">pca_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_Am), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb77-3"></span>
<span id="cb77-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb77-5">explained_var_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_Am)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb77-6">num_pcs_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_Am) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% cumulative variance</span></span>
<span id="cb77-7"></span>
<span id="cb77-8">Am_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_Am])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb77-9"></span>
<span id="cb77-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(Am_pcs)</span></code></pre></div>
<pre><code>## [1] 40 30</code></pre>
<p>30 PCs summarize 95% of the explained variance in genes associated with symbiont photosynthesis (Am)</p>
</section>
<section id="atp-production-go-terms" class="level2">
<h2 class="anchored" data-anchor-id="atp-production-go-terms">4.7 ATP production GO terms</h2>
<p>Reduce dimensionality</p>
<div class="sourceCode" id="cb79" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene set expression matrix</span></span>
<span id="cb79-2">pca_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_ATP_production_GO), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb79-3"></span>
<span id="cb79-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb79-5">explained_var_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_ATP_prod_GO)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb79-6">num_pcs_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_ATP_prod_GO) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% cumulative variance</span></span>
<span id="cb79-7"></span>
<span id="cb79-8">ATP_prod_GO_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_ATP_prod_GO])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb79-9"></span>
<span id="cb79-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(ATP_prod_GO_pcs)</span></code></pre></div>
<pre><code>## [1] 40 11</code></pre>
<p>11 PCs summarize 95% of the explained variance in genes annotated with ATP production GO terms</p>
</section>
<section id="energy-usagestorage-go-terms" class="level2">
<h2 class="anchored" data-anchor-id="energy-usagestorage-go-terms">4.8 Energy usage/storage GO terms</h2>
<p>Reduce dimensionality</p>
<div class="sourceCode" id="cb81" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene set expression matrix</span></span>
<span id="cb81-2">pca_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_energy_GO), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb81-3"></span>
<span id="cb81-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb81-5">explained_var_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_energy_GO)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb81-6">num_pcs_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_energy_GO) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% cumulative variance</span></span>
<span id="cb81-7"></span>
<span id="cb81-8">energy_GO_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_energy_GO])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb81-9"></span>
<span id="cb81-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(energy_GO_pcs)</span></code></pre></div>
<pre><code>## [1] 40 27</code></pre>
<p>27 PCs summarize 95% of the explained variance in genes annotated with ATP production GO terms</p>
</section>
</section>
<section id="merge-predictor-features" class="level1">
<h1>5 Merge predictor features</h1>
<section id="merge-reduced-datasets" class="level2">
<h2 class="anchored" data-anchor-id="merge-reduced-datasets">5.1 Merge reduced datasets</h2>
<p>I want to use miRNA, lncRNA, and methylation (WGBS) as predictors for gene expression, so I need to merge the features of these three data sets.</p>
<div class="sourceCode" id="cb83" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note which dataset each lncRNA and WGBS PC is associated with</span></span>
<span id="cb83-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(lncRNA_pcs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(lncRNA_pcs), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_lncRNA"</span>)</span>
<span id="cb83-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_pcs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_pcs), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_miRNA"</span>)</span>
<span id="cb83-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(wgbs_pcs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(wgbs_pcs), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_WGBS"</span>)</span>
<span id="cb83-5"></span>
<span id="cb83-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Triple check that all three data frames have sample names in the same order</span></span>
<span id="cb83-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(lncRNA_pcs), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(wgbs_pcs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb85" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(lncRNA_pcs), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(miRNA_pcs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb87" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind (stack dataframes horizontally)</span></span>
<span id="cb87-2">full_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(lncRNA_pcs, miRNA_pcs, wgbs_pcs)</span>
<span id="cb87-3"></span>
<span id="cb87-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(full_pred)</span></code></pre></div>
<pre><code>##             PC1_lncRNA PC2_lncRNA PC3_lncRNA PC4_lncRNA  PC5_lncRNA PC6_lncRNA
## ACR-225-TP1 -16.652946  73.328741  -4.900662   23.63265 -15.5434633 18.6993987
## ACR-225-TP2 -64.415273 -39.989770  25.849109   31.36694  -2.7418550 16.8817935
## ACR-225-TP3   7.426632   3.836323   2.613068  -18.79839  -2.1512861  8.4294017
## ACR-225-TP4 -44.525340 -22.405730 -26.727351  -12.11801   9.4110284  5.1441162
## ACR-229-TP1 -56.226873   1.285908  -4.624646  -17.85891   0.4800111  0.9084579
## ACR-229-TP2 -23.046364  25.786839  21.772068  -18.73687  -7.1031312 -0.7275392
##             PC7_lncRNA PC8_lncRNA PC9_lncRNA PC10_lncRNA PC11_lncRNA
## ACR-225-TP1  -6.606146   3.907170 -24.668541    2.700613  -19.570934
## ACR-225-TP2  -6.297825  10.732377  42.589155   24.811017  -26.751535
## ACR-225-TP3  -1.467871 -17.039753  27.992788  -71.853887  -42.845320
## ACR-225-TP4  18.329047  -4.863639   6.499017  -61.577003  -25.414126
## ACR-229-TP1  25.162031 -37.787739  -4.995677   10.091432    5.796247
## ACR-229-TP2   9.430113 -63.615657  14.032926   20.235658   -1.191159
##             PC12_lncRNA PC13_lncRNA PC14_lncRNA PC15_lncRNA PC16_lncRNA
## ACR-225-TP1   14.521305   -2.262914  -41.957968    5.820290   8.3988888
## ACR-225-TP2   23.931986    6.942925    1.163011   -9.992572   8.1105349
## ACR-225-TP3  -13.762339    1.103723   -5.710279   -5.183437  -3.1364670
## ACR-225-TP4  -11.896056   22.104165    2.714092    2.601415   0.1158628
## ACR-229-TP1   -9.434515    6.262263   -1.934178    7.166601   7.3463125
## ACR-229-TP2  -12.910408   -6.829857    2.837974   18.804798  10.0055494
##             PC17_lncRNA PC18_lncRNA PC19_lncRNA PC20_lncRNA PC21_lncRNA
## ACR-225-TP1  -11.414071   -8.144753   -7.129114   -5.766714   0.3039167
## ACR-225-TP2    8.257330  -12.779865    2.255193   14.444535  -3.5473589
## ACR-225-TP3    5.373520    4.439530    4.525741   -6.271834   2.2093061
## ACR-225-TP4   -7.026531   -6.954813   -7.076966   10.860342  -3.9469359
## ACR-229-TP1    3.321744    4.570894    3.865441    6.583016  -1.3653023
## ACR-229-TP2   -7.968622   12.486084    7.597807    5.465330  -3.8226527
##             PC22_lncRNA PC23_lncRNA  PC24_lncRNA PC25_lncRNA PC26_lncRNA
## ACR-225-TP1  3.33621967   6.2624463   7.12577766  -1.1624725  -2.4803030
## ACR-225-TP2 10.36360595  -2.2710427   0.09666598   0.8515688  -0.3120913
## ACR-225-TP3  1.10178240  -3.6705225 -10.74023891  14.7092812 -31.1962830
## ACR-225-TP4 -0.01032393   9.5566511   8.46526275 -15.0129144  38.2439731
## ACR-229-TP1  9.56966429   0.5830298   4.66792421  -5.1182417   0.3595885
## ACR-229-TP2  0.79390943  15.1861516  15.35476257  -4.6161473   8.6759452
##             PC27_lncRNA PC28_lncRNA PC29_lncRNA PC30_lncRNA PC31_lncRNA
## ACR-225-TP1   -3.354632   -1.019635  -3.4401091    1.043338    1.360794
## ACR-225-TP2    1.365050   -1.387810   0.7383812   -1.806439   -1.272689
## ACR-225-TP3    7.629537   25.437233   5.4302405   13.490468   -3.264919
## ACR-225-TP4   -7.281209  -28.557006  -3.6872263  -16.900518    5.777254
## ACR-229-TP1   -3.147646   -6.305934  11.2241848    3.291629   -5.355760
## ACR-229-TP2    6.612615    5.732498  32.6675771   -2.783756    1.239237
##             PC1_miRNA   PC2_miRNA  PC3_miRNA   PC4_miRNA   PC5_miRNA  PC6_miRNA
## ACR-225-TP1  2.798740 -1.60103790  0.3902826 -2.78416979  2.89850841 -1.9126175
## ACR-225-TP2 -2.006672  2.35384472  3.3094108  0.68396712  1.00642619 -2.7188868
## ACR-225-TP3  3.402678  0.03989579  2.7920820 -0.98471667 -0.04969853  0.5269023
## ACR-225-TP4  1.743162 -0.74508972  1.7601194 -1.62529700  2.43570856 -1.1716437
## ACR-229-TP1 -1.684434 -3.73740125 -0.7669801 -2.64001620  2.58499410 -1.9776859
## ACR-229-TP2 -3.660540 -1.78878170  1.2071028 -0.01069494  0.49089503 -0.8033196
##              PC7_miRNA  PC8_miRNA   PC9_miRNA PC10_miRNA  PC11_miRNA PC12_miRNA
## ACR-225-TP1  0.4024505 -1.7868230  1.17633110 -0.8139795  0.84528773 -0.5757136
## ACR-225-TP2 -0.2493649 -3.5015635 -0.01719534 -0.3481687 -1.19223681 -0.5321468
## ACR-225-TP3  3.1542881 -3.1946856  0.81511665 -2.1479615  0.02257447 -0.3650203
## ACR-225-TP4 -0.6827463 -1.1612550  1.71987368 -1.2097857 -0.69841499 -0.4210997
## ACR-229-TP1  1.3091331  0.6514011 -1.91405432  0.4606718  1.11677702 -1.7419935
## ACR-229-TP2  1.2042832  1.1837645 -2.59581592  0.8979452 -0.30985309  1.1755465
##             PC13_miRNA PC14_miRNA PC15_miRNA  PC16_miRNA  PC17_miRNA PC18_miRNA
## ACR-225-TP1  0.2554555 -0.1297357 -0.4883509  1.38110641  0.16749476 -0.5965978
## ACR-225-TP2 -0.1981750 -0.9609219 -0.1396524 -1.67384952  1.62178054 -0.4466742
## ACR-225-TP3 -1.5374296  0.6401065 -0.5767027 -0.68668664 -1.05804473 -0.3272770
## ACR-225-TP4  1.8524932  0.6855648 -0.5112841  0.07760664 -0.18793380  0.9265410
## ACR-229-TP1  0.8215141  1.3028887  0.4432213 -0.30498022  0.09989403  0.2487335
## ACR-229-TP2 -0.6203428  0.6040737 -0.4276845 -1.61714671  0.63347585 -0.5473325
##              PC19_miRNA  PC20_miRNA   PC1_WGBS   PC2_WGBS   PC3_WGBS   PC4_WGBS
## ACR-225-TP1 -0.17349545  0.03586059 -47.371386 -7.4281666 -15.911669 -1.9801404
## ACR-225-TP2 -0.89143615  0.46667292   3.763531 -8.1177745   5.056844 -0.5106781
## ACR-225-TP3  0.34320992 -0.41047389   3.784780 -7.2719899   6.449627  2.5534316
## ACR-225-TP4  0.37380836 -0.74593072   3.149372 -6.2894599   3.109440  3.4838126
## ACR-229-TP1 -0.39021763 -0.16141186   4.620443  0.7863283  -1.764767 -5.1060003
## ACR-229-TP2  0.08006026  0.19192730   4.614269 -0.2214307  -3.036966 -4.6587985
##             PC5_WGBS    PC6_WGBS  PC7_WGBS    PC8_WGBS   PC9_WGBS  PC10_WGBS
## ACR-225-TP1 4.817743  -1.2987551  2.268259  -0.5752089  2.1437705 -0.1523134
## ACR-225-TP2 1.632951 -10.3927327  4.563777  -4.8349365  1.9806328 -6.6701787
## ACR-225-TP3 6.117338  -5.9982021  4.682503 -13.7502728  7.4823613  1.5927329
## ACR-225-TP4 2.596055  -7.8141716  4.917917  -9.3518752  2.0215227  0.8340144
## ACR-229-TP1 3.500710   0.7757339 12.436617   5.2231857 -2.6032216  4.1532102
## ACR-229-TP2 3.681378  -0.4584829 10.458070   5.2523072 -0.6308566 -0.2433186
##              PC11_WGBS  PC12_WGBS  PC13_WGBS  PC14_WGBS  PC15_WGBS  PC16_WGBS
## ACR-225-TP1  1.1999889 -0.2133351 -0.2022223  1.1702454 -0.3240623 -0.4613926
## ACR-225-TP2 -2.0992700  3.7117384 -2.7824001  1.8365265 -3.3164335 -1.6319654
## ACR-225-TP3 -2.0633762 -5.4812552  3.0632119 -2.9768045 -2.4804053 -1.7654961
## ACR-225-TP4 -0.2796565  5.7409197 -0.9415802  1.2707304  7.0430354  2.5553601
## ACR-229-TP1 -0.2271934 -0.7732254  0.2543079  2.5133914  0.4451549  4.8256273
## ACR-229-TP2  1.6555274 -0.6643908  1.0330861 -0.2804019  1.0525279  0.4234749
##              PC17_WGBS   PC18_WGBS  PC19_WGBS PC20_WGBS  PC21_WGBS  PC22_WGBS
## ACR-225-TP1  0.2556796  0.04848013  0.1379598  0.163844  0.4163461 -0.2478828
## ACR-225-TP2  4.0691392  6.21452411 -5.3580039 -2.696985  1.7539712  1.0939080
## ACR-225-TP3  2.3378453 -6.08085670  2.2829177  3.437195 -0.2178858  3.0976112
## ACR-225-TP4 -2.2242573  2.59441480  3.1965907 -1.718827 -1.3134491 -6.1534216
## ACR-229-TP1  1.9901032  1.68799711 -2.4572699  4.012089 -1.8905085  1.9925271
## ACR-229-TP2  1.3819023  0.49627020  0.2958164 -1.487058  2.5702578  1.6684459
##               PC23_WGBS  PC24_WGBS  PC25_WGBS   PC26_WGBS   PC27_WGBS
## ACR-225-TP1 -0.01477822 -0.4024602  0.2823349  0.09620127  0.19132873
## ACR-225-TP2 -2.83840621  0.3542538  2.0758895  1.60663820  0.05388139
## ACR-225-TP3 -0.23924425 -0.4659744 -0.3007130  0.26198619 -0.23169049
## ACR-225-TP4  2.94984959  0.9442884 -2.2553056 -0.51859589 -0.02708711
## ACR-229-TP1  2.35415772 -2.9270652  0.4592204  2.00858242 -0.73890630
## ACR-229-TP2  0.25382606  1.4273242 -0.6150447 -2.84497287  0.11903672
##               PC28_WGBS   PC29_WGBS  PC30_WGBS
## ACR-225-TP1  0.02296127  0.31068945 -0.3600702
## ACR-225-TP2  2.45735398 -0.01454505  0.6784057
## ACR-225-TP3 -1.85458312 -0.53013267 -0.3520069
## ACR-225-TP4  0.20395801 -0.80341258 -1.4896686
## ACR-229-TP1  0.24333281 -2.07909037 -2.5953092
## ACR-229-TP2 -3.70723373 -2.71780970  3.1118242</code></pre>
</section>
<section id="merge-raw-datsets" class="level2">
<h2 class="anchored" data-anchor-id="merge-raw-datsets">5.2 Merge raw datsets</h2>
<p>I also want to try using individiual miRNA/lncRNA/CpGs as predictors, instead of the reduced PCs. Letâ€™s also create a merged dataset that contains the variance stabilized counts for all miRNA, lncRNA, and CpGs.</p>
<div class="sourceCode" id="cb89" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Triple check that all three data frames have sample names in the same order</span></span>
<span id="cb89-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_lncRNA), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_miRNA))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb91" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_lncRNA), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_wgbs))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb93" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind (stack dataframes vertically, so that they match by column/sample)</span></span>
<span id="cb93-2">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(vsd_lncRNA, vsd_miRNA, vsd_wgbs)</span>
<span id="cb93-3"></span>
<span id="cb93-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform so that samples are on rows and features are in columns</span></span>
<span id="cb93-5">full_pred_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(full_pred_counts)</span>
<span id="cb93-6"></span>
<span id="cb93-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(full_pred_counts)</span></code></pre></div>
<pre><code>## [1]    40 16560</code></pre>
<p>Ok, now we can run the model!</p>
<p>The below code uses both predictors (miRNA+lncRNA+CpGs) and responses (genes) that have been reduced using PCs.</p>
</section>
</section>
<section id="all-genes-1" class="level1">
<h1>7 All genes</h1>
<p>Letâ€™s start by just throwing all our genes in.</p>
<p>miRNA + lncRNA + methylation as predictors of expression for all genes</p>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">7.1 The model</h2>
<div class="sourceCode" id="cb95" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure sample matching between gene and miRNA+lncRNA+methylation PCs</span></span>
<span id="cb95-2">common_samples <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(genes_pcs), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(full_pred))</span>
<span id="cb95-3">genes_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> genes_pcs[common_samples, ]</span>
<span id="cb95-4">full_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> full_pred[common_samples, ]</span></code></pre></div>
<p>Train elastic models to predict gene expression PCs from miRNA+lncRNA+methylation PCs.</p>
<div class="sourceCode" id="cb96" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1">train_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_pcs, predictor_pcs) {</span>
<span id="cb96-2">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb96-3">  </span>
<span id="cb96-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb96-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gene expression PC</span></span>
<span id="cb96-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA+lncRNA+methylation PCs as predictors</span></span>
<span id="cb96-7">    </span>
<span id="cb96-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train elastic net model (alpha = 0.5 for mix of LASSO &amp; Ridge)</span></span>
<span id="cb96-9">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb96-10">    </span>
<span id="cb96-11">    models[[pc]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb96-12">  }</span>
<span id="cb96-13">  </span>
<span id="cb96-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(models)</span>
<span id="cb96-15">}</span>
<span id="cb96-16"></span>
<span id="cb96-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA+lncRNA+methylation PCs</span></span>
<span id="cb96-18">models_all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(genes_pcs, full_pred)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb97" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1">get_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models) {</span>
<span id="cb97-2">  importance_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb97-3">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to regular matrix &amp; remove intercept</span></span>
<span id="cb97-4">    </span>
<span id="cb97-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb97-6">    coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs))</span>
<span id="cb97-7">    </span>
<span id="cb97-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df)</span>
<span id="cb97-9">  })</span>
<span id="cb97-10">  </span>
<span id="cb97-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature importance across all predicted gene PCs</span></span>
<span id="cb97-12">  importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(importance_list) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb97-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb97-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Importance)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb97-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb97-16">  </span>
<span id="cb97-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(importance_df)</span>
<span id="cb97-18">}</span>
<span id="cb97-19"></span>
<span id="cb97-20">feature_importance_all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_all)</span>
<span id="cb97-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_all, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top 20 predictive epigenetic features</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature    MeanImportance
##    &lt;chr&gt;               &lt;dbl&gt;
##  1 PC16_miRNA          1.03 
##  2 PC18_miRNA          0.895
##  3 PC9_miRNA           0.687
##  4 PC17_miRNA          0.626
##  5 PC14_miRNA          0.618
##  6 PC11_miRNA          0.614
##  7 PC15_miRNA          0.600
##  8 PC7_miRNA           0.595
##  9 PC12_miRNA          0.586
## 10 PC10_miRNA          0.577
## 11 PC19_miRNA          0.576
## 12 PC20_miRNA          0.562
## 13 PC5_miRNA           0.448
## 14 PC6_miRNA           0.442
## 15 PC13_miRNA          0.438
## 16 PC4_miRNA           0.418
## 17 PC2_miRNA           0.410
## 18 PC8_miRNA           0.397
## 19 PC3_miRNA           0.365
## 20 PC1_miRNA           0.327</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb99" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1">evaluate_model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models, response_pcs, predictor_pcs) {</span>
<span id="cb99-2">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb99-3">  </span>
<span id="cb99-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb99-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]</span>
<span id="cb99-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)</span>
<span id="cb99-7">    </span>
<span id="cb99-8">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models[[pc]]</span>
<span id="cb99-9">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb99-10">    </span>
<span id="cb99-11">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R-squared metric</span></span>
<span id="cb99-12">    results[results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> pc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb99-13">  }</span>
<span id="cb99-14">  </span>
<span id="cb99-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb99-16">}</span>
<span id="cb99-17"></span>
<span id="cb99-18">performance_results_all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_all, genes_pcs, full_pred)</span>
<span id="cb99-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.1811  0.8549  0.9812  0.8504  0.9984  0.9992       4</code></pre>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">7.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb101" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 predictive features</span></span>
<span id="cb101-2">top_features_all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_all <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, MeanImportance)</span>
<span id="cb101-3"></span>
<span id="cb101-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb101-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_all, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb101-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb101-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb101-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb101-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top 20 Predictive Epigenetic Features"</span>,</span>
<span id="cb101-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb101-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-35-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb102" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_all, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb102-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb102-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb102-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb102-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb102-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb102-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb102-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 4 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-36-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb104" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mean explained variance</span></span>
<span id="cb104-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(performance_results_all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2))</span></code></pre></div>
<pre><code>## [1] 0.8666667</code></pre>
<p>View components associated with PCs (need to fix this code to work with the hybrid predictive input)</p>
<div class="sourceCode" id="cb106" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Get the PCA rotation (loadings) matrix from each PCA</span></span>
<span id="cb106-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lncRNA_loadings &lt;- pca_lncRNA$rotation  # Each column corresponds to a PC</span></span>
<span id="cb106-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA_loadings &lt;- pca_miRNA$rotation  # Each column corresponds to a PC</span></span>
<span id="cb106-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># wgbs_loadings &lt;- pca_wgbs$rotation  # Each column corresponds to a PC</span></span>
<span id="cb106-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb106-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Identify the top predictive PCs (from feature importance)</span></span>
<span id="cb106-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># all_top_predictive_pcs &lt;- feature_importance_all$Feature[1:5]  # Select top 5 most predictive PCs</span></span>
<span id="cb106-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb106-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Extract the loadings for those PCs</span></span>
<span id="cb106-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># top_loadings &lt;- wgbs_loadings[, top_predictive_pcs, drop = FALSE]</span></span>
<span id="cb106-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb106-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Convert to data frame and reshape for plotting</span></span>
<span id="cb106-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># top_loadings_df &lt;- as.data.frame(top_loadings) %&gt;%</span></span>
<span id="cb106-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   rownames_to_column(var = "CpG") %&gt;%</span></span>
<span id="cb106-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   pivot_longer(-CpG, names_to = "Methylation_PC", values_to = "Loading")</span></span>
<span id="cb106-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb106-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # View top CpGs contributing most to each PC</span></span>
<span id="cb106-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># top_cpgs &lt;- top_loadings_df %&gt;%</span></span>
<span id="cb106-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   group_by(Methylation_PC) %&gt;%</span></span>
<span id="cb106-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   arrange(desc(abs(Loading))) %&gt;%</span></span>
<span id="cb106-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   slice_head(n = 20)  # Select top 10 CpGs per PC</span></span>
<span id="cb106-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb106-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(top_cpgs)</span></span></code></pre></div>
<p>View top 20 CpGs associated with PC9 (the most important PC)</p>
<div class="sourceCode" id="cb107" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(top_cpgs%&gt;%filter(Methylation_PC=="PC9"))</span></span></code></pre></div>
<div class="sourceCode" id="cb108" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggplot(top_cpgs, aes(x = reorder(CpG, abs(Loading)), y = Loading, fill = Methylation_PC)) +</span></span>
<span id="cb108-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   geom_bar(stat = "identity") +</span></span>
<span id="cb108-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   coord_flip() +  </span></span>
<span id="cb108-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   theme_minimal() +</span></span>
<span id="cb108-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   labs(title = "Top CpGs Contributing to Most Predictive Methylation PCs",</span></span>
<span id="cb108-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#        x = "CpG Site",</span></span>
<span id="cb108-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#        y = "Loading Strength") +</span></span>
<span id="cb108-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   facet_grid(~Methylation_PC, scales = "free_y")  # Separate plots for each PC</span></span></code></pre></div>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb109" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb109-2">best_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb109-3"></span>
<span id="cb109-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb109-5">actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> genes_pcs[[best_pc]]</span>
<span id="cb109-6">predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_all[[best_pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb109-7"></span>
<span id="cb109-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb109-9">prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb109-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb109-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb109-12">)</span>
<span id="cb109-13"></span>
<span id="cb109-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb109-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb109-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb109-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb109-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb109-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc),</span>
<span id="cb109-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb109-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb109-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb109-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb109-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-41-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb111" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_all, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb111-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb111-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb111-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribution of Predictive Performance (RÂ²) Across PCs"</span>,</span>
<span id="cb111-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 4 rows containing non-finite outside the scale range
## (`stat_boxplot()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-42-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb113" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation between actual and predicted gene expression PCs</span></span>
<span id="cb113-2">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(models_all, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))</span>
<span id="cb113-3"></span>
<span id="cb113-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure matrices are the same size</span></span>
<span id="cb113-5">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(genes_pcs), drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align columns</span></span>
<span id="cb113-6"></span>
<span id="cb113-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove 0 variance columns</span></span>
<span id="cb113-8">predicted_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predicted_matrix[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(predicted_matrix, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(col) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb113-9"></span>
<span id="cb113-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation matrix, handling missing values</span></span>
<span id="cb113-11">cor_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(predicted_matrix, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(genes_pcs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"complete.obs"</span>)</span>
<span id="cb113-12"></span>
<span id="cb113-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NA or Inf values with zero</span></span>
<span id="cb113-14">cor_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.infinite</span>(cor_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb113-15"></span>
<span id="cb113-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb113-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(cor_matrix, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb113-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Between Actual and Predicted Gene Expression PCs"</span>,</span>
<span id="cb113-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb113-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb113-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-43-1.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="host-biomass-host_afdw" class="level1">
<h1>8 Host biomass (Host_AFDW)</h1>
<section id="the-model-1" class="level2">
<h2 class="anchored" data-anchor-id="the-model-1">8.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression.</p>
<div class="sourceCode" id="cb114" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1">train_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_pcs, predictor_pcs) {</span>
<span id="cb114-2">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb114-3">  </span>
<span id="cb114-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb114-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gene expression PC</span></span>
<span id="cb114-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA+lncRNA+methylation PCs as predictors</span></span>
<span id="cb114-7">    </span>
<span id="cb114-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train elastic net model (alpha = 0.5 for mix of LASSO &amp; Ridge)</span></span>
<span id="cb114-9">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb114-10">    </span>
<span id="cb114-11">    models[[pc]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb114-12">  }</span>
<span id="cb114-13">  </span>
<span id="cb114-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(models)</span>
<span id="cb114-15">}</span>
<span id="cb114-16"></span>
<span id="cb114-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA+lncRNA+methylation PCs</span></span>
<span id="cb114-18">models_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(Host_AFDW_pcs, full_pred)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb115" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1">get_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models) {</span>
<span id="cb115-2">  importance_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb115-3">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to regular matrix &amp; remove intercept</span></span>
<span id="cb115-4">    </span>
<span id="cb115-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb115-6">    coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs))</span>
<span id="cb115-7">    </span>
<span id="cb115-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df)</span>
<span id="cb115-9">  })</span>
<span id="cb115-10">  </span>
<span id="cb115-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature importance across all predicted gene PCs</span></span>
<span id="cb115-12">  importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(importance_list) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb115-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb115-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Importance)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb115-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb115-16">  </span>
<span id="cb115-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(importance_df)</span>
<span id="cb115-18">}</span>
<span id="cb115-19"></span>
<span id="cb115-20">feature_importance_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_Host_AFDW)</span>
<span id="cb115-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_Host_AFDW, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive features</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature    MeanImportance
##    &lt;chr&gt;               &lt;dbl&gt;
##  1 PC20_miRNA         0.0906
##  2 PC18_miRNA         0.0771
##  3 PC17_miRNA         0.0762
##  4 PC19_miRNA         0.0760
##  5 PC16_miRNA         0.0753
##  6 PC8_miRNA          0.0689
##  7 PC3_miRNA          0.0674
##  8 PC13_miRNA         0.0672
##  9 PC11_miRNA         0.0669
## 10 PC7_miRNA          0.0663
## 11 PC9_miRNA          0.0581
## 12 PC27_WGBS          0.0527
## 13 PC26_WGBS          0.0516
## 14 PC2_miRNA          0.0505
## 15 PC14_miRNA         0.0471
## 16 PC5_miRNA          0.0463
## 17 PC12_miRNA         0.0440
## 18 PC21_WGBS          0.0430
## 19 PC13_WGBS          0.0430
## 20 PC11_WGBS          0.0354</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb117" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1">evaluate_model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models, response_pcs, predictor_pcs) {</span>
<span id="cb117-2">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb117-3"></span>
<span id="cb117-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb117-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]</span>
<span id="cb117-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)</span>
<span id="cb117-7"></span>
<span id="cb117-8">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models[[pc]]</span>
<span id="cb117-9">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb117-10"></span>
<span id="cb117-11">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R-squared metric</span></span>
<span id="cb117-12">    results[results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> pc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb117-13">  }</span>
<span id="cb117-14"></span>
<span id="cb117-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb117-16">}</span>
<span id="cb117-17"></span>
<span id="cb117-18">performance_results_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_Host_AFDW, Host_AFDW_pcs, full_pred)</span>
<span id="cb117-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.2360  0.8370  0.9701  0.8500  0.9960  0.9997       7</code></pre>
</section>
<section id="results-1" class="level2">
<h2 class="anchored" data-anchor-id="results-1">8.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb119" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb119-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># few enough miRNA that we can show all</span></span>
<span id="cb119-3">top_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb119-4"></span>
<span id="cb119-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb119-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb119-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb119-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lncRNA, miRNA, and methylation as predictive features"</span>,</span>
<span id="cb119-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Features"</span>,</span>
<span id="cb119-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-47-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb120" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb120-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb120-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 7 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-48-1.png" class="img-fluid"><!-- --></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb122" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb122-2">loadings_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb122-3"></span>
<span id="cb122-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb122-5">loadings_Host_AFDW_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_Host_AFDW) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb122-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb122-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host_AFDW_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb122-8"></span>
<span id="cb122-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top genes contributing most to each PC</span></span>
<span id="cb122-10">top_genes_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_Host_AFDW_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb122-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Host_AFDW_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb122-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb122-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 genes per PC</span></span>
<span id="cb122-14"></span>
<span id="cb122-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Host_AFDW)</span></code></pre></div>
<pre><code>## # A tibble: 800 Ã— 3
## # Groups:   Host_AFDW_PC [40]
##    gene       Host_AFDW_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_010504 PC1           0.0593
##  2 FUN_033160 PC1           0.0587
##  3 FUN_042402 PC1           0.0580
##  4 FUN_026248 PC1           0.0579
##  5 FUN_010505 PC1           0.0578
##  6 FUN_030089 PC1           0.0576
##  7 FUN_027385 PC1           0.0575
##  8 FUN_013949 PC1           0.0573
##  9 FUN_008069 PC1           0.0572
## 10 FUN_036450 PC1           0.0570
## # â„¹ 790 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb124" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb124-2">best_pc_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb124-3"></span>
<span id="cb124-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb124-5">actual_values_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Host_AFDW_pcs[[best_pc_Host_AFDW]]</span>
<span id="cb124-6">predicted_values_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Host_AFDW[[best_pc_Host_AFDW]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb124-7"></span>
<span id="cb124-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb124-9">prediction_df_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb124-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_Host_AFDW,</span>
<span id="cb124-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_Host_AFDW</span>
<span id="cb124-12">)</span>
<span id="cb124-13"></span>
<span id="cb124-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb124-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb124-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb124-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb124-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb124-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_Host_AFDW),</span>
<span id="cb124-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb124-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb124-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_Host_AFDW), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_Host_AFDW), </span>
<span id="cb124-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb124-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-50-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb126" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb127" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Host_AFDW_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_Host_AFDW))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   Host_AFDW_PC [1]
##    gene       Host_AFDW_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_032266 PC11         -0.121 
##  2 FUN_001078 PC11         -0.120 
##  3 FUN_002256 PC11         -0.110 
##  4 FUN_036908 PC11         -0.105 
##  5 FUN_038819 PC11         -0.102 
##  6 FUN_041309 PC11          0.0960
##  7 FUN_011431 PC11          0.0955
##  8 FUN_026266 PC11          0.0935
##  9 FUN_035522 PC11          0.0903
## 10 FUN_004295 PC11         -0.0870
## 11 FUN_001845 PC11          0.0857
## 12 FUN_035669 PC11         -0.0854
## 13 FUN_008411 PC11          0.0853
## 14 FUN_035580 PC11          0.0849
## 15 FUN_037480 PC11         -0.0848
## 16 FUN_021024 PC11          0.0840
## 17 FUN_012009 PC11          0.0831
## 18 FUN_029326 PC11          0.0812
## 19 FUN_029077 PC11          0.0791
## 20 FUN_027127 PC11          0.0789</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb129" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above 0.75</span></span>
<span id="cb129-2">all_pcs_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb129-3"></span>
<span id="cb129-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Host_AFDW) {</span>
<span id="cb129-5">  </span>
<span id="cb129-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb129-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Host_AFDW_pcs[[pc]]</span>
<span id="cb129-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Host_AFDW[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb129-9">  </span>
<span id="cb129-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb129-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb129-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb129-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb129-14">  )</span>
<span id="cb129-15">  </span>
<span id="cb129-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb129-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb129-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb129-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb129-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb129-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb129-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb129-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb129-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb129-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Host_AFDW[performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb129-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb129-27">  </span>
<span id="cb129-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb129-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-6.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-7.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-8.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-9.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-10.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-11.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-12.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-13.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-14.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-15.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-16.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-52-17.png" class="img-fluid"><!-- --></p>
<p>We can also look at which feature(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb147" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb147-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb147-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb147-4">  </span>
<span id="cb147-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb147-6">}</span>
<span id="cb147-7"></span>
<span id="cb147-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Host_AFDW) {</span>
<span id="cb147-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb147-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_Host_AFDW[[pc]]</span>
<span id="cb147-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb147-12">  </span>
<span id="cb147-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important feature for predicting this PC</span></span>
<span id="cb147-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb147-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb147-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb147-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb147-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, pc),</span>
<span id="cb147-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb147-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb147-21">  </span>
<span id="cb147-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb147-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-6.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-7.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-8.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-9.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-10.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-11.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-12.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-13.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-14.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-15.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-16.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-53-17.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="symbiont-photsynthesis-am" class="level1">
<h1>9 Symbiont photsynthesis (Am)</h1>
<section id="the-model-2" class="level2">
<h2 class="anchored" data-anchor-id="the-model-2">9.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression</p>
<div class="sourceCode" id="cb148" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA+lncRNA+methylation</span></span>
<span id="cb148-2">models_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(Am_pcs, full_pred)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb149" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1">feature_importance_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_Am)</span>
<span id="cb149-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_Am, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive feature</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature    MeanImportance
##    &lt;chr&gt;               &lt;dbl&gt;
##  1 PC20_miRNA         0.327 
##  2 PC10_miRNA         0.210 
##  3 PC18_miRNA         0.201 
##  4 PC16_miRNA         0.197 
##  5 PC12_miRNA         0.172 
##  6 PC9_miRNA          0.172 
##  7 PC19_miRNA         0.162 
##  8 PC14_miRNA         0.155 
##  9 PC5_miRNA          0.150 
## 10 PC7_miRNA          0.146 
## 11 PC11_miRNA         0.138 
## 12 PC23_WGBS          0.127 
## 13 PC13_miRNA         0.125 
## 14 PC17_miRNA         0.124 
## 15 PC30_WGBS          0.121 
## 16 PC19_WGBS          0.116 
## 17 PC1_miRNA          0.104 
## 18 PC15_miRNA         0.103 
## 19 PC8_miRNA          0.0926
## 20 PC6_miRNA          0.0910</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb151" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1">performance_results_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_Am, Am_pcs, full_pred)</span>
<span id="cb151-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.2020  0.8016  0.9304  0.8191  0.9905  0.9995       5</code></pre>
</section>
<section id="results-2" class="level2">
<h2 class="anchored" data-anchor-id="results-2">9.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb153" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb153-2">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb153-3"></span>
<span id="cb153-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb153-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb153-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb153-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb153-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-57-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb154" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb154-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb154-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb154-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-58-1.png" class="img-fluid"><!-- --></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb156" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb156-2">loadings_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb156-3"></span>
<span id="cb156-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb156-5">loadings_Am_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_Am) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb156-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb156-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Am_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb156-8"></span>
<span id="cb156-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top genes contributing most to each PC</span></span>
<span id="cb156-10">top_genes_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_Am_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb156-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Am_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb156-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb156-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 genes per PC</span></span>
<span id="cb156-14"></span>
<span id="cb156-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Am)</span></code></pre></div>
<pre><code>## # A tibble: 800 Ã— 3
## # Groups:   Am_PC [40]
##    gene       Am_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;
##  1 FUN_011681 PC1   -0.0250
##  2 FUN_040949 PC1    0.0244
##  3 FUN_027962 PC1    0.0244
##  4 FUN_023373 PC1    0.0244
##  5 FUN_000239 PC1    0.0244
##  6 FUN_014926 PC1    0.0241
##  7 FUN_001784 PC1   -0.0240
##  8 FUN_016798 PC1   -0.0239
##  9 FUN_023033 PC1   -0.0239
## 10 FUN_016083 PC1   -0.0238
## # â„¹ 790 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb158" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb158-2">best_pc_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb158-3"></span>
<span id="cb158-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb158-5">actual_values_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Am_pcs[[best_pc_Am]]</span>
<span id="cb158-6">predicted_values_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Am[[best_pc_Am]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb158-7"></span>
<span id="cb158-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb158-9">prediction_df_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb158-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_Am,</span>
<span id="cb158-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_Am</span>
<span id="cb158-12">)</span>
<span id="cb158-13"></span>
<span id="cb158-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb158-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb158-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb158-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb158-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb158-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_Am),</span>
<span id="cb158-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb158-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb158-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_Am), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_Am), </span>
<span id="cb158-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb158-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-60-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb160" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb161" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Am_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_Am))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   Am_PC [1]
##    gene       Am_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;
##  1 FUN_005990 PC18   0.0578
##  2 FUN_005864 PC18  -0.0489
##  3 FUN_025766 PC18  -0.0441
##  4 FUN_040041 PC18   0.0440
##  5 FUN_017855 PC18  -0.0439
##  6 FUN_043319 PC18   0.0431
##  7 FUN_001332 PC18   0.0428
##  8 FUN_008277 PC18  -0.0424
##  9 FUN_015347 PC18  -0.0424
## 10 FUN_001477 PC18   0.0422
## 11 FUN_026571 PC18   0.0421
## 12 FUN_027848 PC18  -0.0417
## 13 FUN_005860 PC18  -0.0414
## 14 FUN_024487 PC18  -0.0405
## 15 FUN_033692 PC18  -0.0403
## 16 FUN_041284 PC18  -0.0403
## 17 FUN_000995 PC18  -0.0402
## 18 FUN_001762 PC18  -0.0402
## 19 FUN_014703 PC18   0.0395
## 20 FUN_032441 PC18   0.0395</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb163" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above 0.75</span></span>
<span id="cb163-2">all_pcs_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb163-3"></span>
<span id="cb163-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Am) {</span>
<span id="cb163-5">  </span>
<span id="cb163-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb163-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Am_pcs[[pc]]</span>
<span id="cb163-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Am[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb163-9">  </span>
<span id="cb163-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb163-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb163-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb163-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb163-14">  )</span>
<span id="cb163-15">  </span>
<span id="cb163-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb163-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb163-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb163-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb163-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb163-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb163-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb163-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb163-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb163-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Am[performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb163-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb163-27">  </span>
<span id="cb163-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb163-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-6.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-7.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-8.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-9.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-10.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-11.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-12.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-13.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-14.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-15.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-16.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-17.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-18.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-62-19.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb183" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb183-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb183-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb183-4">  </span>
<span id="cb183-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb183-6">}</span>
<span id="cb183-7"></span>
<span id="cb183-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Am) {</span>
<span id="cb183-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb183-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_Am[[pc]]</span>
<span id="cb183-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb183-12">  </span>
<span id="cb183-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb183-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb183-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb183-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb183-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb183-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, pc),</span>
<span id="cb183-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Features"</span>,</span>
<span id="cb183-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb183-21">  </span>
<span id="cb183-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb183-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-6.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-7.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-8.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-9.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-10.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-11.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-12.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-13.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-14.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-15.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-16.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-17.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-18.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-63-19.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="atp-production-go-terms-1" class="level1">
<h1>10 ATP production (GO terms)</h1>
<section id="the-model-3" class="level2">
<h2 class="anchored" data-anchor-id="the-model-3">10.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression</p>
<div class="sourceCode" id="cb184" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA/lncRNA/methylation PCs</span></span>
<span id="cb184-2">models_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(ATP_prod_GO_pcs, full_pred)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb185" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1">feature_importance_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_ATP_prod_GO)</span>
<span id="cb185-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_ATP_prod_GO, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive feature PCs</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature    MeanImportance
##    &lt;chr&gt;               &lt;dbl&gt;
##  1 PC19_miRNA        0.0437 
##  2 PC12_miRNA        0.0380 
##  3 PC5_miRNA         0.0298 
##  4 PC18_miRNA        0.0251 
##  5 PC20_miRNA        0.0236 
##  6 PC30_WGBS         0.0224 
##  7 PC16_miRNA        0.0223 
##  8 PC1_miRNA         0.0209 
##  9 PC2_miRNA         0.0169 
## 10 PC24_WGBS         0.0154 
## 11 PC12_WGBS         0.0145 
## 12 PC23_WGBS         0.0143 
## 13 PC7_miRNA         0.0139 
## 14 PC3_miRNA         0.0137 
## 15 PC4_miRNA         0.00962
## 16 PC11_WGBS         0.00828
## 17 PC15_miRNA        0.00820
## 18 PC21_WGBS         0.00786
## 19 PC9_WGBS          0.00761
## 20 PC14_miRNA        0.00712</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb187" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1">performance_results_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_ATP_prod_GO, ATP_prod_GO_pcs, full_pred)</span>
<span id="cb187-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.1980  0.7518  0.9177  0.7903  0.9953  0.9994       3</code></pre>
</section>
<section id="results-3" class="level2">
<h2 class="anchored" data-anchor-id="results-3">10.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb189" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb189-2">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb189-3"></span>
<span id="cb189-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb189-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb189-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb189-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb189-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb189-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb189-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb189-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-67-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb190" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb190-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb190-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb190-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb190-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb190-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb190-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb190-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-68-1.png" class="img-fluid"><!-- --></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb192" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb192-2">loadings_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb192-3"></span>
<span id="cb192-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb192-5">loadings_ATP_prod_GO_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_ATP_prod_GO) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb192-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb192-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_prod_GO_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb192-8"></span>
<span id="cb192-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top genes contributing most to each PC</span></span>
<span id="cb192-10">top_genes_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_ATP_prod_GO_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb192-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(ATP_prod_GO_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb192-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb192-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 genes per PC</span></span>
<span id="cb192-14"></span>
<span id="cb192-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_ATP_prod_GO)</span></code></pre></div>
<pre><code>## # A tibble: 440 Ã— 3
## # Groups:   ATP_prod_GO_PC [22]
##    gene       ATP_prod_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;
##  1 FUN_025802 PC1              0.328
##  2 FUN_025367 PC1              0.316
##  3 FUN_000960 PC1              0.313
##  4 FUN_031975 PC1              0.311
##  5 FUN_031686 PC1              0.290
##  6 FUN_014565 PC1              0.277
##  7 FUN_007016 PC1              0.246
##  8 FUN_039808 PC1              0.243
##  9 FUN_038166 PC1              0.242
## 10 FUN_025823 PC1              0.208
## # â„¹ 430 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb194" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb194-2">best_pc_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb194-3"></span>
<span id="cb194-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb194-5">actual_values_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ATP_prod_GO_pcs[[best_pc_ATP_prod_GO]]</span>
<span id="cb194-6">predicted_values_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO[[best_pc_ATP_prod_GO]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb194-7"></span>
<span id="cb194-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb194-9">prediction_df_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb194-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_ATP_prod_GO,</span>
<span id="cb194-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_ATP_prod_GO</span>
<span id="cb194-12">)</span>
<span id="cb194-13"></span>
<span id="cb194-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb194-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb194-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb194-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb194-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb194-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_ATP_prod_GO),</span>
<span id="cb194-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb194-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb194-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_ATP_prod_GO), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_ATP_prod_GO), </span>
<span id="cb194-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb194-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-70-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb196" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb197" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ATP_prod_GO_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_ATP_prod_GO))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   ATP_prod_GO_PC [1]
##    gene       ATP_prod_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;
##  1 FUN_014563 PC4             0.371 
##  2 FUN_040783 PC4            -0.361 
##  3 FUN_015065 PC4             0.328 
##  4 FUN_014565 PC4             0.319 
##  5 FUN_038688 PC4             0.309 
##  6 FUN_007016 PC4             0.258 
##  7 FUN_038727 PC4            -0.249 
##  8 FUN_032701 PC4            -0.236 
##  9 FUN_014564 PC4             0.236 
## 10 FUN_033885 PC4             0.209 
## 11 FUN_028263 PC4            -0.197 
## 12 FUN_038166 PC4            -0.183 
## 13 FUN_025802 PC4            -0.137 
## 14 FUN_038738 PC4             0.122 
## 15 FUN_009532 PC4            -0.109 
## 16 FUN_025367 PC4            -0.0883
## 17 FUN_031686 PC4             0.0695
## 18 FUN_039808 PC4            -0.0625
## 19 FUN_036898 PC4            -0.0576
## 20 FUN_000960 PC4            -0.0524</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb199" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above line in plot</span></span>
<span id="cb199-2">all_pcs_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb199-3"></span>
<span id="cb199-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_ATP_prod_GO) {</span>
<span id="cb199-5">  </span>
<span id="cb199-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb199-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ATP_prod_GO_pcs[[pc]]</span>
<span id="cb199-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb199-9">  </span>
<span id="cb199-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb199-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb199-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb199-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb199-14">  )</span>
<span id="cb199-15">  </span>
<span id="cb199-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb199-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb199-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb199-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb199-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb199-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb199-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb199-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb199-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb199-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO[performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb199-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb199-27">  </span>
<span id="cb199-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb199-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-72-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-72-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-72-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-72-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-72-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-72-6.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb206" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb206-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb206-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb206-4">  </span>
<span id="cb206-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb206-6">}</span>
<span id="cb206-7"></span>
<span id="cb206-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_ATP_prod_GO) {</span>
<span id="cb206-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb206-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_ATP_prod_GO[[pc]]</span>
<span id="cb206-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb206-12">  </span>
<span id="cb206-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation for predicting this PC</span></span>
<span id="cb206-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb206-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb206-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb206-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb206-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation Predictors for"</span>, pc),</span>
<span id="cb206-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb206-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb206-21">  </span>
<span id="cb206-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb206-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-73-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-73-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-73-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-73-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-73-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-73-6.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="energy-usagestorage-go-terms-1" class="level1">
<h1>11 Energy Usage/Storage (GO terms)</h1>
<section id="the-model-4" class="level2">
<h2 class="anchored" data-anchor-id="the-model-4">11.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression</p>
<div class="sourceCode" id="cb207" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA/lncRNA/methylation PCs</span></span>
<span id="cb207-2">models_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(energy_GO_pcs, full_pred)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb208" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1">feature_importance_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_energy_GO)</span>
<span id="cb208-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_energy_GO, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA/lncRNA/methylation PCs</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature    MeanImportance
##    &lt;chr&gt;               &lt;dbl&gt;
##  1 PC10_miRNA         0.0556
##  2 PC16_miRNA         0.0544
##  3 PC20_miRNA         0.0542
##  4 PC11_miRNA         0.0516
##  5 PC12_miRNA         0.0449
##  6 PC18_miRNA         0.0423
##  7 PC9_miRNA          0.0395
##  8 PC17_miRNA         0.0378
##  9 PC23_WGBS          0.0330
## 10 PC6_miRNA          0.0327
## 11 PC14_miRNA         0.0317
## 12 PC5_miRNA          0.0307
## 13 PC7_miRNA          0.0262
## 14 PC20_WGBS          0.0255
## 15 PC27_WGBS          0.0245
## 16 PC19_miRNA         0.0240
## 17 PC18_WGBS          0.0235
## 18 PC29_WGBS          0.0215
## 19 PC4_miRNA          0.0215
## 20 PC15_miRNA         0.0208</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb210" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1">performance_results_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_energy_GO, energy_GO_pcs, full_pred)</span>
<span id="cb210-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.1689  0.6786  0.9219  0.7595  0.9822  0.9996       4</code></pre>
</section>
<section id="results-4" class="level2">
<h2 class="anchored" data-anchor-id="results-4">11.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb212" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb212-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># few enough miRNA that we can show all</span></span>
<span id="cb212-3">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb212-4"></span>
<span id="cb212-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb212-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb212-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb212-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb212-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb212-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation as Predictive Features"</span>,</span>
<span id="cb212-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb212-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-77-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb213" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb213-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb213-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb213-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb213-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb213-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb213-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb213-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 4 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-78-1.png" class="img-fluid"><!-- --></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb215" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb215-2">loadings_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb215-3"></span>
<span id="cb215-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb215-5">loadings_energy_GO_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_energy_GO) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb215-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb215-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"energy_GO_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb215-8"></span>
<span id="cb215-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top genes contributing most to each PC</span></span>
<span id="cb215-10">top_genes_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_energy_GO_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb215-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(energy_GO_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb215-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb215-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 genes per PC</span></span>
<span id="cb215-14"></span>
<span id="cb215-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_energy_GO)</span></code></pre></div>
<pre><code>## # A tibble: 800 Ã— 3
## # Groups:   energy_GO_PC [40]
##    gene       energy_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_028200 PC1            0.115
##  2 FUN_040444 PC1            0.113
##  3 FUN_017915 PC1            0.112
##  4 FUN_001396 PC1           -0.109
##  5 FUN_026618 PC1           -0.108
##  6 FUN_029673 PC1           -0.107
##  7 FUN_023596 PC1            0.107
##  8 FUN_000370 PC1           -0.106
##  9 FUN_039293 PC1            0.106
## 10 FUN_001160 PC1           -0.105
## # â„¹ 790 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb217" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb217-2">best_pc_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb217-3"></span>
<span id="cb217-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb217-5">actual_values_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energy_GO_pcs[[best_pc_energy_GO]]</span>
<span id="cb217-6">predicted_values_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_energy_GO[[best_pc_energy_GO]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb217-7"></span>
<span id="cb217-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb217-9">prediction_df_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb217-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_energy_GO,</span>
<span id="cb217-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_energy_GO</span>
<span id="cb217-12">)</span>
<span id="cb217-13"></span>
<span id="cb217-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb217-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb217-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb217-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb217-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb217-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_energy_GO),</span>
<span id="cb217-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb217-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb217-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_energy_GO), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_energy_GO), </span>
<span id="cb217-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb217-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-80-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb219" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb220" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(energy_GO_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_energy_GO))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   energy_GO_PC [1]
##    gene       energy_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_022041 PC24           0.205
##  2 FUN_037231 PC24          -0.189
##  3 FUN_033720 PC24           0.187
##  4 FUN_041903 PC24          -0.172
##  5 FUN_009346 PC24          -0.163
##  6 FUN_042618 PC24          -0.151
##  7 FUN_012471 PC24          -0.150
##  8 FUN_017849 PC24           0.150
##  9 FUN_041699 PC24          -0.137
## 10 FUN_011931 PC24           0.137
## 11 FUN_011927 PC24           0.132
## 12 FUN_036984 PC24           0.132
## 13 FUN_023089 PC24           0.128
## 14 FUN_012329 PC24           0.126
## 15 FUN_014897 PC24           0.124
## 16 FUN_001205 PC24           0.122
## 17 FUN_004635 PC24           0.121
## 18 FUN_006975 PC24          -0.120
## 19 FUN_025406 PC24          -0.118
## 20 FUN_043629 PC24           0.113</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb222" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above line in plot</span></span>
<span id="cb222-2">all_pcs_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb222-3"></span>
<span id="cb222-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_energy_GO) {</span>
<span id="cb222-5">  </span>
<span id="cb222-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb222-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energy_GO_pcs[[pc]]</span>
<span id="cb222-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_energy_GO[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(full_pred), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb222-9">  </span>
<span id="cb222-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb222-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb222-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb222-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb222-14">  )</span>
<span id="cb222-15">  </span>
<span id="cb222-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb222-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb222-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb222-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb222-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb222-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb222-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb222-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb222-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb222-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_energy_GO[performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb222-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb222-27">  </span>
<span id="cb222-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb222-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-6.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-7.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-8.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-9.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-10.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-11.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-12.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-13.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-14.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-82-15.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb238" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb238-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb238-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb238-4">  </span>
<span id="cb238-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb238-6">}</span>
<span id="cb238-7"></span>
<span id="cb238-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_energy_GO) {</span>
<span id="cb238-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb238-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_energy_GO[[pc]]</span>
<span id="cb238-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb238-12">  </span>
<span id="cb238-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA/lncRNA/methylation PCs for predicting this PC</span></span>
<span id="cb238-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb238-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb238-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb238-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb238-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA/lncRNA/methylation PC Predictors for"</span>, pc),</span>
<span id="cb238-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>,</span>
<span id="cb238-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb238-21">  </span>
<span id="cb238-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb238-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-6.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-7.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-8.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-9.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-10.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-11.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-12.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-13.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-14.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-83-15.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="compare" class="level1">
<h1>12 Compare</h1>
<p>Visualize the relative importance of miRNA in predicting expression for these different gene sets:</p>
<div class="sourceCode" id="cb239" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform min-max normalization on the mean importance of miRNA/lncRNA/methylation PC for each group</span></span>
<span id="cb239-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This will place all along a 0-1 range for comparison purposes</span></span>
<span id="cb239-3">normalize <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb239-4">  (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x))</span>
<span id="cb239-5">}</span>
<span id="cb239-6"></span>
<span id="cb239-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalize</span></span>
<span id="cb239-8">top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb239-9">top_features_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb239-10">top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb239-11">top_features_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb239-12"></span>
<span id="cb239-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add group labels</span></span>
<span id="cb239-14">top_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host_AFDW"</span>)</span>
<span id="cb239-15">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Am"</span>)</span>
<span id="cb239-16">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_prod_GO"</span>)</span>
<span id="cb239-17">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"energy_GO"</span>)</span>
<span id="cb239-18"></span>
<span id="cb239-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set rows in same order</span></span>
<span id="cb239-20">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Am[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb239-21">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb239-22">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_energy_GO[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb239-23"></span>
<span id="cb239-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine</span></span>
<span id="cb239-25">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_features_Host_AFDW, top_features_Am, top_features_ATP_prod_GO, top_features_energy_GO)</span>
<span id="cb239-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove raw mean importance</span></span>
<span id="cb239-27">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>MeanImportance)</span>
<span id="cb239-28"></span>
<span id="cb239-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wide format: rows = miRNAs, columns = groups</span></span>
<span id="cb239-30">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb239-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> MeanImportance_norm)</span>
<span id="cb239-32"></span>
<span id="cb239-33">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(heatmap_df)</span>
<span id="cb239-34"></span>
<span id="cb239-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Melt into long format for ggplot</span></span>
<span id="cb239-36">heatmap_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(heatmap_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>)</span>
<span id="cb239-37"></span>
<span id="cb239-38"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(heatmap_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Feature, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb239-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb239-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb239-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb239-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb239-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-84-1.png" class="img-fluid"><!-- --></p>
<p>Cluster by miRNA importance</p>
<div class="sourceCode" id="cb240" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make Feature column the rownames and convert to matrix</span></span>
<span id="cb240-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(heatmap_df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> heatmap_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature</span>
<span id="cb240-3">heatmap_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(heatmap_df[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Removes the 'Feature' column</span></span>
<span id="cb240-4"></span>
<span id="cb240-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace NAs with 0</span></span>
<span id="cb240-6">heatmap_matrix[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(heatmap_matrix)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb240-7"></span>
<span id="cb240-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(</span>
<span id="cb240-9">  heatmap_matrix, </span>
<span id="cb240-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering miRNAs (rows) by similarity in importance</span></span>
<span id="cb240-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering groups (columns)</span></span>
<span id="cb240-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># No scaling (since data is already normalized)</span></span>
<span id="cb240-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_rownames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show miRNA names</span></span>
<span id="cb240-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_colnames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show group names</span></span>
<span id="cb240-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Red gradient for importance</span></span>
<span id="cb240-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA/lncRNA/methylation PCs' Importance Across Groups"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Title of the heatmap</span></span>
<span id="cb240-17">)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.2-Apul-multiomic-machine-learning_files/figure-gfm/unnamed-chunk-85-1.png" class="img-fluid"><!-- --></p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_18_timeseries_multiomic_ML_1.html</guid>
  <pubDate>Fri, 18 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul phenotype and gene/miRNA machine learning â€“ Part 4</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_11_timeseries_ML_4.html</link>
  <description><![CDATA[ 




<p>Requested a list of GO terms related to energy usage and storage from ChatGPT4o:<br>
<br>
<strong>Energy Usage / Energy Production:</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 34%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>GO Term</th>
<th>Term Name</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GO:0006096</strong></td>
<td><strong>Glycolysis</strong></td>
<td>Breakdown of glucose to produce ATP.</td>
</tr>
<tr class="even">
<td><strong>GO:0006091</strong></td>
<td><strong>Generation of precursor metabolites and energy</strong></td>
<td>Broad, covers glycolysis, TCA cycle, etc.</td>
</tr>
<tr class="odd">
<td><strong>GO:0006099</strong></td>
<td><strong>Tricarboxylic acid cycle (TCA cycle)</strong></td>
<td>AKA Krebs cycle â€” key ATP-generating pathway.</td>
</tr>
<tr class="even">
<td><strong>GO:0006119</strong></td>
<td><strong>Oxidative phosphorylation</strong></td>
<td>ATP generation using the mitochondrial electron transport chain.</td>
</tr>
<tr class="odd">
<td><strong>GO:0006635</strong></td>
<td><strong>Fatty acid beta-oxidation</strong></td>
<td>Breaks down fats to feed into energy production.</td>
</tr>
<tr class="even">
<td><strong>GO:0009150</strong></td>
<td><strong>Purine ribonucleotide biosynthetic process</strong></td>
<td>Important for making ATP and other nucleotides (energy carriers).</td>
</tr>
<tr class="odd">
<td><strong>GO:0030163</strong></td>
<td><strong>Protein catabolic process</strong></td>
<td>Energy extraction from proteins, especially during starvation.</td>
</tr>
</tbody>
</table>
<p><strong>Energy Storage:</strong></p>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 30%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>GO Term</th>
<th>Term Name</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GO:0008610</strong></td>
<td><strong>Lipid biosynthetic process</strong></td>
<td>Making lipids for energy storage.</td>
</tr>
<tr class="even">
<td><strong>GO:0045721</strong></td>
<td><strong>Negative regulation of gluconeogenesis</strong></td>
<td>Helps switch from producing glucose to storing it.</td>
</tr>
<tr class="odd">
<td><strong>GO:0046467</strong></td>
<td><strong>Membrane lipid catabolic process</strong></td>
<td>Mobilizing stored energy from lipid stores.</td>
</tr>
<tr class="even">
<td><strong>GO:0016042</strong></td>
<td><strong>Lipid catabolic process</strong></td>
<td>General term for fat breakdown.</td>
</tr>
<tr class="odd">
<td><strong>GO:0005975</strong></td>
<td><strong>Carbohydrate metabolic process</strong></td>
<td>Storage of energy as glycogen or starch (depending on organism).</td>
</tr>
<tr class="even">
<td><strong>GO:0045722</strong></td>
<td><strong>Positive regulation of glycolysis</strong></td>
<td>Promotes glucose usage over storage when energy is needed.</td>
</tr>
<tr class="odd">
<td><strong>GO:0042594</strong></td>
<td><strong>Response to starvation</strong></td>
<td>Triggering the usage of energy stores (lipids, proteins, etc.).</td>
</tr>
</tbody>
</table>
<p><strong>Bonus Terms (helpful if you want full coverage):</strong></p>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 34%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th>GO Term</th>
<th>Term Name</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GO:0046034</strong></td>
<td><strong>ATP metabolic process</strong></td>
<td>Directly handling the cellâ€™s energy currency.</td>
</tr>
<tr class="even">
<td><strong>GO:0006094</strong></td>
<td><strong>Gluconeogenesis</strong></td>
<td>Building glucose for later use or emergency supply.</td>
</tr>
<tr class="odd">
<td><strong>GO:0006629</strong></td>
<td><strong>Lipid metabolic process</strong></td>
<td>Umbrella term for both storage and usage of lipids.</td>
</tr>
<tr class="even">
<td><strong>GO:0032869</strong></td>
<td><strong>Cellular response to insulin stimulus</strong></td>
<td>Insulin controls whether energy is stored or used.</td>
</tr>
<tr class="odd">
<td><strong>GO:0006006</strong></td>
<td><strong>Glucose metabolic process</strong></td>
<td>General term covering breakdown and storage.</td>
</tr>
</tbody>
</table>
<p>Then generated a gene set of genes in our time series Apul reads that are annotated with at least one of these terms. This gene set was used in the ML model.<br>
<br>
<a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets.Rmd">Full code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets.md">Full rendered code</a></p>
<section id="energy-usagestorage-go-terms" class="level1">
<h1>7 Energy Usage/Storage (GO terms)</h1>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">7.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA expression</span></span>
<span id="cb1-2">models_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(energy_GO_pcs, vsd_miRNA)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">feature_importance_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_energy_GO)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_energy_GO, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature       MeanImportance
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Cluster_17173         0.222 
##  2 Cluster_5516          0.202 
##  3 Cluster_17623         0.192 
##  4 Cluster_2372          0.184 
##  5 Cluster_17192         0.181 
##  6 Cluster_9420          0.170 
##  7 Cluster_9786          0.169 
##  8 Cluster_14146         0.164 
##  9 Cluster_5517          0.150 
## 10 Cluster_14605         0.142 
## 11 Cluster_3301          0.140 
## 12 Cluster_1819          0.129 
## 13 Cluster_17186         0.105 
## 14 Cluster_14165         0.104 
## 15 Cluster_10452         0.0935
## 16 Cluster_9366          0.0924
## 17 Cluster_4752          0.0864
## 18 Cluster_4036          0.0862
## 19 Cluster_1865          0.0838
## 20 Cluster_3226          0.0816</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">performance_results_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_energy_GO, energy_GO_pcs, vsd_miRNA)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.1121  0.5775  0.6554  0.6060  0.7653  0.9519      13</code></pre>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">7.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># few enough miRNA that we can show all</span></span>
<span id="cb6-3">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA as Predictive Features"</span>,</span>
<span id="cb6-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb6-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-53-1.png" class="img-fluid"></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb7-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb7-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 13 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-54-1.png" class="img-fluid"></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb9-2">loadings_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb9-5">loadings_energy_GO_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_energy_GO) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"energy_GO_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top CpGs contributing most to each PC</span></span>
<span id="cb9-10">top_genes_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_energy_GO_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(energy_GO_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 10 CpGs per PC</span></span>
<span id="cb9-14"></span>
<span id="cb9-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_energy_GO)</span></code></pre></div>
<pre><code>## # A tibble: 800 Ã— 3
## # Groups:   energy_GO_PC [40]
##    gene       energy_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_028200 PC1           -0.115
##  2 FUN_040444 PC1           -0.113
##  3 FUN_017915 PC1           -0.112
##  4 FUN_001396 PC1            0.109
##  5 FUN_026618 PC1            0.108
##  6 FUN_029673 PC1            0.107
##  7 FUN_023596 PC1           -0.107
##  8 FUN_000370 PC1            0.106
##  9 FUN_039293 PC1           -0.106
## 10 FUN_001160 PC1            0.105
## # â„¹ 790 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb11-2">best_pc_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb11-5">actual_values_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energy_GO_pcs[[best_pc_energy_GO]]</span>
<span id="cb11-6">predicted_values_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_energy_GO[[best_pc_energy_GO]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb11-9">prediction_df_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb11-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_energy_GO,</span>
<span id="cb11-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_energy_GO</span>
<span id="cb11-12">)</span>
<span id="cb11-13"></span>
<span id="cb11-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb11-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_energy_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_energy_GO),</span>
<span id="cb11-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb11-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_energy_GO), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_energy_GO), </span>
<span id="cb11-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb11-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-56-1.png" class="img-fluid"></p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(energy_GO_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_energy_GO))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   energy_GO_PC [1]
##    gene       energy_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_042982 PC3           0.176 
##  2 FUN_008385 PC3           0.140 
##  3 FUN_036246 PC3           0.139 
##  4 FUN_014563 PC3           0.134 
##  5 FUN_011723 PC3          -0.131 
##  6 FUN_031898 PC3           0.124 
##  7 FUN_015086 PC3           0.123 
##  8 FUN_037137 PC3          -0.121 
##  9 FUN_015261 PC3           0.120 
## 10 FUN_023676 PC3           0.119 
## 11 FUN_013363 PC3          -0.118 
## 12 FUN_014844 PC3          -0.118 
## 13 FUN_022926 PC3          -0.109 
## 14 FUN_037111 PC3          -0.107 
## 15 FUN_014565 PC3           0.104 
## 16 FUN_040116 PC3          -0.104 
## 17 FUN_022700 PC3           0.101 
## 18 FUN_029437 PC3           0.101 
## 19 FUN_007022 PC3          -0.100 
## 20 FUN_022927 PC3          -0.0997</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above line in plot</span></span>
<span id="cb16-2">all_pcs_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_energy_GO) {</span>
<span id="cb16-5">  </span>
<span id="cb16-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb16-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> energy_GO_pcs[[pc]]</span>
<span id="cb16-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_energy_GO[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb16-9">  </span>
<span id="cb16-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb16-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb16-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb16-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb16-14">  )</span>
<span id="cb16-15">  </span>
<span id="cb16-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb16-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb16-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb16-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb16-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_energy_GO[performance_results_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb16-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb16-27">  </span>
<span id="cb16-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb16-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-58-1.png" class="img-fluid"></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-58-2.png" class="img-fluid"></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-58-3.png" class="img-fluid"></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-58-4.png" class="img-fluid"></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb21-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb21-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb21-4">  </span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb21-6">}</span>
<span id="cb21-7"></span>
<span id="cb21-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_energy_GO) {</span>
<span id="cb21-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb21-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_energy_GO[[pc]]</span>
<span id="cb21-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb21-12">  </span>
<span id="cb21-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA for predicting this PC</span></span>
<span id="cb21-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA Predictors for"</span>, pc),</span>
<span id="cb21-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb21-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb21-21">  </span>
<span id="cb21-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb21-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-59-1.png" class="img-fluid"><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-59-2.png" class="img-fluid"><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-59-3.png" class="img-fluid"><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-59-4.png" class="img-fluid"></p>
</section>
</section>
<section id="compare" class="level1">
<h1>8 Compare</h1>
<p>Visualize the relative importance of miRNA in predicting expression for these different gene sets:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perfomr min-max normalization on the mean importance of miRNA for each group</span></span>
<span id="cb22-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This will place all along a 0-1 range for comparison purposes</span></span>
<span id="cb22-3">normalize <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb22-4">  (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x))</span>
<span id="cb22-5">}</span>
<span id="cb22-6"></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalize</span></span>
<span id="cb22-8">top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb22-9">top_features_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb22-10">top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb22-11">top_features_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_energy_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb22-12"></span>
<span id="cb22-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add group labels</span></span>
<span id="cb22-14">top_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host_AFDW"</span>)</span>
<span id="cb22-15">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Am"</span>)</span>
<span id="cb22-16">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_prod_GO"</span>)</span>
<span id="cb22-17">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_energy_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"energy_GO"</span>)</span>
<span id="cb22-18"></span>
<span id="cb22-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set rows in same order</span></span>
<span id="cb22-20">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Am[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb22-21">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb22-22">top_features_energy_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_energy_GO[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb22-23"></span>
<span id="cb22-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine</span></span>
<span id="cb22-25">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_features_Host_AFDW, top_features_Am, top_features_ATP_prod_GO, top_features_energy_GO)</span>
<span id="cb22-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove raw mean importance</span></span>
<span id="cb22-27">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>MeanImportance)</span>
<span id="cb22-28"></span>
<span id="cb22-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wide format: rows = miRNAs, columns = groups</span></span>
<span id="cb22-30">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> MeanImportance_norm)</span>
<span id="cb22-32"></span>
<span id="cb22-33">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(heatmap_df)</span>
<span id="cb22-34"></span>
<span id="cb22-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Melt into long format for ggplot</span></span>
<span id="cb22-36">heatmap_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(heatmap_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>)</span>
<span id="cb22-37"></span>
<span id="cb22-38"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(heatmap_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Feature, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-60-1.png" class="img-fluid"></p>
<p>Cluster by miRNA importance</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make Feature column the rownames and convert to matrix</span></span>
<span id="cb23-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(heatmap_df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> heatmap_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature</span>
<span id="cb23-3">heatmap_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(heatmap_df[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Removes the 'Feature' column</span></span>
<span id="cb23-4"></span>
<span id="cb23-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(</span>
<span id="cb23-6">  heatmap_matrix, </span>
<span id="cb23-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering miRNAs (rows) by similarity in importance</span></span>
<span id="cb23-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering groups (columns)</span></span>
<span id="cb23-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># No scaling (since data is already normalized)</span></span>
<span id="cb23-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_rownames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show miRNA names</span></span>
<span id="cb23-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_colnames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show group names</span></span>
<span id="cb23-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Red gradient for importance</span></span>
<span id="cb23-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNAs Importance Across Groups"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Title of the heatmap</span></span>
<span id="cb23-14">)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files_2/figure-gfm/unnamed-chunk-61-1.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_11_timeseries_ML_4.html</guid>
  <pubDate>Fri, 11 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-Dive Expression: Functional comparisons for known miRNA</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_10_dde_named_miRNA_functions.html</link>
  <description><![CDATA[ 




<p>Weâ€™ve determined putative function of our miRNAs by <a href="./2025_04_09_dde_miranda_miRNA_FE">running functional enrichment on each miRNAâ€™s putative targets</a>. Now Iâ€™d like to compare our putative functions to the function(s) of any miRNA that are previously described.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in miRNA with assigned names</span></span>
<span id="cb8-2">miRNA_named <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/urol-e5/deep-dive-expression/77b55212aaca4763917f67188d9e5e0fd1000c11/D-Apul/output/11-Apul-sRNA-ShortStack_4.1.0-pulchra_genome/ShortStack_out/Apul_Results_mature_named_miRNAs.csv"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Name, given_miRNA_name)</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(miRNA_named <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"novel"</span>, given_miRNA_name)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Name given_miRNA_name
1  Cluster_2859    apul-mir-9425
2  Cluster_3437    apul-mir-2030
3  Cluster_4254    apul-mir-2050
4  Cluster_5012    apul-mir-2023
5 Cluster_10057    apul-mir-2028
6 Cluster_10228    apul-mir-2022
7 Cluster_15316    apul-mir-2025
8 Cluster_18728     apul-mir-100
9 Cluster_18772    apul-mir-2036</code></pre>
</div>
</div>
<p>9 of our 39 miRNA identified by Shortstack are previously described.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in functional enrichment analysis results</span></span>
<span id="cb10-2">miRNA_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/urol-e5/deep-dive-expression/77b55212aaca4763917f67188d9e5e0fd1000c11/D-Apul/output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/miRNA_targets_topGO_FE.csv"</span>)</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function for pulling encriched terms for input miRNA</span></span>
<span id="cb10-5">FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(miRNA_name){</span>
<span id="cb10-6">  cluster <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_named <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(given_miRNA_name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> miRNA_name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Name)</span>
<span id="cb10-7">  terms <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_FE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> cluster) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(GO.ID, Term, type)</span>
<span id="cb10-8">  </span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(terms)</span>
<span id="cb10-10">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in functional annotation table</span></span>
<span id="cb11-2">miRNA_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/urol-e5/deep-dive-expression/refs/heads/main/D-Apul/output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/miRNA_targets_FA.csv"</span>)</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter to significant correlation of expression</span></span>
<span id="cb11-5">miRNA_sig_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Gene.Ontology.IDs))</span>
<span id="cb11-8"></span>
<span id="cb11-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to pull annotated terms for input miRNA</span></span>
<span id="cb11-10">sig_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(miRNA_name){</span>
<span id="cb11-11">  cluster <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_named <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(given_miRNA_name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> miRNA_name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(Name)</span>
<span id="cb11-12">  terms <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_sig_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> cluster) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Gene.Ontology..biological.process., Gene.Ontology.IDs, mRNA)</span>
<span id="cb11-13">  </span>
<span id="cb11-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(terms)</span>
<span id="cb11-15">}</span></code></pre></div>
</div>
<section id="mir-2022" class="level2">
<h2 class="anchored" data-anchor-id="mir-2022">mir-2022</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2022"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                 Term               type
1 GO:0001964                     startle response Biological.Process
2 GO:0002218 activation of innate immune response Biological.Process
3 GO:0005496                      steroid binding Molecular.Function
4 GO:0004995         tachykinin receptor activity Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2022"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                            Gene.Ontology..biological.process.
1 fibroblast growth factor receptor signaling pathway [GO:0008543]; hatching gland development [GO:0048785]; nervous system development [GO:0007399]; neural crest cell fate commitment [GO:0014034]; neural crest formation [GO:0014029]; positive regulation of DNA-templated transcription [GO:0045893]; Wnt signaling pathway [GO:0016055]
                                                                                                       Gene.Ontology.IDs
1 GO:0000981; GO:0003677; GO:0005634; GO:0007399; GO:0008543; GO:0014029; GO:0014034; GO:0016055; GO:0045893; GO:0048785
        mRNA
1 FUN_040720</code></pre>
</div>
</div>
<p><span class="citation" data-cites="teefy2020">Teefy (2020)</span> found that predicted targets of miR-2022 are predominantly expressed in nematocytes and that miR-2022 is controlled by PAX-A transcription factor, a regulator of nematogenesis in cnidarians. They hypothesize that â€œmiR-2022 participates in an incoherent feedforward loop to control gene dosage during nematocyte development.â€</p>
<p><span class="citation" data-cites="fridrich_ancient_2023">Fridrich et al. (2023)</span> showed that miR-2022 is predominantly expressed in stinging cells, and that miR-2022 knockdown in <em>Nematostella</em> inhibits cnidogenisis (development of stinging cnidocyte cells) and defensive capabilities in juvenile <em>Nematostella</em></p>
<p><span class="citation" data-cites="liew_identification_2014">Liew et al. (2014)</span> found that predicted targets of miR-2022 in <em>Stylophera pistillata</em> are enriched (topGO, FDR pval &lt; 0.01) for the Biological Processes:</p>
<p><strong>Immunity:</strong> â€œGO:0044003: modification by symbiont of host morphology or physiologyâ€, â€œGO:0019048: virus-host interactionâ€<br>
<strong>Cell cycle:</strong> â€œGO:0010564 : regulation of cell cycle processâ€, â€œGO:0000281: cytokinesis after mitosisâ€, â€œGO:2001237: negative regulation of extrinsic apoptotic signaling pathwayâ€<strong><br>
Transport/Signaling:</strong> â€œGO:0042147: retrograde transport, endosome to Golgiâ€, â€œGO:0006886: intracellular protein transportâ€, â€œGO:0051904: pigment granule transportâ€<br>
<strong>Differentiation/development:</strong> â€œ**GO:0001822: kidney developmentâ€, â€œGO:0030858: positive regulation of epithelial cell differentiationâ€, â€œGO:0001942: hair follicle developmentâ€, â€œGO:0048864: stem cell developmentâ€, â€œGO:0021670: lateral ventricle developmentâ€, â€œGO:0043588: skin developmentâ€</p>
<p>Our enriched terms seem to support the previously described function of miR-2022, since both â€œstartle responseâ€ and â€œtachykinin receptor activityâ€ are directly related to sensation/response, a primary function of nematocytes/cnidocytes!</p>
</section>
<section id="mir-2030" class="level2">
<h2 class="anchored" data-anchor-id="mir-2030">mir-2030</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2030"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                  Term               type
1 GO:0000226 microtubule cytoskeleton organization Biological.Process</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2030"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Gene.Ontology..biological.process. Gene.Ontology.IDs                 
[3] mRNA                              
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>(None of apul-mir-2030â€™s significantly correlated targets are annotated)</p>
<p>Highly conserved across bilateria</p>
<p><span class="citation" data-cites="krishna_deep_2013">Krishna et al. (2013)</span> found that miR-2030 is expressed throughout the body column of <em>Hydra magnipapillata</em> during head regeneration, but *not* in the tentacles</p>
<p>however, <span class="citation" data-cites="moran_cnidarian_2014">Moran et al. (2014)</span> found that miR-2030 is expressed <em>only</em> in the tentacles in <em>Nematostella vectensis</em></p>
<p><span class="citation" data-cites="liew_identification_2014">Liew et al. (2014)</span> found that predicted targets of miR-2030 in <em>Stylophera pistillata</em> are enriched (topGO, FDR pval &lt; 0.01) for the Biological Processes:</p>
<p><strong>Differentiation/Development:</strong> â€œGO:0009952: anterior/posterior pattern specificationâ€, â€œGO:0048538: thymus developmentâ€, â€œGO:0007283: spermatogenesisâ€,<br>
<strong>Miscellaneous:</strong> â€œGO:0007030: Golgi organizationâ€</p>
</section>
<section id="mir-100" class="level2">
<h2 class="anchored" data-anchor-id="mir-100">mir-100</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-100"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                                   Term
1 GO:0002224                   toll-like receptor signaling pathway
2 GO:0006598                            polyamine catabolic process
3 GO:0001578                           microtubule bundle formation
4 GO:0006699                         bile acid biosynthetic process
5 GO:0005471                            ATP:ADP antiporter activity
6 GO:0003960                       NADPH:quinone reductase activity
7 GO:0004675 transmembrane receptor protein serine/threonine kin...
8 GO:0004860                      protein kinase inhibitor activity
9 GO:0004857                              enzyme inhibitor activity
                type
1 Biological.Process
2 Biological.Process
3 Biological.Process
4 Biological.Process
5 Molecular.Function
6 Molecular.Function
7 Molecular.Function
8 Molecular.Function
9 Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-100"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Gene.Ontology..biological.process.
1 embryonic body morphogenesis [GO:0010172]; fibroblast growth factor receptor signaling pathway [GO:0008543]; G1/S transition of mitotic cell cycle [GO:0000082]; miRNA metabolic process [GO:0010586]; miRNA-mediated gene silencing by inhibition of translation [GO:0035278]; negative regulation of translation [GO:0017148]; neural tube development [GO:0021915]; proteasome-mediated ubiquitin-dependent protein catabolic process [GO:0043161]; protein autoubiquitination [GO:0051865]; protein polyubiquitination [GO:0000209]; regulation of miRNA-mediated gene silencing [GO:0060964]; regulation of neural precursor cell proliferation [GO:2000177]; stem cell proliferation [GO:0072089]
2 embryonic body morphogenesis [GO:0010172]; fibroblast growth factor receptor signaling pathway [GO:0008543]; G1/S transition of mitotic cell cycle [GO:0000082]; miRNA metabolic process [GO:0010586]; miRNA-mediated gene silencing by inhibition of translation [GO:0035278]; negative regulation of translation [GO:0017148]; neural tube development [GO:0021915]; proteasome-mediated ubiquitin-dependent protein catabolic process [GO:0043161]; protein autoubiquitination [GO:0051865]; protein polyubiquitination [GO:0000209]; regulation of miRNA-mediated gene silencing [GO:0060964]; regulation of neural precursor cell proliferation [GO:2000177]; stem cell proliferation [GO:0072089]
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             bile acid biosynthetic process [GO:0006699]
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                transposition, DNA-mediated [GO:0006313]
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      cell cycle [GO:0007049]; cell division [GO:0051301]; regulation of mitotic cell cycle [GO:0007346]
                                                                                                                                                                                                                   Gene.Ontology.IDs
1 GO:0000082; GO:0000209; GO:0000932; GO:0004842; GO:0008270; GO:0008543; GO:0010172; GO:0010586; GO:0017148; GO:0021915; GO:0030371; GO:0035198; GO:0035278; GO:0043161; GO:0051865; GO:0060964; GO:0061630; GO:0072089; GO:2000177
2 GO:0000082; GO:0000209; GO:0000932; GO:0004842; GO:0008270; GO:0008543; GO:0010172; GO:0010586; GO:0017148; GO:0021915; GO:0030371; GO:0035198; GO:0035278; GO:0043161; GO:0051865; GO:0060964; GO:0061630; GO:0072089; GO:2000177
3                                                                                                                                                                                                 GO:0006699; GO:0045302; GO:0047742
4                                                                                                                                                                                                             GO:0003964; GO:0006313
5                                                                                                                                     GO:0000922; GO:0005737; GO:0005815; GO:0007049; GO:0007346; GO:0019900; GO:0030496; GO:0051301
        mRNA
1 FUN_029594
2 FUN_029602
3 FUN_011056
4 FUN_034127
5 FUN_018376</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>in humans, miR-100 has been shown to target genes involved in growth and development. Examples include Plk1, a key mitotic checkpoint regulatory protein [26]; RBSP3, involved in cell proliferation and myeloid cell differentiation [27]; BMPR2, involved in osteogenesis [94]; and FRAP1/mTOR, which regulates cell growth [95]. (Liew et al, 2014)</p>
</blockquote>
<p><span class="citation" data-cites="liew_identification_2014">Liew et al. (2014)</span> found that predicted targets of miR-100 in <em>Stylophera pistillata</em> are enriched (topGO, FDR pval &lt; 0.01) for the Biological Processes:</p>
<p><strong>Biomineralisation:</strong> â€œGO:0060348: bone developmentâ€<br>
<strong>Transcription:</strong> â€œGO:0000122: negative regulation of transcription from RNA polymerase II promoterâ€<br>
<strong>Transport/Signaling:</strong> â€œGO:0006895: Golgi to endosome transportâ€<br>
<strong>Differentiation/Development:</strong> â€œGO:0035115: embryonic forelimb morphogenesisâ€<br>
<strong>Miscellaneous:</strong> â€œGO:0009987: cellular processâ€, â€œGO:0045176: apical protein localizationâ€</p>
</section>
<section id="mir-2050" class="level2">
<h2 class="anchored" data-anchor-id="mir-2050">mir-2050</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2050"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        GO.ID                                                   Term
1  GO:0006836                             neurotransmitter transport
2  GO:0001843                                    neural tube closure
3  GO:0015969             guanosine tetraphosphate metabolic process
4  GO:0000413                  protein peptidyl-prolyl isomerization
5  GO:0004064                                  arylesterase activity
6  GO:0005262                               calcium channel activity
7  GO:0004312                           fatty acid synthase activity
8  GO:0005539                              glycosaminoglycan binding
9  GO:0004560                            alpha-L-fucosidase activity
10 GO:0000977 RNA polymerase II transcription regulatory region s...
                 type
1  Biological.Process
2  Biological.Process
3  Biological.Process
4  Biological.Process
5  Molecular.Function
6  Molecular.Function
7  Molecular.Function
8  Molecular.Function
9  Molecular.Function
10 Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2050"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Gene.Ontology..biological.process. Gene.Ontology.IDs                 
[3] mRNA                              
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>(None of apul-mir-2050â€™s significantly correlated targets are annotated)</p>
<p><span class="citation" data-cites="grinblat_biogeography_2021">Grinblat (2021)</span> found miR-2050 was highly expressed during spawning in <em>Fungia fungites</em></p>
</section>
<section id="mir-2023" class="level2">
<h2 class="anchored" data-anchor-id="mir-2023">mir-2023</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2023"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                Term               type
1 GO:0004736       pyruvate carboxylase activity Molecular.Function
2 GO:0005388 P-type calcium transporter activity Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2023"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Gene.Ontology..biological.process. Gene.Ontology.IDs                 
[3] mRNA                              
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>(None of apul-mir-2023â€™s significantly correlated targets are annotated)</p>
<p><span class="citation" data-cites="liew_identification_2014">Liew et al. (2014)</span> found that predicted targets of miR-2023 in <em>Stylophera pistillata</em> are enriched (topGO, FDR pval &lt; 0.01) for the Biological Processes:</p>
<p><strong>Transport/signaling:</strong> â€œGO:0032869: cellular response to insulin stimulusâ€<br>
<strong>Cell cycle:</strong> â€œGO:0007049: cell cycleâ€<br>
<strong>Transcription:</strong> â€œGO:0006397: mRNA processingâ€<br>
<strong>Miscellaneous:</strong> â€œGO:0042177: negative regulation of protein catabolic processâ€, â€œGO:0007030: Golgi organizationâ€</p>
</section>
<section id="mir-2028" class="level2">
<h2 class="anchored" data-anchor-id="mir-2028">mir-2028</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2028"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                       Term               type
1 GO:0000278                         mitotic cell cycle Biological.Process
2 GO:0004345 glucose-6-phosphate dehydrogenase activity Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2028"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                        Gene.Ontology..biological.process.
1 mitotic cell cycle [GO:0000278]; positive regulation of NLRP3 inflammasome complex assembly [GO:1900227]
                                                                                                       Gene.Ontology.IDs
1 GO:0000278; GO:0000775; GO:0000922; GO:0004722; GO:0005634; GO:0005829; GO:0017018; GO:0046872; GO:0046982; GO:1900227
        mRNA
1 FUN_001214</code></pre>
</div>
</div>
</section>
<section id="mir-2036" class="level2">
<h2 class="anchored" data-anchor-id="mir-2036">mir-2036</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2036"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                                   Term
1 GO:0000209                             protein polyubiquitination
2 GO:0004591 oxoglutarate dehydrogenase (succinyl-transferring) ...
                type
1 Biological.Process
2 Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2036"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Gene.Ontology..biological.process. Gene.Ontology.IDs                 
[3] mRNA                              
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>(None of apul-mir-2036â€™s significantly correlated targets are annotated)</p>
<p><span class="citation" data-cites="liew_identification_2014">Liew et al. (2014)</span> found that predicted targets of miR-2036 in <em>Stylophera pistillata</em> are enriched (topGO, FDR pval &lt; 0.01) for the Biological Processes:</p>
<p><strong>Cytoskeleton:</strong> â€œGO:0030199: collagen fibril organizationâ€<br>
<strong>Differentiation/development:</strong> â€œGO:0021670: lateral ventricle developmentâ€, â€œGO:0003323: type B pancreatic cell developmentâ€, â€œGO:0045638: negative regulation of myeloid cell differentiationâ€<br>
<strong>Miscellaneous:</strong> â€œGO:0045766: positive regulation of angiogenesisâ€</p>
</section>
<section id="mir-2025" class="level2">
<h2 class="anchored" data-anchor-id="mir-2025">mir-2025</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2025"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                       Term               type
1 GO:0001649 osteoblast differentiation Biological.Process</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-2025"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Gene.Ontology..biological.process. Gene.Ontology.IDs                 
[3] mRNA                              
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>(None of apul-mir-2025â€™s significantly correlated targets are annotated)</p>
</section>
<section id="mir-9425" class="level2">
<h2 class="anchored" data-anchor-id="mir-9425">mir-9425</h2>
<p>Functions that are enriched in this miRNAâ€™s putative targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-9425"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                              Term
1 GO:0000082             G1/S transition of mitotic cell cycle
2 GO:0001523                        retinoid metabolic process
3 GO:0015101 organic cation transmembrane transporter activity
                type
1 Biological.Process
2 Biological.Process
3 Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-9425"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                              Gene.Ontology..biological.process.
1 beta-carotene metabolic process [GO:1901810]; carotene catabolic process [GO:0016121]; retinal metabolic process [GO:0042574]; retinoid metabolic process [GO:0001523]; retinol metabolic process [GO:0042572]
                                                                                           Gene.Ontology.IDs
1 GO:0001523; GO:0003834; GO:0005829; GO:0010436; GO:0016121; GO:0042572; GO:0042574; GO:0046872; GO:1901810
        mRNA
1 FUN_008226</code></pre>
</div>
</div>
</section>
<section id="apul-mir-novel-34-mir-2037" class="level2">
<h2 class="anchored" data-anchor-id="apul-mir-novel-34-mir-2037">apul-mir-novel-34 / miR-2037</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-novel-34"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        GO.ID                                                   Term
1  GO:0000266                                  mitochondrial fission
2  GO:0003360                                  brainstem development
3  GO:0000413                  protein peptidyl-prolyl isomerization
4  GO:0002291 T cell activation via T cell receptor contact with ...
5  GO:0002221         pattern recognition receptor signaling pathway
6  GO:0004013                        adenosylhomocysteinase activity
7  GO:0004402                     histone acetyltransferase activity
8  GO:0005200                 structural constituent of cytoskeleton
9  GO:0005109                                       frizzled binding
10 GO:0004758                 serine C-palmitoyltransferase activity
11 GO:0005245                 voltage-gated calcium channel activity
                 type
1  Biological.Process
2  Biological.Process
3  Biological.Process
4  Biological.Process
5  Biological.Process
6  Molecular.Function
7  Molecular.Function
8  Molecular.Function
9  Molecular.Function
10 Molecular.Function
11 Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-novel-34"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Gene.Ontology..biological.process.
1 activation of cysteine-type endopeptidase activity involved in apoptotic process [GO:0006919]; apoptotic process [GO:0006915]; cellular response to muramyl dipeptide [GO:0071225]; defense response to bacterium [GO:0042742]; defense response to Gram-positive bacterium [GO:0050830]; detection of bacterium [GO:0016045]; ERK1 and ERK2 cascade [GO:0070371]; I-kappaB kinase/NF-kappaB signaling [GO:0007249]; innate immune response [GO:0045087]; intracellular signal transduction [GO:0035556]; JNK cascade [GO:0007254]; pattern recognition receptor signaling pathway [GO:0002221]; positive regulation of cell death [GO:0010942]; positive regulation of cysteine-type endopeptidase activity involved in apoptotic process [GO:0043280]; positive regulation of dendritic cell antigen processing and presentation [GO:0002606]; positive regulation of ERK1 and ERK2 cascade [GO:0070374]; positive regulation of I-kappaB kinase/NF-kappaB signaling [GO:0043123]; positive regulation of interleukin-1 beta production [GO:0032731]; positive regulation of interleukin-6 production [GO:0032755]; positive regulation of interleukin-8 production [GO:0032757]; positive regulation of JNK cascade [GO:0046330]; positive regulation of macrophage cytokine production [GO:0060907]; positive regulation of NF-kappaB transcription factor activity [GO:0051092]; positive regulation of NIK/NF-kappaB signaling [GO:1901224]; positive regulation of nitric-oxide synthase activity [GO:0051000]; positive regulation of stress-activated MAPK cascade [GO:0032874]; positive regulation of tumor necrosis factor production [GO:0032760]; positive regulation of xenophagy [GO:1904417]; regulation of apoptotic process [GO:0042981]; stress-activated MAPK cascade [GO:0051403]; xenophagy [GO:0098792]
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   regulation of biological quality [GO:0065008]
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        proteolysis [GO:0006508]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Gene.Ontology.IDs
1 GO:0002221; GO:0002606; GO:0005524; GO:0005737; GO:0005829; GO:0005886; GO:0006915; GO:0006919; GO:0007249; GO:0007254; GO:0010942; GO:0016045; GO:0016323; GO:0016324; GO:0032731; GO:0032755; GO:0032757; GO:0032760; GO:0032874; GO:0035556; GO:0038187; GO:0042742; GO:0042802; GO:0042803; GO:0042981; GO:0043123; GO:0043280; GO:0044877; GO:0045087; GO:0045335; GO:0046330; GO:0050700; GO:0050830; GO:0051000; GO:0051092; GO:0051403; GO:0060907; GO:0070371; GO:0070374; GO:0071225; GO:0098792; GO:1901224; GO:1904417
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 GO:0004930; GO:0005886; GO:0065008
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 GO:0004252; GO:0005576; GO:0006508
        mRNA
1 FUN_035124
2 FUN_001557
3 FUN_037296</code></pre>
</div>
</div>
<p><span class="citation" data-cites="liew_identification_2014">Liew et al. (2014)</span> identify a matching miRNA in <em>Stylophora pistillata</em> (spi-miR-temp-20) with targets enriched (topGO, FDR pval &lt; 0.01) for the Biological Processes:</p>
<p><strong>Immunity:</strong> â€œGO:0032088: negative regulation of NF-kappaB transcription factor activityâ€<br>
<strong>Cell cycle:</strong> â€œGO:0042981: regulation of apoptotic processâ€<br>
<strong>Transport/signaling:</strong> â€œGO:0046330: positive regulation of JNK cascadeâ€<br>
<strong>Differentiation/development:</strong> â€œGO:0061146: Peyerâ€™s patch morphogenesisâ€<strong><br>
Miscellaneous:</strong> â€œGO:0048169: regulation of long-term neuronal synaptic plasticityâ€, â€œGO:0008542: visual learningâ€, â€œGO:0006290: pyrimidine dimer repairâ€</p>
</section>
<section id="apul-mir-novel-9" class="level2">
<h2 class="anchored" data-anchor-id="apul-mir-novel-9">apul-mir-novel-9</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FE</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-novel-9"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       GO.ID                                                   Term
1 GO:0001745                             compound eye morphogenesis
2 GO:0001933         negative regulation of protein phosphorylation
3 GO:0009734                      auxin-activated signaling pathway
4 GO:0004459                       L-lactate dehydrogenase activity
5 GO:0004760                  serine-pyruvate transaminase activity
6 GO:0004742 dihydrolipoyllysine-residue acetyltransferase activ...
7 GO:0003779                                          actin binding
                type
1 Biological.Process
2 Biological.Process
3 Biological.Process
4 Molecular.Function
5 Molecular.Function
6 Molecular.Function
7 Molecular.Function</code></pre>
</div>
</div>
<p>Functions of targets with significantly correlated expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sig_FA</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"apul-mir-novel-9"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Gene.Ontology..biological.process.
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cell cycle [GO:0007049]; cell division [GO:0051301]; regulation of mitotic cell cycle [GO:0007346]
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    signal transduction [GO:0007165]
3 I-kappaB kinase/NF-kappaB signaling [GO:0007249]; intracellular signal transduction [GO:0035556]; negative regulation of cytokine production involved in inflammatory response [GO:1900016]; negative regulation of epithelial cell proliferation [GO:0050680]; negative regulation of fibroblast proliferation [GO:0048147]; negative regulation of I-kappaB kinase/NF-kappaB signaling [GO:0043124]; negative regulation of inflammatory response [GO:0050728]; negative regulation of innate immune response [GO:0045824]; negative regulation of interferon-alpha production [GO:0032687]; negative regulation of interferon-beta production [GO:0032688]; negative regulation of interleukin-1 beta production [GO:0032691]; negative regulation of interleukin-12 production [GO:0032695]; negative regulation of interleukin-6 production [GO:0032715]; negative regulation of NF-kappaB transcription factor activity [GO:0032088]; negative regulation of NIK/NF-kappaB signaling [GO:1901223]; negative regulation of NLRP3 inflammasome complex assembly [GO:1900226]; negative regulation of phosphatidylinositol 3-kinase signaling [GO:0014067]; negative regulation of tumor necrosis factor production [GO:0032720]; regulation of protein ubiquitination [GO:0031396]; response to lipopolysaccharide [GO:0032496]; T cell activation [GO:0042110]
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      carboxylic acid metabolic process [GO:0019752]
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cell cycle [GO:0007049]; cell division [GO:0051301]; regulation of mitotic cell cycle [GO:0007346]
                                                                                                                                                                                                                                                                                                                               Gene.Ontology.IDs
1                                                                                                                                                                                                                         GO:0005737; GO:0005813; GO:0007049; GO:0007346; GO:0019900; GO:0030496; GO:0051301; GO:0072686; GO:0097431; GO:1990023
2                                                                                                                                                                                                                                                                                     GO:0003924; GO:0005525; GO:0005886; GO:0007165; GO:0019003
3 GO:0005524; GO:0005737; GO:0005829; GO:0007249; GO:0014067; GO:0031396; GO:0032088; GO:0032496; GO:0032687; GO:0032688; GO:0032691; GO:0032695; GO:0032715; GO:0032720; GO:0034451; GO:0035556; GO:0036312; GO:0042110; GO:0043124; GO:0043231; GO:0045824; GO:0048147; GO:0048471; GO:0050680; GO:0050728; GO:1900016; GO:1900226; GO:1901223
4                                                                                                                                                                                                                                                                                                             GO:0004459; GO:0005737; GO:0019752
5                                                                                                                                                                                                                                                 GO:0000922; GO:0005737; GO:0005815; GO:0007049; GO:0007346; GO:0019900; GO:0030496; GO:0051301
        mRNA
1 FUN_024529
2 FUN_038089
3 FUN_040522
4 FUN_006649
5 FUN_018376</code></pre>
</div>
</div>
<p><span class="citation" data-cites="gajigan_microrna_2017">Gajigan and Conaco (2017)</span> identify a miRNA in <em>Acropora digitifera</em> (Adi-Mir-Novel-5_3p) that matches our â€œapul-mir-novel-9â€. They found this miRNA was differentially expressed in response to thermal stress, and itâ€™s predicted targets were enriched (topGO, FDR pval &lt; 0.05) for:</p>
<p><strong>Regulation of expression:</strong> â€œRNA polymerase II transcription corepressor activityâ€, â€œHistone dephosphorylationâ€, â€œDNA demethylationâ€, â€œPositive regulation of transcription RNA poIII promoterâ€, â€œTranscription, DNA-templetedâ€, â€œCircadian regulation of gene expressionâ€<strong><br>
Stress response:</strong> â€œCytokine productionâ€, â€œOxidative stress-induced premature senescenceâ€, â€œMyD88-dependent toll-like receptorâ€, â€œProtein disulfide isomerase activityâ€, â€œSecretion of lysosomal enzymesâ€, â€œAdaptive immune responseâ€, â€œNegative regulation of cell cycleâ€<br>
<strong>Repair:</strong> â€œPositive regulation of DNA repairâ€, â€œRegulation of nucleotide-excisionâ€, â€œRNA repairâ€ â€œOxidative demethylationâ€<br>
<strong>Signaling:</strong> â€œReceptor catabolic processâ€, â€œG-protein coupled receptor kinaseâ€, â€œPhosphatidylinositol bindingâ€, â€œGABA receptor bindingâ€, â€œProtein serine/threonineâ€, â€œcAMP-dependent protein kinaseâ€<br>
<strong>Tissue morphogenisis:</strong> â€œType I TGFbeta receptor bindingâ€, â€œEmbryonic skeletal system morphogeneâ€, â€œZonula adherens maintenanceâ€<br>
</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-fridrich_ancient_2023" class="csl-entry">
Fridrich, Arie, Miguel Salinas-Saaverda, Itamar Kozlolvski, Joachim M. Surm, Eleni Chrysostomou, Abhinandan M. Tripathi, Uri Frank, and Yehu Moran. 2023. <span>â€œAn Ancient Pan-Cnidarian <span class="nocase">microRNA</span> Regulates Stinging Capsule Biogenesis in <em><span>Nematostella</span> Vectensis</em>.â€</span> <em>Cell Reports</em> 42 (9): 113072. <a href="https://doi.org/10.1016/j.celrep.2023.113072">https://doi.org/10.1016/j.celrep.2023.113072</a>.
</div>
<div id="ref-gajigan_microrna_2017" class="csl-entry">
Gajigan, Andrian P., and Cecilia Conaco. 2017. <span>â€œA <span class="nocase">microRNA</span> Regulates the Response of Corals to Thermal Stress.â€</span> <em>Molecular Ecology</em> 26 (13): 3472â€“83. <a href="https://doi.org/10.1111/mec.14130">https://doi.org/10.1111/mec.14130</a>.
</div>
<div id="ref-grinblat_biogeography_2021" class="csl-entry">
Grinblat, Mila. 2021. <span>â€œBiogeography, Reproductive Biology and Early Development in Scleractinian Corals.â€</span> Phd, James Cook University. <a href="https://doi.org/10.25903/5v26-zb37">https://doi.org/10.25903/5v26-zb37</a>.
</div>
<div id="ref-krishna_deep_2013" class="csl-entry">
Krishna, Srikar, Aparna Nair, Sirisha Cheedipudi, Deepak Poduval, Jyotsna Dhawan, Dasaradhi Palakodeti, and Yashoda Ghanekar. 2013. <span>â€œDeep Sequencing Reveals Unique Small <span>RNA</span> Repertoire That Is Regulated During Head Regeneration in <span>Hydra</span> Magnipapillata.â€</span> <em>Nucleic Acids Research</em> 41 (1): 599â€“616. <a href="https://doi.org/10.1093/nar/gks1020">https://doi.org/10.1093/nar/gks1020</a>.
</div>
<div id="ref-liew_identification_2014" class="csl-entry">
Liew, Yi Jin, Manuel Aranda, Adrian Carr, Sebastian Baumgarten, Didier Zoccola, Sylvie TambuttÃ©, Denis Allemand, Gos Micklem, and Christian R. Voolstra. 2014. <span>â€œIdentification of <span>MicroRNAs</span> in the <span>Coral</span> <span>Stylophora</span> Pistillata.â€</span> <em>PLOS ONE</em> 9 (3): e91101. <a href="https://doi.org/10.1371/journal.pone.0091101">https://doi.org/10.1371/journal.pone.0091101</a>.
</div>
<div id="ref-moran_cnidarian_2014" class="csl-entry">
Moran, Yehu, David Fredman, Daniela Praher, Xin Li, Liang Wee, Fabian Rentzsch, Phillip Zamore, Ulrich Technau, and HervÃ© Seitz. 2014. <span>â€œCnidarian <span class="nocase">microRNAs</span> Frequently Regulate Targets by Cleavage.â€</span> <em>Genome Research</em> 24 (March). <a href="https://doi.org/10.1101/gr.162503.113">https://doi.org/10.1101/gr.162503.113</a>.
</div>
<div id="ref-teefy2020" class="csl-entry">
Teefy, Bryan Barrett. 2020. <span>â€œThe Function of Small RNA Pathways in Cnidarians.â€</span> PhD thesis, United States â€“ California. <a href="https://www.proquest.com/docview/2503663922/abstract/885C0525BC204266PQ/1">https://www.proquest.com/docview/2503663922/abstract/885C0525BC204266PQ/1</a>.
</div>
</div></section></div> ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_10_dde_named_miRNA_functions.html</guid>
  <pubDate>Thu, 10 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries: miRNA-lncRNA Coexpression</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_16_timeseries_lncRNA_PCC.html</link>
  <description><![CDATA[ 




<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/14.2-Apul-miRNA-lncRNA-coexpression.Rmd">Code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/14.2-Apul-miRNA-lncRNA-coexpression.md">Rendered code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/tree/main/D-Apul/output/14.2-Apul-miRNA-lncRNA-coexpression">Output files</a></p>
<p>Iâ€™ve already used miRanda to predict miRNA-lncRNA binding. Now I want to assess coexpression for miRNA-lncRNA pairs using Pearsonâ€™s correlation coefficient.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#library(energy)</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span></code></pre></div>
<p>Now that weâ€™ve found putative interactions, including those with high complementarity, in <code>10-Apul-lncRNA-miRNA-miRanda</code> we need to validate by examining patterns of coexpression. Weâ€™d expect a putatively-interacting miRNA-lncRNA pair to be highly coexpressed, and weâ€™d expect a strong negative relationship to indicate either a lncRNA sponging miRNA OR an miRNA targeting lncRNA for degradation.</p>
<section id="obtain-pearsons-coefficient-correlation-values" class="level2">
<h2 class="anchored" data-anchor-id="obtain-pearsons-coefficient-correlation-values">0.1 Obtain Pearsonâ€™s coefficient correlation values</h2>
<p>Read in, format, and normalize data</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">miRNA_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>)</span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simplify column names</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_counts) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_.*"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_counts))</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_counts) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_counts))</span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove any miRNA with 0 counts across samples </span></span>
<span id="cb2-7">miRNA_counts<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>miRNA_counts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-10">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb2-11"></span>
<span id="cb2-12">lncRNA_counts_full <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/08-Apul-lncRNA/counts.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(lncRNA_counts_full) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lncRNA_counts_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Geneid</span>
<span id="cb2-14">lncRNA_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lncRNA_counts_full <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Geneid, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Chr, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Start, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>End, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Strand, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Length)</span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Format lncRNA column names to match the miRNA names</span></span>
<span id="cb2-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(lncRNA_counts) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"...data."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(lncRNA_counts))</span>
<span id="cb2-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(lncRNA_counts) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".sorted.bam"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(lncRNA_counts))</span>
<span id="cb2-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Order lncRNA column names to match the miRNA column order</span></span>
<span id="cb2-20">lncRNA_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lncRNA_counts[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_counts)]</span>
<span id="cb2-21"></span>
<span id="cb2-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check that the columns match name and order for both dataframes</span></span>
<span id="cb2-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(lncRNA_counts) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_counts)</span></code></pre></div>
<pre><code>##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [16] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [31] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove any lncRNAs with 0 for all samples </span></span>
<span id="cb4-2">lncRNA_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lncRNA_counts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-5">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to normalize counts (simple RPM normalization)</span></span>
<span id="cb4-8">normalize_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(counts) {</span>
<span id="cb4-9">  rpm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(counts) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(counts)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(rpm)</span>
<span id="cb4-11">}</span>
<span id="cb4-12"></span>
<span id="cb4-13">miRNA_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize_counts</span>(miRNA_counts)</span>
<span id="cb4-14">lncRNA_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize_counts</span>(lncRNA_counts)</span></code></pre></div>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to calculate PCC and p-value for a pair of vectors</span></span>
<span id="cb5-2">calc_pcc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, y) {</span>
<span id="cb5-3">  result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor.test</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>)</span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PCC =</span> result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_value =</span> result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value))</span>
<span id="cb5-5">}</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a data frame of all miRNA-lncRNA pairs</span></span>
<span id="cb5-8">pairs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand.grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">miRNA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(miRNA_norm), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lncRNA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(lncRNA_norm))</span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate PCC and p-value for each pair</span></span>
<span id="cb5-11">pcc_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pairs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pcc_stats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calc_pcc</span>(miRNA_norm[miRNA,], lncRNA_norm[lncRNA,]))</span>
<span id="cb5-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest_wider</span>(pcc_stats)</span>
<span id="cb5-17"></span>
<span id="cb5-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adjust p-values for FDR</span></span>
<span id="cb5-19">pcc_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pcc_results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adjusted_p_value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">p.adjust</span>(p_value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fdr"</span>))</span>
<span id="cb5-21"></span>
<span id="cb5-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save as csv</span></span>
<span id="cb5-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(pcc_results, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/14.2-Apul-miRNA-lncRNA-coexpression/Apul-PCC_miRNA_lncRNA-full.csv"</span>)</span></code></pre></div>
<p>Check</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in results </span></span>
<span id="cb6-2">pcc_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/14.2-Apul-miRNA-lncRNA-coexpression/Apul-PCC_miRNA_lncRNA-full.csv"</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use this code to download the PCC results if needed </span></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pcc_results &lt;- read.csv("https://gannet.fish.washington.edu/kdurkin1/ravenbackups/timeseries_molecular/D-Apul/output/14.2-Apul-miRNA-lncRNA-coexpression/Apul-PCC_miRNA_lncRNA-full.csv")</span></span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(pcc_results)</span></code></pre></div>
<pre><code>## [1] 950283</code></pre>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(pcc_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(PCC.cor) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span>))</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(pcc_results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))</span></code></pre></div>
<pre><code>## [1] 81605</code></pre>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(pcc_results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(PCC.cor) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span>))</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>of the 950,283 possible miRNA-lncRNA interactions, 3 have a Pearsonâ€™s correlation coefficient with a magnitude above 0.9, and 81,605 have a significant correlation (pval&lt;0.05). All of the coefficients with a magnitude &gt;0.9 are significant.</p>
<p>I find it interesting that so many putative interactions have significant pvalues, but so few have correlation coefficients above 0.9. What does the distribution of significant correlation coefficients look like?</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(pcc_results[pcc_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PCC.cor)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density of Significant Correlations"</span>,</span>
<span id="cb14-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Correlation Coefficient"</span>,</span>
<span id="cb14-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/14.2-Apul-miRNA-lncRNA-coexpression_files/figure-gfm/unnamed-chunk-5-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(pcc_results[pcc_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(PCC.cor))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density of Significant Correlations (magnitudes)"</span>,</span>
<span id="cb15-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Magnitude of Correlation Coefficient"</span>,</span>
<span id="cb15-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/14.2-Apul-miRNA-lncRNA-coexpression_files/figure-gfm/unnamed-chunk-5-2.png" class="img-fluid"><!-- --></p>
<p>Mean of the absolute value of correlation for significant correlation coefficients is <code>{r} round(mean(abs(pcc_results[pcc_results$p_value &lt; 0.05,]$PCC.cor)),2)</code></p>
</section>
<section id="incorporate-miranda-target-prediction-results" class="level1">
<h1>1 Incorporate miRanda target prediction results</h1>
<section id="full-lncrna" class="level2">
<h2 class="anchored" data-anchor-id="full-lncrna">1.1 full lncRNA</h2>
<p>I realized that the lncRNA counts matrix includes some duplicate lncRNA, where two or more distinct lncRNA IDs share the exact same genomic coordinates. As far as I can tell all of the duplicate lncRNAs have counts of 0 across all samples, so it was likely just a naming error. This also means the duplicates didnâ€™t affect the correlation calculations above, since I filtered out lncRNAs that had all-0 counts before PCC.</p>
<p>Iâ€™ll need to filter then out though to facilitate joining.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create mapping table that shows the full genomic location for each lncRNA</span></span>
<span id="cb16-2">lncRNA_mapping <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb16-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lncRNA =</span> lncRNA_counts_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Geneid,</span>
<span id="cb16-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(lncRNA_counts_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Chr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>, (lncRNA_counts_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Start<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, lncRNA_counts_full<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>End)</span>
<span id="cb16-5">)</span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Isolate lncRNA that have been repeated</span></span>
<span id="cb16-8">repeats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lncRNA_mapping[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">duplicated</span>(lncRNA_mapping<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">duplicated</span>(lncRNA_mapping<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fromLast =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), ]</span>
<span id="cb16-9"></span>
<span id="cb16-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Isolate the repeated lncRNA counts</span></span>
<span id="cb16-11">repeats_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lncRNA_counts_full <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Geneid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> repeats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lncRNA)</span>
<span id="cb16-12"></span>
<span id="cb16-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(lncRNA_mapping)</span></code></pre></div>
<pre><code>## [1] 24181</code></pre>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(lncRNA_mapping<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location))</span></code></pre></div>
<pre><code>## [1] 23782</code></pre>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(lncRNA_mapping) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(lncRNA_mapping<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location))</span></code></pre></div>
<pre><code>## [1] 399</code></pre>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(repeats_counts)</span></code></pre></div>
<pre><code>##                Geneid      Chr   Start     End Strand Length
## lncRNA_062 lncRNA_062 ntLink_6 7465722 7467150      +   1429
## lncRNA_063 lncRNA_063 ntLink_6 7465722 7467150      +   1429
## lncRNA_071 lncRNA_071 ntLink_6 7548691 7551215      +   2525
## lncRNA_072 lncRNA_072 ntLink_6 7548691 7551215      +   2525
## lncRNA_080 lncRNA_080 ntLink_6 9559991 9569239      +   9249
## lncRNA_081 lncRNA_081 ntLink_6 9559991 9569239      +   9249
##            ...data.1A10.sorted.bam ...data.1A12.sorted.bam
## lncRNA_062                       0                       0
## lncRNA_063                       0                       0
## lncRNA_071                       0                       0
## lncRNA_072                       0                       0
## lncRNA_080                       0                       0
## lncRNA_081                       0                       0
##            ...data.1A1.sorted.bam ...data.1A2.sorted.bam ...data.1A8.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.1A9.sorted.bam ...data.1B10.sorted.bam
## lncRNA_062                      0                       0
## lncRNA_063                      0                       0
## lncRNA_071                      0                       0
## lncRNA_072                      0                       0
## lncRNA_080                      0                       0
## lncRNA_081                      0                       0
##            ...data.1B1.sorted.bam ...data.1B2.sorted.bam ...data.1B5.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.1B9.sorted.bam ...data.1C10.sorted.bam
## lncRNA_062                      0                       0
## lncRNA_063                      0                       0
## lncRNA_071                      0                       0
## lncRNA_072                      0                       0
## lncRNA_080                      0                       0
## lncRNA_081                      0                       0
##            ...data.1C4.sorted.bam ...data.1D10.sorted.bam
## lncRNA_062                      0                       0
## lncRNA_063                      0                       0
## lncRNA_071                      0                       0
## lncRNA_072                      0                       0
## lncRNA_080                      0                       0
## lncRNA_081                      0                       0
##            ...data.1D3.sorted.bam ...data.1D4.sorted.bam ...data.1D6.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.1D8.sorted.bam ...data.1D9.sorted.bam ...data.1E1.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.1E3.sorted.bam ...data.1E5.sorted.bam ...data.1E9.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.1F11.sorted.bam ...data.1F4.sorted.bam
## lncRNA_062                       0                      0
## lncRNA_063                       0                      0
## lncRNA_071                       0                      0
## lncRNA_072                       0                      0
## lncRNA_080                       0                      0
## lncRNA_081                       0                      0
##            ...data.1F8.sorted.bam ...data.1G5.sorted.bam
## lncRNA_062                      0                      0
## lncRNA_063                      0                      0
## lncRNA_071                      0                      0
## lncRNA_072                      0                      0
## lncRNA_080                      0                      0
## lncRNA_081                      0                      0
##            ...data.1H11.sorted.bam ...data.1H12.sorted.bam
## lncRNA_062                       0                       0
## lncRNA_063                       0                       0
## lncRNA_071                       0                       0
## lncRNA_072                       0                       0
## lncRNA_080                       0                       0
## lncRNA_081                       0                       0
##            ...data.1H6.sorted.bam ...data.1H7.sorted.bam ...data.1H8.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.2B2.sorted.bam ...data.2B3.sorted.bam ...data.2C1.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.2C2.sorted.bam ...data.2D2.sorted.bam ...data.2E2.sorted.bam
## lncRNA_062                      0                      0                      0
## lncRNA_063                      0                      0                      0
## lncRNA_071                      0                      0                      0
## lncRNA_072                      0                      0                      0
## lncRNA_080                      0                      0                      0
## lncRNA_081                      0                      0                      0
##            ...data.2F1.sorted.bam ...data.2G1.sorted.bam
## lncRNA_062                      0                      0
## lncRNA_063                      0                      0
## lncRNA_071                      0                      0
## lncRNA_072                      0                      0
## lncRNA_080                      0                      0
## lncRNA_081                      0                      0</code></pre>
<p>There are 399 duplicate lncRNAs in the counts data</p>
<p>Since Iâ€™ll be using <code>lncRNA_mapping</code> for joining purposes, it must contain only unique genomic locations.</p>
<p>Deduplicate <code>lncRNA_mapping</code>:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">unique_mapping <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lncRNA_mapping[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">duplicated</span>(lncRNA_mapping<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location), ]</span>
<span id="cb24-2"></span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(lncRNA_mapping) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(unique_mapping)</span></code></pre></div>
<pre><code>## [1] 399</code></pre>
<p>Great! Now that we have a mapping file of only our unique lncRNAs, we can proceed to incorporating the miRanda output.</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA-lncRNA_full miRanda output</span></span>
<span id="cb26-2">miRNA_lncRNA_miRanda <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/10-Apul-lncRNA-miRNA-miRanda/Apul-miRanda-lncRNA-strict-parsed.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<pre><code>## Rows: 178148 Columns: 9
## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Delimiter: "\t"
## chr (6): X1, X2, X5, X6, X8, X9
## dbl (3): X3, X4, X7
## 
## â„¹ Use `spec()` to retrieve the full column specification for this data.
## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRNA_lncRNA_miRanda) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mirna"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Target"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Score"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Energy_Kcal_Mol"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Query_Aln"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject_Aln"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Al_Len"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject_Identity"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Query_Identity"</span>)</span>
<span id="cb28-2"></span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format miRNA names</span></span>
<span id="cb28-5">miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mirna <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mirna)</span>
<span id="cb28-6">miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mirna <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">..*"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mirna)</span>
<span id="cb28-7"></span>
<span id="cb28-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join with mapping file to annote miRanda results with lncRNA IDs</span></span>
<span id="cb28-9">miRNA_lncRNA_miRanda <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(miRNA_lncRNA_miRanda, unique_mapping, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Target"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>))</span>
<span id="cb28-10"></span>
<span id="cb28-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a columns that contains both the miRNA and interacting lncRNA</span></span>
<span id="cb28-12">pcc_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>interaction <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(pcc_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>, pcc_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lncRNA)</span>
<span id="cb28-13">miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>interaction <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mirna, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>, miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lncRNA)</span>
<span id="cb28-14"></span>
<span id="cb28-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Annotate miRanda results w PCC info </span></span>
<span id="cb28-16">miRNA_lncRNA_miRanda <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(miRNA_lncRNA_miRanda, pcc_results, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"interaction"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter to high complementarity putative targets</span></span>
<span id="cb29-2">target_21bp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_lncRNA_miRanda[miRNA_lncRNA_miRanda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Al_Len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,]</span>
<span id="cb29-3">target_21bp_3mis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> target_21bp[target_21bp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Subject_Identity<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>,]</span>
<span id="cb29-4"></span>
<span id="cb29-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># How many w significant correlation?</span></span>
<span id="cb29-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(miRNA_lncRNA_miRanda)</span></code></pre></div>
<pre><code>## [1] 178148</code></pre>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(miRNA_lncRNA_miRanda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(PCC.cor)))</span></code></pre></div>
<pre><code>## [1] 115512</code></pre>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(miRNA_lncRNA_miRanda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))</span></code></pre></div>
<pre><code>## [1] 9677</code></pre>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(target_21bp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))</span></code></pre></div>
<pre><code>## [1] 1396</code></pre>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(target_21bp_3mis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>For miRNA binding to lncRNA, miRanda predicts 178,148 putative interactions. Of these, 115,512 yield a correlation value (indicating the lncRNA is actually present in our counts data); 9,677 have significant PCCs; 1,396 are &gt;21bp and have signficant PCCs; and 0 are &gt;21bp with &lt;=3 mismatches and have significant PCCs.</p>
</section>
</section>
<section id="summary" class="level1">
<h1>2 Summary</h1>
<p>How does different input and/or complementarity filtering affect # putative interactions:</p>
<p>Reminder summary of miRanda results:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;">All</th>
<th style="text-align: left;">21bp</th>
<th style="text-align: left;">21bp, &gt;=3 mismatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lncRNA</td>
<td style="text-align: left;">178,148</td>
<td style="text-align: left;">24,018 (13.48% of total)</td>
<td style="text-align: left;">22 (0.012% of total)</td>
</tr>
</tbody>
</table>
<p>For different filters, how many putative interactions <strong><em>also show significant coexpression</em></strong> (PCC pval &lt; 0.05)?</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;">All</th>
<th style="text-align: left;">21bp</th>
<th style="text-align: left;">21bp, &gt;=3 mismatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lncRNA</td>
<td style="text-align: left;">105,835</td>
<td style="text-align: left;">14,503 (13.7% of total)</td>
<td style="text-align: left;">13 (0.012% of total)</td>
</tr>
</tbody>
</table>
<p>Note that some putative interactions indicated by miRanda are not present in the counts data (i.e.&nbsp;the miRNA and/or lncRNA had 0 counts inour RNAseq data), and are thus excluded from the PCC-filtered data</p>
<p>Is there a clear â€œcutoffâ€ for what complementarity parameters are most associated with significant coexpression?</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">significant_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_lncRNA_miRanda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb39-2"></span>
<span id="cb39-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot with jitter (significant coexpression only)</span></span>
<span id="cb39-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(significant_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Al_Len, </span>
<span id="cb39-5">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, Subject_Identity)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density_2d_filled</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">contour_var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"density"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(significant_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Al_Len), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(significant_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Al_Len), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alignment Length (Al_Len)"</span>, </span>
<span id="cb39-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject Identity (%)"</span>, </span>
<span id="cb39-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2D Density: Alignment Length vs. Subject Identity (p &lt; 0.05)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/14.2-Apul-miRNA-lncRNA-coexpression_files/figure-gfm/unnamed-chunk-10-1.png" class="img-fluid">Interesting! There are significant coexpressions happening across both metrics of complementarity, but we see clustering between 17 and 20nt alignment length.</p>
<p>In other words, for all the miRNA-lncRNA binding interactions predicted by miRanda, interactions with high alignment lengths (17-20nt) appear most likely to also show significantly correlated expression.</p>
<p>Thereâ€™s also a cluster at the top left corner, showing us that many interactions significant correlations have low alignment lengths but perfect complementarity. this likely represents perfect binding in the seed region.</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save putative interactions with significantly correlated coexpression for visualization</span></span>
<span id="cb40-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (e.g. creating an interaction network plot in Cytoscape)</span></span>
<span id="cb40-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(significant_df, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/14.2-Apul-miRNA-lncRNA-coexpression/miRanda-PCC-significant-miRNA_lncRNA.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_16_timeseries_lncRNA_PCC.html</guid>
  <pubDate>Thu, 10 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-Dive Expression: Functional annotation/enrichment of each miRNAâ€™s targets</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_09_dde_miranda_miRNA_FE.html</link>
  <description><![CDATA[ 




<p>This code attempts to identify the function of each miRNA by running functional enrichment analysis on each miRNAâ€™s set of target genes.</p>
<p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment.Rmd">Code</a><br>
<a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment.md?plain=1">Rendered code</a><br>
<a href="https://github.com/urol-e5/deep-dive-expression/tree/main/D-Apul/output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment">Output files</a></p>
<p>Also see post on <a href="../../../posts/projects/E5_coral/2025_04_08_dde_miranda_FE.html">functional enrichment of all targets</a></p>
<section id="format-topgo-files" class="level1">
<h1>1 Format topGO files</h1>
<section id="read-in-and-format-annotation-files" class="level2">
<h2 class="anchored" data-anchor-id="read-in-and-format-annotation-files">1.1 Read in and format annotation files</h2>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in Apul annotations</span></span>
<span id="cb1-2">annot_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab"</span>)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unneeded columns </span></span>
<span id="cb1-4">annot_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot_locations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>X, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>V13)</span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure there are no duplicate rows</span></span>
<span id="cb1-6">annot_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot_locations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(annot_locations)</span></code></pre></div>
<pre><code>##                     V1     V3 Protein.names
## 1   ntLink_4:1155-1537 P35061   Histone H2A
## 2   ntLink_4:2660-3441 P84239    Histone H3
## 3   ntLink_4:4515-6830 P35061   Histone H2A
## 4   ntLink_4:7096-7859 P84239    Histone H3
## 5   ntLink_4:8474-9669 P35061   Histone H2A
## 6 ntLink_4:11162-11925 P84239    Histone H3
##                                     Organism Gene.Ontology..biological.process.
## 1          Acropora formosa (Staghorn coral)                                   
## 2 Urechis caupo (Innkeeper worm) (Spoonworm)                                   
## 3          Acropora formosa (Staghorn coral)                                   
## 4 Urechis caupo (Innkeeper worm) (Spoonworm)                                   
## 5          Acropora formosa (Staghorn coral)                                   
## 6 Urechis caupo (Innkeeper worm) (Spoonworm)                                   
##                                            Gene.Ontology.IDs
## 1 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 2 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 3 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 4 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 5 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 6 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982</code></pre>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Looks good!</span></span></code></pre></div>
<p>This file shows each gene as itâ€™s genomic location. We want to use gene IDs to associate genes, so add gene IDs to this annotation table</p>
<p>Read in file that associates each mRNA genomic location with corresponding gene ID</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">mRNA_FUNids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/15-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"product"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unwanted text from parent column</span></span>
<span id="cb4-4">mRNA_FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parent="</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, mRNA_FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID)</span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only need to keep mRNA location and gene ID</span></span>
<span id="cb4-6">mRNA_FUNids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mRNA_FUNids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(location, gene_ID)</span></code></pre></div>
<p>join with annotation file</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># join</span></span>
<span id="cb5-2">annot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(annot_locations, mRNA_FUNids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>))</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensure there are no duplicate rows</span></span>
<span id="cb5-5">annot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span></code></pre></div>
</section>
<section id="set-up-gene2go-object" class="level2">
<h2 class="anchored" data-anchor-id="set-up-gene2go-object">1.2 Set up gene2GO object</h2>
<p>Want to isolate a list of GO terms per gene</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Gene.Ontology.IDs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(gene_ID, Gene.Ontology.IDs)</span>
<span id="cb6-2">gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GO.ID =</span> Gene.Ontology.IDs)</span>
<span id="cb6-3"></span>
<span id="cb6-4">gene2go_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setNames</span>(</span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>), </span>
<span id="cb6-6">  gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID</span>
<span id="cb6-7">)</span></code></pre></div>
<p>Note: I think this means genes that had a Uniprot ID but no GO terms are excluded from this analysis</p>
</section>
<section id="define-reference-set" class="level2">
<h2 class="anchored" data-anchor-id="define-reference-set">1.3 Define reference set</h2>
<p>Define reference set of genes. This should be all genes <em>found in our samples</em>, NOT all genes in the A.pulchra genome. Some genes (e.g., reproduction pathways) may not be found/expected in our samples for valid biological reasons.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in counts matrix</span></span>
<span id="cb7-2">Apul_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/07-Apul-Hisat/Apul-gene_count_matrix.csv"</span>)</span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exclude genes with all 0 counts</span></span>
<span id="cb7-4">Apul_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_counts[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_counts[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select gene IDs of the genes present in our samples</span></span>
<span id="cb7-7">all_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_counts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(all_genes)</span></code></pre></div>
<pre><code>## [1] 33624</code></pre>
<p>So we have a reference set of 33624 genes present in our samples.</p>
</section>
<section id="read-in-pccmiranda-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-pccmiranda-data">1.4 Read in PCC/miranda data</h2>
<p>This is a table of all putative miRNA-mRNA binding predicted by miRanda, plus Pearsons correlation coefficients for coexpression of each putative binding pair.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09-Apul-mRNA-miRNA-interactions/miranda_PCC_miRNA_mRNA.csv"</span>)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data)</span></code></pre></div>
<pre><code>##   X         miRNA       mRNA    PCC.cor   p_value adjusted_p_value score energy
## 1 1  Cluster_5981 FUN_028147  0.6825537 0.2041707        0.9986496   146 -22.19
## 2 2 Cluster_15340 FUN_013332  0.6371070 0.2476393        0.9986496   158 -23.15
## 3 3  Cluster_5981 FUN_041253 -0.2250869 0.7158492        0.9986496   153 -20.50
## 4 4  Cluster_3366 FUN_010827  0.3671005 0.5433145        0.9986496   163 -22.14
## 5 5  Cluster_3367 FUN_010827  0.5369304 0.3507987        0.9986496   163 -22.14
## 6 6 Cluster_15340 FUN_003342  0.1096213 0.8607058        0.9986496   154 -20.65
##   query_start_end subject_start_end total_bp_shared query_similar
## 1            2 21           185 209              21        66.67%
## 2            2 20           198 220              19        68.42%
## 3            2 21           699 719              19        73.68%
## 4            2 18           346 368              16        81.25%
## 5            2 18           346 368              16        81.25%
## 6            2 20           562 585              20        65.00%
##   subject_similar
## 1          71.43%
## 2          84.21%
## 3          73.68%
## 4          93.75%
## 5          93.75%
## 6          80.00%</code></pre>
<p>Set function to select genes of interest (ie those that have pvalue &lt; 0.05)</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">topDiffGenes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(allScore) {</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(allScore <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)}</span></code></pre></div>
</section>
</section>
<section id="fa-of-all-mirna-targets" class="level1">
<h1>2 FA of all miRNA targets</h1>
<p>Functional annotation of all putative miRNA targets</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">cor_bind_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(data, annot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb12-2"></span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(cor_bind_FA)</span></code></pre></div>
<pre><code>## [1] 4657</code></pre>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(cor_bind_FA[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(cor_bind_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Gene.Ontology.IDs),])</span></code></pre></div>
<pre><code>## [1] 923</code></pre>
<p>Of the 4657 putative miRNA targets predicted by miRanda, 923 have available annotations</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">sig_cor_bind_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cor_bind_FA[cor_bind_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(sig_cor_bind_FA)</span></code></pre></div>
<pre><code>## [1] 266</code></pre>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(sig_cor_bind_FA[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(sig_cor_bind_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Gene.Ontology.IDs),])</span></code></pre></div>
<pre><code>## [1] 52</code></pre>
<p>Of the 266 putative miRNA targets predicted by miRanda that are also have significantly correlated expression, only 52 have available annotations. This is an average of 1-2 annotated targets per miRNA. This unfortunately means <strong>functional enrichment analysis will likely be uninformative for most groups of significantly coexpressed targets.</strong></p>
<p>Save</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(cor_bind_FA, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/miRNA_targets_FA.csv"</span>)</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(sig_cor_bind_FA, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/miRNA_sig_cor_targets_FA.csv"</span>)</span></code></pre></div>
</section>
<section id="fe-of-specific-mirnas-targets-all-targets" class="level1">
<h1>3 FE of specific miRNAâ€™s targets (all targets)</h1>
<p>Create topGO function for use with miRNA names</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">miRNA_topGO_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(miRNA.name, input_interactions) {</span>
<span id="cb21-2">  </span>
<span id="cb21-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Isolate genes in our input module of interest</span></span>
<span id="cb21-4">  interacting_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> input_interactions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> miRNA.name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(mRNA)</span>
<span id="cb21-7">  </span>
<span id="cb21-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(interacting_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb21-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create factor for all reference genes, where 1 represents module membership and 0 means the gene is not in module of interest</span></span>
<span id="cb21-10">    gene_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(all_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> interacting_genes))</span>
<span id="cb21-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(gene_list) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes</span>
<span id="cb21-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(gene_list)</span>
<span id="cb21-13">    </span>
<span id="cb21-14">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Biological Process ##</span></span>
<span id="cb21-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create topGO object</span></span>
<span id="cb21-16">    GO_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb21-17">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BP"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Biological Process</span></span>
<span id="cb21-18">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes =</span> gene_list,</span>
<span id="cb21-19">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb21-20">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO =</span> gene2go_list,</span>
<span id="cb21-21">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span>
<span id="cb21-22">    </span>
<span id="cb21-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run GO enrichment test</span></span>
<span id="cb21-24">    GO_BP_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span>
<span id="cb21-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View the results</span></span>
<span id="cb21-26">    GO_BP_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_BP_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span>
<span id="cb21-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter by significant results</span></span>
<span id="cb21-28">    GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb21-29">    GO_BP_results_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_BP_results[GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span>
<span id="cb21-30">    </span>
<span id="cb21-31">    </span>
<span id="cb21-32">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Molecular Function ##</span></span>
<span id="cb21-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create topGO object</span></span>
<span id="cb21-34">    GO_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb21-35">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MF"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Molecular Function</span></span>
<span id="cb21-36">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes =</span> gene_list,</span>
<span id="cb21-37">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb21-38">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO =</span> gene2go_list,</span>
<span id="cb21-39">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span>
<span id="cb21-40">    </span>
<span id="cb21-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run GO enrichment test</span></span>
<span id="cb21-42">    GO_MF_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span>
<span id="cb21-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View the results</span></span>
<span id="cb21-44">    GO_MF_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_MF_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span>
<span id="cb21-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter by significant results</span></span>
<span id="cb21-46">    GO_MF_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_MF_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb21-47">    GO_MF_results_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_MF_results[GO_MF_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span>
<span id="cb21-48">  </span>
<span id="cb21-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return</span></span>
<span id="cb21-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add type column only if results exist</span></span>
<span id="cb21-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(GO_BP_results_sig) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb21-52">      GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological.Process"</span></span>
<span id="cb21-53">    }</span>
<span id="cb21-54">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(GO_MF_results_sig) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb21-55">      GO_MF_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular.Function"</span></span>
<span id="cb21-56">    }</span>
<span id="cb21-57">    GO_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(GO_BP_results_sig, GO_MF_results_sig)</span>
<span id="cb21-58">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(GO_results)</span>
<span id="cb21-59">  }</span>
<span id="cb21-60">}</span></code></pre></div>
<p>Loop through all miRNA and run functional enrichment on the miRNAâ€™s targets (all predicted targets)</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">interacting_miRNAs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(cor_bind_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> na.omit</span>
<span id="cb22-2">results_all_targets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize empty df</span></span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(miRNA <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> interacting_miRNAs) {</span>
<span id="cb22-5">  </span>
<span id="cb22-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run topGO enrichment function</span></span>
<span id="cb22-7">  miRNA_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">miRNA_topGO_FE</span>(miRNA, cor_bind_FA)</span>
<span id="cb22-8">  </span>
<span id="cb22-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep results if not empty</span></span>
<span id="cb22-10">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(miRNA_results) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb22-11">    </span>
<span id="cb22-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the miRNA source column</span></span>
<span id="cb22-13">    miRNA_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA</span>
<span id="cb22-14"></span>
<span id="cb22-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind to the accumulating results data frame</span></span>
<span id="cb22-16">    results_all_targets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(results_all_targets, miRNA_results)</span>
<span id="cb22-17">  }</span>
<span id="cb22-18">}</span></code></pre></div>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(results_all_targets)</span></code></pre></div>
<pre><code>##        GO.ID                                                   Term Annotated
## 1 GO:0001745                             compound eye morphogenesis         3
## 2 GO:0001933         negative regulation of protein phosphorylation         5
## 3 GO:0009734                      auxin-activated signaling pathway         5
## 4 GO:0004459                       L-lactate dehydrogenase activity         1
## 5 GO:0004760                  serine-pyruvate transaminase activity         1
## 6 GO:0004742 dihydrolipoyllysine-residue acetyltransferase activ...         1
##   Significant Expected Fisher               type        miRNA
## 1           1     0.03  0.027 Biological.Process Cluster_5981
## 2           1     0.05  0.045 Biological.Process Cluster_5981
## 3           1     0.05  0.045 Biological.Process Cluster_5981
## 4           1     0.01  0.012 Molecular.Function Cluster_5981
## 5           1     0.01  0.012 Molecular.Function Cluster_5981
## 6           1     0.01  0.012 Molecular.Function Cluster_5981</code></pre>
<p>Save results</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(results_all_targets, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/miRNA_all_targets_topGO_FE.csv"</span>)</span></code></pre></div>
</section>
<section id="fe-of-specific-mirnas-targets-significant-cor-targets" class="level1">
<h1>4 FE of specific miRNAâ€™s targets (significant cor targets)</h1>
<p>Loop through all miRNA and run functional enrichment on the miRNAâ€™s significantly correlated targets</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">interacting_miRNAs_sig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(sig_cor_bind_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> na.omit</span>
<span id="cb26-2">results_sig_cor_targets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize empty df</span></span>
<span id="cb26-3"></span>
<span id="cb26-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(miRNA <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> interacting_miRNAs_sig) {</span>
<span id="cb26-5">  </span>
<span id="cb26-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run topGO enrichment function</span></span>
<span id="cb26-7">  miRNA_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">miRNA_topGO_FE</span>(miRNA, sig_cor_bind_FA)</span>
<span id="cb26-8">  </span>
<span id="cb26-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep results if not empty</span></span>
<span id="cb26-10">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(miRNA_results) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb26-11">    </span>
<span id="cb26-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the miRNA source column</span></span>
<span id="cb26-13">    miRNA_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA</span>
<span id="cb26-14"></span>
<span id="cb26-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind to the accumulating results data frame</span></span>
<span id="cb26-16">    results_sig_cor_targets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(results_sig_cor_targets, miRNA_results)</span>
<span id="cb26-17">  }</span>
<span id="cb26-18">}</span></code></pre></div>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(results_sig_cor_targets)</span></code></pre></div>
<pre><code>##        GO.ID                                           Term Annotated
## 1 GO:0001947                                  heart looping         4
## 2 GO:0003341                                cilium movement        22
## 3 GO:0004842         ubiquitin-protein transferase activity        35
## 4 GO:0002221 pattern recognition receptor signaling pathway        11
## 5 GO:0004252             serine-type endopeptidase activity        53
## 6 GO:0001933 negative regulation of protein phosphorylation         5
##   Significant Expected Fisher               type         miRNA
## 1           1     0.00 0.0028 Biological.Process Cluster_19193
## 2           1     0.02 0.0150 Biological.Process Cluster_10051
## 3           1     0.02 0.0240 Molecular.Function Cluster_10051
## 4           1     0.01 0.0077 Biological.Process Cluster_16409
## 5           1     0.04 0.0370 Molecular.Function Cluster_16409
## 6           1     0.00 0.0035 Biological.Process  Cluster_3250</code></pre>
<p>Save results</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(results_sig_cor_targets, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/miRNA_sig_cor_targets_topGO_FE.csv"</span>)</span></code></pre></div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_09_dde_miranda_miRNA_FE.html</guid>
  <pubDate>Wed, 09 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-Dive Expression: Functional enrichment of miRNA-mRNA interactions</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_08_dde_miranda_FE.html</link>
  <description><![CDATA[ 




<p>Weâ€™ve identified putative miRNA-mRNA interactions by using miRanda to predict miRNA-mRNA binding, then using Pearsonâ€™s correlation coefficient to evaluate coexpression of putatively binding miRNA-mRNA pairs.</p>
<p>This code performs functional enrichment analysis to investigate the function(s) of these putative miRNA targets</p>
<p><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment.Rmd">Code</a><br>
<a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment.md">Rendered Code</a><br>
<a href="https://github.com/urol-e5/deep-dive-expression/tree/main/D-Apul/output">Output files</a></p>
<section id="results" class="level1">
<h1>Results</h1>
<p><strong>miRNA targets with significant negative correlation:</strong></p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 45%">
<col style="width: 16%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>GO ID</th>
<th>Term</th>
<th>Fisher p_val</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GO:0016980</td>
<td>creatinase&nbsp;activity</td>
<td>0.0035</td>
<td>Molecular Function</td>
</tr>
<tr class="even">
<td>GO:0004126</td>
<td>cytidine&nbsp;deaminase&nbsp;activity</td>
<td>0.0175</td>
<td>Molecular Function</td>
</tr>
<tr class="odd">
<td>GO:0003924</td>
<td>GTPase&nbsp;activity</td>
<td>0.0218</td>
<td>Molecular Function</td>
</tr>
<tr class="even">
<td>GO:0004966</td>
<td>galanin&nbsp;receptor&nbsp;activity</td>
<td>0.0415</td>
<td>Molecular Function</td>
</tr>
<tr class="odd">
<td>GO:0000272</td>
<td>polysaccharide catabolic process</td>
<td>0.038</td>
<td>Biological Process</td>
</tr>
<tr class="even">
<td>GO:0000082</td>
<td>G1/S transition of mitotic cell cycle</td>
<td>0.046</td>
<td>Biological Process</td>
</tr>
</tbody>
</table>
<p><strong>miRNA targets with significant positive correlation:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>GO ID</th>
<th>Term</th>
<th>Fisher p_val</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GO:0003924</td>
<td>GTPase activity</td>
<td>0.0218</td>
<td>Molecular Function</td>
</tr>
</tbody>
</table>
</section>
<section id="code" class="level1">
<h1>Code</h1>
</section>
<section id="mrna-mirna-interactions-functional-enrichment" class="level1">
<h1>mRNA-miRNA interactions functional enrichment</h1>
<p>Code used below was created by <code>Jill Ashey</code>, modified for use with A.pulchra datasets by <code>Kathleen Durkin</code></p>
</section>
<section id="format-topgo-files" class="level1">
<h1>1 Format topGO files</h1>
<section id="read-in-and-format-annotation-files" class="level2">
<h2 class="anchored" data-anchor-id="read-in-and-format-annotation-files">1.1 Read in and format annotation files</h2>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in Apul annotations</span></span>
<span id="cb1-2">annot_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab"</span>)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unneeded columns </span></span>
<span id="cb1-4">annot_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot_locations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>X, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>V13)</span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure there are no duplicate rows</span></span>
<span id="cb1-6">annot_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot_locations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(annot_locations)</span></code></pre></div>
<pre><code>##                     V1     V3 Protein.names
## 1   ntLink_4:1155-1537 P35061   Histone H2A
## 2   ntLink_4:2660-3441 P84239    Histone H3
## 3   ntLink_4:4515-6830 P35061   Histone H2A
## 4   ntLink_4:7096-7859 P84239    Histone H3
## 5   ntLink_4:8474-9669 P35061   Histone H2A
## 6 ntLink_4:11162-11925 P84239    Histone H3
##                                     Organism Gene.Ontology..biological.process.
## 1          Acropora formosa (Staghorn coral)                                   
## 2 Urechis caupo (Innkeeper worm) (Spoonworm)                                   
## 3          Acropora formosa (Staghorn coral)                                   
## 4 Urechis caupo (Innkeeper worm) (Spoonworm)                                   
## 5          Acropora formosa (Staghorn coral)                                   
## 6 Urechis caupo (Innkeeper worm) (Spoonworm)                                   
##                                            Gene.Ontology.IDs
## 1 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 2 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 3 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 4 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 5 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982
## 6 GO:0000786; GO:0003677; GO:0005634; GO:0030527; GO:0046982</code></pre>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Looks good!</span></span></code></pre></div>
<p>This file shows each gene as itâ€™s genomic location. We want to use gene IDs to associate genes, so add gene IDs to this annotation table</p>
<p>Read in file that associates each mRNA genomic location with corresponding gene ID</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">mRNA_FUNids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/15-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"product"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unwanted text from parent column</span></span>
<span id="cb4-4">mRNA_FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parent="</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, mRNA_FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID)</span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only need to keep mRNA location and gene ID</span></span>
<span id="cb4-6">mRNA_FUNids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mRNA_FUNids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(location, gene_ID)</span></code></pre></div>
<p>join with annotation file</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># join</span></span>
<span id="cb5-2">annot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(annot_locations, mRNA_FUNids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>))</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensure there are no duplicate rows</span></span>
<span id="cb5-5">annot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span></code></pre></div>
</section>
<section id="set-up-gene2go-object" class="level2">
<h2 class="anchored" data-anchor-id="set-up-gene2go-object">1.2 Set up gene2GO object</h2>
<p>Want to isolate a list of GO terms per gene</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> annot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Gene.Ontology.IDs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(gene_ID, Gene.Ontology.IDs)</span>
<span id="cb6-2">gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GO.ID =</span> Gene.Ontology.IDs)</span>
<span id="cb6-3"></span>
<span id="cb6-4">gene2go_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setNames</span>(</span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>), </span>
<span id="cb6-6">  gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID</span>
<span id="cb6-7">)</span></code></pre></div>
<p>Note: I think this means genes that had a Uniprot ID but no GO terms are excluded from this analysis</p>
</section>
<section id="define-reference-set" class="level2">
<h2 class="anchored" data-anchor-id="define-reference-set">1.3 Define reference set</h2>
<p>Define reference set of genes. This should be all genes <em>found in our samples</em>, NOT all genes in the A.pulchra genome. Some genes (e.g., reproduction pathways) may not be found/expected in our samples for valid biological reasons.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in counts matrix</span></span>
<span id="cb7-2">Apul_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/07-Apul-Hisat/Apul-gene_count_matrix.csv"</span>)</span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exclude genes with all 0 counts</span></span>
<span id="cb7-4">Apul_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_counts[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(Apul_counts[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select gene IDs of the genes present in our samples</span></span>
<span id="cb7-7">all_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_counts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(all_genes)</span></code></pre></div>
<pre><code>## [1] 33624</code></pre>
<p>So we have a reference set of 33624 genes present in our samples.</p>
</section>
<section id="read-in-pccmiranda-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-pccmiranda-data">1.4 Read in PCC/miranda data</h2>
<p>This is a table of all putative miRNA-mRNA binding predicted by miRanda, plus Pearsons correlation coefficients for coexpression of each putative binding pair.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09-Apul-mRNA-miRNA-interactions/miranda_PCC_miRNA_mRNA.csv"</span>)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(data)</span></code></pre></div>
<pre><code>##   X         miRNA       mRNA    PCC.cor   p_value adjusted_p_value score energy
## 1 1  Cluster_5981 FUN_028147  0.6825537 0.2041707        0.9986496   146 -22.19
## 2 2 Cluster_15340 FUN_013332  0.6371070 0.2476393        0.9986496   158 -23.15
## 3 3  Cluster_5981 FUN_041253 -0.2250869 0.7158492        0.9986496   153 -20.50
## 4 4  Cluster_3366 FUN_010827  0.3671005 0.5433145        0.9986496   163 -22.14
## 5 5  Cluster_3367 FUN_010827  0.5369304 0.3507987        0.9986496   163 -22.14
## 6 6 Cluster_15340 FUN_003342  0.1096213 0.8607058        0.9986496   154 -20.65
##   query_start_end subject_start_end total_bp_shared query_similar
## 1            2 21           185 209              21        66.67%
## 2            2 20           198 220              19        68.42%
## 3            2 21           699 719              19        73.68%
## 4            2 18           346 368              16        81.25%
## 5            2 18           346 368              16        81.25%
## 6            2 20           562 585              20        65.00%
##   subject_similar
## 1          71.43%
## 2          84.21%
## 3          73.68%
## 4          93.75%
## 5          93.75%
## 6          80.00%</code></pre>
<p>Set function to select genes of interest (ie those that have pvalue &lt; 0.05)</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">topDiffGenes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(allScore) {</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(allScore <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)}</span></code></pre></div>
</section>
</section>
<section id="fe-of-all-targets-as-predicted-by-miranda" class="level1">
<h1>2 FE of all targets, as predicted by miranda</h1>
<p>TO DO</p>
</section>
<section id="fe-of-targets-negatively-correlated-with-mirnas-regardless-of-correlation-significance" class="level1">
<h1>3 FE of targets negatively correlated with miRNAs (regardless of correlation significance)</h1>
<p>Filter PCC miranda data</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter so that only negative correlations remain </span></span>
<span id="cb12-2">neg_corr_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC.cor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<p>Make list of target genes for input to topGO</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Genes of interest - ie those targeted by miRNAs</span></span>
<span id="cb13-2">target_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(neg_corr_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mRNA))</span></code></pre></div>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply 1 or 0 if gene is gene of interest </span></span>
<span id="cb14-2">GeneList <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(all_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> target_genes))</span>
<span id="cb14-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(GeneList) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes</span></code></pre></div>
<p>The following code will perform GO enrichment using the weighted Fisherâ€™s exact test to assess whether specific GO terms are overrepresented in the genes targeted by miRNAs, regardless of correlation significance.</p>
<section id="biological-processes" class="level3">
<h3 class="anchored" data-anchor-id="biological-processes">3.0.1 Biological Processes</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">GO_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb15-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BP"</span>, </span>
<span id="cb15-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb15-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb15-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb15-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 273 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 1231 GO terms and 2377 relations. )

## 
## Annotating nodes ...............

##  ( 1427 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">GO_BP_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 373 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 14:  1 nodes to be scored    (0 eliminated genes)

## 
##   Level 13:  5 nodes to be scored    (0 eliminated genes)

## 
##   Level 12:  5 nodes to be scored    (11 eliminated genes)

## 
##   Level 11:  7 nodes to be scored    (157 eliminated genes)

## 
##   Level 10:  16 nodes to be scored   (211 eliminated genes)

## 
##   Level 9:   27 nodes to be scored   (226 eliminated genes)

## 
##   Level 8:   34 nodes to be scored   (337 eliminated genes)

## 
##   Level 7:   47 nodes to be scored   (451 eliminated genes)

## 
##   Level 6:   65 nodes to be scored   (627 eliminated genes)

## 
##   Level 5:   72 nodes to be scored   (908 eliminated genes)

## 
##   Level 4:   50 nodes to be scored   (1025 eliminated genes)

## 
##   Level 3:   32 nodes to be scored   (1219 eliminated genes)

## 
##   Level 2:   11 nodes to be scored   (1343 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (1417 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">GO_BP_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_BP_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb20-2">GO_BP_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_BP_En[GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_BP_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb21-2">neg_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb21-6">neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb21-7">GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb21-8"></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb21-10">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> neg_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_BP_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb21-13"></span>
<span id="cb21-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb21-15">GO_BP_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span></span>
<span id="cb21-16"></span>
<span id="cb21-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb21-18">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> GO_BP_En_sig_gene <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span></code></pre></div>
</section>
<section id="cellular-components" class="level3">
<h3 class="anchored" data-anchor-id="cellular-components">3.0.2 Cellular Components</h3>
</section>
<section id="molecular-functions" class="level3">
<h3 class="anchored" data-anchor-id="molecular-functions">3.0.3 Molecular Functions</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">GO_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb22-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MF"</span>, </span>
<span id="cb22-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb22-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb22-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb22-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 461 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 910 GO terms and 1191 relations. )

## 
## Annotating nodes ...............

##  ( 2843 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">GO_MF_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 243 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 10:  4 nodes to be scored    (0 eliminated genes)

## 
##   Level 9:   12 nodes to be scored   (0 eliminated genes)

## 
##   Level 8:   19 nodes to be scored   (146 eliminated genes)

## 
##   Level 7:   30 nodes to be scored   (481 eliminated genes)

## 
##   Level 6:   47 nodes to be scored   (621 eliminated genes)

## 
##   Level 5:   47 nodes to be scored   (930 eliminated genes)

## 
##   Level 4:   50 nodes to be scored   (1352 eliminated genes)

## 
##   Level 3:   24 nodes to be scored   (2004 eliminated genes)

## 
##   Level 2:   9 nodes to be scored    (2371 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (2681 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">GO_MF_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_MF_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb27-2">GO_MF_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_MF_En[GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_MF_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb28-2">neg_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb28-4"></span>
<span id="cb28-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb28-6">neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb28-7">GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb28-8"></span>
<span id="cb28-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb28-10">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> neg_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_MF_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb28-13"></span>
<span id="cb28-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb28-15">GO_MF_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span></span>
<span id="cb28-16"></span>
<span id="cb28-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb28-18">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(GO_MF_En_sig_gene)</span></code></pre></div>
</section>
<section id="join-ontologies" class="level3">
<h3 class="anchored" data-anchor-id="join-ontologies">3.0.4 Join ontologies</h3>
<p>Bind so there is a df that has significantly enriched GO terms for all ontologies</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">GO_neg_corr_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(GO_BP_En_sig_gene, GO_MF_En_sig_gene)</span></code></pre></div>
<p>Merge with <code>GO_neg_corr_df</code></p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> GO_neg_corr_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(neg_corr_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#%&gt;%</span></span>
<span id="cb30-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#mutate(direction = ifelse(PCC.cor &gt; 0, "Positive", "Negative")) #%&gt;%</span></span>
<span id="cb30-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(ontology != "Cellular Components") #%&gt;%</span></span>
<span id="cb30-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(p_value &lt; 0.1)</span></span>
<span id="cb30-6"></span>
<span id="cb30-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save as csv </span></span>
<span id="cb30-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_neg_corr_target_enrichment.csv"</span>)</span></code></pre></div>
<p>Plot!</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb31-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb31-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb31-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb31-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#scale_size(range = c(2, 20)) + </span></span>
<span id="cb31-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb31-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-23-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_neg_corr_target_enrichment.pdf"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb32-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_neg_corr_target_enrichment.png"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
<p>Examine the top 10 most significant GO terms for BP and MF</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to get top 5 unique terms</span></span>
<span id="cb33-2">get_top_10_unique <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, ontology_type) {</span>
<span id="cb33-3">  data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ontology <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> ontology_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Fisher) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.keep_all =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb33-8">}</span>
<span id="cb33-9"></span>
<span id="cb33-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Biological Processes</span></span>
<span id="cb33-11">top_10_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span>)</span>
<span id="cb33-12"></span>
<span id="cb33-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Molecular Functions</span></span>
<span id="cb33-14">top_10_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span>)</span>
<span id="cb33-15"></span>
<span id="cb33-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine results</span></span>
<span id="cb33-17">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_10_BP, top_10_MF)</span>
<span id="cb33-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(top_10_combined<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Term)</span></code></pre></div>
<pre><code>## [1] "auxin-activated signaling pathway"         
## [2] "protein ubiquitination"                    
## [3] "MAPK cascade"                              
## [4] "alternative mRNA splicing, via spliceosome"
## [5] "chromatin binding"</code></pre>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot </span></span>
<span id="cb35-2">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_10_combined <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Fisher)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(Term)))</span>
<span id="cb35-5"></span>
<span id="cb35-6">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_10_combined, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb35-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb35-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb35-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb35-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb35-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb35-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-24-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb36-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_neg_corr_target_enrichment.pdf"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb36-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_neg_corr_target_enrichment.png"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
</section>
</section>
<section id="fe-of-targets-positively-correlated-with-mirnas-regardless-of-correlation-significance" class="level1">
<h1>4 FE of targets positively correlated with miRNAs (regardless of correlation significance)</h1>
<p>Filter PCC miranda data</p>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter so that only positive correlations remain </span></span>
<span id="cb37-2">pos_corr_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC.cor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb37-4"></span>
<span id="cb37-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make list of target genes for input to topGO</span></span>
<span id="cb37-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Genes of interest - ie those targeted by miRNAs</span></span>
<span id="cb37-7">target_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(pos_corr_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mRNA))</span>
<span id="cb37-8"></span>
<span id="cb37-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply 1 or 0 if gene is gene of interest </span></span>
<span id="cb37-10">GeneList <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(all_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> target_genes))</span>
<span id="cb37-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(GeneList) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes</span></code></pre></div>
<p>The following code will perform GO enrichment using the weighted Fisherâ€™s exact test to assess whether specific GO terms are overrepresented in the genes targeted by miRNAs with positively correlated expression, regardless of correlation significance.</p>
<section id="biological-processes-1" class="level3">
<h3 class="anchored" data-anchor-id="biological-processes-1">4.0.1 Biological Processes</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">GO_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb38-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BP"</span>, </span>
<span id="cb38-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb38-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb38-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb38-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 273 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 1231 GO terms and 2377 relations. )

## 
## Annotating nodes ...............

##  ( 1427 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">GO_BP_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 456 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 13:  2 nodes to be scored    (0 eliminated genes)

## 
##   Level 12:  9 nodes to be scored    (0 eliminated genes)

## 
##   Level 11:  13 nodes to be scored   (141 eliminated genes)

## 
##   Level 10:  21 nodes to be scored   (219 eliminated genes)

## 
##   Level 9:   38 nodes to be scored   (235 eliminated genes)

## 
##   Level 8:   50 nodes to be scored   (331 eliminated genes)

## 
##   Level 7:   58 nodes to be scored   (466 eliminated genes)

## 
##   Level 6:   78 nodes to be scored   (664 eliminated genes)

## 
##   Level 5:   85 nodes to be scored   (939 eliminated genes)

## 
##   Level 4:   53 nodes to be scored   (1067 eliminated genes)

## 
##   Level 3:   37 nodes to be scored   (1276 eliminated genes)

## 
##   Level 2:   11 nodes to be scored   (1342 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (1402 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">GO_BP_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_BP_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb43-2">GO_BP_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_BP_En[GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_BP_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb44-2">pos_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb44-4"></span>
<span id="cb44-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb44-6">pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb44-7">GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb44-8"></span>
<span id="cb44-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb44-10">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pos_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_BP_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb44-13"></span>
<span id="cb44-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb44-15">GO_BP_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span></span>
<span id="cb44-16"></span>
<span id="cb44-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb44-18">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(GO_BP_En_sig_gene)</span></code></pre></div>
</section>
<section id="cellular-components-1" class="level3">
<h3 class="anchored" data-anchor-id="cellular-components-1">4.0.2 Cellular Components</h3>
</section>
<section id="molecular-functions-1" class="level3">
<h3 class="anchored" data-anchor-id="molecular-functions-1">4.0.3 Molecular Functions</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">GO_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb45-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MF"</span>, </span>
<span id="cb45-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb45-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb45-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb45-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 461 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 910 GO terms and 1191 relations. )

## 
## Annotating nodes ...............

##  ( 2843 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1">GO_MF_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 320 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 13:  1 nodes to be scored    (0 eliminated genes)

## 
##   Level 12:  1 nodes to be scored    (0 eliminated genes)

## 
##   Level 11:  1 nodes to be scored    (2 eliminated genes)

## 
##   Level 10:  5 nodes to be scored    (2 eliminated genes)

## 
##   Level 9:   12 nodes to be scored   (4 eliminated genes)

## 
##   Level 8:   20 nodes to be scored   (155 eliminated genes)

## 
##   Level 7:   38 nodes to be scored   (499 eliminated genes)

## 
##   Level 6:   71 nodes to be scored   (635 eliminated genes)

## 
##   Level 5:   69 nodes to be scored   (1005 eliminated genes)

## 
##   Level 4:   63 nodes to be scored   (1501 eliminated genes)

## 
##   Level 3:   27 nodes to be scored   (2192 eliminated genes)

## 
##   Level 2:   11 nodes to be scored   (2507 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (2692 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">GO_MF_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_MF_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1">GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb50-2">GO_MF_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_MF_En[GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_MF_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb51-2">pos_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb51-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb51-4"></span>
<span id="cb51-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb51-6">pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb51-7">GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb51-8"></span>
<span id="cb51-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb51-10">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pos_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb51-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_MF_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb51-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb51-13"></span>
<span id="cb51-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb51-15">GO_MF_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span></span>
<span id="cb51-16"></span>
<span id="cb51-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb51-18">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(GO_MF_En_sig_gene)</span></code></pre></div>
</section>
<section id="join-ontologies-1" class="level3">
<h3 class="anchored" data-anchor-id="join-ontologies-1">4.0.4 Join ontologies</h3>
<p>Bind so there is a df that has significantly enriched GO terms for all ontologies</p>
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1">GO_pos_corr_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(GO_BP_En_sig_gene, GO_MF_En_sig_gene)</span></code></pre></div>
<p>Merge with <code>GO_pos_corr_df</code></p>
<div class="sourceCode" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1">test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> GO_pos_corr_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(pos_corr_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#%&gt;%</span></span>
<span id="cb53-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#mutate(direction = ifelse(PCC.cor &gt; 0, "Positive", "Negative")) #%&gt;%</span></span>
<span id="cb53-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(ontology != "Cellular Components") #%&gt;%</span></span>
<span id="cb53-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(p_value &lt; 0.1)</span></span>
<span id="cb53-6"></span>
<span id="cb53-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save as csv </span></span>
<span id="cb53-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_pos_corr_target_enrichment.csv"</span>)</span></code></pre></div>
<p>Plot!</p>
<div class="sourceCode" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb54-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb54-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb54-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb54-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb54-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#scale_size(range = c(2, 20)) + </span></span>
<span id="cb54-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb54-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb54-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb54-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb54-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-38-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb55-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_pos_corr_target_enrichment.pdf"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb55-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_pos_corr_target_enrichment.png"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
<p>Examine the top 10 most significant GO terms for BP and MF</p>
<div class="sourceCode" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to get top 5 unique terms</span></span>
<span id="cb56-2">get_top_10_unique <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, ontology_type) {</span>
<span id="cb56-3">  data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb56-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ontology <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> ontology_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb56-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Fisher) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb56-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.keep_all =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb56-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb56-8">}</span>
<span id="cb56-9"></span>
<span id="cb56-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Biological Processes</span></span>
<span id="cb56-11">top_10_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span>)</span>
<span id="cb56-12"></span>
<span id="cb56-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Molecular Functions</span></span>
<span id="cb56-14">top_10_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span>)</span>
<span id="cb56-15"></span>
<span id="cb56-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine results</span></span>
<span id="cb56-17">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_10_BP, top_10_MF)</span>
<span id="cb56-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(top_10_combined<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Term)</span></code></pre></div>
<pre><code>## [1] "polyamine catabolic process"                           
## [2] "negative regulation of protein phosphorylation"        
## [3] "RNA polymerase II cis-regulatory region sequence-sp..."
## [4] "cytidine deaminase activity"                           
## [5] "glycosaminoglycan binding"</code></pre>
<div class="sourceCode" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot </span></span>
<span id="cb58-2">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_10_combined <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb58-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Fisher)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb58-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(Term)))</span>
<span id="cb58-5"></span>
<span id="cb58-6">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_10_combined, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb58-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb58-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb58-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb58-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb58-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb58-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb58-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb58-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb58-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb58-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-39-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb59-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_pos_corr_target_enrichment.pdf"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb59-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_pos_corr_target_enrichment.png"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
</section>
</section>
<section id="fe-of-targets-significantly-negatively-correlated-with-mirnas" class="level1">
<h1>5 FE of targets significantly negatively correlated with miRNAs</h1>
<p>Filter PCC miranda data</p>
<div class="sourceCode" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter so that only significant negative correlations remain </span></span>
<span id="cb60-2">sig_neg_corr_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb60-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC.cor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb60-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb60-5"></span>
<span id="cb60-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make list of target genes for input to topGO</span></span>
<span id="cb60-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Genes of interest - ie those targeted by miRNAs</span></span>
<span id="cb60-8">target_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(sig_neg_corr_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mRNA))</span>
<span id="cb60-9"></span>
<span id="cb60-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply 1 or 0 if gene is gene of interest </span></span>
<span id="cb60-11">GeneList <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(all_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> target_genes))</span>
<span id="cb60-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(GeneList) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes</span></code></pre></div>
<p>The following code will perform GO enrichment using the weighted Fisherâ€™s exact test to assess whether specific GO terms are overrepresented in the genes targeted by miRNAs with significantly negatively correlated expression.</p>
<section id="biological-processes-2" class="level3">
<h3 class="anchored" data-anchor-id="biological-processes-2">5.0.1 Biological Processes</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1">GO_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb61-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BP"</span>, </span>
<span id="cb61-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb61-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb61-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb61-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 273 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 1231 GO terms and 2377 relations. )

## 
## Annotating nodes ...............

##  ( 1427 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1">GO_BP_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 40 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 10:  1 nodes to be scored    (0 eliminated genes)

## 
##   Level 9:   1 nodes to be scored    (0 eliminated genes)

## 
##   Level 8:   1 nodes to be scored    (30 eliminated genes)

## 
##   Level 7:   3 nodes to be scored    (37 eliminated genes)

## 
##   Level 6:   5 nodes to be scored    (37 eliminated genes)

## 
##   Level 5:   8 nodes to be scored    (181 eliminated genes)

## 
##   Level 4:   7 nodes to be scored    (253 eliminated genes)

## 
##   Level 3:   8 nodes to be scored    (369 eliminated genes)

## 
##   Level 2:   5 nodes to be scored    (708 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (806 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1">GO_BP_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_BP_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1">GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb66-2">GO_BP_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_BP_En[GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_BP_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb67-2">sig_neg_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb67-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb67-4"></span>
<span id="cb67-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb67-6">sig_neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(sig_neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb67-7">GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb67-8"></span>
<span id="cb67-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb67-10">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sig_neg_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb67-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_BP_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb67-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb67-13"></span>
<span id="cb67-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb67-15">GO_BP_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span></span>
<span id="cb67-16"></span>
<span id="cb67-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb67-18">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(GO_BP_En_sig_gene)</span></code></pre></div>
</section>
<section id="cellular-components-2" class="level3">
<h3 class="anchored" data-anchor-id="cellular-components-2">5.0.2 Cellular Components</h3>
</section>
<section id="molecular-functions-2" class="level3">
<h3 class="anchored" data-anchor-id="molecular-functions-2">5.0.3 Molecular Functions</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1">GO_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb68-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MF"</span>, </span>
<span id="cb68-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb68-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb68-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb68-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 461 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 910 GO terms and 1191 relations. )

## 
## Annotating nodes ...............

##  ( 2843 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb70" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1">GO_MF_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 60 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 10:  1 nodes to be scored    (0 eliminated genes)

## 
##   Level 9:   3 nodes to be scored    (0 eliminated genes)

## 
##   Level 8:   4 nodes to be scored    (101 eliminated genes)

## 
##   Level 7:   6 nodes to be scored    (145 eliminated genes)

## 
##   Level 6:   10 nodes to be scored   (238 eliminated genes)

## 
##   Level 5:   10 nodes to be scored   (469 eliminated genes)

## 
##   Level 4:   13 nodes to be scored   (518 eliminated genes)

## 
##   Level 3:   8 nodes to be scored    (862 eliminated genes)

## 
##   Level 2:   4 nodes to be scored    (1296 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (2156 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb72" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1">GO_MF_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_MF_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1">GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb73-2">GO_MF_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_MF_En[GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_MF_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb74" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb74-2">sig_neg_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb74-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb74-4"></span>
<span id="cb74-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb74-6">sig_neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(sig_neg_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb74-7">GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb74-8"></span>
<span id="cb74-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb74-10">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sig_neg_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb74-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_MF_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb74-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb74-13"></span>
<span id="cb74-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb74-15">GO_MF_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span></span>
<span id="cb74-16"></span>
<span id="cb74-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb74-18">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(GO_MF_En_sig_gene)</span></code></pre></div>
</section>
<section id="join-ontologies-2" class="level3">
<h3 class="anchored" data-anchor-id="join-ontologies-2">5.0.4 Join ontologies</h3>
<p>Bind so there is a df that has significantly enriched GO terms for all ontologies</p>
<div class="sourceCode" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1">GO_sig_neg_corr_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(GO_BP_En_sig_gene, GO_MF_En_sig_gene)</span></code></pre></div>
<p>Merge with <code>GO_sig_neg_corr_df</code></p>
<div class="sourceCode" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1">test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> GO_sig_neg_corr_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb76-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(sig_neg_corr_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#%&gt;%</span></span>
<span id="cb76-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#mutate(direction = ifelse(PCC.cor &gt; 0, "Positive", "Negative")) #%&gt;%</span></span>
<span id="cb76-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(ontology != "Cellular Components") #%&gt;%</span></span>
<span id="cb76-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(p_value &lt; 0.1)</span></span>
<span id="cb76-6"></span>
<span id="cb76-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save as csv </span></span>
<span id="cb76-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_sig_neg_corr_target_enrichment.csv"</span>)</span></code></pre></div>
<p>Plot!</p>
<div class="sourceCode" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb77-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb77-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb77-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb77-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb77-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#scale_size(range = c(2, 20)) + </span></span>
<span id="cb77-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb77-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb77-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb77-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb77-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-53-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb78" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb78-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_sig_neg_corr_target_enrichment.pdf"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb78-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_sig_neg_corr_target_enrichment.png"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
<p>Examine the top 10 most significant GO terms for BP and MF</p>
<div class="sourceCode" id="cb79" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to get top 5 unique terms</span></span>
<span id="cb79-2">get_top_10_unique <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, ontology_type) {</span>
<span id="cb79-3">  data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb79-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ontology <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> ontology_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb79-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Fisher) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb79-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.keep_all =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb79-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb79-8">}</span>
<span id="cb79-9"></span>
<span id="cb79-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Biological Processes</span></span>
<span id="cb79-11">top_10_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span>)</span>
<span id="cb79-12"></span>
<span id="cb79-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Molecular Functions</span></span>
<span id="cb79-14">top_10_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span>)</span>
<span id="cb79-15"></span>
<span id="cb79-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine results</span></span>
<span id="cb79-17">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_10_BP, top_10_MF)</span>
<span id="cb79-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(top_10_combined<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Term)</span></code></pre></div>
<pre><code>## [1] "polysaccharide catabolic process"     
## [2] "G1/S transition of mitotic cell cycle"
## [3] "creatinase activity"                  
## [4] "cytidine deaminase activity"          
## [5] "GTPase activity"                      
## [6] "galanin receptor activity"</code></pre>
<div class="sourceCode" id="cb81" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot </span></span>
<span id="cb81-2">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_10_combined <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb81-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Fisher)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb81-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(Term)))</span>
<span id="cb81-5"></span>
<span id="cb81-6">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_10_combined, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb81-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb81-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb81-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb81-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb81-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb81-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-54-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb82-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_sig_neg_corr_target_enrichment.pdf"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb82-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_sig_neg_corr_target_enrichment.png"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
</section>
</section>
<section id="fe-of-targets-significantly-positively-correlated-with-mirnas" class="level1">
<h1>6 FE of targets significantly positively correlated with miRNAs</h1>
<p>Filter PCC miranda data</p>
<div class="sourceCode" id="cb83" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter so that only significant negative correlations remain </span></span>
<span id="cb83-2">sig_pos_corr_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb83-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(PCC.cor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb83-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb83-5"></span>
<span id="cb83-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make list of target genes for input to topGO</span></span>
<span id="cb83-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Genes of interest - ie those targeted by miRNAs</span></span>
<span id="cb83-8">target_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(sig_neg_corr_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mRNA))</span>
<span id="cb83-9"></span>
<span id="cb83-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply 1 or 0 if gene is gene of interest </span></span>
<span id="cb83-11">GeneList <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(all_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> target_genes))</span>
<span id="cb83-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(GeneList) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_genes</span></code></pre></div>
<p>The following code will perform GO enrichment using the weighted Fisherâ€™s exact test to assess whether specific GO terms are overrepresented in the genes targeted by miRNAs with significantly positively correlated expression.</p>
<section id="biological-processes-3" class="level3">
<h3 class="anchored" data-anchor-id="biological-processes-3">6.0.1 Biological Processes</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb84" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1">GO_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb84-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BP"</span>, </span>
<span id="cb84-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb84-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb84-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb84-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 273 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 1231 GO terms and 2377 relations. )

## 
## Annotating nodes ...............

##  ( 1427 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb86" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1">GO_BP_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 40 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 10:  1 nodes to be scored    (0 eliminated genes)

## 
##   Level 9:   1 nodes to be scored    (0 eliminated genes)

## 
##   Level 8:   1 nodes to be scored    (30 eliminated genes)

## 
##   Level 7:   3 nodes to be scored    (37 eliminated genes)

## 
##   Level 6:   5 nodes to be scored    (37 eliminated genes)

## 
##   Level 5:   8 nodes to be scored    (181 eliminated genes)

## 
##   Level 4:   7 nodes to be scored    (253 eliminated genes)

## 
##   Level 3:   8 nodes to be scored    (369 eliminated genes)

## 
##   Level 2:   5 nodes to be scored    (708 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (806 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb88" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1">GO_BP_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_BP_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb89" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1">GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb89-2">GO_BP_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_BP_En[GO_BP_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_BP_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb90" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb90-2">sig_pos_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb90-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb90-4"></span>
<span id="cb90-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb90-6">sig_pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(sig_pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb90-7">GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_BP_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb90-8"></span>
<span id="cb90-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb90-10">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sig_pos_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb90-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_BP_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb90-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb90-13"></span>
<span id="cb90-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb90-15">GO_BP_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span></span>
<span id="cb90-16"></span>
<span id="cb90-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb90-18">GO_BP_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(GO_BP_En_sig_gene)</span></code></pre></div>
</section>
<section id="cellular-components-3" class="level3">
<h3 class="anchored" data-anchor-id="cellular-components-3">6.0.2 Cellular Components</h3>
</section>
<section id="molecular-functions-3" class="level3">
<h3 class="anchored" data-anchor-id="molecular-functions-3">6.0.3 Molecular Functions</h3>
<p>Create <code>topGOdata</code> object, which is required for topGO analysis</p>
<div class="sourceCode" id="cb91" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1">GO_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>, </span>
<span id="cb91-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MF"</span>, </span>
<span id="cb91-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO=</span>gene2go_list, </span>
<span id="cb91-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes=</span>GeneList, </span>
<span id="cb91-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb91-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geneSel=</span>topDiffGenes)</span></code></pre></div>
<pre><code>## 
## Building most specific GOs .....

##  ( 461 GO terms found. )

## 
## Build GO DAG topology ..........

##  ( 910 GO terms and 1191 relations. )

## 
## Annotating nodes ...............

##  ( 2843 genes annotated to the GO terms. )</code></pre>
<p>Run GO enrichment test</p>
<div class="sourceCode" id="cb93" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1">GO_MF_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span></code></pre></div>
<pre><code>## 
##           -- Weight01 Algorithm -- 
## 
##       the algorithm is scoring 60 nontrivial nodes
##       parameters: 
##           test statistic: fisher

## 
##   Level 10:  1 nodes to be scored    (0 eliminated genes)

## 
##   Level 9:   3 nodes to be scored    (0 eliminated genes)

## 
##   Level 8:   4 nodes to be scored    (101 eliminated genes)

## 
##   Level 7:   6 nodes to be scored    (145 eliminated genes)

## 
##   Level 6:   10 nodes to be scored   (238 eliminated genes)

## 
##   Level 5:   10 nodes to be scored   (469 eliminated genes)

## 
##   Level 4:   13 nodes to be scored   (518 eliminated genes)

## 
##   Level 3:   8 nodes to be scored    (862 eliminated genes)

## 
##   Level 2:   4 nodes to be scored    (1296 eliminated genes)

## 
##   Level 1:   1 nodes to be scored    (2156 eliminated genes)</code></pre>
<p>Generate results table</p>
<div class="sourceCode" id="cb95" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1">GO_MF_En <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_MF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_MF_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span></code></pre></div>
<p>Only taking the top 100 GO terms</p>
<p>Filter by significant results</p>
<div class="sourceCode" id="cb96" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1">GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb96-2">GO_MF_En_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_MF_En[GO_MF_En<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span></code></pre></div>
<p>Merge <code>GO_MF_En_sig</code> with GO and gene info.</p>
<div class="sourceCode" id="cb97" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate GO terms </span></span>
<span id="cb97-2">sig_pos_cor_gene2go <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb97-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_rows</span>(GO.ID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span>
<span id="cb97-4"></span>
<span id="cb97-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure GO terms in both datasets are formatted similarly (trim whitespaces)</span></span>
<span id="cb97-6">sig_pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(sig_pos_cor_gene2go<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb97-7">GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trimws</span>(GO_MF_En_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GO.ID)</span>
<span id="cb97-8"></span>
<span id="cb97-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join the datasets based on GO term</span></span>
<span id="cb97-10">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sig_pos_cor_gene2go <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb97-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(GO_MF_En_sig, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO.ID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb97-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb97-13"></span>
<span id="cb97-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add ontology column </span></span>
<span id="cb97-15">GO_MF_En_sig_gene<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ontology <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span></span>
<span id="cb97-16"></span>
<span id="cb97-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only unique rows </span></span>
<span id="cb97-18">GO_MF_En_sig_gene <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(GO_MF_En_sig_gene)</span></code></pre></div>
</section>
<section id="join-ontologies-3" class="level3">
<h3 class="anchored" data-anchor-id="join-ontologies-3">6.0.4 Join ontologies</h3>
<p>Bind so there is a df that has significantly enriched GO terms for all ontologies</p>
<div class="sourceCode" id="cb98" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1">GO_sig_pos_corr_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(GO_BP_En_sig_gene, GO_MF_En_sig_gene)</span></code></pre></div>
<p>Merge with <code>GO_pos_corr_df</code></p>
<div class="sourceCode" id="cb99" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1">test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> GO_sig_pos_corr_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb99-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(sig_pos_corr_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#%&gt;%</span></span>
<span id="cb99-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#mutate(direction = ifelse(PCC.cor &gt; 0, "Positive", "Negative")) #%&gt;%</span></span>
<span id="cb99-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(ontology != "Cellular Components") #%&gt;%</span></span>
<span id="cb99-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(p_value &lt; 0.1)</span></span>
<span id="cb99-6"></span>
<span id="cb99-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save as csv </span></span>
<span id="cb99-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_sig_pos_corr_target_enrichment.csv"</span>)</span></code></pre></div>
<p>Plot!</p>
<div class="sourceCode" id="cb100" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb100-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb100-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb100-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb100-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#scale_size(range = c(2, 20)) + </span></span>
<span id="cb100-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb100-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-68-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb101" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb101-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_sig_pos_corr_target_enrichment.pdf"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb101-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/topGO_sig_pos_corr_target_enrichment.png"</span>, plot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
<p>Examine the top 10 most significant GO terms for BP and MF</p>
<div class="sourceCode" id="cb102" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to get top 5 unique terms</span></span>
<span id="cb102-2">get_top_10_unique <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, ontology_type) {</span>
<span id="cb102-3">  data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb102-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ontology <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> ontology_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb102-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Fisher) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb102-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.keep_all =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb102-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb102-8">}</span>
<span id="cb102-9"></span>
<span id="cb102-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Biological Processes</span></span>
<span id="cb102-11">top_10_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biological Processes"</span>)</span>
<span id="cb102-12"></span>
<span id="cb102-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get top 5 unique Molecular Functions</span></span>
<span id="cb102-14">top_10_MF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_top_10_unique</span>(test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Molecular Functions"</span>)</span>
<span id="cb102-15"></span>
<span id="cb102-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine results</span></span>
<span id="cb102-17">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_10_BP, top_10_MF)</span>
<span id="cb102-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(top_10_combined<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Term)</span></code></pre></div>
<pre><code>## [1] "GTPase activity"</code></pre>
<div class="sourceCode" id="cb104" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot </span></span>
<span id="cb104-2">top_10_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_10_combined <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb104-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Fisher)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb104-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(Term)))</span>
<span id="cb104-5"></span>
<span id="cb104-6">plot<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_10_combined, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fisher, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> p_value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb104-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ylim(0, 1) +</span></span>
<span id="cb104-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, linetype = "solid", color = "black", linewidth = 1)+</span></span>
<span id="cb104-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#geom_hline(yintercept = 0.05, color = "black", linetype = "solid", linewidth = 0.5) +  # Add line at 0.05 </span></span>
<span id="cb104-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb104-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb104-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb104-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher p-value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb104-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb104-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(ontology), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">space =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb104-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>(); plot</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment_files/figure-gfm/unnamed-chunk-69-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb105" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save plot </span></span>
<span id="cb105-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_sig_pos_corr_target_enrichment.pdf"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">last_plot</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb105-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/09.1-Apul-mRNA-miRNA-interactions-functional-enrichment/top10GO_sig_pos_corr_target_enrichment.png"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">last_plot</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_08_dde_miranda_FE.html</guid>
  <pubDate>Tue, 08 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul phenotype and gene/miRNA machine learning â€“ Part 3</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_04_timeseries_ML_3.html</link>
  <description><![CDATA[ 




<p>Now running model using miRNA as predictors, and specific sets of genes as response.</p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets.Rmd">Code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets.md">Rendered code</a></p>
<p>I used miRNA expression to predict expression of three different gene sets:</p>
<ul>
<li>host biomass (â€œHost_AFDWâ€):
<ul>
<li>Genes contained in WGCNA modules significnatly correlated with host biomass.</li>
<li>793 genes (all retained through counts filtering)</li>
</ul></li>
<li>symbiont photosynthesis (â€œAmâ€)
<ul>
<li>Genes contained within WGCNA modules significantly correlated with symbiont photosynthesis</li>
<li>5746 genes (all retained through counts filtering)</li>
</ul></li>
<li>List of GO terms provided by Steven (â€œATP_production_GOâ€)
<ul>
<li>Genes annotated with at least one of the four GO terms, related to ATP production</li>
<li>22 genes (all retained through counts filtering)</li>
</ul></li>
</ul>
<p>Note that the gene set of STP production GO terms contains two genes (<code>FUN_014565</code>, <code>FUN031686</code>) that are also present in the symbiont photosynthesis list.</p>
<p>Note that all gene sets were reduced to PCs before use.</p>
<section id="results" class="level1">
<h1>Results</h1>
<section id="high-model-performance-for-all-three-sets." class="level3">
<h3 class="anchored" data-anchor-id="high-model-performance-for-all-three-sets."><strong>High model performance for all three sets.</strong></h3>
<p>Host biomass:<br>
<img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/b88b583d1dd33f9843d4edf18f169e4f83e93ef8/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-23-1.png?raw=true" class="img-fluid"></p>
<p>Symbiont photosynthesis:<br>
<img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/b88b583d1dd33f9843d4edf18f169e4f83e93ef8/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-33-1.png?raw=true" class="img-fluid"></p>
<p>ATP production GO terms:<br>
<img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/b88b583d1dd33f9843d4edf18f169e4f83e93ef8/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-43-1.png?raw=true" class="img-fluid"></p>
</section>
<section id="a-selection-of-mirna-are-predictively-important" class="level3">
<h3 class="anchored" data-anchor-id="a-selection-of-mirna-are-predictively-important">A selection of miRNA are predictively important</h3>
<p>We can also look at the predictive importance of individual miRNA. Summarizing across all three gene sets, we see the following (note: mean importance is min-max normalized to sit on same 0-1 scale):</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/b88b583d1dd33f9843d4edf18f169e4f83e93ef8/D-Apul/code/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-50-1.png?raw=true" class="img-fluid"></p>
<p>A couple of interesting things pop out here!</p>
<p>First, most miRNA are contributing to model performance in all three gene sets. Generally speaking, host biomass has the most miRNA that are highly important to predicting gene expression (it has the most dark red bars). In contrast <strong>symbiont photosynthesis and ATP production have only a couple of miRNA that are highly important</strong>. For the ATP group this isnâ€™t too surprising since the model includes only 22 genes. However, the photosynthesis gene set contains almost 6000 genes, so the limited number of important miRNA is really interesting!</p>
<p>Thereâ€™s also interesting patterns of overlap. <strong>All of the miRNA important to predicting symbiont photosynthesis are also important to predicting host biomass</strong> Does this suggest these miRNA are involved in energy storage?<br>
In contrast, the miRNA most important to predicting the ATP-production genes are of limited important to the photosynthesis and host biomass sets.</p>
</section>
</section>
<section id="notesobservations" class="level1">
<h1>Notes/observations:</h1>
<ul>
<li><p>Rerunning the code without changes yields slightly different results each time, suggesting thereâ€™s a random component somewhere in the model training/prediction.</p>
<ul>
<li><p>Look more into how this model works and how predictions/accuracy may vary</p></li>
<li><p>consider bootstrapping or something similar to account for variation</p></li>
</ul></li>
<li><p>Think vst should be applied on all genes before isolating specific gene sets of interest, but should check with Ariana.</p></li>
</ul>
<section id="code-included-below-in-case-of-file-changes" class="level3">
<h3 class="anchored" data-anchor-id="code-included-below-in-case-of-file-changes">Code included below in case of file changes</h3>
<p>Applying ML model using smaller, specific gene sets (e.g.&nbsp;genes significantly correlated with a phys metric, genes with a specific known function). Also adding in pOverA filtering</p>
<p>Inputs:</p>
<ul>
<li><p>RNA counts matrix (raw): <code>../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv</code></p></li>
<li><p>Gene sets of interest: <code>../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/</code></p></li>
<li><p>sRNA/miRNA counts matrix (raw): <code>../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt</code></p></li>
<li><p>sample metadata: <code>../../M-multi-species/data/rna_metadata.csv</code></p></li>
</ul>
</section>
</section>
<section id="load-libraries" class="level1">
<h1>1 Load libraries</h1>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## â”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€
## âœ” dplyr     1.1.4     âœ” readr     2.1.5
## âœ” forcats   1.0.0     âœ” stringr   1.5.1
## âœ” ggplot2   3.5.1     âœ” tibble    3.2.1
## âœ” lubridate 1.9.4     âœ” tidyr     1.3.1
## âœ” purrr     1.0.2     
## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## âœ– dplyr::filter() masks stats::filter()
## âœ– dplyr::lag()    masks stats::lag()
## â„¹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DESeq2)</span></code></pre></div>
<pre><code>## Loading required package: S4Vectors
## Loading required package: stats4
## Loading required package: BiocGenerics
## 
## Attaching package: 'BiocGenerics'
## 
## The following objects are masked from 'package:lubridate':
## 
##     intersect, setdiff, union
## 
## The following objects are masked from 'package:dplyr':
## 
##     combine, intersect, setdiff, union
## 
## The following objects are masked from 'package:stats':
## 
##     IQR, mad, sd, var, xtabs
## 
## The following objects are masked from 'package:base':
## 
##     anyDuplicated, aperm, append, as.data.frame, basename, cbind,
##     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,
##     get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,
##     match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,
##     Position, rank, rbind, Reduce, rownames, sapply, setdiff, sort,
##     table, tapply, union, unique, unsplit, which.max, which.min
## 
## 
## Attaching package: 'S4Vectors'
## 
## The following objects are masked from 'package:lubridate':
## 
##     second, second&lt;-
## 
## The following objects are masked from 'package:dplyr':
## 
##     first, rename
## 
## The following object is masked from 'package:tidyr':
## 
##     expand
## 
## The following objects are masked from 'package:base':
## 
##     expand.grid, I, unname
## 
## Loading required package: IRanges
## 
## Attaching package: 'IRanges'
## 
## The following object is masked from 'package:lubridate':
## 
##     %within%
## 
## The following objects are masked from 'package:dplyr':
## 
##     collapse, desc, slice
## 
## The following object is masked from 'package:purrr':
## 
##     reduce
## 
## Loading required package: GenomicRanges
## Loading required package: GenomeInfoDb
## Loading required package: SummarizedExperiment
## Loading required package: MatrixGenerics
## Loading required package: matrixStats
## 
## Attaching package: 'matrixStats'
## 
## The following object is masked from 'package:dplyr':
## 
##     count
## 
## 
## Attaching package: 'MatrixGenerics'
## 
## The following objects are masked from 'package:matrixStats':
## 
##     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
##     colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
##     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
##     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
##     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
##     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
##     colWeightedMeans, colWeightedMedians, colWeightedSds,
##     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
##     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
##     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
##     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
##     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
##     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
##     rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
##     rowWeightedSds, rowWeightedVars
## 
## Loading required package: Biobase
## Welcome to Bioconductor
## 
##     Vignettes contain introductory material; view with
##     'browseVignettes()'. To cite Bioconductor, see
##     'citation("Biobase")', and for packages 'citation("pkgname")'.
## 
## 
## Attaching package: 'Biobase'
## 
## The following object is masked from 'package:MatrixGenerics':
## 
##     rowMedians
## 
## The following objects are masked from 'package:matrixStats':
## 
##     anyMissing, rowMedians</code></pre>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'igraph'
## 
## The following object is masked from 'package:GenomicRanges':
## 
##     union
## 
## The following object is masked from 'package:IRanges':
## 
##     union
## 
## The following object is masked from 'package:S4Vectors':
## 
##     union
## 
## The following objects are masked from 'package:BiocGenerics':
## 
##     normalize, path, union
## 
## The following objects are masked from 'package:lubridate':
## 
##     %--%, union
## 
## The following objects are masked from 'package:dplyr':
## 
##     as_data_frame, groups, union
## 
## The following objects are masked from 'package:purrr':
## 
##     compose, simplify
## 
## The following object is masked from 'package:tidyr':
## 
##     crossing
## 
## The following object is masked from 'package:tibble':
## 
##     as_data_frame
## 
## The following objects are masked from 'package:stats':
## 
##     decompose, spectrum
## 
## The following object is masked from 'package:base':
## 
##     union</code></pre>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(psych)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'psych'
## 
## The following object is masked from 'package:SummarizedExperiment':
## 
##     distance
## 
## The following object is masked from 'package:GenomicRanges':
## 
##     distance
## 
## The following objects are masked from 'package:IRanges':
## 
##     distance, reflect
## 
## The following objects are masked from 'package:ggplot2':
## 
##     %+%, alpha</code></pre>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidygraph)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'tidygraph'
## 
## The following object is masked from 'package:igraph':
## 
##     groups
## 
## The following objects are masked from 'package:IRanges':
## 
##     active, slice
## 
## The following objects are masked from 'package:S4Vectors':
## 
##     active, rename
## 
## The following object is masked from 'package:stats':
## 
##     filter</code></pre>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WGCNA)</span></code></pre></div>
<pre><code>## Loading required package: dynamicTreeCut
## Loading required package: fastcluster
## 
## Attaching package: 'fastcluster'
## 
## The following object is masked from 'package:stats':
## 
##     hclust
## 
## 
## 
## Attaching package: 'WGCNA'
## 
## The following object is masked from 'package:IRanges':
## 
##     cor
## 
## The following object is masked from 'package:S4Vectors':
## 
##     cor
## 
## The following object is masked from 'package:stats':
## 
##     cor</code></pre>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(edgeR)</span></code></pre></div>
<pre><code>## Loading required package: limma
## 
## Attaching package: 'limma'
## 
## The following object is masked from 'package:DESeq2':
## 
##     plotMA
## 
## The following object is masked from 'package:BiocGenerics':
## 
##     plotMA</code></pre>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reshape2)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'reshape2'
## 
## The following object is masked from 'package:tidyr':
## 
##     smiths</code></pre>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggcorrplot)</span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(corrplot)</span></code></pre></div>
<pre><code>## corrplot 0.94 loaded</code></pre>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'rvest'
## 
## The following object is masked from 'package:readr':
## 
##     guess_encoding</code></pre>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pheatmap)</span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span></code></pre></div>
<pre><code>## Loading required package: Matrix
## 
## Attaching package: 'Matrix'
## 
## The following object is masked from 'package:S4Vectors':
## 
##     expand
## 
## The following objects are masked from 'package:tidyr':
## 
##     expand, pack, unpack
## 
## Loaded glmnet 4.1-8</code></pre>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span></code></pre></div>
<pre><code>## Loading required package: lattice
## 
## Attaching package: 'caret'
## 
## The following object is masked from 'package:purrr':
## 
##     lift</code></pre>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(factoextra)</span></code></pre></div>
<pre><code>## Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(vegan)</span></code></pre></div>
<pre><code>## Loading required package: permute
## 
## Attaching package: 'permute'
## 
## The following object is masked from 'package:igraph':
## 
##     permute
## 
## This is vegan 2.6-8
## 
## Attaching package: 'vegan'
## 
## The following object is masked from 'package:caret':
## 
##     tolerance
## 
## The following object is masked from 'package:psych':
## 
##     pca
## 
## The following object is masked from 'package:igraph':
## 
##     diversity</code></pre>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggfortify)</span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(genefilter)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'genefilter'
## 
## The following object is masked from 'package:psych':
## 
##     AUC
## 
## The following objects are masked from 'package:MatrixGenerics':
## 
##     rowSds, rowVars
## 
## The following objects are masked from 'package:matrixStats':
## 
##     rowSds, rowVars
## 
## The following object is masked from 'package:readr':
## 
##     spec</code></pre>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scales)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'scales'
## 
## The following objects are masked from 'package:psych':
## 
##     alpha, rescale
## 
## The following object is masked from 'package:purrr':
## 
##     discard
## 
## The following object is masked from 'package:readr':
## 
##     col_factor</code></pre>
</section>
<section id="load-and-prep-data" class="level1">
<h1>2 Load and prep data</h1>
<p>Load in count matrices for RNAseq.</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw gene counts data (will filter and variance stabilize)</span></span>
<span id="cb33-2">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span></code></pre></div>
<pre><code>## Rows: 44371 Columns: 41
## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Delimiter: ","
## chr  (1): gene_id
## dbl (40): 1A1, 1A10, 1A12, 1A2, 1A8, 1A9, 1B1, 1B10, 1B2, 1B5, 1B9, 1C10, 1C...
## 
## â„¹ Use `spec()` to retrieve the full column specification for this data.
## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span>
<span id="cb35-2"></span>
<span id="cb35-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format gene IDs as rownames (instead of a column)</span></span>
<span id="cb35-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb35-5">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>gene_id)</span>
<span id="cb35-6"></span>
<span id="cb35-7"></span>
<span id="cb35-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load and format metadata</span></span>
<span id="cb35-9">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../M-multi-species/data/rna_metadata.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(AzentaSampleName, ColonyID, Timepoint) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACR"</span>, ColonyID))</span></code></pre></div>
<pre><code>## New names:
## Rows: 117 Columns: 19
## â”€â”€ Column specification
## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Delimiter: "," chr
## (13): SampleName, WellNumber, AzentaSampleName, ColonyID, Timepoint, Sam... dbl
## (5): SampleNumber, Plate, TotalAmount-ng, Volume-uL, Conc-ng.uL lgl (1):
## MethodUsedForSpectrophotometry
## â„¹ Use `spec()` to retrieve the full column specification for this data. â„¹
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## â€¢ `` -&gt; `...19`</code></pre>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb37-2"></span>
<span id="cb37-3">colonies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID)</span>
<span id="cb37-4"></span>
<span id="cb37-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename gene column names to include full sample info (as in miRNA table)</span></span>
<span id="cb37-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb37-7"></span>
<span id="cb37-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw miRNA counts (will filter and variance stabilize)</span></span>
<span id="cb37-9">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<section id="counts-filtering" class="level2">
<h2 class="anchored" data-anchor-id="counts-filtering">2.1 Counts filtering</h2>
<p>Note: Iâ€™m filtering (removing unrepresented and lowly-represented genes) and variance stabilizing <em>before</em> I isolate specific gene sets. Not sure if the preliminary vst is appropriate though?</p>
<p>Ensure there are no genes or miRNAs with 0 counts across all samples.</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes)</span></code></pre></div>
<pre><code>## [1] 44371</code></pre>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">Apul_genes_red<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-2">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-4">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb40-5"></span>
<span id="cb40-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_red)</span></code></pre></div>
<pre><code>## [1] 35869</code></pre>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNAs</span></span>
<span id="cb42-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA)</span></code></pre></div>
<pre><code>## [1] 51</code></pre>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">Apul_miRNA_red<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-2">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-4">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb44-5"></span>
<span id="cb44-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red)</span></code></pre></div>
<pre><code>## [1] 51</code></pre>
<p>Removing genes with only 0 counts reduced number from 44371 to 35869. Retained all 51 miRNAs.</p>
<p><em>pOverA</em>: Specifying the minimum count for a proportion of samples for each gene. Setting 3/38 = 0.08. This would retain genes that are only expressed in a single season in a couple of the colonies. Additionally, setting the minimum count so that the minimum number of samples must have a gene count above a certain threshold.</p>
<p>genes:</p>
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb46-2"></span>
<span id="cb46-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb46-4">gfilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_genes_red, filt)</span>
<span id="cb46-5"></span>
<span id="cb46-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb46-7">gkeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_red[gfilt,]</span>
<span id="cb46-8"></span>
<span id="cb46-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify gene lists</span></span>
<span id="cb46-10">gn.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(gkeep)</span>
<span id="cb46-11"></span>
<span id="cb46-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#gene count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb46-13">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> gn.keep),])</span>
<span id="cb46-14"></span>
<span id="cb46-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb46-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_red) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Before</span></span></code></pre></div>
<pre><code>## [1] 35869</code></pre>
<div class="sourceCode" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_filt) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#After</span></span></code></pre></div>
<pre><code>## [1] 25730</code></pre>
<p>We had 35869 genes before, and 25730 genes after filtering.</p>
<p>miRNA:</p>
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filterfun</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pOverA</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb50-2"></span>
<span id="cb50-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create filter for the counts data</span></span>
<span id="cb50-4">mifilt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">genefilter</span>(Apul_miRNA_red, mifilt)</span>
<span id="cb50-5"></span>
<span id="cb50-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb50-7">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb50-8"></span>
<span id="cb50-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify genes to keep by count filter</span></span>
<span id="cb50-10">mikeep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_red[mifilt,]</span>
<span id="cb50-11"></span>
<span id="cb50-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#identify gene lists</span></span>
<span id="cb50-13">mi.keep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(mikeep)</span>
<span id="cb50-14"></span>
<span id="cb50-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#gene count data filtered in PoverA, P percent of the samples have counts over A</span></span>
<span id="cb50-16">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_miRNA_red[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> mi.keep),])</span>
<span id="cb50-17"></span>
<span id="cb50-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#How many rows do we have before and after filtering?</span></span>
<span id="cb50-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_red) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Before</span></span></code></pre></div>
<pre><code>## [1] 51</code></pre>
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_filt) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#After</span></span></code></pre></div>
<pre><code>## [1] 47</code></pre>
<p>Of the 51 miRNA, 47 were retained. Which were removed?</p>
<div class="sourceCode" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_red), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_miRNA_filt))</span></code></pre></div>
<pre><code>## [1] "Cluster_5685"  "Cluster_11565" "Cluster_13647" "Cluster_14633"</code></pre>
</section>
<section id="assign-metadata-and-arrange-order-of-columns" class="level2">
<h2 class="anchored" data-anchor-id="assign-metadata-and-arrange-order-of-columns">2.2 Assign metadata and arrange order of columns</h2>
<p>Order metadata the same as the column order in the gene matrix.</p>
<div class="sourceCode" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)</span>
<span id="cb56-2">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(list)</span>
<span id="cb56-3"></span>
<span id="cb56-4">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample)</span>
<span id="cb56-5"></span>
<span id="cb56-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the levels</span></span>
<span id="cb56-7">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span>list)</span>
<span id="cb56-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the data.frame</span></span>
<span id="cb56-9">metadata_ordered <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample),]</span>
<span id="cb56-10">metadata_ordered<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span></code></pre></div>
<pre><code>##  [1] 1A1_ACR-173_TP1  1A10_ACR-145_TP4 1A12_ACR-237_TP3 1A2_ACR-244_TP4 
##  [5] 1A8_ACR-186_TP2  1A9_ACR-244_TP2  1B1_ACR-225_TP3  1B10_ACR-150_TP4
##  [9] 1B2_ACR-173_TP3  1B5_ACR-229_TP1  1B9_ACR-265_TP4  1C10_ACR-173_TP4
## [13] 1C4_ACR-139_TP4  1D10_ACR-265_TP2 1D3_ACR-225_TP4  1D4_ACR-237_TP4 
## [17] 1D6_ACR-229_TP2  1D8_ACR-237_TP2  1D9_ACR-229_TP4  1E1_ACR-265_TP3 
## [21] 1E3_ACR-150_TP2  1E5_ACR-139_TP3  1E9_ACR-237_TP1  1F11_ACR-173_TP2
## [25] 1F4_ACR-150_TP3  1F8_ACR-145_TP3  1G5_ACR-244_TP3  1H11_ACR-225_TP1
## [29] 1H12_ACR-186_TP3 1H6_ACR-225_TP2  1H7_ACR-229_TP3  1H8_ACR-186_TP4 
## [33] 2B2_ACR-145_TP1  2B3_ACR-139_TP2  2C1_ACR-244_TP1  2C2_ACR-139_TP1 
## [37] 2D2_ACR-150_TP1  2E2_ACR-186_TP1  2F1_ACR-265_TP1  2G1_ACR-145_TP2 
## 40 Levels: 1A1_ACR-173_TP1 1A10_ACR-145_TP4 ... 2G1_ACR-145_TP2</code></pre>
<div class="sourceCode" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sure the miRNA colnames are also in the same order as the gene colnames</span></span>
<span id="cb58-2">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)]</span></code></pre></div>
<p>Metadata and gene count matrix are now ordered the same.</p>
</section>
<section id="conduct-variance-stabilized-transformation" class="level2">
<h2 class="anchored" data-anchor-id="conduct-variance-stabilized-transformation">2.3 Conduct variance stabilized transformation</h2>
<p>VST should be performed on our two input datasets (gene counts and miRNA counts) separately</p>
<p>Genes:</p>
<div class="sourceCode" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb59-2">dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_genes_filt,</span>
<span id="cb59-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb59-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## converting counts to integer mode

## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<p>Check size factors.</p>
<div class="sourceCode" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1">SF.dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_genes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span></code></pre></div>
<pre><code>##  1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3  1A2_ACR-244_TP4 
##        0.7568558        0.7687730        1.4234818        0.6420081 
##  1A8_ACR-186_TP2  1A9_ACR-244_TP2  1B1_ACR-225_TP3 1B10_ACR-150_TP4 
##        1.1213916        1.2061267        1.4198168        1.4021990 
##  1B2_ACR-173_TP3  1B5_ACR-229_TP1  1B9_ACR-265_TP4 1C10_ACR-173_TP4 
##        1.0388656        1.6077879        0.9862597        0.7148431 
##  1C4_ACR-139_TP4 1D10_ACR-265_TP2  1D3_ACR-225_TP4  1D4_ACR-237_TP4 
##        1.1895625        1.1390590        0.6730531        1.0550212 
##  1D6_ACR-229_TP2  1D8_ACR-237_TP2  1D9_ACR-229_TP4  1E1_ACR-265_TP3 
##        1.0931378        0.8705408        0.6710741        1.0715773 
##  1E3_ACR-150_TP2  1E5_ACR-139_TP3  1E9_ACR-237_TP1 1F11_ACR-173_TP2 
##        1.1807769        1.2228114        1.0417935        1.0435593 
##  1F4_ACR-150_TP3  1F8_ACR-145_TP3  1G5_ACR-244_TP3 1H11_ACR-225_TP1 
##        1.3998258        0.7956019        1.6096974        1.4234818 
## 1H12_ACR-186_TP3  1H6_ACR-225_TP2  1H7_ACR-229_TP3  1H8_ACR-186_TP4 
##        0.6119729        0.7956019        1.3289120        1.2201768 
##  2B2_ACR-145_TP1  2B3_ACR-139_TP2  2C1_ACR-244_TP1  2C2_ACR-139_TP1 
##        1.1042385        1.4406114        0.6651642        1.1926753 
##  2D2_ACR-150_TP1  2E2_ACR-186_TP1  2F1_ACR-265_TP1  2G1_ACR-145_TP2 
##        0.7835924        0.6245044        0.9581634        0.8213095</code></pre>
<div class="sourceCode" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
<pre><code>## Warning in all(sizeFactors(SF.dds_genes)): coercing argument of type 'double'
## to logical

## [1] TRUE</code></pre>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="sourceCode" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size</span></span>
<span id="cb67-2">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_genes)</span>
<span id="cb67-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(vsd_genes, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.  </span></span></code></pre></div>
<pre><code>##            1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3 1A2_ACR-244_TP4
## FUN_002326        6.381927         6.314605         5.963893        5.647868
## FUN_002303        7.272815         6.789218         6.385965        5.817225
## FUN_002304        6.611599         5.502055         5.752904        5.527221
##            1A8_ACR-186_TP2 1A9_ACR-244_TP2 1B1_ACR-225_TP3 1B10_ACR-150_TP4
## FUN_002326        5.547668        5.536500        5.989895         5.915797
## FUN_002303        5.617732        5.660921        6.387376         6.245288
## FUN_002304        5.456087        5.448168        5.575266         5.514644
##            1B2_ACR-173_TP3 1B5_ACR-229_TP1 1B9_ACR-265_TP4 1C10_ACR-173_TP4
## FUN_002326        6.380263        5.419572        5.937605         6.320872
## FUN_002303        6.996842        5.554799        6.270729         6.801444
## FUN_002304        5.693721        5.234250        5.470765         5.909332
##            1C4_ACR-139_TP4 1D10_ACR-265_TP2 1D3_ACR-225_TP4 1D4_ACR-237_TP4
## FUN_002326        5.538589         5.889583        6.168475        6.284689
## FUN_002303        5.942188         6.331095        6.447554        6.705413
## FUN_002304        5.606644         5.545237        5.520407        5.557336
##            1D6_ACR-229_TP2 1D8_ACR-237_TP2 1D9_ACR-229_TP4 1E1_ACR-265_TP3
## FUN_002326        5.458930        6.128558        5.520828        5.787281
## FUN_002303        5.551676        6.587336        5.234250        6.230238
## FUN_002304        5.458930        5.735774        5.234250        5.626491
##            1E3_ACR-150_TP2 1E5_ACR-139_TP3 1E9_ACR-237_TP1 1F11_ACR-173_TP2
## FUN_002326        5.539715        5.601574        6.167772         5.838837
## FUN_002303        5.761383        5.867108        6.602561         6.243007
## FUN_002304        5.450448        5.446706        5.559372         5.794565
##            1F4_ACR-150_TP3 1F8_ACR-145_TP3 1G5_ACR-244_TP3 1H11_ACR-225_TP1
## FUN_002326        5.916364        6.015555        5.496001         5.963893
## FUN_002303        6.510569        6.409577        5.816389         6.385965
## FUN_002304        5.916364        5.497514        5.496001         5.752904
##            1H12_ACR-186_TP3 1H6_ACR-225_TP2 1H7_ACR-229_TP3 1H8_ACR-186_TP4
## FUN_002326         5.657826        6.015555        5.438063        5.534761
## FUN_002303         5.752103        6.409577        5.438063        5.793954
## FUN_002304         5.234250        5.497514        5.438063        5.446935
##            2B2_ACR-145_TP1 2B3_ACR-139_TP2 2C1_ACR-244_TP1 2C2_ACR-139_TP1
## FUN_002326        5.968475        5.572807        5.640653        5.606161
## FUN_002303        6.367643        5.711957        5.731177        5.908979
## FUN_002304        5.550083        5.430015        5.522094        5.538193
##            2D2_ACR-150_TP1 2E2_ACR-186_TP1 2F1_ACR-265_TP1 2G1_ACR-145_TP2
## FUN_002326        6.519530        5.653585        6.259654        5.810603
## FUN_002303        6.813192        5.653585        6.639302        6.391978
## FUN_002304        6.021376        5.531284        5.474200        5.681868</code></pre>
<p>miRNA:</p>
<div class="sourceCode" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb69-2">dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_miRNA_filt,</span>
<span id="cb69-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb69-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
<pre><code>## Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
## design formula are characters, converting to factors

##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<p>Check size factors.</p>
<div class="sourceCode" id="cb71" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1">SF.dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_miRNA) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span></code></pre></div>
<pre><code>##  1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3  1A2_ACR-244_TP4 
##        1.4663620        0.5013837        1.1375801        1.4285229 
##  1A8_ACR-186_TP2  1A9_ACR-244_TP2  1B1_ACR-225_TP3 1B10_ACR-150_TP4 
##        1.4848190        3.6543406        0.6428434        0.6090123 
##  1B2_ACR-173_TP3  1B5_ACR-229_TP1  1B9_ACR-265_TP4 1C10_ACR-173_TP4 
##        0.8904346        3.5848052        0.5041214        0.3523615 
##  1C4_ACR-139_TP4 1D10_ACR-265_TP2  1D3_ACR-225_TP4  1D4_ACR-237_TP4 
##        0.2687172        1.7352574        3.3952218        1.7342028 
##  1D6_ACR-229_TP2  1D8_ACR-237_TP2  1D9_ACR-229_TP4  1E1_ACR-265_TP3 
##        3.1325088        1.6420440        1.6784438        0.4768304 
##  1E3_ACR-150_TP2  1E5_ACR-139_TP3  1E9_ACR-237_TP1 1F11_ACR-173_TP2 
##        2.5657486        0.1036718        0.8991829        1.4685414 
##  1F4_ACR-150_TP3  1F8_ACR-145_TP3  1G5_ACR-244_TP3 1H11_ACR-225_TP1 
##        1.9455453        0.4071314        2.2838388        0.8196170 
## 1H12_ACR-186_TP3  1H6_ACR-225_TP2  1H7_ACR-229_TP3  1H8_ACR-186_TP4 
##        0.4730390        1.9006672        1.1185865        0.8466327 
##  2B2_ACR-145_TP1  2B3_ACR-139_TP2  2C1_ACR-244_TP1  2C2_ACR-139_TP1 
##        0.9294126        1.8998015        1.2208764        1.4280205 
##  2D2_ACR-150_TP1  2E2_ACR-186_TP1  2F1_ACR-265_TP1  2G1_ACR-145_TP2 
##        0.5326906        0.3152060        0.3054304        1.9176071</code></pre>
<div class="sourceCode" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
<pre><code>## Warning in all(sizeFactors(SF.dds_miRNA)): coercing argument of type 'double'
## to logical

## [1] TRUE</code></pre>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="sourceCode" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size. Using varianceStabilizingTransformation() instead of vst() because few input genes</span></span></code></pre></div>
<pre><code>##   Note: levels of factors in the design contain characters other than
##   letters, numbers, '_' and '.'. It is recommended (but not required) to use
##   only letters, numbers, and delimiters '_' or '.', as these are safe characters
##   for column names in R. [This is a message, not a warning or an error]</code></pre>
<div class="sourceCode" id="cb79" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA)</span>
<span id="cb79-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(vsd_miRNA, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.</span></span></code></pre></div>
<pre><code>##              1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3 1A2_ACR-244_TP4
## Cluster_1819        6.238826         6.317673         5.193726        5.902841
## Cluster_1832       10.289253         9.353757         8.601591        9.385848
## Cluster_1833        5.048031         5.238450         5.689758        4.740887
##              1A8_ACR-186_TP2 1A9_ACR-244_TP2 1B1_ACR-225_TP3 1B10_ACR-150_TP4
## Cluster_1819        5.965996        6.629812        5.144832         4.845529
## Cluster_1832        9.713980        9.231169        9.827051         8.514351
## Cluster_1833        3.187374        1.605181        5.581722         3.938572
##              1B2_ACR-173_TP3 1B5_ACR-229_TP1 1B9_ACR-265_TP4 1C10_ACR-173_TP4
## Cluster_1819        5.533393        5.973709        5.794654         5.833047
## Cluster_1832        9.277000        9.958107        8.808700         9.394462
## Cluster_1833        5.305314        5.533981        4.125680         3.800581
##              1C4_ACR-139_TP4 1D10_ACR-265_TP2 1D3_ACR-225_TP4 1D4_ACR-237_TP4
## Cluster_1819        5.429070         5.936798        4.652820        4.878331
## Cluster_1832        9.628054         8.500652        9.747072        9.154859
## Cluster_1833        5.762673         1.605181        4.903375        5.910117
##              1D6_ACR-229_TP2 1D8_ACR-237_TP2 1D9_ACR-229_TP4 1E1_ACR-265_TP3
## Cluster_1819        6.091687        5.787796        5.498316        5.515029
## Cluster_1832        9.831971        8.639755        9.366864        9.133968
## Cluster_1833        3.911358        5.342319        3.643082        5.642128
##              1E3_ACR-150_TP2 1E5_ACR-139_TP3 1E9_ACR-237_TP1 1F11_ACR-173_TP2
## Cluster_1819        6.227797        4.644213        4.747952         6.041496
## Cluster_1832        9.030323        8.781771        8.350263        10.030506
## Cluster_1833        1.605181        1.605181        4.747952         4.459880
##              1F4_ACR-150_TP3 1F8_ACR-145_TP3 1G5_ACR-244_TP3 1H11_ACR-225_TP1
## Cluster_1819        5.112737        5.964150        5.569442         4.792447
## Cluster_1832        8.626276        9.054458       10.240496         9.551367
## Cluster_1833        3.516495        4.515605        1.605181         4.915503
##              1H12_ACR-186_TP3 1H6_ACR-225_TP2 1H7_ACR-229_TP3 1H8_ACR-186_TP4
## Cluster_1819         6.242681        4.931185        5.661095        5.282405
## Cluster_1832         9.867459        9.826331        9.503289       10.018506
## Cluster_1833         4.858957        4.684693        3.936790        5.795099
##              2B2_ACR-145_TP1 2B3_ACR-139_TP2 2C1_ACR-244_TP1 2C2_ACR-139_TP1
## Cluster_1819        5.734780        5.380442        5.716894        5.353031
## Cluster_1832        7.998131        9.872251        9.347640        9.619989
## Cluster_1833        1.605181        3.901090        5.623762        4.490532
##              2D2_ACR-150_TP1 2E2_ACR-186_TP1 2F1_ACR-265_TP1 2G1_ACR-145_TP2
## Cluster_1819        5.560357        6.359532        5.865697        5.254525
## Cluster_1832        8.110494        9.399757        9.144490        9.088095
## Cluster_1833        3.686480        1.605181        1.605181        4.299740</code></pre>
<div class="sourceCode" id="cb81" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_genes))</span>
<span id="cb81-2">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_miRNA))</span></code></pre></div>
</section>
<section id="islolate-gene-sets" class="level2">
<h2 class="anchored" data-anchor-id="islolate-gene-sets">2.4 Islolate gene sets</h2>
<p>Read in gene set tables</p>
<div class="sourceCode" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes from WGCNA modules significantly correlated with host biomass</span></span>
<span id="cb82-2">Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/Host_AFDW.mg.cm2_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb82-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes from WGCNA modules significantly correlated with symbiont photosynthesis</span></span>
<span id="cb82-4">Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/Am_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb82-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GO temrs related to energy production</span></span>
<span id="cb82-6">ATP_production_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/ATP_production_GO_terms_gene_counts.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<p>Isolate filtered counts by gene set</p>
<div class="sourceCode" id="cb83" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1">vsd_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id]</span>
<span id="cb83-2">vsd_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id]</span>
<span id="cb83-3">vsd_ATP_production_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ATP_production_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id]</span></code></pre></div>
</section>
</section>
<section id="feature-selection" class="level1">
<h1>3 Feature selection</h1>
<p>For gene sets that are large weâ€™ll need to reduce dimensionality using PCA. Note that the # of miRNA (47 after filtering) is low enough that reduction isnâ€™t necessary.</p>
<section id="host_afdw" class="level2">
<h2 class="anchored" data-anchor-id="host_afdw">3.1 Host_AFDW</h2>
<p>Reduce dimensionality</p>
<div class="sourceCode" id="cb84" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene+miRNA expression matrix</span></span>
<span id="cb84-2">pca_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(vsd_Host_AFDW, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb84-3"></span>
<span id="cb84-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb84-5">explained_var_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_Host_AFDW)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb84-6">num_pcs_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_Host_AFDW) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% cumulative variance</span></span>
<span id="cb84-7"></span>
<span id="cb84-8">Host_AFDW_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_Host_AFDW])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb84-9"></span>
<span id="cb84-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(Host_AFDW_pcs)</span></code></pre></div>
<pre><code>## [1] 40 29</code></pre>
<p>29 PCs summarize 95% of the explained variance in genes associated with host biomass (Host AFDW)</p>
</section>
<section id="am" class="level2">
<h2 class="anchored" data-anchor-id="am">3.2 Am</h2>
<p>Reduce dimensionality</p>
<div class="sourceCode" id="cb86" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene+miRNA expression matrix</span></span>
<span id="cb86-2">pca_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(vsd_Am, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb86-3"></span>
<span id="cb86-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb86-5">explained_var_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_Am)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb86-6">num_pcs_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_Am) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% cumulative variance</span></span>
<span id="cb86-7"></span>
<span id="cb86-8">Am_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_Am])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb86-9"></span>
<span id="cb86-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(Am_pcs)</span></code></pre></div>
<pre><code>## [1] 40 30</code></pre>
<p>30 PCs summarize 95% of the explained variance in genes associated with symbiont photosynthesis (Am)</p>
</section>
<section id="am-1" class="level2">
<h2 class="anchored" data-anchor-id="am-1">3.3 Am</h2>
<p>Reduce dimensionality</p>
<div class="sourceCode" id="cb88" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene+miRNA expression matrix</span></span>
<span id="cb88-2">pca_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(vsd_ATP_production_GO, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb88-3"></span>
<span id="cb88-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb88-5">explained_var_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_ATP_prod_GO)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb88-6">num_pcs_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_ATP_prod_GO) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% cumulative variance</span></span>
<span id="cb88-7"></span>
<span id="cb88-8">ATP_prod_GO_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_ATP_prod_GO])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb88-9"></span>
<span id="cb88-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(ATP_prod_GO_pcs)</span></code></pre></div>
<pre><code>## [1] 40 11</code></pre>
<p>11 PCs summarize 95% of the explained variance in genes associated with symbiont photosynthesis (Am)</p>
</section>
</section>
<section id="host-biomass-host_afdw" class="level1">
<h1>4 Host biomass (Host_AFDW)</h1>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">4.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression.</p>
<div class="sourceCode" id="cb90" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1">train_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_pcs, predictor_pcs) {</span>
<span id="cb90-2">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb90-3">  </span>
<span id="cb90-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb90-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gene expression PC</span></span>
<span id="cb90-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNA expression as predictors</span></span>
<span id="cb90-7">    </span>
<span id="cb90-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train elastic net model (alpha = 0.5 for mix of LASSO &amp; Ridge)</span></span>
<span id="cb90-9">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb90-10">    </span>
<span id="cb90-11">    models[[pc]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb90-12">  }</span>
<span id="cb90-13">  </span>
<span id="cb90-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(models)</span>
<span id="cb90-15">}</span>
<span id="cb90-16"></span>
<span id="cb90-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA expression</span></span>
<span id="cb90-18">models_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(Host_AFDW_pcs, vsd_miRNA)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb91" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1">get_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models) {</span>
<span id="cb91-2">  importance_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb91-3">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to regular matrix &amp; remove intercept</span></span>
<span id="cb91-4">    </span>
<span id="cb91-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb91-6">    coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs))</span>
<span id="cb91-7">    </span>
<span id="cb91-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df)</span>
<span id="cb91-9">  })</span>
<span id="cb91-10">  </span>
<span id="cb91-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature importance across all predicted gene PCs</span></span>
<span id="cb91-12">  importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(importance_list) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb91-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb91-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Importance)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb91-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb91-16">  </span>
<span id="cb91-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(importance_df)</span>
<span id="cb91-18">}</span>
<span id="cb91-19"></span>
<span id="cb91-20">feature_importance_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_Host_AFDW)</span>
<span id="cb91-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_Host_AFDW, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature       MeanImportance
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Cluster_5517           0.362
##  2 Cluster_17623          0.352
##  3 Cluster_9706           0.325
##  4 Cluster_17173          0.324
##  5 Cluster_9420           0.318
##  6 Cluster_3109           0.317
##  7 Cluster_14605          0.312
##  8 Cluster_2746           0.309
##  9 Cluster_5516           0.284
## 10 Cluster_1819           0.284
## 11 Cluster_17186          0.279
## 12 Cluster_14146          0.237
## 13 Cluster_1950           0.230
## 14 Cluster_3226           0.208
## 15 Cluster_3301           0.207
## 16 Cluster_1865           0.204
## 17 Cluster_17245          0.199
## 18 Cluster_9512           0.190
## 19 Cluster_14692          0.185
## 20 Cluster_17192          0.184</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb93" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1">evaluate_model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models, response_pcs, predictor_pcs) {</span>
<span id="cb93-2">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb93-3"></span>
<span id="cb93-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb93-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]</span>
<span id="cb93-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)</span>
<span id="cb93-7"></span>
<span id="cb93-8">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models[[pc]]</span>
<span id="cb93-9">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb93-10"></span>
<span id="cb93-11">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R-squared metric</span></span>
<span id="cb93-12">    results[results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> pc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb93-13">  }</span>
<span id="cb93-14"></span>
<span id="cb93-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb93-16">}</span>
<span id="cb93-17"></span>
<span id="cb93-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function with error warnings:</span></span>
<span id="cb93-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># evaluate_model_performance &lt;- function(models, response_pcs, predictor_pcs) {</span></span>
<span id="cb93-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   results &lt;- data.frame(PC = colnames(response_pcs), R2 = NA)</span></span>
<span id="cb93-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   </span></span>
<span id="cb93-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   for (pc in colnames(response_pcs)) {</span></span>
<span id="cb93-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     cat("Processing:", pc, "\n")</span></span>
<span id="cb93-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     </span></span>
<span id="cb93-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     y &lt;- response_pcs[[pc]]</span></span>
<span id="cb93-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     X &lt;- as.matrix(predictor_pcs)</span></span>
<span id="cb93-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     </span></span>
<span id="cb93-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     if (!(pc %in% names(models))) {</span></span>
<span id="cb93-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       cat("Model missing for PC:", pc, "\n")</span></span>
<span id="cb93-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       next</span></span>
<span id="cb93-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     }</span></span>
<span id="cb93-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   </span></span>
<span id="cb93-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     model &lt;- models[[pc]]</span></span>
<span id="cb93-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     preds &lt;- predict(model, X, s = "lambda.min")</span></span>
<span id="cb93-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     </span></span>
<span id="cb93-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     if (any(is.na(preds))) {</span></span>
<span id="cb93-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       cat("NA in predictions for PC:", pc, "\n")</span></span>
<span id="cb93-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     }</span></span>
<span id="cb93-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     </span></span>
<span id="cb93-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     if (var(y) == 0) {</span></span>
<span id="cb93-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       cat("Zero variance in y for PC:", pc, "\n")</span></span>
<span id="cb93-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       next</span></span>
<span id="cb93-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     }</span></span>
<span id="cb93-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   </span></span>
<span id="cb93-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     R2 &lt;- cor(y, preds)^2</span></span>
<span id="cb93-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     results[results$PC == pc, "R2"] &lt;- R2</span></span>
<span id="cb93-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   }</span></span>
<span id="cb93-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   </span></span>
<span id="cb93-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   return(results)</span></span>
<span id="cb93-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># }</span></span>
<span id="cb93-51"></span>
<span id="cb93-52">performance_results_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_Host_AFDW, Host_AFDW_pcs, vsd_miRNA)</span>
<span id="cb93-53"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.1751  0.4099  0.7795  0.6614  0.8911  0.9503      15</code></pre>
</section>
<section id="results-1" class="level2">
<h2 class="anchored" data-anchor-id="results-1">4.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb95" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb95-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># few enough miRNA that we can show all</span></span>
<span id="cb95-3">top_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb95-4"></span>
<span id="cb95-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb95-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb95-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb95-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA as Predictive Features"</span>,</span>
<span id="cb95-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb95-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-22-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb96" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb96-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb96-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb96-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb96-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb96-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb96-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb96-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-23-1.png" class="img-fluid"><!-- --></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb98" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb98-2">loadings_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb98-3"></span>
<span id="cb98-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb98-5">loadings_Host_AFDW_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_Host_AFDW) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb98-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb98-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host_AFDW_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb98-8"></span>
<span id="cb98-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top CpGs contributing most to each PC</span></span>
<span id="cb98-10">top_genes_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_Host_AFDW_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb98-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Host_AFDW_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb98-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb98-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 10 CpGs per PC</span></span>
<span id="cb98-14"></span>
<span id="cb98-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Host_AFDW)</span></code></pre></div>
<pre><code>## # A tibble: 800 Ã— 3
## # Groups:   Host_AFDW_PC [40]
##    gene       Host_AFDW_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_010504 PC1          -0.0593
##  2 FUN_033160 PC1          -0.0587
##  3 FUN_042402 PC1          -0.0580
##  4 FUN_026248 PC1          -0.0579
##  5 FUN_010505 PC1          -0.0578
##  6 FUN_030089 PC1          -0.0576
##  7 FUN_027385 PC1          -0.0575
##  8 FUN_013949 PC1          -0.0573
##  9 FUN_008069 PC1          -0.0572
## 10 FUN_036450 PC1          -0.0570
## # â„¹ 790 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb100" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb100-2">best_pc_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb100-3"></span>
<span id="cb100-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb100-5">actual_values_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Host_AFDW_pcs[[best_pc_Host_AFDW]]</span>
<span id="cb100-6">predicted_values_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Host_AFDW[[best_pc_Host_AFDW]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb100-7"></span>
<span id="cb100-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb100-9">prediction_df_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb100-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_Host_AFDW,</span>
<span id="cb100-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_Host_AFDW</span>
<span id="cb100-12">)</span>
<span id="cb100-13"></span>
<span id="cb100-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb100-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_Host_AFDW, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_Host_AFDW),</span>
<span id="cb100-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb100-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb100-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_Host_AFDW), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_Host_AFDW), </span>
<span id="cb100-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb100-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-25-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb102" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb103" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Host_AFDW_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_Host_AFDW))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   Host_AFDW_PC [1]
##    gene       Host_AFDW_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 FUN_010504 PC1          -0.0593
##  2 FUN_033160 PC1          -0.0587
##  3 FUN_042402 PC1          -0.0580
##  4 FUN_026248 PC1          -0.0579
##  5 FUN_010505 PC1          -0.0578
##  6 FUN_030089 PC1          -0.0576
##  7 FUN_027385 PC1          -0.0575
##  8 FUN_013949 PC1          -0.0573
##  9 FUN_008069 PC1          -0.0572
## 10 FUN_036450 PC1          -0.0570
## 11 FUN_025551 PC1          -0.0569
## 12 FUN_027383 PC1          -0.0567
## 13 FUN_035483 PC1          -0.0566
## 14 FUN_040002 PC1          -0.0563
## 15 FUN_031375 PC1          -0.0558
## 16 FUN_040401 PC1          -0.0558
## 17 FUN_032914 PC1          -0.0557
## 18 FUN_032541 PC1          -0.0555
## 19 FUN_027486 PC1          -0.0555
## 20 FUN_033529 PC1          -0.0552</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb105" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above 0.75</span></span>
<span id="cb105-2">all_pcs_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb105-3"></span>
<span id="cb105-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Host_AFDW) {</span>
<span id="cb105-5">  </span>
<span id="cb105-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb105-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Host_AFDW_pcs[[pc]]</span>
<span id="cb105-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Host_AFDW[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb105-9">  </span>
<span id="cb105-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb105-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb105-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb105-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb105-14">  )</span>
<span id="cb105-15">  </span>
<span id="cb105-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb105-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb105-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb105-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb105-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb105-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Host_AFDW[performance_results_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb105-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb105-27">  </span>
<span id="cb105-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb105-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-6.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-7.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-27-8.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb114" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb114-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb114-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb114-4">  </span>
<span id="cb114-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb114-6">}</span>
<span id="cb114-7"></span>
<span id="cb114-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Host_AFDW) {</span>
<span id="cb114-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb114-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_Host_AFDW[[pc]]</span>
<span id="cb114-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb114-12">  </span>
<span id="cb114-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA for predicting this PC</span></span>
<span id="cb114-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb114-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb114-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb114-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb114-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA Predictors for"</span>, pc),</span>
<span id="cb114-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb114-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb114-21">  </span>
<span id="cb114-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb114-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-6.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-7.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-28-8.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="symbiont-photsynthesis-am" class="level1">
<h1>5 Symbiont photsynthesis (Am)</h1>
<section id="the-model-1" class="level2">
<h2 class="anchored" data-anchor-id="the-model-1">5.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression</p>
<div class="sourceCode" id="cb115" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA expression</span></span>
<span id="cb115-2">models_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(Am_pcs, vsd_miRNA)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb116" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1">feature_importance_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_Am)</span>
<span id="cb116-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_Am, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature       MeanImportance
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Cluster_17173          1.20 
##  2 Cluster_5516           0.969
##  3 Cluster_9706           0.848
##  4 Cluster_9420           0.785
##  5 Cluster_4752           0.688
##  6 Cluster_14146          0.570
##  7 Cluster_4036           0.555
##  8 Cluster_5517           0.534
##  9 Cluster_1865           0.523
## 10 Cluster_9786           0.522
## 11 Cluster_2372           0.515
## 12 Cluster_17245          0.505
## 13 Cluster_1836           0.484
## 14 Cluster_17623          0.480
## 15 Cluster_17186          0.462
## 16 Cluster_1819           0.430
## 17 Cluster_4026           0.410
## 18 Cluster_16354          0.403
## 19 Cluster_10452          0.403
## 20 Cluster_5603           0.385</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb118" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1">performance_results_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_Am, Am_pcs, vsd_miRNA)</span>
<span id="cb118-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.2014  0.5638  0.6729  0.6452  0.8223  0.9250      16</code></pre>
</section>
<section id="results-2" class="level2">
<h2 class="anchored" data-anchor-id="results-2">5.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb120" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb120-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># few enough miRNA that we can show all</span></span>
<span id="cb120-3">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb120-4"></span>
<span id="cb120-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb120-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb120-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb120-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA as Predictive Features"</span>,</span>
<span id="cb120-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb120-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-32-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb121" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb121-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb121-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb121-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb121-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb121-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb121-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb121-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 16 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-33-1.png" class="img-fluid"><!-- --></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb123" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb123-2">loadings_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb123-3"></span>
<span id="cb123-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb123-5">loadings_Am_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_Am) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb123-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb123-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Am_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb123-8"></span>
<span id="cb123-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top CpGs contributing most to each PC</span></span>
<span id="cb123-10">top_genes_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_Am_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb123-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Am_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb123-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb123-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 10 CpGs per PC</span></span>
<span id="cb123-14"></span>
<span id="cb123-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Am)</span></code></pre></div>
<pre><code>## # A tibble: 800 Ã— 3
## # Groups:   Am_PC [40]
##    gene       Am_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;
##  1 FUN_011681 PC1   -0.0250
##  2 FUN_040949 PC1    0.0244
##  3 FUN_027962 PC1    0.0244
##  4 FUN_023373 PC1    0.0244
##  5 FUN_000239 PC1    0.0244
##  6 FUN_014926 PC1    0.0241
##  7 FUN_001784 PC1   -0.0240
##  8 FUN_016798 PC1   -0.0239
##  9 FUN_023033 PC1   -0.0239
## 10 FUN_016083 PC1   -0.0238
## # â„¹ 790 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb125" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb125-2">best_pc_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb125-3"></span>
<span id="cb125-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb125-5">actual_values_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Am_pcs[[best_pc_Am]]</span>
<span id="cb125-6">predicted_values_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Am[[best_pc_Am]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb125-7"></span>
<span id="cb125-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb125-9">prediction_df_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb125-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_Am,</span>
<span id="cb125-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_Am</span>
<span id="cb125-12">)</span>
<span id="cb125-13"></span>
<span id="cb125-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb125-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_Am, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb125-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb125-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb125-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb125-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_Am),</span>
<span id="cb125-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb125-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb125-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_Am), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_Am), </span>
<span id="cb125-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb125-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-35-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb127" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb128" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Am_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_Am))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   Am_PC [1]
##    gene       Am_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;
##  1 FUN_000870 PC5   -0.0479
##  2 FUN_031256 PC5   -0.0439
##  3 FUN_006410 PC5    0.0420
##  4 FUN_034999 PC5   -0.0416
##  5 FUN_018197 PC5    0.0411
##  6 FUN_036049 PC5   -0.0402
##  7 FUN_043250 PC5   -0.0400
##  8 FUN_011275 PC5   -0.0398
##  9 FUN_015215 PC5    0.0397
## 10 FUN_008217 PC5    0.0396
## 11 FUN_001269 PC5    0.0389
## 12 FUN_039800 PC5    0.0389
## 13 FUN_018741 PC5   -0.0382
## 14 FUN_003878 PC5   -0.0382
## 15 FUN_030103 PC5    0.0381
## 16 FUN_005241 PC5   -0.0378
## 17 FUN_035648 PC5    0.0378
## 18 FUN_033743 PC5    0.0377
## 19 FUN_029320 PC5   -0.0376
## 20 FUN_037177 PC5   -0.0375</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb130" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above 0.75</span></span>
<span id="cb130-2">all_pcs_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb130-3"></span>
<span id="cb130-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Am) {</span>
<span id="cb130-5">  </span>
<span id="cb130-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb130-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Am_pcs[[pc]]</span>
<span id="cb130-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_Am[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb130-9">  </span>
<span id="cb130-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb130-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb130-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb130-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb130-14">  )</span>
<span id="cb130-15">  </span>
<span id="cb130-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb130-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb130-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb130-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb130-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb130-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_Am[performance_results_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb130-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb130-27">  </span>
<span id="cb130-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb130-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-37-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-37-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-37-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-37-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-37-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-37-6.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb137" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb137-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb137-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb137-4">  </span>
<span id="cb137-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb137-6">}</span>
<span id="cb137-7"></span>
<span id="cb137-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_Am) {</span>
<span id="cb137-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb137-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_Am[[pc]]</span>
<span id="cb137-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb137-12">  </span>
<span id="cb137-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA for predicting this PC</span></span>
<span id="cb137-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb137-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb137-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb137-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb137-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA Predictors for"</span>, pc),</span>
<span id="cb137-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb137-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb137-21">  </span>
<span id="cb137-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb137-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-38-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-38-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-38-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-38-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-38-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-38-6.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="atp-production-go-terms" class="level1">
<h1>6 ATP production (GO terms)</h1>
<section id="the-model-2" class="level2">
<h2 class="anchored" data-anchor-id="the-model-2">6.1 The model</h2>
<p>Train elastic models to predict gene expression PCs from miRNA expression</p>
<div class="sourceCode" id="cb138" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from miRNA expression</span></span>
<span id="cb138-2">models_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(ATP_prod_GO_pcs, vsd_miRNA)</span></code></pre></div>
<p>Extract feature importance.</p>
<div class="sourceCode" id="cb139" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1">feature_importance_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models_ATP_prod_GO)</span>
<span id="cb139-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance_ATP_prod_GO, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive miRNA</span></span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 2
##    Feature       MeanImportance
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Cluster_2372          0.186 
##  2 Cluster_17623         0.179 
##  3 Cluster_14146         0.147 
##  4 Cluster_9366          0.146 
##  5 Cluster_9786          0.138 
##  6 Cluster_4752          0.103 
##  7 Cluster_10452         0.0896
##  8 Cluster_17186         0.0813
##  9 Cluster_4026          0.0807
## 10 Cluster_3109          0.0777
## 11 Cluster_17245         0.0775
## 12 Cluster_4034          0.0746
## 13 Cluster_17173         0.0728
## 14 Cluster_9706          0.0688
## 15 Cluster_14165         0.0676
## 16 Cluster_16354         0.0654
## 17 Cluster_1865          0.0629
## 18 Cluster_9512          0.0624
## 19 Cluster_1836          0.0612
## 20 Cluster_12081         0.0600</code></pre>
<p>Evaluate performance.</p>
<div class="sourceCode" id="cb141" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1">performance_results_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models_ATP_prod_GO, ATP_prod_GO_pcs, vsd_miRNA)</span>
<span id="cb141-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##  0.2543  0.6024  0.7618  0.6743  0.8301  0.8518       2</code></pre>
</section>
<section id="results-3" class="level2">
<h2 class="anchored" data-anchor-id="results-3">6.2 Results</h2>
<p>Plot results.</p>
<div class="sourceCode" id="cb143" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top predictive features</span></span>
<span id="cb143-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># few enough miRNA that we can show all</span></span>
<span id="cb143-3">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, MeanImportance)</span>
<span id="cb143-4"></span>
<span id="cb143-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb143-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb143-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb143-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb143-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb143-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA as Predictive Features"</span>,</span>
<span id="cb143-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb143-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-42-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb144" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(PC), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb144-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb144-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb144-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb144-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb144-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb144-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb144-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-43-1.png" class="img-fluid"><!-- --></p>
<p>View components associated with gene PCs</p>
<div class="sourceCode" id="cb146" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb146-2">loadings_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb146-3"></span>
<span id="cb146-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb146-5">loadings_ATP_prod_GO_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(loadings_ATP_prod_GO) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb146-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb146-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_prod_GO_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb146-8"></span>
<span id="cb146-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top CpGs contributing most to each PC</span></span>
<span id="cb146-10">top_genes_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> loadings_ATP_prod_GO_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb146-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(ATP_prod_GO_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb146-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb146-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 10 CpGs per PC</span></span>
<span id="cb146-14"></span>
<span id="cb146-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_ATP_prod_GO)</span></code></pre></div>
<pre><code>## # A tibble: 440 Ã— 3
## # Groups:   ATP_prod_GO_PC [22]
##    gene       ATP_prod_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;
##  1 FUN_025802 PC1             -0.328
##  2 FUN_025367 PC1             -0.316
##  3 FUN_000960 PC1             -0.313
##  4 FUN_031975 PC1             -0.311
##  5 FUN_031686 PC1             -0.290
##  6 FUN_014565 PC1             -0.277
##  7 FUN_007016 PC1             -0.246
##  8 FUN_039808 PC1             -0.243
##  9 FUN_038166 PC1             -0.242
## 10 FUN_025823 PC1             -0.208
## # â„¹ 430 more rows</code></pre>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="sourceCode" id="cb148" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb148-2">best_pc_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb148-3"></span>
<span id="cb148-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb148-5">actual_values_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ATP_prod_GO_pcs[[best_pc_ATP_prod_GO]]</span>
<span id="cb148-6">predicted_values_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO[[best_pc_ATP_prod_GO]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb148-7"></span>
<span id="cb148-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb148-9">prediction_df_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb148-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values_ATP_prod_GO,</span>
<span id="cb148-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values_ATP_prod_GO</span>
<span id="cb148-12">)</span>
<span id="cb148-13"></span>
<span id="cb148-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb148-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df_ATP_prod_GO, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb148-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb148-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb148-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb148-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc_ATP_prod_GO),</span>
<span id="cb148-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb148-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb148-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values_ATP_prod_GO), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values_ATP_prod_GO), </span>
<span id="cb148-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb148-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-45-1.png" class="img-fluid"><!-- --></p>
<div class="sourceCode" id="cb150" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p>View top 20 genes associated with the PC with the highest R^2</p>
<div class="sourceCode" id="cb151" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(ATP_prod_GO_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>best_pc_ATP_prod_GO))</span></code></pre></div>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   ATP_prod_GO_PC [1]
##    gene       ATP_prod_GO_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;
##  1 FUN_009532 PC5            -0.618 
##  2 FUN_028263 PC5            -0.319 
##  3 FUN_031686 PC5            -0.316 
##  4 FUN_036898 PC5             0.293 
##  5 FUN_014565 PC5            -0.292 
##  6 FUN_038166 PC5             0.243 
##  7 FUN_025823 PC5             0.236 
##  8 FUN_014564 PC5             0.175 
##  9 FUN_040783 PC5            -0.140 
## 10 FUN_038688 PC5            -0.110 
## 11 FUN_031975 PC5             0.110 
## 12 FUN_032701 PC5            -0.105 
## 13 FUN_033885 PC5             0.0843
## 14 FUN_007016 PC5             0.0843
## 15 FUN_015065 PC5            -0.0721
## 16 FUN_025367 PC5             0.0716
## 17 FUN_025802 PC5            -0.0711
## 18 FUN_038727 PC5             0.0706
## 19 FUN_014563 PC5            -0.0693
## 20 FUN_039808 PC5             0.0617</code></pre>
<p>Plot performance for all PCs</p>
<div class="sourceCode" id="cb153" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select all PCs with R^2 values above line in plot</span></span>
<span id="cb153-2">all_pcs_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(R2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(PC)</span>
<span id="cb153-3"></span>
<span id="cb153-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_ATP_prod_GO) {</span>
<span id="cb153-5">  </span>
<span id="cb153-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb153-7">  actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ATP_prod_GO_pcs[[pc]]</span>
<span id="cb153-8">  predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models_ATP_prod_GO[[pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb153-9">  </span>
<span id="cb153-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb153-11">  prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb153-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb153-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb153-14">  )</span>
<span id="cb153-15">  </span>
<span id="cb153-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb153-17">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, pc),</span>
<span id="cb153-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb153-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb153-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb153-25">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results_ATP_prod_GO[performance_results_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>pc,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb153-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb153-27">  </span>
<span id="cb153-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb153-29">}</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-47-1.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-47-2.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-47-3.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-47-4.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-47-5.png" class="img-fluid"><!-- --></p>
<pre><code>## `geom_smooth()` using formula = 'y ~ x'</code></pre>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-47-6.png" class="img-fluid"><!-- --></p>
<p>We can also look at which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="sourceCode" id="cb160" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1">get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb160-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb160-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb160-4">  </span>
<span id="cb160-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb160-6">}</span>
<span id="cb160-7"></span>
<span id="cb160-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_pcs_ATP_prod_GO) {</span>
<span id="cb160-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb160-10">  best_pc_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models_ATP_prod_GO[[pc]]</span>
<span id="cb160-11">  best_pc_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model)</span>
<span id="cb160-12">  </span>
<span id="cb160-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot top most important miRNA for predicting this PC</span></span>
<span id="cb160-14">  plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb160-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb160-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb160-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb160-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA Predictors for"</span>, pc),</span>
<span id="cb160-19">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb160-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span>
<span id="cb160-21">  </span>
<span id="cb160-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(plot)</span>
<span id="cb160-23">}</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-48-1.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-48-2.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-48-3.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-48-4.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-48-5.png" class="img-fluid"><!-- --><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-48-6.png" class="img-fluid"><!-- --></p>
</section>
</section>
<section id="compare" class="level1">
<h1>7 Compare</h1>
<p>Visualize the relative importance of miRNA in predicting expression for these different gene sets:</p>
<div class="sourceCode" id="cb161" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perfomr min-max normalization on the mean importance of miRNA for each group</span></span>
<span id="cb161-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This will place all along a 0-1 range for comparison purposes</span></span>
<span id="cb161-3">normalize <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb161-4">  (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x))</span>
<span id="cb161-5">}</span>
<span id="cb161-6"></span>
<span id="cb161-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalize</span></span>
<span id="cb161-8">top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_Host_AFDW<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb161-9">top_features_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_Am<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb161-10">top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance_norm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">normalize</span>(top_features_ATP_prod_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MeanImportance)</span>
<span id="cb161-11"></span>
<span id="cb161-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add group labels</span></span>
<span id="cb161-13">top_features_Host_AFDW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Host_AFDW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host_AFDW"</span>)</span>
<span id="cb161-14">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Am <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Am"</span>)</span>
<span id="cb161-15">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_prod_GO"</span>)</span>
<span id="cb161-16"></span>
<span id="cb161-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set rows in same order</span></span>
<span id="cb161-18">top_features_Am <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_Am[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb161-19">top_features_ATP_prod_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> top_features_ATP_prod_GO[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(top_features_Host_AFDW),]</span>
<span id="cb161-20"></span>
<span id="cb161-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine</span></span>
<span id="cb161-22">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(top_features_Host_AFDW, top_features_Am, top_features_ATP_prod_GO)</span>
<span id="cb161-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove raw mean importance</span></span>
<span id="cb161-24">all_gene_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>MeanImportance)</span>
<span id="cb161-25"></span>
<span id="cb161-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wide format: rows = miRNAs, columns = groups</span></span>
<span id="cb161-27">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> all_gene_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb161-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> MeanImportance_norm)</span>
<span id="cb161-29"></span>
<span id="cb161-30">heatmap_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(heatmap_df)</span>
<span id="cb161-31"></span>
<span id="cb161-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Melt into long format for ggplot</span></span>
<span id="cb161-33">heatmap_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(heatmap_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>)</span>
<span id="cb161-34"></span>
<span id="cb161-35"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(heatmap_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Feature, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb161-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb161-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb161-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb161-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feature"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb161-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/22.1-Apul-miRNA-mRNA-machine-learning-gene_sets_files/figure-gfm/unnamed-chunk-49-1.png" class="img-fluid"><!-- --></p>
<p>Cluster by miRNA importance</p>
<div class="sourceCode" id="cb162" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make Feature column the rownames and convert to matrix</span></span>
<span id="cb162-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(heatmap_df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> heatmap_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Feature</span>
<span id="cb162-3">heatmap_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(heatmap_df[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Removes the 'Feature' column</span></span>
<span id="cb162-4"></span>
<span id="cb162-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pheatmap</span>(</span>
<span id="cb162-6">  heatmap_matrix, </span>
<span id="cb162-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_rows =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering miRNAs (rows) by similarity in importance</span></span>
<span id="cb162-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster_cols =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clustering groups (columns)</span></span>
<span id="cb162-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># No scaling (since data is already normalized)</span></span>
<span id="cb162-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_rownames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show miRNA names</span></span>
<span id="cb162-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_colnames =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show group names</span></span>
<span id="cb162-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Red gradient for importance</span></span>
<span id="cb162-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNAs Importance Across Groups"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Title of the heatmap</span></span>
<span id="cb162-14">)</span></code></pre></div>
<p>[](22.1-Apul-miRNA-mRNA-machine-lea</p>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_04_timeseries_ML_3.html</guid>
  <pubDate>Mon, 07 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul, Functional Annotation and Enrichment Analyses</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_01_timeseries_FA_FE.html</link>
  <description><![CDATA[ 




<p>Note that I began this work before my time off (Thurs 3/20) and finished after returning, so some portions of this post are retroactive</p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/21-Apul-annotate-miRNA-mRNA-WGCNA.Rmd">Code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/21-Apul-annotate-miRNA-mRNA-WGCNA.md">Rendered code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/tree/main/D-Apul/output/21-Apul-annotate-miRNA-mRNA-WGCNA">Output files</a></p>
<p>This work is based on the mRNA-miRNA WGCNA and the correlation of WGCNA modules with traits of interest (e.g.&nbsp;physiological metrics, seasonal/environmental metrics). In it, I:</p>
<ul>
<li><p>Functionally annotated all WGCNA modules</p></li>
<li><p>Performed functional enrichment analysis (topGO) on all WGCNA modules that are significantly correlated with a trait to inform what genes and functions are associated with phenotype and season.</p></li>
<li><p>Identified overlaps in module-module correlation <em>and</em> miRanda-based putative binding to try to identify putative miRNA-mRNA interactions.</p></li>
<li><p>For putative miRNA-mRNA interactions, performed functional annotation</p></li>
<li><p>For putative miRNA-mRNA interactions, performed functional enrichment analysis on the genes a given miRNA putatively interacts with to investigate putative miRNA function</p></li>
<li><p>For genes of interest (e.g.&nbsp;genes contained within modules that are significantly correlated with a trait), saved filtered gene sets, both an FA table and raw counts.</p></li>
</ul>
<p>Frankly, this is sooooo much data and I didnâ€™t figure out a great way to summarize all of the results in a visual or digestible way. Here a few summary figures:</p>
<p><strong>Which traits have the most significantly correlated modules/genes?</strong></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/21-Apul-annotate-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-28-1.png?raw=true" class="img-fluid"></p>
<p><strong>For traits of interest, what biological processes are overrepresented, and what overlap is there among traits of interest?</strong></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/21-Apul-annotate-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-14-1.png?raw=true" class="img-fluid"></p>
<p>The true value of these analyses will require identifying a trait/module/miRNA of interest and the looking at what functions are enriched for it. Iâ€™ve been playing around with some interaction network visualizations, similarly to what I did with the miRanda/Pcor results, but this includes many more genes and is thus much more computationally intensive and would make the visualization less helpful</p>
<p>Code copied below in case of file path changes:</p>
<p>After running WGCNA to evaluate modules of mRNA and miRNA with correlated expression, we need to functionally annotate genes to evaluate module function(s).</p>
<section id="load-packages" class="level1">
<h1>Load packages</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(topGO)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span></code></pre></div>
</div>
</section>
<section id="load-and-format-annotation-files" class="level1">
<h1>Load and format annotation files</h1>
<p>Already annotated the A.pulchra genome as part of the <code>deep-dive expression</code> project (see <a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/02-Apul-reference-annotation.Rmd"><code>deep-dive-expression/D-Apul/code/02-Apul-reference-annotation.Rmd</code></a>), so weâ€™ll pull the annotation file from that</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Can access file stored here if needed</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://gannet.fish.washington.edu/kdurkin1/ravenbackups/deep-dive-expression/D-Apul/output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cp</span> ../../../deep-dive-expression/D-Apul/output/02-Apul-reference-annotation/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab ../output/21-Apul-annotate-miRNA-mRNA-WGCNA</span></code></pre></div>
</div>
<p>Read mapping file into R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">IDmapping_dirty <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/Apulcra-genome-mRNA-IDmapping-2024_12_12.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Need to remove quotations surrounding each entry</span></span>
<span id="cb3-4">IDmapping_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> IDmapping_dirty</span>
<span id="cb3-5">IDmapping_locations[] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(IDmapping_locations, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'^"(.*)"$'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1'</span>, x))</span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unneeded columns </span></span>
<span id="cb3-7">IDmapping_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> IDmapping_locations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>X, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>V13)</span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure there are no duplicate rows</span></span>
<span id="cb3-9">IDmapping_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> IDmapping_locations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(IDmapping_locations)</span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Looks good!</span></span></code></pre></div>
</div>
<p>This file shows each gene as itâ€™s genomic location. We want to use gene IDs to associate genes, so add gene IDs to this annotation table</p>
<p>Read in file that associates each mRNA genomic location with corresponding gene ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">mRNA_FUNids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/05-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"product"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unwanted text from parent column</span></span>
<span id="cb4-4">mRNA_FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parent="</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, mRNA_FUNids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID)</span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only need to keep mRNA location and gene ID</span></span>
<span id="cb4-6">mRNA_FUNids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mRNA_FUNids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(location, gene_ID)</span></code></pre></div>
</div>
<p>join with annotation file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">IDmapping <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(IDmapping_locations, mRNA_FUNids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>))</span></code></pre></div>
</div>
</section>
<section id="annotate-wgcna-modules" class="level1">
<h1>Annotate WGCNA modules</h1>
<p>Load file that shows which module each gene/miRNA is in</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">module_membership <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/12-Apul-miRNA-mRNA-WGCNA/WGCNA-module-membership.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<p>join with annotation file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">module_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(module_membership, IDmapping, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span>))</span></code></pre></div>
</div>
<p>Many of the genes donâ€™t have available annotations, so reduce to only keep those that are annotated (note this will also remove lncRNA and miRNA).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">module_FA_available <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_FA[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(module_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Gene.Ontology.IDs),]</span>
<span id="cb8-2">module_FA_available <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_FA_available[module_FA_available<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Gene.Ontology.IDs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,]</span></code></pre></div>
</div>
</section>
<section id="functional-enrichment-of-modules-topgo" class="level1">
<h1>Functional Enrichment of modules (topGO)</h1>
<p>I want to see whether our modules of coexpressed genes/miRNA represent specific, over-represented functionalities (i.e.&nbsp;does any module contain more metabolism-related genes than expected?)</p>
<p>To do this weâ€™ll perform functional enrichment of each module using the R package topGO</p>
<section id="format-gene-ontology-go-annotations" class="level2">
<h2 class="anchored" data-anchor-id="format-gene-ontology-go-annotations">Format Gene Ontology (GO) annotations</h2>
<p>Want to isolate a list of GO terms per gene</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">gene_to_GO <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> IDmapping <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Gene.Ontology.IDs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(gene_ID, Gene.Ontology.IDs)</span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#head(gene_to_GO)</span></span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Needs to be formatted as a named list for use in topGO</span></span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert data frame to a named list</span></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gene_to_GO_list &lt;- gene_to_GO %&gt;%</span></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   mutate(GO_terms = strsplit(Gene.Ontology.IDs, ";")) %&gt;%</span></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   tibble::deframe()</span></span>
<span id="cb9-9"></span>
<span id="cb9-10">gene_to_GO_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setNames</span>(</span>
<span id="cb9-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(gene_to_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Gene.Ontology.IDs), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>), </span>
<span id="cb9-12">  gene_to_GO<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_ID</span>
<span id="cb9-13">)</span></code></pre></div>
</div>
<p>Note: I think this means genes that had a Uniprot ID but no GO terms are excluded from this analysis</p>
<p>Define reference set. This should be all genes <em>found in our samples</em>, NOT all genes in the A.pulchra genome. Some genes (e.g., reproduction pathways) may not be found/expected in our samples for valid biological reasons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">reference_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_membership<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene</span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(reference_genes)</span></code></pre></div>
</div>
</section>
<section id="extract-list-of-significant-wgcna-modules" class="level2">
<h2 class="anchored" data-anchor-id="extract-list-of-significant-wgcna-modules">Extract list of significant WGCNA modules</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">WGCNA_pvals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/12-Apul-miRNA-mRNA-WGCNA/pval-cor-WGCNA_module-phys_envir.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter to only keep rows and columns with at least one significant pval</span></span>
<span id="cb11-4">filtered_rows <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WGCNA_pvals[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(WGCNA_pvals <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span>
<span id="cb11-5">WGCNA_pvals_significant <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> filtered_rows[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(filtered_rows <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create list of modules that are significantly correlated with at least one trait</span></span>
<span id="cb11-8">significant_modules <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row.names</span>(WGCNA_pvals_significant)</span></code></pre></div>
</div>
</section>
<section id="topgo-function" class="level2">
<h2 class="anchored" data-anchor-id="topgo-function">topGO function</h2>
<p>Create a function to run topGO functional enrichment analysis for an input module (weâ€™ll want to use this for many modules of interest)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">module_topGO_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(module.name) {</span>
<span id="cb12-2">  </span>
<span id="cb12-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Isolate genes in our input module of interest</span></span>
<span id="cb12-4">  genes_in_module <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_membership <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> module.name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(gene)</span>
<span id="cb12-7">  </span>
<span id="cb12-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create factor for all reference genes, where 1 represents module membership and 0 means the gene is not in module of interest</span></span>
<span id="cb12-9">  gene_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(reference_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> genes_in_module))</span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(gene_list) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> reference_genes</span>
<span id="cb12-11">  </span>
<span id="cb12-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create topGO object</span></span>
<span id="cb12-13">  GO_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>,</span>
<span id="cb12-14">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">description =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Functional Enrichment Analysis"</span>, </span>
<span id="cb12-15">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BP"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Biological Process</span></span>
<span id="cb12-16">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes =</span> gene_list,</span>
<span id="cb12-17">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb12-18">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO =</span> gene_to_GO_list)</span>
<span id="cb12-19">  </span>
<span id="cb12-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run GO enrichment test</span></span>
<span id="cb12-21">  GO_BP_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span>
<span id="cb12-22">  </span>
<span id="cb12-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View the results</span></span>
<span id="cb12-24">  GO_BP_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_BP_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span>
<span id="cb12-25">  </span>
<span id="cb12-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter by significant results</span></span>
<span id="cb12-27">  GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb12-28">  GO_BP_results_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_BP_results[GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span>
<span id="cb12-29"></span>
<span id="cb12-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return</span></span>
<span id="cb12-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(GO_BP_results_sig)</span>
<span id="cb12-32">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(module <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> significant_modules) {</span>
<span id="cb13-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run topGo enrichent function</span></span>
<span id="cb13-5">  module_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">module_topGO_FE</span>(module)</span>
<span id="cb13-6">  </span>
<span id="cb13-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep results if not empty</span></span>
<span id="cb13-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(module_results) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb13-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note the source column</span></span>
<span id="cb13-10">    module_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module</span>
<span id="cb13-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># append to results list</span></span>
<span id="cb13-12">    results[[module]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_results</span>
<span id="cb13-13">  }</span>
<span id="cb13-14">}</span>
<span id="cb13-15"></span>
<span id="cb13-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all the resuts data frames into one</span></span>
<span id="cb13-17">combined_GO_BP_results_sig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, results)</span>
<span id="cb13-18"></span>
<span id="cb13-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View</span></span>
<span id="cb13-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(combined_GO_BP_results_sig)</span></code></pre></div>
</div>
</section>
<section id="heatmap-of-significant-go-terms-by-trait" class="level2">
<h2 class="anchored" data-anchor-id="heatmap-of-significant-go-terms-by-trait">Heatmap of significant GO terms by trait</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract significant modules for each trait</span></span>
<span id="cb14-2">significant_modules_per_trait <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(WGCNA_pvals_significant, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(WGCNA_pvals_significant)[x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>])</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Specify traits of interest</span></span>
<span id="cb14-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#traits &lt;- colnames(WGCNA_pvals_significant)</span></span>
<span id="cb14-6">traits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_Temp_mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_solar_rad_kwpm2_mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative_rainfall_mm_mean"</span>)</span>
<span id="cb14-7"></span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create empty matrix to store values for hetmap</span></span>
<span id="cb14-9">go_term_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(traits), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Term)))</span>
<span id="cb14-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(go_term_counts) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> traits  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Trait names</span></span>
<span id="cb14-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(go_term_counts) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Term)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unique GO terms</span></span>
<span id="cb14-12"></span>
<span id="cb14-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loop through each trait, calculate the number of significant modules enriched for each GO term</span></span>
<span id="cb14-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (trait <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> traits) {</span>
<span id="cb14-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the significant modules for this trait</span></span>
<span id="cb14-16">  significant_modules <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_per_trait[[trait]]</span>
<span id="cb14-17">  </span>
<span id="cb14-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if a module is enriched for each GO term</span></span>
<span id="cb14-19">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (go_term <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Term)) {</span>
<span id="cb14-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if the module is in the list of significant modules for the trait and if it's enriched for this GO term</span></span>
<span id="cb14-21">    enriched_modules <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> combined_GO_BP_results_sig <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> go_term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> significant_modules) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-23">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Count of modules enriched for this GO term</span></span>
<span id="cb14-24">    </span>
<span id="cb14-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Count number of modules that contain each GO term</span></span>
<span id="cb14-26">    go_term_counts[trait, go_term] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> enriched_modules</span>
<span id="cb14-27">  }</span>
<span id="cb14-28">}</span>
<span id="cb14-29"></span>
<span id="cb14-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert matrix to df for plotting</span></span>
<span id="cb14-31">go_term_counts_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(go_term_counts) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trait"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO_term"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Module_Count"</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Trait)</span>
<span id="cb14-34"></span>
<span id="cb14-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Truncate GO term names</span></span>
<span id="cb14-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#go_term_counts_df$GO_term &lt;- substr(go_term_counts_df$GO_term, 1, 40)</span></span>
<span id="cb14-37"></span>
<span id="cb14-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb14-39"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(go_term_counts_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Trait, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> GO_term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Module_Count)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adds grid lines</span></span>
<span id="cb14-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Color gradient from white (low) to blue (high)</span></span>
<span id="cb14-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), </span>
<span id="cb14-44">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb14-45">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# of Enriched Modules"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Significant Modules Enriched for GO Terms"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>)</span>
<span id="cb14-48"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/go_term_heatmap_envir_traits.png"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
</div>
</section>
<section id="isolate-enriched-terms-by-associated-traits" class="level2">
<h2 class="anchored" data-anchor-id="isolate-enriched-terms-by-associated-traits">Isolate enriched terms by associated trait(s)</h2>
<p>Terms enriched in modules correlated with TP2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">modules_TP2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_per_trait[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint2"</span>]]</span>
<span id="cb15-2">GO_TP2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> combined_GO_BP_results_sig[combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> modules_TP2,]</span>
<span id="cb15-3">GO_TP2</span></code></pre></div>
</div>
<p>Terms enriched in modules correlated with TP3</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">modules_TP3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_per_trait[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint3"</span>]]</span>
<span id="cb16-2">GO_TP3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> combined_GO_BP_results_sig[combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> modules_TP3,]</span>
<span id="cb16-3">GO_TP3</span></code></pre></div>
</div>
<p>Terms enriched in modules correlated with temp</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">modules_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_per_trait[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_Temp_mean"</span>]]</span>
<span id="cb17-2">GO_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> combined_GO_BP_results_sig[combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> modules_temp,]</span>
<span id="cb17-3">GO_temp</span></code></pre></div>
</div>
<p>Terms enriched in modules correlated with solar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">modules_solar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_per_trait[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_solar_rad_kwpm2_mean"</span>]]</span>
<span id="cb18-2">GO_solar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> combined_GO_BP_results_sig[combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> modules_solar,]</span>
<span id="cb18-3">GO_solar</span></code></pre></div>
</div>
<p>Terms enriched in modules correlated with rain</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">modules_rain <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_per_trait[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative_rainfall_mm_mean"</span>]]</span>
<span id="cb19-2">GO_rain <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> combined_GO_BP_results_sig[combined_GO_BP_results_sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> modules_rain,]</span>
<span id="cb19-3">GO_rain</span></code></pre></div>
</div>
</section>
</section>
<section id="annotate-putative-binding" class="level1">
<h1>Annotate putative binding</h1>
<p>Outline:</p>
<ol type="1">
<li>Have table module pair and correlation values</li>
</ol>
<section id="load-module-module-correlations" class="level2">
<h2 class="anchored" data-anchor-id="load-module-module-correlations">Load module-module correlations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">modules_cor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/12-Apul-miRNA-mRNA-WGCNA/WGCNA-modules-correlations.tab"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove instances where a module is just correlating to itself</span></span>
<span id="cb20-3">modules_cor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> modules_cor[modules_cor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module_A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> modules_cor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module_B,]</span></code></pre></div>
</div>
</section>
<section id="annotate-whether-a-given-module-contains-mirna" class="level2">
<h2 class="anchored" data-anchor-id="annotate-whether-a-given-module-contains-mirna">Annotate whether a given module contains miRNA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Separate module membership into only mRNA and only miRNA</span></span>
<span id="cb21-2">module_membership_mRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_membership <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, gene))</span>
<span id="cb21-3">module_membership_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_membership <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster"</span>, gene))</span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Expand each miRNA_module to show all contained miRNAa</span></span>
<span id="cb21-6">modules_cor_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(modules_cor, module_membership_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module_A"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span>))</span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename columns appropriately</span></span>
<span id="cb21-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(modules_cor_miRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA_module"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA_module"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"correlation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>)</span>
<span id="cb21-9"></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove instances where the module_A (miRNA_module) doesn't contain miRNA</span></span>
<span id="cb21-11">modules_cor_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> modules_cor_miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(miRNA))</span>
<span id="cb21-12"></span>
<span id="cb21-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Expand each mRNA module to show all contained genes</span></span>
<span id="cb21-14">modules_cor_miRNA_mRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(modules_cor_miRNA, module_membership_mRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA_module"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span>))</span></code></pre></div>
</div>
</section>
<section id="id-which-mirna-mrna-pairs-putatively-bind" class="level2">
<h2 class="anchored" data-anchor-id="id-which-mirna-mrna-pairs-putatively-bind">ID which miRNA-mRNA pairs putatively bind</h2>
<p>Load and format miRanda tables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Load ##</span></span>
<span id="cb22-2">miRanda_3UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/07-Apul-miRNA-mRNA-miRanda/Apul-miRanda-3UTR-strict-parsed-geneIDs.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-3"></span>
<span id="cb22-4">miRanda_5UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/07.1-Apul-miRNA-mRNA-miRanda-additional_inputs/Apul-miRanda-5UTR_1kb-strict-parsed.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-5">  </span>
<span id="cb22-6">miRanda_mRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/07.1-Apul-miRNA-mRNA-miRanda-additional_inputs/Apul-miRanda-mRNA_full-strict-parsed.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-7"></span>
<span id="cb22-8"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Format ##</span></span>
<span id="cb22-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove superfluous text in miRNA name column</span></span>
<span id="cb22-10">miRanda_3UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRanda_3UTR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(V1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster[^.]+"</span>))</span>
<span id="cb22-11">miRanda_5UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRanda_5UTR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(V1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster[^.]+"</span>))</span>
<span id="cb22-12">miRanda_mRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRanda_mRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(V1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cluster[^.]+"</span>))</span>
<span id="cb22-13"></span>
<span id="cb22-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For 5UTR and mRNA, need to add gene_IDs associated with each genomic location</span></span>
<span id="cb22-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load and format table of 5UTR geneIDs</span></span>
<span id="cb22-16">FUNids_5UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.delim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/05-Apul-annotate-UTRs/Apul-5UTR-FUNids.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-17">FUNids_5UTR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parent="</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, FUNids_5UTR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V4)</span>
<span id="cb22-18">FUNids_5UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> FUNids_5UTR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(V1, V4)</span>
<span id="cb22-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Already have table of mRNA geneIDs</span></span>
<span id="cb22-20"></span>
<span id="cb22-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add gene IDs to the miRanda tables</span></span>
<span id="cb22-22">miRanda_5UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(miRanda_5UTR, FUNids_5UTR, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span>))</span>
<span id="cb22-23">miRanda_mRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(miRanda_mRNA, mRNA_FUNids, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span>))</span>
<span id="cb22-24"></span>
<span id="cb22-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure no unwanted duplicate rows</span></span>
<span id="cb22-26">miRanda_3UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRanda_3UTR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb22-27">miRanda_5UTR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRanda_5UTR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb22-28">miRanda_mRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRanda_mRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb22-29"></span>
<span id="cb22-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add column to identify whether putative binding is in 3UTR, 5UTR, or CDS</span></span>
<span id="cb22-31">miRanda_3UTR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>binding_loc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3UTR"</span></span>
<span id="cb22-32">miRanda_5UTR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>binding_loc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5UTR"</span></span>
<span id="cb22-33">miRanda_mRNA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>binding_loc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mRNA"</span></span>
<span id="cb22-34"></span>
<span id="cb22-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine into single data frame</span></span>
<span id="cb22-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRanda_3UTR) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binding_loc"</span>)</span>
<span id="cb22-37"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRanda_5UTR) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binding_loc"</span>)</span>
<span id="cb22-38"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(miRanda_mRNA) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V7"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binding_loc"</span>)</span>
<span id="cb22-39">miRanda_combined <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(miRanda_3UTR, miRanda_5UTR, miRanda_mRNA)</span>
<span id="cb22-40"></span>
<span id="cb22-41"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(miRanda_combined)</span></code></pre></div>
</div>
<p>Join with table of correlating modules and their members to annotate, for each miRNA, which of the mRNAs in its correlated module it may bind to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join </span></span>
<span id="cb23-2">modules_cor_miRNA_mRNA_bind <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(modules_cor_miRNA_mRNA, miRanda_combined, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V10"</span>))</span>
<span id="cb23-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep rows where the full miRNA-mRNA interaction matches, not just the mRNA</span></span>
<span id="cb23-4">modules_cor_miRNA_mRNA_bind <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> modules_cor_miRNA_mRNA_bind[modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V1,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span></code></pre></div>
</div>
<p>This is now a table that, for each module that contians miRNA (miRNA_module), shows each module itâ€™s correlated with (mRNA_module), the genes in that module, and whether that gene putatively binds with the miRNA. It still includes, though, instances of multiple putative binding positions for the same miRNA-mRNA pair. Since we just care about the high-level miRNA-mRNA pair, letâ€™s remove this level of detail</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">mod_cor_bind <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> modules_cor_miRNA_mRNA_bind <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(miRNA_module, mRNA_module, correlation, miRNA, gene, binding_loc) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb24-2"></span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(mod_cor_bind)</span>
<span id="cb24-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(mod_cor_bind[mod_cor_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>correlation <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,])</span></code></pre></div>
</div>
<p>So there are 41,633 instances of an miRNA putatively binding to a gene that is contained in a correlated module. 21,274 of these (roughly half) are putative binding between modules that are <em>negatively</em> correlated with each other, which is the expected behavior for canonical miRNA function.</p>
</section>
<section id="join-with-fa-table-to-annotate-each-binding-mrna" class="level2">
<h2 class="anchored" data-anchor-id="join-with-fa-table-to-annotate-each-binding-mrna">Join with FA table to annotate each binding mRNA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">mod_cor_bind_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(mod_cor_bind, IDmapping, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ID"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>()</span>
<span id="cb25-2"></span>
<span id="cb25-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(mod_cor_bind_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Gene.Ontology.IDs)))</span>
<span id="cb25-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(mod_cor_bind_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Gene.Ontology.IDs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> correlation <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span></code></pre></div>
</div>
<p>Of these 41,633 instances of an miRNA putatively binding to a gene contained in a correlated module, only 12,367 (roughly a quarter) of the putatively bound genes are annotated with GO terms. Roughly half of the annotated genes are associated with negative module correlation.</p>
</section>
</section>
<section id="functional-enrichment-of-putative-binding" class="level1">
<h1>Functional Enrichment of putative binding</h1>
<p>In the above annotation weâ€™ve functionally annotated all miRNA-mRNA pairs that are in correlated modules <em>and</em> putatively bind in the 3UTR, 5UTR and/or coding sequence (based on miRanda). The ultimate goal is to elucidate putative function of our miRNAs by evaluating the functions of the mRNAs they putatively interact with.</p>
<p>To aid this we can run functional enrichment on the mRNAs that each miRNA putatively interacts with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modify topGO function for use with miRNA names</span></span>
<span id="cb26-2"></span>
<span id="cb26-3">miRNA_topGO_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(miRNA.name) {</span>
<span id="cb26-4">  </span>
<span id="cb26-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Isolate genes in our input module of interest</span></span>
<span id="cb26-6">  interacting_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mod_cor_bind_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> miRNA.name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(gene)</span>
<span id="cb26-9">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(interacting_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb26-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create factor for all reference genes, where 1 represents module membership and 0 means the gene is not in module of interest</span></span>
<span id="cb26-11">    gene_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(reference_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> interacting_genes))</span>
<span id="cb26-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(gene_list) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> reference_genes</span>
<span id="cb26-13">    </span>
<span id="cb26-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(gene_list)</span>
<span id="cb26-15">    </span>
<span id="cb26-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create topGO object</span></span>
<span id="cb26-17">    GO_BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topGOdata"</span>,</span>
<span id="cb26-18">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">description =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Functional Enrichment Analysis"</span>, </span>
<span id="cb26-19">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ontology =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BP"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Biological Process</span></span>
<span id="cb26-20">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allGenes =</span> gene_list,</span>
<span id="cb26-21">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annot =</span> annFUN.gene2GO, </span>
<span id="cb26-22">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gene2GO =</span> gene_to_GO_list)</span>
<span id="cb26-23">    </span>
<span id="cb26-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run GO enrichment test</span></span>
<span id="cb26-25">    GO_BP_FE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runTest</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fisher"</span>)</span>
<span id="cb26-26">    </span>
<span id="cb26-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View the results</span></span>
<span id="cb26-28">    GO_BP_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GenTable</span>(GO_BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fisher =</span> GO_BP_FE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orderBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fisher"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topNodes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numChar =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>)</span>
<span id="cb26-29">    </span>
<span id="cb26-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter by significant results</span></span>
<span id="cb26-31">    GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher)</span>
<span id="cb26-32">    GO_BP_results_sig<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>GO_BP_results[GO_BP_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Fisher<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,]</span>
<span id="cb26-33">  </span>
<span id="cb26-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return</span></span>
<span id="cb26-35">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(GO_BP_results_sig)</span>
<span id="cb26-36">  }</span>
<span id="cb26-37">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">interacting_miRNAs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(mod_cor_bind_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> na.omit</span>
<span id="cb27-2">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb27-3"></span>
<span id="cb27-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(miRNA <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> interacting_miRNAs) {</span>
<span id="cb27-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run topGo enrichment function</span></span>
<span id="cb27-6">  miRNA_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">miRNA_topGO_FE</span>(miRNA)</span>
<span id="cb27-7">  </span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(miRNA_results)</span>
<span id="cb27-9">  </span>
<span id="cb27-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only keep results if not empty</span></span>
<span id="cb27-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(miRNA_results) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb27-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note the source column</span></span>
<span id="cb27-13">    miRNA_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA</span>
<span id="cb27-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># append to results list</span></span>
<span id="cb27-15">    results[[miRNA]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> miRNA_results</span>
<span id="cb27-16">  }</span>
<span id="cb27-17">}</span>
<span id="cb27-18"></span>
<span id="cb27-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all the resuts data frames into one</span></span>
<span id="cb27-20">combined_GO_BP_results_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind, results)</span>
<span id="cb27-21"></span>
<span id="cb27-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View</span></span>
<span id="cb27-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(combined_GO_BP_results_miRNA)</span></code></pre></div>
</div>
</section>
<section id="summary-figures" class="level1">
<h1>Summary figures</h1>
<p>Bubbleplot showing number of significantly correlated modules for eacvh trait and the total genes represented by those modules</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example significance threshold</span></span>
<span id="cb28-2">pval_threshold <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter significant modules for each trait</span></span>
<span id="cb28-5">significant_modules_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WGCNA_pvals <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>module, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trait"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pvalue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Pvalue <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb28-9"></span>
<span id="cb28-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Count the number of significant modules per trait</span></span>
<span id="cb28-11">module_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Trait) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NumModules =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>())</span>
<span id="cb28-14"></span>
<span id="cb28-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Count the number of genes in significant modules</span></span>
<span id="cb28-16">gene_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_membership <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> significant_modules_long<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(module) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NumGenes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(significant_modules_long, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Trait) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">TotalGenes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(NumGenes))</span>
<span id="cb28-23"></span>
<span id="cb28-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Merge data</span></span>
<span id="cb28-25">plot_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_counts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(gene_counts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trait"</span>)</span>
<span id="cb28-27"></span>
<span id="cb28-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter to certain traits if desired</span></span>
<span id="cb28-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># traits &lt;- c("timepoint2", "timepoint3", "mean_Temp_mean", "mean_solar_rad_kwpm2_mean", "cumulative_rainfall_mm_mean")</span></span>
<span id="cb28-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot_data &lt;- plot_data[plot_data$Trait %in% traits,]</span></span>
<span id="cb28-31"></span>
<span id="cb28-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bubble plot</span></span>
<span id="cb28-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(plot_data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Trait, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> TotalGenes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> NumModules)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trans =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log10"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb28-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Significant Modules per Trait"</span>,</span>
<span id="cb28-40">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trait"</span>,</span>
<span id="cb28-41">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb28-42">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Genes"</span>,</span>
<span id="cb28-43">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Num Modules"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb28-45">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Hide y-axis labels</span></span>
<span id="cb28-46">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb28-47"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/bubble_signif_modules.png"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpi =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span></code></pre></div>
</div>
<p>Interaction network showing, for a variable of interest, all the correlated modules, their genes, and miRNA interactions</p>
<ol type="1">
<li>Which modules are in variable of interest WGCNA_pvals[WGCNA_pvals$trait &lt; 0.05,] %&gt;% rownames()</li>
<li>Which genes/miRNA are in each module <code>module_membership</code></li>
<li>which genes each miRNA interacts with <code>modules_cor_miRNA_mRNA_bind</code> ^includes Correlation between modules</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">trait <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span></span>
<span id="cb29-2"></span>
<span id="cb29-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract correlated modules</span></span>
<span id="cb29-4">sig_modules <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(WGCNA_pvals[WGCNA_pvals<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, ])</span>
<span id="cb29-5"></span>
<span id="cb29-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract genes and miRNA n each module</span></span>
<span id="cb29-7">module_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_membership[module_membership<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sig_modules, ]</span>
<span id="cb29-8"></span>
<span id="cb29-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract miRNA-mRNA interactions for these modules</span></span>
<span id="cb29-10">miRNA_interactions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> modules_cor_miRNA_mRNA_bind[</span>
<span id="cb29-11">  modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA_module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sig_modules <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb29-12">  modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mRNA_module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> sig_modules, </span>
<span id="cb29-13">]</span>
<span id="cb29-14"></span>
<span id="cb29-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create edge list for the network</span></span>
<span id="cb29-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># edges &lt;- rbind(</span></span>
<span id="cb29-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   data.frame(from = module_genes$gene, to = module_genes$module, type = "gene-module"),</span></span>
<span id="cb29-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   data.frame(from = miRNA_interactions$miRNA, to = miRNA_interactions$mRNA, type = "miRNA-mRNA"),</span></span>
<span id="cb29-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   data.frame(from = miRNA_interactions$miRNA_module, to = miRNA_interactions$mRNA_module, type = "module-module")</span></span>
<span id="cb29-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># )</span></span>
<span id="cb29-21"></span>
<span id="cb29-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Gene-to-Module edges (Genes and miRNAs assigned to modules)</span></span>
<span id="cb29-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># edges_genes &lt;- data.frame(</span></span>
<span id="cb29-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   from = module_membership$gene, </span></span>
<span id="cb29-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   to = module_membership$module, </span></span>
<span id="cb29-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   type = "gene-module",</span></span>
<span id="cb29-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   correlation = NA  # No correlation needed for membership edges</span></span>
<span id="cb29-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># )</span></span>
<span id="cb29-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb29-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # miRNA-Gene interaction edges (including correlation from module correlation)</span></span>
<span id="cb29-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># edges_miRNA_gene &lt;- data.frame(</span></span>
<span id="cb29-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   from = modules_cor_miRNA_mRNA_bind$miRNA, </span></span>
<span id="cb29-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   to = modules_cor_miRNA_mRNA_bind$gene, </span></span>
<span id="cb29-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   type = "miRNA-gene",</span></span>
<span id="cb29-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   correlation = modules_cor_miRNA_mRNA_bind$correlation  # Assign correlation value</span></span>
<span id="cb29-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># )</span></span>
<span id="cb29-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb29-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Combine all edges into a single dataframe</span></span>
<span id="cb29-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># edges &lt;- rbind(edges_genes, edges_miRNA_gene) %&gt;% distinct()</span></span>
<span id="cb29-40"></span>
<span id="cb29-41">edges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb29-42">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA, </span>
<span id="cb29-43">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene, </span>
<span id="cb29-44">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA-gene"</span>,</span>
<span id="cb29-45">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">correlation =</span> modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>correlation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Correlation between miRNA and gene parent modules</span></span>
<span id="cb29-46">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb29-47"></span>
<span id="cb29-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create node data frame with miRNAs and genes</span></span>
<span id="cb29-49">miRNA_nodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb29-50">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unique miRNAs</span></span>
<span id="cb29-51">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">module =</span> modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA_module[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA), modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>miRNA)],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Corresponding miRNA module</span></span>
<span id="cb29-52">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span></span>
<span id="cb29-53">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb29-54"></span>
<span id="cb29-55"></span>
<span id="cb29-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create gene-node dataframe with the filtered module_membership</span></span>
<span id="cb29-57">gene_nodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb29-58">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unique genes</span></span>
<span id="cb29-59">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">module =</span> modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mRNA_module[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene), modules_cor_miRNA_mRNA_bind<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene)],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Corresponding gene module</span></span>
<span id="cb29-60">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span></span>
<span id="cb29-61">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span>
<span id="cb29-62"></span>
<span id="cb29-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine both miRNA and gene nodes</span></span>
<span id="cb29-64">nodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(miRNA_nodes, gene_nodes)</span>
<span id="cb29-65"></span>
<span id="cb29-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb29-67">g <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">graph_from_data_frame</span>(edges, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">directed =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertices =</span> nodes)</span>
<span id="cb29-68"></span>
<span id="cb29-69"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span>(g, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-70">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nodes colored by their module (categorical)</span></span>
<span id="cb29-71">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> module), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-72">  </span>
<span id="cb29-73">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Edges colored by correlation (continuous)</span></span>
<span id="cb29-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_link</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> correlation), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-75">  </span>
<span id="cb29-76">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Discrete color scale for modules</span></span>
<span id="cb29-77">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rainbow</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(g)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>module)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-78">  </span>
<span id="cb29-79">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Continuous gradient color scale for correlation values</span></span>
<span id="cb29-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_edge_color_gradient2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mid =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midpoint =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-81">  </span>
<span id="cb29-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-83">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(edges, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/edges.csv"</span>)</span>
<span id="cb30-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(nodes, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/nodes.csv"</span>)</span></code></pre></div>
</div>
</section>
<section id="save-gene-sets" class="level1">
<h1>Save gene sets</h1>
<p>Weâ€™ll likely want to use function-specific gene sets in later analyses, so weâ€™ll save those here. Gene sets should be saved as</p>
<ol type="a">
<li>a df of the genes, the WGCNA module they fall in, and the annotated GO term(s), AND</li>
<li>raw count matrices, with samples in the columns and genes in the rows.</li>
</ol>
<p>Sets will be named for the filter applied (e.g.&nbsp;â€œrespirationâ€ for genes annotated with respiration-related GO terms). Note that, since these gene sets will be used with a functional focus, weâ€™ll exclude miRNAs.</p>
<p>Load raw gene counts</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span>
<span id="cb31-2">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each trait of interest:</span></span>
<span id="cb32-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (trait <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(significant_modules_per_trait)) {</span>
<span id="cb32-3">  </span>
<span id="cb32-4">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## a) a df of the genes, the WGCNA module they fall in, and the annotated GO term(s)</span></span>
<span id="cb32-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select modules that are significantly correlated with this trait</span></span>
<span id="cb32-6">  trait_sig_modules <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> significant_modules_per_trait[[trait]]</span>
<span id="cb32-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter the annotated list of genes to only keep those in selected modules, keep only genes (not miRNA)</span></span>
<span id="cb32-8">  trait_genes_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(module <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> trait_sig_modules <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FUN"</span>, gene))</span>
<span id="cb32-10">  </span>
<span id="cb32-11">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## b) raw count matrices, with samples in the columns and genes in the rows. </span></span>
<span id="cb32-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter the raw gene counts to keep only genes in selected modules</span></span>
<span id="cb32-13">  trait_gene_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(gene_id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> trait_genes_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene)</span>
<span id="cb32-15">  </span>
<span id="cb32-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set file names</span></span>
<span id="cb32-17">  file_name_genes_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/"</span>, trait, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_genes_FA.tab"</span>)</span>
<span id="cb32-18">  file_name_gene_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/"</span>, trait, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_gene_counts.tab"</span>)</span>
<span id="cb32-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save</span></span>
<span id="cb32-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(trait_genes_FA, file_name_genes_FA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(trait_gene_counts, file_name_gene_counts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-22">}</span></code></pre></div>
</div>
<p>We also want to be able to save genes associated with functions (GO terms) of interest.</p>
<p>For example, Steven identified a several GO terms related to ATP production a <a href="https://sr320.github.io/tumbling-oysters/posts/41-Apul-GO/">notebook post</a>: - Aerobic respiration (GO:0009060) - Oxidative phosphorylation (GO:0006119) - Canonical glycolysis (GO:0061621) - Tricarboxylic Acid Cycle (GO:0006099)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># List GO terms of interest (CHANGE as desired)</span></span>
<span id="cb33-2">GO_terms_interest <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO:0009060"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO:0006119"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO:0061621"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GO:0006099"</span>)</span>
<span id="cb33-3"></span>
<span id="cb33-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select genes that have been functionally annotated with at least on of the listed GO terms of interest</span></span>
<span id="cb33-5">GO_terms_genes_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> module_FA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(Gene.Ontology.IDs, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">any</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(GO_terms_interest, grepl, x))))</span>
<span id="cb33-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For these selected genes, get raw gene counts</span></span>
<span id="cb33-8">GO_terms_gene_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(gene_id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> GO_terms_genes_FA<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene)</span>
<span id="cb33-10"></span>
<span id="cb33-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set file name (CHANGE as desired)</span></span>
<span id="cb33-12">file_name_GO_FA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_production"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_GO_terms_genes_FA.tab"</span>)</span>
<span id="cb33-13">file_name_GO_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/21-Apul-annotate-miRNA-mRNA-WGCNA/filtered-gene-sets/"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATP_production"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_GO_terms_gene_counts.tab"</span>)</span>
<span id="cb33-14"></span>
<span id="cb33-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(GO_terms_genes_FA, file_name_GO_FA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb33-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(go_term_counts_df, file_name_GO_counts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_01_timeseries_FA_FE.html</guid>
  <pubDate>Tue, 01 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul phenotype and gene/miRNA machine learning â€“ Part 2</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_01_timeseries_ML_2.html</link>
  <description><![CDATA[ 




<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22-Apul-miRNA-mRNA-machine-learning.Rmd">Code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22-Apul-miRNA-mRNA-machine-learning.md">Rendered code</a></p>
<p>In <a href="../../../posts/projects/E5_coral/2025_03_31_timeseries_ML.html">Part 1</a> I ran the ML model on phenotype as a predictor of gene/miRNA expression.</p>
<p>This time I ran the ML model with miRNA expression as the predictor and gene expression as response to investigate miRNA-mRNA interactions. Note that, due to the high number of genes, I performed dimensionality reduction, essentially summarizing genes to PCs of coexpression</p>
<section id="results" class="level1">
<h1>Results</h1>
<p>A couple miRNA pop out as notably highly predictive of gene expression, but all of the top 20 miRNA are important</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/top-20-predictive-mirna-features.png" class="img-fluid">Many gene PCs are highly explained by miRNA expression, with 11 gene PCs of R<sup>2</sup> &gt;~0.75</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/model-performance-across-gene-expression-pcs-mirna.png" class="img-fluid">We can then look at which genes are included in highly predicted PCs. For example, in PC11, the most highly predicted PC, we see an R<sup>2</sup> of 0.996 and extremely strong model performance</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/predicted-v-actual-pc11.png" class="img-fluid">Here are the top 20 genes included in PC11:</p>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   Genes_PC [1]
##    gene       Genes_PC Loading
##    &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt;
##  1 FUN_029347 PC11      0.0196
##  2 FUN_001854 PC11     -0.0193
##  3 FUN_025457 PC11      0.0192
##  4 FUN_021609 PC11     -0.0190
##  5 FUN_041974 PC11      0.0190
##  6 FUN_008614 PC11      0.0190
##  7 FUN_001958 PC11      0.0189
##  8 FUN_033958 PC11      0.0189
##  9 FUN_000394 PC11     -0.0188
## 10 FUN_039508 PC11      0.0187
## 11 FUN_016324 PC11     -0.0187
## 12 FUN_001244 PC11     -0.0185
## 13 FUN_016966 PC11     -0.0185
## 14 FUN_004574 PC11      0.0183
## 15 FUN_011795 PC11     -0.0181
## 16 FUN_015171 PC11      0.0181
## 17 FUN_009743 PC11      0.0180
## 18 FUN_039139 PC11      0.0180
## 19 FUN_020597 PC11      0.0180
## 20 FUN_032877 PC11      0.0180</code></pre>
<p>We can also look at which miRNA most contributed to predicting expression for PC11</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/top-mirna-predictors-for-pc11.png" class="img-fluid">We see that, rather than a single miRNA being primarily responsible for predicting PC11 expression, many are involved with high importance, suggesting a complex interaction network</p>
<section id="code-copied-below-in-case-of-file-path-changes" class="level3">
<h3 class="anchored" data-anchor-id="code-copied-below-in-case-of-file-path-changes">Code copied below in case of file path changes:</h3>
<p>Iâ€™d like to see whether phenotype can predict gene and/or miRNA expression, will be testing this using the ML approach Ariana has been trialing (see her mRNA-WGBS ML post here: https://ahuffmyer.github.io/ASH_Putnam_Lab_Notebook/E5-timeseries-molecular-mRNA-WGBS-machine-learning-analysis-Part-1/)</p>
<p>Inputs:</p>
<ul>
<li><p>RNA counts matrix (raw): <code>../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv</code></p></li>
<li><p>sRNA/miRNA counts matrix (raw): <code>../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt</code></p></li>
<li><p>sample metadata: <code>../../M-multi-species/data/rna_metadata.csv</code></p></li>
<li><p>physiological data: https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/master_timeseries.csv</p></li>
</ul>
<p>Note that Iâ€™ll start by using phenotype (e.g.&nbsp;biomass, respiration) as the predictor, which is suitable for understanding <em>how external factors drive gene expression changes.</em></p>
<p>If, instead, we wanted to build some sort of predictive model, where <em>gene expression could be used to predict phenotype</em>, we could switch so that gene counts are used as the predictors.</p>
</section>
</section>
<section id="load-libraries" class="level1">
<h1>Load libraries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DESeq2)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(psych)</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidygraph)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WGCNA)</span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(edgeR)</span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reshape2)</span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggcorrplot)</span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(corrplot)</span>
<span id="cb2-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb2-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb2-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pheatmap)</span>
<span id="cb2-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span>
<span id="cb2-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb2-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(factoextra)</span>
<span id="cb2-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(vegan)</span>
<span id="cb2-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggfortify)</span></code></pre></div>
</div>
</section>
<section id="load-and-prep-data" class="level1">
<h1>Load and prep data</h1>
<p>Load in count matrices for RNAseq.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw gene counts data (will filter and variance stabilize)</span></span>
<span id="cb3-2">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span>
<span id="cb3-3">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format gene IDs as rownames (instead of a column)</span></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb3-7">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>gene_id)</span>
<span id="cb3-8"></span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load and format metadata</span></span>
<span id="cb3-11">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../M-multi-species/data/rna_metadata.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(AzentaSampleName, ColonyID, Timepoint) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACR"</span>, ColonyID))</span>
<span id="cb3-13">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb3-14"></span>
<span id="cb3-15">colonies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID)</span>
<span id="cb3-16"></span>
<span id="cb3-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load physiological data</span></span>
<span id="cb3-18">phys<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/master_timeseries.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(colony_id_corr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> colonies)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(colony_id_corr, species, timepoint, site, Host_AFDW.mg.cm2, Sym_AFDW.mg.cm2, Am, AQY, Rd, Ik, Ic, calc.umol.cm2.hr, cells.mgAFDW, prot_mg.mgafdw, Ratio_AFDW.mg.cm2, Total_Chl, Total_Chl_cell, cre.umol.mgafdw)</span>
<span id="cb3-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format timepoint</span></span>
<span id="cb3-21">phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP"</span>, phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint)</span>
<span id="cb3-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#add column with full sample info</span></span>
<span id="cb3-23">phys <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(phys, metadata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"colony_id_corr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ColonyID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Timepoint"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AzentaSampleName)</span>
<span id="cb3-25">  </span>
<span id="cb3-26"></span>
<span id="cb3-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#add site information into metadata </span></span>
<span id="cb3-28">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Site<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>site[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colony_id_corr)]</span>
<span id="cb3-29"></span>
<span id="cb3-30"></span>
<span id="cb3-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename gene column names to include full sample info (as in miRNA table)</span></span>
<span id="cb3-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb3-33"></span>
<span id="cb3-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw miRNA counts (will filter and variance stabilize)</span></span>
<span id="cb3-35">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<section id="counts-filtering" class="level2">
<h2 class="anchored" data-anchor-id="counts-filtering">Counts filtering</h2>
<p>Ensure there are no genes or miRNAs with 0 counts across all samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes)</span>
<span id="cb4-2"></span>
<span id="cb4-3">Apul_genes_filt<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-4">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-6">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_filt)</span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNAs</span></span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA)</span>
<span id="cb4-12"></span>
<span id="cb4-13">Apul_miRNA_filt<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-14">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-16">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb4-17"></span>
<span id="cb4-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_filt)</span></code></pre></div>
</div>
<p>Removing genes with only 0 counts reduced number from 44371 to 35869. Retained all 51 miRNAs.</p>
<p>Will not be performing pOverA filtering for now, since LM should presumabily incorporate sample representation</p>
</section>
<section id="physiology-filtering" class="level2">
<h2 class="anchored" data-anchor-id="physiology-filtering">Physiology filtering</h2>
<p>Run PCA on physiology data to see if there are phys outliers</p>
<p>Export data for PERMANOVA test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">test<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(phys)</span>
<span id="cb5-2">test<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>test[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(test), ]</span></code></pre></div>
</div>
<p>Build PERMANOVA model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">scaled_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fviz_eig</span>(scaled_test)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale data</span></span>
<span id="cb6-5">vegan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric)))</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PerMANOVA </span></span>
<span id="cb6-8">permanova<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">adonis2</span>(vegan <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>site, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'eu'</span>)</span>
<span id="cb6-9">permanova</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">pca1<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoplot</span>(scaled_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frame.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"site"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frame=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PC2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(colony_id_corr, timepoint)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>), </span>
<span id="cb7-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span id="cb7-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>), </span>
<span id="cb7-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>), </span>
<span id="cb7-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>));pca1</span></code></pre></div>
</div>
<p>Remove ACR-173, timepoint 3 sample from analysis. This is Azenta sample 1B2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_filt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B2_ACR-173_TP3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B2_ACR-173_TP3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B2_ACR-173_TP3"</span>)</span></code></pre></div>
</div>
<p>We also do not have phys data for colony 1B9 ACR-265 at TP4, so Iâ€™ll remove that here as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_filt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B9_ACR-265_TP4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B9_ACR-265_TP4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb9-6"></span>
<span id="cb9-7">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B9_ACR-265_TP4"</span>)</span></code></pre></div>
</div>
</section>
<section id="assign-metadata-and-arrange-order-of-columns" class="level2">
<h2 class="anchored" data-anchor-id="assign-metadata-and-arrange-order-of-columns">Assign metadata and arrange order of columns</h2>
<p>Order metadata the same as the column order in the gene matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)</span>
<span id="cb10-2">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(list)</span>
<span id="cb10-3"></span>
<span id="cb10-4">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample)</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the levels</span></span>
<span id="cb10-7">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span>list)</span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the data.frame</span></span>
<span id="cb10-9">metadata_ordered <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample),]</span>
<span id="cb10-10">metadata_ordered<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span>
<span id="cb10-11"></span>
<span id="cb10-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sure the miRNA colnames are also in the same order as the gene colnames</span></span>
<span id="cb10-13">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)]</span></code></pre></div>
</div>
<p>Metadata and gene count matrix are now ordered the same.</p>
</section>
<section id="conduct-variance-stabilized-transformation" class="level2">
<h2 class="anchored" data-anchor-id="conduct-variance-stabilized-transformation">Conduct variance stabilized transformation</h2>
<p>VST should be performed on our two input datasets (gene counts and miRNA counts) separately</p>
<section id="genes" class="level3">
<h3 class="anchored" data-anchor-id="genes">Genes:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb11-2">dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_genes_filt,</span>
<span id="cb11-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb11-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
</div>
<p>Check size factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">SF.dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_genes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
</div>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size</span></span>
<span id="cb13-2">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_genes)</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(vsd_genes, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.  </span></span></code></pre></div>
</div>
</section>
<section id="mirna" class="level3">
<h3 class="anchored" data-anchor-id="mirna">miRNA:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb14-2">dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_miRNA_filt,</span>
<span id="cb14-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb14-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
</div>
<p>Check size factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">SF.dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_miRNA) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
</div>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size. Using varianceStabilizingTransformation() instead of vst() because few input genes</span></span>
<span id="cb16-2">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA)</span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(vsd_miRNA, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.</span></span></code></pre></div>
</div>
</section>
</section>
<section id="combine-counts-data" class="level2">
<h2 class="anchored" data-anchor-id="combine-counts-data">Combine counts data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract variance stabilized counts as dataframes</span></span>
<span id="cb17-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># want samples in rows, genes/miRNAs in columns</span></span>
<span id="cb17-3">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_genes))</span>
<span id="cb17-4">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_miRNA))</span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Double check the row names (sample names) are in same order</span></span>
<span id="cb17-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_miRNA)</span>
<span id="cb17-8"></span>
<span id="cb17-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine vst gene counts and vst miRNA counts by rows (sample names)</span></span>
<span id="cb17-10">vsd_merged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(vsd_genes, vsd_miRNA)</span></code></pre></div>
</div>
</section>
</section>
<section id="feature-selection" class="level1">
<h1>Feature selection</h1>
<section id="genes-mirna" class="level2">
<h2 class="anchored" data-anchor-id="genes-mirna">Genes + miRNA</h2>
<p>We have a large number of genes, so weâ€™ll reduce dimensionality using PCA. Note that, since we only have a few phenotypes of interest, we donâ€™t need to reduce this dataset</p>
<p>First need to remove any genes/miRNA that are invariant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">vsd_merged_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_merged[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(vsd_merged, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_merged)</span>
<span id="cb18-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_merged_filt)</span>
<span id="cb18-5"></span>
<span id="cb18-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_merged[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(vsd_merged, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span></code></pre></div>
</div>
<p>Removed 74 invariant genes. I was worried we lost miRNA, but it looks like everything removed was a gene (prefix â€œFUNâ€)!</p>
<p>Reduce dimensionality (genes+miRNA)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene+miRNA expression matrix</span></span>
<span id="cb19-2">pca_merged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(vsd_merged_filt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb19-3"></span>
<span id="cb19-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb19-5">explained_var <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_merged)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb19-6">num_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb19-7"></span>
<span id="cb19-8">merged_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_merged<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb19-9"></span>
<span id="cb19-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(merged_pcs)</span></code></pre></div>
</div>
<p>We have 27 gene/miRNA expression PCs</p>
</section>
<section id="genes-only" class="level2">
<h2 class="anchored" data-anchor-id="genes-only">Genes only</h2>
<p>To investigate gene expression separately from miRNA expression, reduce dimensionality of genes alone.</p>
<p>Remove any genes that are invariant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">vsd_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(vsd_genes, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb20-2"></span>
<span id="cb20-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_genes)</span>
<span id="cb20-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_genes_filt)</span></code></pre></div>
</div>
<p>Removed 74 invariant genes.</p>
<p>Reduce dimensionality</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene expression matrix</span></span>
<span id="cb21-2">pca_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(vsd_genes_filt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb21-5">explained_var_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_genes)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb21-6">num_pcs_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb21-7"></span>
<span id="cb21-8">genes_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_genes])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb21-9"></span>
<span id="cb21-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(genes_pcs)</span></code></pre></div>
</div>
</section>
<section id="physiological-metrics" class="level2">
<h2 class="anchored" data-anchor-id="physiological-metrics">Physiological metrics</h2>
<p>Select physiological metrics of interest. For now weâ€™ll focus on biomass (â€œHost_AFDW.mg.cm2â€), protein (â€œprot_mg.mgafdwâ€), and respiration (â€œRdâ€). These are all metrics of host energy storage and expenditure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Assign sample IDs to row names</span></span>
<span id="cb22-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(phys) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select metrics</span></span>
<span id="cb22-5">phys_selection <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> phys <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Host_AFDW.mg.cm2, prot_mg.mgafdw, Rd)</span>
<span id="cb22-6"></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sure the phys rownames are in the same order as the gene/miRNA rownames</span></span>
<span id="cb22-8">phys_selection <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> phys_selection[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(merged_pcs),]</span></code></pre></div>
</div>
</section>
</section>
<section id="phenotype-to-predict-genemirna-expression" class="level1">
<h1>Phenotype to predict gene/miRNA expression</h1>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">The model</h2>
<p>Train elastic models to predict gene expression PCs from phys data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">train_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_pcs, predictor_pcs) {</span>
<span id="cb23-2">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb23-3">  </span>
<span id="cb23-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb23-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gene expression PC</span></span>
<span id="cb23-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Phys as predictors</span></span>
<span id="cb23-7">    </span>
<span id="cb23-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train elastic net model (alpha = 0.5 for mix of LASSO &amp; Ridge)</span></span>
<span id="cb23-9">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb23-10">    </span>
<span id="cb23-11">    models[[pc]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb23-12">  }</span>
<span id="cb23-13">  </span>
<span id="cb23-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(models)</span>
<span id="cb23-15">}</span>
<span id="cb23-16"></span>
<span id="cb23-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from phys data</span></span>
<span id="cb23-18">models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(merged_pcs, phys_selection)</span></code></pre></div>
</div>
<p>Extract feature importance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">get_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models) {</span>
<span id="cb24-2">  importance_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb24-3">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to regular matrix &amp; remove intercept</span></span>
<span id="cb24-4">    </span>
<span id="cb24-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb24-6">    coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs))</span>
<span id="cb24-7">    </span>
<span id="cb24-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df)</span>
<span id="cb24-9">  })</span>
<span id="cb24-10">  </span>
<span id="cb24-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature importance across all predicted gene PCs</span></span>
<span id="cb24-12">  importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(importance_list) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Importance)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb24-16">  </span>
<span id="cb24-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(importance_df)</span>
<span id="cb24-18">}</span>
<span id="cb24-19"></span>
<span id="cb24-20">feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models)</span>
<span id="cb24-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive phys features</span></span></code></pre></div>
</div>
<p>Evaluate performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">evaluate_model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models, response_pcs, predictor_pcs) {</span>
<span id="cb25-2">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb25-3">  </span>
<span id="cb25-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb25-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]</span>
<span id="cb25-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)</span>
<span id="cb25-7">    </span>
<span id="cb25-8">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models[[pc]]</span>
<span id="cb25-9">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb25-10">    </span>
<span id="cb25-11">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R-squared metric</span></span>
<span id="cb25-12">    results[results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> pc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb25-13">  }</span>
<span id="cb25-14">  </span>
<span id="cb25-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb25-16">}</span>
<span id="cb25-17"></span>
<span id="cb25-18">performance_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models, merged_pcs, phys_selection)</span>
<span id="cb25-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
</div>
</section>
<section id="results-1" class="level2">
<h2 class="anchored" data-anchor-id="results-1">Results</h2>
<p>Plot results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 predictive phys features</span></span>
<span id="cb26-2">top_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, MeanImportance)</span>
<span id="cb26-3"></span>
<span id="cb26-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb26-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb26-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top 20 Predictive Phys Features"</span>,</span>
<span id="cb26-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Physiological Metric"</span>,</span>
<span id="cb26-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb27-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb27-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
</div>
<p>Keep in mind that, while we ran the model with physiological predictors, weâ€™re really interested in the genes/miRNA associated with these predictors</p>
<p>View components associated with gene/miRNA PCs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene/miRNA PCA</span></span>
<span id="cb28-2">merged_loadings <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_merged<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb28-5">merged_loadings_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(merged_loadings) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_miRNA"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Merged_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb28-8"></span>
<span id="cb28-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top CpGs contributing most to each PC</span></span>
<span id="cb28-10">top_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_loadings_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Merged_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 10 CpGs per PC</span></span>
<span id="cb28-14"></span>
<span id="cb28-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes)</span></code></pre></div>
</div>
<p>View top 20 miRNA/genes associated with PC9 (the PC with the highest R^2)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Merged_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC9"</span>))</span></code></pre></div>
</div>
<p>Interesting, thereâ€™s an miRNA in there!</p>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb30-2">best_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb30-3"></span>
<span id="cb30-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb30-5">actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_pcs[[best_pc]]</span>
<span id="cb30-6">predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models[[best_pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(phys_selection), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb30-7"></span>
<span id="cb30-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb30-9">prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb30-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb30-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb30-12">)</span>
<span id="cb30-13"></span>
<span id="cb30-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb30-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc),</span>
<span id="cb30-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb30-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb30-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb30-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb30-25"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
</div>
</section>
</section>
<section id="mirna-expression-to-predict-gene-expression" class="level1">
<h1>miRNA expression to predict gene expression</h1>
<section id="the-model-1" class="level2">
<h2 class="anchored" data-anchor-id="the-model-1">The model</h2>
<p>Train elastic models to predict gene expression PCs from phys data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from phys data</span></span>
<span id="cb31-2">models2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(genes_pcs, vsd_miRNA)</span></code></pre></div>
</div>
<p>Extract feature importance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">feature_importance2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models2)</span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance2, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive phys features</span></span></code></pre></div>
</div>
<p>Evaluate performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">performance_results2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models2, genes_pcs, vsd_miRNA)</span>
<span id="cb33-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
</div>
</section>
<section id="results-2" class="level2">
<h2 class="anchored" data-anchor-id="results-2">Results</h2>
<p>Plot results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 predictive phys features</span></span>
<span id="cb34-2">top_features2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, MeanImportance)</span>
<span id="cb34-3"></span>
<span id="cb34-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb34-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb34-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top 20 Predictive miRNA Features"</span>,</span>
<span id="cb34-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression"</span>,</span>
<span id="cb34-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb35-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb35-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb35-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
</div>
<p>View components associated with gene PCs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene PCA</span></span>
<span id="cb36-2">genes_loadings <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb36-3"></span>
<span id="cb36-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb36-5">genes_loadings_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(genes_loadings) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Genes_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb36-8"></span>
<span id="cb36-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top genes contributing most to each PC</span></span>
<span id="cb36-10">top_genes2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> genes_loadings_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Genes_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 10 CpGs per PC</span></span>
<span id="cb36-14"></span>
<span id="cb36-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes2)</span></code></pre></div>
</div>
<p>View top 20 genes associated with PC11 (the most â€œpredictableâ€ PC, with the highest R^2)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Genes_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC11"</span>))</span></code></pre></div>
</div>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb38-2">best_pc2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb38-3"></span>
<span id="cb38-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb38-5">actual_values2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> genes_pcs[[best_pc2]]</span>
<span id="cb38-6">predicted_values2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models2[[best_pc2]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(vsd_miRNA), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb38-7"></span>
<span id="cb38-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb38-9">prediction_df2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb38-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values2,</span>
<span id="cb38-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values2</span>
<span id="cb38-12">)</span>
<span id="cb38-13"></span>
<span id="cb38-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb38-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc2),</span>
<span id="cb38-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb38-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values2), </span>
<span id="cb38-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb38-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb38-25"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
</div>
<p>We can also look att which miRNA(s) contributed most to predicting gene PCs of interest</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"> get_feature_importance_for_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb39-2">  coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove intercept</span></span>
<span id="cb39-3">  coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs)))</span>
<span id="cb39-4">  </span>
<span id="cb39-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Importance)))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by importance</span></span>
<span id="cb39-6">}</span>
<span id="cb39-7"></span>
<span id="cb39-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract feature importance for the most predictable PC</span></span>
<span id="cb39-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#best_pc2 &lt;- "PC11"</span></span>
<span id="cb39-10">best_pc_model2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models2[[best_pc2]]</span>
<span id="cb39-11">best_pc_importance2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance_for_pc</span>(best_pc_model2)</span>
<span id="cb39-12"></span>
<span id="cb39-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top most important miRNA for predicting this PC</span></span>
<span id="cb39-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(best_pc_importance2, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb39-15"></span>
<span id="cb39-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb39-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(best_pc_importance2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, Importance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Importance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb39-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top miRNA Predictors for"</span>, best_pc2),</span>
<span id="cb39-22">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"miRNA"</span>,</span>
<span id="cb39-23">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Importance Score"</span>)</span></code></pre></div>
</div>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_04_01_timeseries_ML_2.html</guid>
  <pubDate>Tue, 01 Apr 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul phenotype and gene/miRNA machine learning â€“ Part 1</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_03_31_timeseries_ML.html</link>
  <description><![CDATA[ 




<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22-Apul-miRNA-mRNA-machine-learning.Rmd">Code</a><br>
<a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/22-Apul-miRNA-mRNA-machine-learning.md">Rendered code</a></p>
<p>Iâ€™d like to see whether phenotype can predict gene and/or miRNA expression, will be testing this using the ML approach Ariana has been trialing (see her mRNA-WGBS ML post here: <a href="https://ahuffmyer.github.io/ASH_Putnam_Lab_Notebook/E5-timeseries-molecular-mRNA-WGBS-machine-learning-analysis-Part-1/" class="uri">https://ahuffmyer.github.io/ASH_Putnam_Lab_Notebook/E5-timeseries-molecular-mRNA-WGBS-machine-learning-analysis-Part-1/</a>)</p>
<section id="results" class="level1">
<h1>Results</h1>
<p>I filtered, variance stabilized, and combined the raw gene counts and miRNA counts. Then, due to the high number, I reduced this combined expression data to PCs of similar expression. For phenotype, I used host biomass, host protein, and respiration, all of which are indicators of host energy storage and expenditure. I ran the ML model using phenotypes as the predictor and expression PCs as the response.</p>
<p>Protein was most predictive of expression, with respiration also highly predictive. Interestingly, biomass did not contribute much!</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Top-20-Predictive-Phys-Features.png" class="img-fluid"></p>
<p>None of the gene PCs were well-predicted by phenotype, with the highest R<sup>2</sup> value sitting at 0.177 (~18% of variance in the PCs explained by phenotype).</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Model-Performance-Across-Gene-Expression-PCs.png" class="img-fluid">Also, most of the expression PCs (21/31) had NA R<sup>2</sup> values, which I believe is related to low variance in the phenotype metrics, particularly the protein phenotype</p>
<pre><code>&gt; apply(merged_pcs, 2, var)</code></pre>
<pre><code>      PC1       PC2       PC3       PC4       PC5       PC6       PC7       PC8       PC9      PC10      PC11      PC12      PC13      PC14      PC15      PC16      PC17 
5801.1357 2808.7631 2370.6702 1990.1140 1760.0861 1627.7522 1317.6404 1274.2452 1078.4045 1034.5725  976.4311  937.5277  891.5255  796.3490  779.2450  699.0609  676.0976 
     PC18      PC19      PC20      PC21      PC22      PC23      PC24      PC25      PC26      PC27      PC28      PC29      PC30      PC31 
 650.9711  620.9733  606.8573  591.2129  575.7182  550.6815  528.1735  519.2895  506.3591  474.2105  467.2894  454.2832  436.9429  423.9563 </code></pre>
<pre><code>&gt; apply(phys_selection, 2, var)</code></pre>
<pre><code>Host_AFDW.mg.cm2   prot_mg.mgafdw               Rd 
      0.33627626       0.01063323       0.03545622 </code></pre>
<p>We can look at model performance for specific expression PCs. For example, hereâ€™s PC9, which is the best-predicted PC (highest R<sup>2</sup> value)</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Predicted-v-Actual-PC9.png" class="img-fluid">We can also look at the top miRNA/genes associated with it. This was interesting because there is an miRNA that pops out (Cluster_4034)!</p>
<pre><code>## # A tibble: 20 Ã— 3
## # Groups:   Merged_PC [1]
##    gene_miRNA   Merged_PC Loading
##    &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt;
##  1 FUN_023262   PC9       -0.0227
##  2 FUN_016918   PC9        0.0198
##  3 FUN_007014   PC9       -0.0194
##  4 FUN_031632   PC9        0.0192
##  5 FUN_035523   PC9        0.0188
##  6 FUN_041996   PC9        0.0188
##  7 FUN_006731   PC9       -0.0186
##  8 FUN_022897   PC9       -0.0185
##  9 FUN_043835   PC9        0.0184
## 10 FUN_004465   PC9        0.0183
## 11 FUN_014188   PC9       -0.0183
## 12 FUN_034114   PC9       -0.0181
## 13 FUN_024741   PC9       -0.0181
## 14 FUN_006446   PC9       -0.0179
## 15 FUN_018629   PC9       -0.0178
## 16 FUN_013857   PC9       -0.0178
## 17 Cluster_4034 PC9        0.0176
## 18 FUN_039308   PC9       -0.0175
## 19 FUN_012117   PC9        0.0175
## 20 FUN_000459   PC9       -0.0174</code></pre>
<section id="code-copied-below-in-case-of-file-path-changes" class="level3">
<h3 class="anchored" data-anchor-id="code-copied-below-in-case-of-file-path-changes">Code copied below in case of file path changes:</h3>
<p>Inputs:</p>
<ul>
<li><p>RNA counts matrix (raw): <code>../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv</code></p></li>
<li><p>sRNA/miRNA counts matrix (raw): <code>../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt</code></p></li>
<li><p>sample metadata: <code>../../M-multi-species/data/rna_metadata.csv</code></p></li>
<li><p>physiological data: https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/master_timeseries.csv</p></li>
</ul>
<p>Note that Iâ€™ll start by using phenotype (e.g.&nbsp;biomass, respiration) as the predictor, which is suitable for understanding <em>how external factors drive gene expression changes.</em></p>
<p>If, instead, we wanted to build some sort of predictive model, where <em>gene expression could be used to predict phenotype</em>, we could switch so that gene counts are used as the predictors.</p>
</section>
</section>
<section id="load-libraries" class="level1">
<h1>Load libraries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DESeq2)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(psych)</span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidygraph)</span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggraph)</span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(WGCNA)</span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(edgeR)</span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reshape2)</span>
<span id="cb6-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggcorrplot)</span>
<span id="cb6-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(corrplot)</span>
<span id="cb6-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb6-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb6-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pheatmap)</span>
<span id="cb6-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span>
<span id="cb6-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb6-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(factoextra)</span>
<span id="cb6-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(vegan)</span>
<span id="cb6-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggfortify)</span></code></pre></div>
</div>
</section>
<section id="load-and-prep-data" class="level1">
<h1>Load and prep data</h1>
<p>Load in count matrices for RNAseq.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw gene counts data (will filter and variance stabilize)</span></span>
<span id="cb7-2">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv"</span>)</span>
<span id="cb7-3">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(Apul_genes)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format gene IDs as rownames (instead of a column)</span></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene_id</span>
<span id="cb7-7">Apul_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>gene_id)</span>
<span id="cb7-8"></span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load and format metadata</span></span>
<span id="cb7-11">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../M-multi-species/data/rna_metadata.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(AzentaSampleName, ColonyID, Timepoint) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACR"</span>, ColonyID))</span>
<span id="cb7-13">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Timepoint, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb7-14"></span>
<span id="cb7-15">colonies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID)</span>
<span id="cb7-16"></span>
<span id="cb7-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load physiological data</span></span>
<span id="cb7-18">phys<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/master_timeseries.csv"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(colony_id_corr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> colonies)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(colony_id_corr, species, timepoint, site, Host_AFDW.mg.cm2, Sym_AFDW.mg.cm2, Am, AQY, Rd, Ik, Ic, calc.umol.cm2.hr, cells.mgAFDW, prot_mg.mgafdw, Ratio_AFDW.mg.cm2, Total_Chl, Total_Chl_cell, cre.umol.mgafdw)</span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format timepoint</span></span>
<span id="cb7-21">phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TP"</span>, phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>timepoint)</span>
<span id="cb7-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#add column with full sample info</span></span>
<span id="cb7-23">phys <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(phys, metadata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"colony_id_corr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ColonyID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Timepoint"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AzentaSampleName)</span>
<span id="cb7-25">  </span>
<span id="cb7-26"></span>
<span id="cb7-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#add site information into metadata </span></span>
<span id="cb7-28">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Site<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>site[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ColonyID, phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>colony_id_corr)]</span>
<span id="cb7-29"></span>
<span id="cb7-30"></span>
<span id="cb7-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename gene column names to include full sample info (as in miRNA table)</span></span>
<span id="cb7-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes), metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AzentaSampleName)]</span>
<span id="cb7-33"></span>
<span id="cb7-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># raw miRNA counts (will filter and variance stabilize)</span></span>
<span id="cb7-35">Apul_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<section id="counts-filtering" class="level2">
<h2 class="anchored" data-anchor-id="counts-filtering">Counts filtering</h2>
<p>Ensure there are no genes or miRNAs with 0 counts across all samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes)</span>
<span id="cb8-2"></span>
<span id="cb8-3">Apul_genes_filt<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_genes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-4">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-6">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb8-7"></span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_genes_filt)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># miRNAs</span></span>
<span id="cb8-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA)</span>
<span id="cb8-12"></span>
<span id="cb8-13">Apul_miRNA_filt<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>Apul_miRNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-14">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(.[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-16">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>Total)</span>
<span id="cb8-17"></span>
<span id="cb8-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Apul_miRNA_filt)</span></code></pre></div>
</div>
<p>Removing genes with only 0 counts reduced number from 44371 to 35869. Retained all 51 miRNAs.</p>
<p>Will not be performing pOverA filtering for now, since LM should presumabily incorporate sample representation</p>
</section>
<section id="physiology-filtering" class="level2">
<h2 class="anchored" data-anchor-id="physiology-filtering">Physiology filtering</h2>
<p>Run PCA on physiology data to see if there are phys outliers</p>
<p>Export data for PERMANOVA test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">test<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(phys)</span>
<span id="cb9-2">test<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>test[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete.cases</span>(test), ]</span></code></pre></div>
</div>
<p>Build PERMANOVA model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">scaled_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fviz_eig</span>(scaled_test)</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale data</span></span>
<span id="cb10-5">vegan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric)))</span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PerMANOVA </span></span>
<span id="cb10-8">permanova<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">adonis2</span>(vegan <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>site, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'eu'</span>)</span>
<span id="cb10-9">permanova</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">pca1<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoplot</span>(scaled_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frame.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timepoint"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"site"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.colour=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frame=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loadings.label.vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> PC2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(colony_id_corr, timepoint)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-4">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>), </span>
<span id="cb11-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span id="cb11-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>), </span>
<span id="cb11-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>), </span>
<span id="cb11-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>));pca1</span></code></pre></div>
</div>
<p>Remove ACR-173, timepoint 3 sample from analysis. This is Azenta sample 1B2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_filt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B2_ACR-173_TP3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B2_ACR-173_TP3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb12-6"></span>
<span id="cb12-7">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B2_ACR-173_TP3"</span>)</span></code></pre></div>
</div>
<p>We also do not have phys data for colony 1B9 ACR-265 at TP4, so Iâ€™ll remove that here as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">Apul_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_genes_filt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B9_ACR-265_TP4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb13-3"></span>
<span id="cb13-4">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1B9_ACR-265_TP4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb13-6"></span>
<span id="cb13-7">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1B9_ACR-265_TP4"</span>)</span></code></pre></div>
</div>
</section>
<section id="assign-metadata-and-arrange-order-of-columns" class="level2">
<h2 class="anchored" data-anchor-id="assign-metadata-and-arrange-order-of-columns">Assign metadata and arrange order of columns</h2>
<p>Order metadata the same as the column order in the gene matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)</span>
<span id="cb14-2">list<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(list)</span>
<span id="cb14-3"></span>
<span id="cb14-4">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample)</span>
<span id="cb14-5"></span>
<span id="cb14-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the levels</span></span>
<span id="cb14-7">metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span>list)</span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-order the data.frame</span></span>
<span id="cb14-9">metadata_ordered <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metadata[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">order</span>(metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample),]</span>
<span id="cb14-10">metadata_ordered<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span>
<span id="cb14-11"></span>
<span id="cb14-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sure the miRNA colnames are also in the same order as the gene colnames</span></span>
<span id="cb14-13">Apul_miRNA_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Apul_miRNA_filt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(Apul_genes_filt)]</span></code></pre></div>
</div>
<p>Metadata and gene count matrix are now ordered the same.</p>
</section>
<section id="conduct-variance-stabilized-transformation" class="level2">
<h2 class="anchored" data-anchor-id="conduct-variance-stabilized-transformation">Conduct variance stabilized transformation</h2>
<p>VST should be performed on our two input datasets (gene counts and miRNA counts) separately</p>
<section id="genes" class="level3">
<h3 class="anchored" data-anchor-id="genes">Genes:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb15-2">dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_genes_filt,</span>
<span id="cb15-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb15-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
</div>
<p>Check size factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">SF.dds_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_genes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_genes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
</div>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vst</span>(dds_genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size</span></span>
<span id="cb17-2">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_genes)</span>
<span id="cb17-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(vsd_genes, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.  </span></span></code></pre></div>
</div>
</section>
<section id="mirna" class="level3">
<h3 class="anchored" data-anchor-id="mirna">miRNA:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Set DESeq2 design</span></span>
<span id="cb18-2">dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DESeqDataSetFromMatrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">countData =</span> Apul_miRNA_filt,</span>
<span id="cb18-3">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colData =</span> metadata_ordered,</span>
<span id="cb18-4">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">design =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Timepoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ColonyID)</span></code></pre></div>
</div>
<p>Check size factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">SF.dds_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">estimateSizeFactors</span>(dds_miRNA) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View size factors</span></span>
<span id="cb19-3"></span>
<span id="cb19-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeFactors</span>(SF.dds_miRNA)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
</div>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">varianceStabilizingTransformation</span>(dds_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blind=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size. Using varianceStabilizingTransformation() instead of vst() because few input genes</span></span>
<span id="cb20-2">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assay</span>(vsd_miRNA)</span>
<span id="cb20-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(vsd_miRNA, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#view transformed gene count data for the first three genes in the dataset.</span></span></code></pre></div>
</div>
</section>
</section>
<section id="combine-counts-data" class="level2">
<h2 class="anchored" data-anchor-id="combine-counts-data">Combine counts data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract variance stabilized counts as dataframes</span></span>
<span id="cb21-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># want samples in rows, genes/miRNAs in columns</span></span>
<span id="cb21-3">vsd_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_genes))</span>
<span id="cb21-4">vsd_miRNA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vsd_miRNA))</span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Double check the row names (sample names) are in same order</span></span>
<span id="cb21-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(vsd_miRNA)</span>
<span id="cb21-8"></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine vst gene counts and vst miRNA counts by rows (sample names)</span></span>
<span id="cb21-10">vsd_merged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(vsd_genes, vsd_miRNA)</span></code></pre></div>
</div>
</section>
</section>
<section id="feature-selection" class="level1">
<h1>Feature selection</h1>
<section id="genes-mirna" class="level2">
<h2 class="anchored" data-anchor-id="genes-mirna">Genes + miRNA</h2>
<p>We have a large number of genes, so weâ€™ll reduce dimensionality using PCA. Note that, since we only have a few phenotypes of interest, we donâ€™t need to reduce this dataset</p>
<p>First need to remove any genes/miRNA that are invariant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">vsd_merged_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_merged[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(vsd_merged, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb22-2"></span>
<span id="cb22-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_merged)</span>
<span id="cb22-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_merged_filt)</span>
<span id="cb22-5"></span>
<span id="cb22-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(vsd_merged[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(vsd_merged, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span></code></pre></div>
</div>
<p>Removed 74 invariant genes. I was worried we lost miRNA, but it looks like everything removed was a gene (prefix â€œFUNâ€)!</p>
<p>Reduce dimensionality (genes+miRNA)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene+miRNA expression matrix</span></span>
<span id="cb23-2">pca_merged <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(vsd_merged_filt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb23-3"></span>
<span id="cb23-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb23-5">explained_var <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_merged)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb23-6">num_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb23-7"></span>
<span id="cb23-8">merged_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_merged<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb23-9"></span>
<span id="cb23-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(merged_pcs)</span></code></pre></div>
</div>
<p>We have 27 gene/miRNA expression PCs</p>
</section>
<section id="genes-only" class="level2">
<h2 class="anchored" data-anchor-id="genes-only">Genes only</h2>
<p>To investigate gene expression separately from miRNA expression, reduce dimensionality of genes alone.</p>
<p>Remove any genes that are invariant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">vsd_genes_filt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vsd_genes[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(vsd_genes, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, var) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-2"></span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_genes)</span>
<span id="cb24-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(vsd_genes_filt)</span></code></pre></div>
</div>
<p>Removed 74 invariant genes.</p>
<p>Reduce dimensionality</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform PCA on gene expression matrix</span></span>
<span id="cb25-2">pca_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(vsd_genes_filt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale. =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top PCs that explain most variance (e.g., top 50 PCs)</span></span>
<span id="cb25-5">explained_var_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pca_genes)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>importance[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cumulative variance explained</span></span>
<span id="cb25-6">num_pcs_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(explained_var_genes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep PCs that explain 95% variance</span></span>
<span id="cb25-7"></span>
<span id="cb25-8">genes_pcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(pca_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_pcs_genes])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract selected PCs</span></span>
<span id="cb25-9"></span>
<span id="cb25-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(genes_pcs)</span></code></pre></div>
</div>
</section>
<section id="physiological-metrics" class="level2">
<h2 class="anchored" data-anchor-id="physiological-metrics">Physiological metrics</h2>
<p>Select physiological metrics of interest. For now weâ€™ll focus on biomass (â€œHost_AFDW.mg.cm2â€), protein (â€œprot_mg.mgafdwâ€), and respiration (â€œRdâ€). These are all metrics of host energy storage and expenditure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Assign sample IDs to row names</span></span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(phys) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> phys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sample</span>
<span id="cb26-3"></span>
<span id="cb26-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select metrics</span></span>
<span id="cb26-5">phys_selection <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> phys <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Host_AFDW.mg.cm2, prot_mg.mgafdw, Rd)</span>
<span id="cb26-6"></span>
<span id="cb26-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make sure the phys rownames are in the same order as the gene/miRNA rownames</span></span>
<span id="cb26-8">phys_selection <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> phys_selection[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(merged_pcs),]</span></code></pre></div>
</div>
</section>
</section>
<section id="phenotype-to-predict-genemirna-expression" class="level1">
<h1>Phenotype to predict gene/miRNA expression</h1>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">The model</h2>
<p>Train elastic models to predict gene expression PCs from phys data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">train_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(response_pcs, predictor_pcs) {</span>
<span id="cb27-2">  models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb27-3">  </span>
<span id="cb27-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb27-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gene expression PC</span></span>
<span id="cb27-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Phys as predictors</span></span>
<span id="cb27-7">    </span>
<span id="cb27-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train elastic net model (alpha = 0.5 for mix of LASSO &amp; Ridge)</span></span>
<span id="cb27-9">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb27-10">    </span>
<span id="cb27-11">    models[[pc]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model</span>
<span id="cb27-12">  }</span>
<span id="cb27-13">  </span>
<span id="cb27-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(models)</span>
<span id="cb27-15">}</span>
<span id="cb27-16"></span>
<span id="cb27-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train models predicting gene expression PCs from phys data</span></span>
<span id="cb27-18">models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train_models</span>(merged_pcs, phys_selection)</span></code></pre></div>
</div>
<p>Extract feature importance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">get_feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models) {</span>
<span id="cb28-2">  importance_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(models, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(model) {</span>
<span id="cb28-3">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, , drop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to regular matrix &amp; remove intercept</span></span>
<span id="cb28-4">    </span>
<span id="cb28-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb28-6">    coefs_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Feature =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(coefs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Importance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(coefs))</span>
<span id="cb28-7">    </span>
<span id="cb28-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(coefs_df)</span>
<span id="cb28-9">  })</span>
<span id="cb28-10">  </span>
<span id="cb28-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine feature importance across all predicted gene PCs</span></span>
<span id="cb28-12">  importance_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(importance_list) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Feature) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeanImportance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Importance)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(MeanImportance))</span>
<span id="cb28-16">  </span>
<span id="cb28-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(importance_df)</span>
<span id="cb28-18">}</span>
<span id="cb28-19"></span>
<span id="cb28-20">feature_importance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_importance</span>(models)</span>
<span id="cb28-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(feature_importance, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top predictive phys features</span></span></code></pre></div>
</div>
<p>Evaluate performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">evaluate_model_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(models, response_pcs, predictor_pcs) {</span>
<span id="cb29-2">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R2 =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb29-3">  </span>
<span id="cb29-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (pc <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(response_pcs)) {</span>
<span id="cb29-5">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> response_pcs[[pc]]</span>
<span id="cb29-6">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(predictor_pcs)</span>
<span id="cb29-7">    </span>
<span id="cb29-8">    model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> models[[pc]]</span>
<span id="cb29-9">    preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(model, X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb29-10">    </span>
<span id="cb29-11">    R2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(y, preds)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R-squared metric</span></span>
<span id="cb29-12">    results[results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> pc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> R2</span>
<span id="cb29-13">  }</span>
<span id="cb29-14">  </span>
<span id="cb29-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb29-16">}</span>
<span id="cb29-17"></span>
<span id="cb29-18">performance_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluate_model_performance</span>(models, merged_pcs, phys_selection)</span>
<span id="cb29-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)</span></code></pre></div>
</div>
</section>
<section id="results-1" class="level2">
<h2 class="anchored" data-anchor-id="results-1">Results</h2>
<p>Plot results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 20 predictive phys features</span></span>
<span id="cb30-2">top_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_importance <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, MeanImportance)</span>
<span id="cb30-3"></span>
<span id="cb30-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb30-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(top_features, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Feature, MeanImportance), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> MeanImportance)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip for readability</span></span>
<span id="cb30-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top 20 Predictive Phys Features"</span>,</span>
<span id="cb30-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Physiological Metric"</span>,</span>
<span id="cb30-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Importance"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(performance_results, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> PC, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model Performance Across Gene Expression PCs"</span>,</span>
<span id="cb31-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gene Expression PC"</span>,</span>
<span id="cb31-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² (Variance Explained)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate labels</span></span></code></pre></div>
</div>
<p>Keep in mind that, while we ran the model with physiological predictors, weâ€™re really interested in the genes/miRNA associated with these predictors</p>
<p>View components associated with gene/miRNA PCs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the PCA rotation (loadings) matrix from the original gene/miRNA PCA</span></span>
<span id="cb32-2">merged_loadings <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pca_merged<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Each column corresponds to a PC</span></span>
<span id="cb32-3"></span>
<span id="cb32-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame and reshape for plotting</span></span>
<span id="cb32-5">merged_loadings_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(merged_loadings) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_miRNA"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gene_miRNA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Merged_PC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading"</span>)</span>
<span id="cb32-8"></span>
<span id="cb32-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># View top CpGs contributing most to each PC</span></span>
<span id="cb32-10">top_genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_loadings_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Merged_PC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(Loading))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select top 10 CpGs per PC</span></span>
<span id="cb32-14"></span>
<span id="cb32-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes)</span></code></pre></div>
</div>
<p>View top 20 miRNA/genes associated with PC9 (the PC with the highest R^2)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(top_genes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Merged_PC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PC9"</span>))</span></code></pre></div>
</div>
<p>Interesting, thereâ€™s an miRNA in there!</p>
<p>View predicted vs actual gene expression values to evaluate model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose a gene expression PC to visualize (e.g., the most predictable one)</span></span>
<span id="cb34-2">best_pc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PC[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2)]</span>
<span id="cb34-3"></span>
<span id="cb34-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract actual and predicted values for that PC</span></span>
<span id="cb34-5">actual_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> merged_pcs[[best_pc]]</span>
<span id="cb34-6">predicted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(models[[best_pc]], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(phys_selection), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>)</span>
<span id="cb34-7"></span>
<span id="cb34-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data frame</span></span>
<span id="cb34-9">prediction_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb34-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Actual =</span> actual_values,</span>
<span id="cb34-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predicted =</span> predicted_values</span>
<span id="cb34-12">)</span>
<span id="cb34-13"></span>
<span id="cb34-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with regression line</span></span>
<span id="cb34-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(prediction_df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lambda.min)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted vs. Actual for"</span>, best_pc),</span>
<span id="cb34-20">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual Gene Expression PC"</span>,</span>
<span id="cb34-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Gene Expression PC"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(actual_values), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(predicted_values), </span>
<span id="cb34-23">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RÂ² ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(performance_results<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>R2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)), </span>
<span id="cb34-24">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb34-25"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
</div>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_03_31_timeseries_ML.html</guid>
  <pubDate>Mon, 31 Mar 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Timeseries molecular: A.pul WGCNA, mRNA and miRNA</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_03_11_timeseries_WGCNA.html</link>
  <description><![CDATA[ 




<p>Working with the <em>A. pulchra</em> timeseries gene expression (RNA + sRNA) data from E5 Coral project.</p>
<p><a href="https://github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA.md">Code</a></p>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>I ran a Weighted Gene Correlation Network Analysis (WGCNA) with both gene and miRNA expression to a) group similarly-expressed sets of genes and/or miRNAs into â€œmodulesâ€ of coexpression, and b) evaluate correlation of gene expression modules with different physiological and environmental variables.</p>
<p>Note that, unlike my original trials with WGCNA, I variance stabilized the gene counts and miRNA counts <em>separately</em> this time, after talking w Ariana about how to prep data appropriately. This didnâ€™t have a huge impact on overall trends (which were already driven by the genes, not miRNA), but it really impacted miRNA module placement. When I VSTâ€™d everything together almost all miRNA ended up placed in the same module, likely because all the miRNA have relatively low counts. After performing VST separately, WGCNA now places the miRNA across ~15 modules.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-31-1.png?raw=true" class="img-fluid"></p>
<p>WGCNA identified a total of 54 modules of coexpressed genes/miRNA, 19 of which contain miRNA. Roughly half of the miRNA are contained within a single module, one of the larger modules that likely represents housekeeping function. The remaining miRNA are spread out, generally the only miRNA in their modules.</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-34-1.png?raw=true" class="img-fluid"></p>
<p>In the above interaction network plot, each module is shown as a node. Modules that contain miRNA are black nodes, while gene-only modules are in grey. A line between two modules indicates the module eigengenes are significantly correlated, with a correlation coefficient magnitude of at least 0.7. Blue shading indicates positive correlation and red indicates negative correlation.</p>
<p>To look for potential miRNA-target mRNA interactions weâ€™re looking for negative correlations where at least one module contains miRNA. I count roughly 20 of these!</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/images/Module-trait-relationship-heatmap.jpg" class="img-fluid"></p>
<p>Ran correlation of modules with physiological and environmental variables, and some interesting stuff popped out! Interestingly, timepoints 2 and 3 have significantly correlated modules, but timepoints 1 and 4 donâ€™t. This suggests the influence of timepoint stems largely from the temperature conditions, since a) timepoints 2 and 3 have the most â€œextremeâ€ temperatures (in comparison to annual mean), and b) many of their correlated modules are also significantly correlated with temperature. Interestingly, timepoints 2 and 3 (March and September 2020) are actually extreme in opposite directions. March 2020 was the warmest timepoint and September was the coolest. If the two are correlated with very similar sets of gene modules, that suggests very similar expression pathways are used in response to both heat stress and cold stress in A.pulchra!</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-48-1.png?raw=true" class="img-fluid"></p>
<p>We can also plot out the eigengene expression of modules of interest across variables. Above are all the modules significantly correlated withe temperature, plotted across standardized temperature.</p>
</section>
<section id="update-03182025" class="level1">
<h1>Update 03/18/2025:</h1>
<p>After plotting eigengene expression for modules significantly correlated with timepoints 2 and 3 (there are no modules significantly correlated with timepoints 1 and 4), something else pops out. First, TP3 is significantly correlated with many more modules than TP2 (15 vs.&nbsp;6). Second, several of these overlap <em>and</em> show matching expression profiles. Modules 1, 2, and 19 are significantly correlated with both TP2 and TP3, indicating significant differential expression when comparing TP2 to all other seasons and when comparing TP3 to all other seasons. Additionally, Modules 1, 2, and 19 are upregulated, downregulated, and upregulated, respectively, for both TP2 and TP3. See plots below:</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-48-4.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-48-5.png?raw=true" class="img-fluid"></p>
<p>Iâ€™ve also plotted the eigengene expression of modules significantly correlated with our other two environmental variables, solar radiation and rainfall. Interestingly, Module 18 is the only significantly correlated module for both solar radiation and rainfall, but shows inverse patterns of eigengene expression for the two. Module 18 is also one of the modules significantly correlated with TP3. Notably, both solar radiation and rainfall hit â€œextremesâ€ at TP3 (TP3 represents both the maximum recorded solar radiation and minimum recorded rainfall of our 4 timepoints). See plots below:</p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-48-2.png?raw=true" class="img-fluid"></p>
<p><img src="https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/https:/github.com/urol-e5/timeseries_molecular/blob/main/D-Apul/code/12-Apul-miRNA-mRNA-WGCNA_files/figure-gfm/unnamed-chunk-48-3.png?raw=true" class="img-fluid"></p>
</section>
<section id="code" class="level1">
<h1>Code:</h1>
<p>Running Weighted Gene Correlation Network Analysis (WGCNA) to assess patterns of miRNA-mRNA coexpression in A.pulchra.</p>
</section>
<section id="install-and-load-packages" class="level1">
<h1>1 Install and load packages</h1>
<pre><code>library(tidyverse) library(ggplot2) library(WGCNA) library(magrittr) library(genefilter) library(DESeq2) library(ggfortify) library(RColorBrewer) library(pheatmap) library(factoextra) library(vegan) library(dendsort) library(ComplexHeatmap) library(psych) library(igraph) library(ggraph)</code></pre>
</section>
<section id="load-and-prep-data" class="level1">
<h1>2 Load and prep data</h1>
<p>Load in count matrices for RNAseq.</p>
<pre><code># raw gene counts data (will filter and variance stabilize) Apul_genes &lt;- read_csv("../output/02.20-D-Apul-RNAseq-alignment-HiSat2/apul-gene_count_matrix.csv") Apul_genes &lt;- as.data.frame(Apul_genes)  # format gene IDs as rownames (instead of a column) rownames(Apul_genes) &lt;- Apul_genes$gene_id Apul_genes &lt;- Apul_genes%&gt;%select(!gene_id)   # load and format metadata metadata &lt;- read_csv("../../M-multi-species/data/rna_metadata.csv")%&gt;%select(AzentaSampleName, ColonyID, Timepoint)%&gt;%   filter(grepl("ACR", ColonyID)) metadata$Sample &lt;- paste(metadata$AzentaSampleName, metadata$ColonyID, metadata$Timepoint, sep = "_")  colonies &lt;- unique(metadata$ColonyID)  # Load physiological data phys&lt;-read_csv("https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/master_timeseries.csv")%&gt;%filter(colony_id_corr %in% colonies)%&gt;%   select(colony_id_corr, species, timepoint, site, Host_AFDW.mg.cm2, Sym_AFDW.mg.cm2, Am, AQY, Rd, Ik, Ic, calc.umol.cm2.hr, cells.mgAFDW, prot_mg.mgafdw, Ratio_AFDW.mg.cm2, Total_Chl, Total_Chl_cell, cre.umol.mgafdw) # format timepoint phys$timepoint &lt;- gsub("timepoint", "TP", phys$timepoint) #add column with full sample info phys &lt;- merge(phys, metadata, by.x = c("colony_id_corr", "timepoint"), by.y = c("ColonyID", "Timepoint")) %&gt;%   select(-AzentaSampleName)     #add site information into metadata  metadata$Site&lt;-phys$site[match(metadata$ColonyID, phys$colony_id_corr)]   # Rename gene column names to include full sample info (as in miRNA table) colnames(Apul_genes) &lt;- metadata$Sample[match(colnames(Apul_genes), metadata$AzentaSampleName)]  # raw miRNA counts (will filter and variance stabilize) Apul_miRNA &lt;- read.table(file = "../output/03.10-D-Apul-sRNAseq-expression-DESeq2/Apul_miRNA_ShortStack_counts_formatted.txt", header = TRUE, sep = "\t", check.names = FALSE)</code></pre>
<p>Ensure there are no genes or miRNAs with 0 counts across all samples.</p>
<pre><code>nrow(Apul_genes)</code></pre>
<pre><code>[1] 44371 </code></pre>
<pre><code>Apul_genes&lt;-Apul_genes %&gt;%      mutate(Total = rowSums(.[, 1:40]))%&gt;%     filter(!Total==0)%&gt;%     dplyr::select(!Total)  nrow(Apul_genes)</code></pre>
<pre><code>[1] 35869 </code></pre>
<pre><code># miRNAs nrow(Apul_miRNA)</code></pre>
<pre><code>[1] 51 </code></pre>
<pre><code>Apul_miRNA&lt;-Apul_miRNA %&gt;%      mutate(Total = rowSums(.[, 1:40]))%&gt;%     filter(!Total==0)%&gt;%     dplyr::select(!Total)  nrow(Apul_miRNA)</code></pre>
<pre><code>[1] 51 </code></pre>
<p>Removing genes with only 0 counts reduced number from 44371 to 35869. Retained all 51 miRNAs.</p>
<section id="physiology-filtering" class="level2">
<h2 class="anchored" data-anchor-id="physiology-filtering">2.1 Physiology filtering</h2>
<p>Run PCA on physiology data to see if there are phys outliers</p>
<p>Export data for PERMANOVA test.</p>
<pre><code>test&lt;-as.data.frame(phys) test&lt;-test[complete.cases(test), ]</code></pre>
<p>Build PERMANOVA model.</p>
<pre><code>scaled_test &lt;-prcomp(test%&gt;%select(where(is.numeric)), scale=TRUE, center=TRUE) fviz_eig(scaled_test)</code></pre>
<pre><code># scale data vegan &lt;- scale(test%&gt;%select(where(is.numeric)))  # PerMANOVA  permanova&lt;-adonis2(vegan ~ timepoint*site, data = test, method='eu') permanova</code></pre>
<pre><code>Permutation test for adonis under reduced model Permutation: free Number of permutations: 999  adonis2(formula = vegan ~ timepoint * site, data = test, method = "eu")          Df SumOfSqs      R2      F Pr(&gt;F)     Model     7   208.16 0.43731 2.9976  0.001 *** Residual 27   267.84 0.56269                   Total    34   476.00 1.00000                   --- Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 </code></pre>
<pre><code>pca1&lt;-ggplot2::autoplot(scaled_test, data=test, frame.colour="timepoint", loadings=FALSE,  colour="timepoint", shape="site", loadings.label.colour="black", loadings.colour="black", loadings.label=FALSE, frame=FALSE, loadings.label.size=5, loadings.label.vjust=-1, size=5) +    geom_text(aes(x = PC1, y = PC2, label = paste(colony_id_corr, timepoint)), vjust = -0.5)+   theme_classic()+    theme(legend.text = element_text(size=18),           legend.position="right",         plot.background = element_blank(),         legend.title = element_text(size=18, face="bold"),          axis.text = element_text(size=18),          axis.title = element_text(size=18,  face="bold"));pca1</code></pre>
<p>Remove ACR-173, timepoint 3 sample from analysis. This is Azenta sample 1B2.</p>
<pre><code>Apul_genes &lt;- Apul_genes%&gt;%   select(!`1B2_ACR-173_TP3`)  Apul_miRNA &lt;- Apul_miRNA%&gt;%   select(!`1B2_ACR-173_TP3`)  metadata &lt;- metadata %&gt;%   filter(Sample != "1B2_ACR-173_TP3")</code></pre>
<p>We also do not have phys data for colony 1B9 ACR-265 at TP4, so I'll remove that here as well.</p>
<pre><code>Apul_genes &lt;- Apul_genes%&gt;%   select(!`1B9_ACR-265_TP4`)  Apul_miRNA &lt;- Apul_miRNA%&gt;%   select(!`1B9_ACR-265_TP4`)  metadata &lt;- metadata %&gt;%   filter(Sample != "1B9_ACR-265_TP4")</code></pre>
</section>
<section id="povera-filtering" class="level2">
<h2 class="anchored" data-anchor-id="povera-filtering">2.2 pOverA filtering</h2>
<p><em>pOverA</em>: Specifying the minimum count for a proportion of samples for each gene. Here, we are using a pOverA of 0.1. This is because we have 40 samples with a minimum of n=4 samples per timepoint per site. Therefore, we will accept genes that are present in 4/40 = 0.1 of the samples because we expect different expression by life stage. We are further setting the minimum count of genes and miRNA to 10, such that 12.5% of the samples must have a gene count of &gt;10 in order for the gene to remain in the data set.</p>
<p>Filter in the package "genefilter". Pre-filtering our dataset to reduce the memory size dataframe, increase the speed of the transformation and testing functions, and improve quality of statistical analysis by removing low-coverage counts. Removed counts could represent outliers in the data and removing these improves sensitivity of statistical tests.</p>
<p>genes:</p>
<pre><code>filt &lt;- filterfun(pOverA(0.1,10))  #create filter for the counts data gfilt &lt;- genefilter(Apul_genes, filt)  #identify genes to keep by count filter gkeep &lt;- Apul_genes[gfilt,]  #identify genes to keep by count filter gkeep &lt;- Apul_genes[gfilt,]  #identify gene lists gn.keep &lt;- rownames(gkeep)  #gene count data filtered in PoverA, P percent of the samples have counts over A Apul_genes_filt &lt;- as.data.frame(Apul_genes[which(rownames(Apul_genes) %in% gn.keep),])  #How many rows do we have before and after filtering? nrow(Apul_genes) #Before</code></pre>
<pre><code>[1] 35869 </code></pre>
<pre><code>nrow(Apul_genes_filt) #After</code></pre>
<pre><code>[1] 23459 </code></pre>
<p>We had 35869 genes before, and 23459 genes after filtering.</p>
<p>miRNA:</p>
<pre><code>mifilt &lt;- filterfun(pOverA(0.1,10))  #create filter for the counts data mifilt &lt;- genefilter(Apul_miRNA, mifilt)  #identify genes to keep by count filter mikeep &lt;- Apul_miRNA[mifilt,]  #identify genes to keep by count filter mikeep &lt;- Apul_miRNA[mifilt,]  #identify gene lists mi.keep &lt;- rownames(mikeep)  #gene count data filtered in PoverA, P percent of the samples have counts over A Apul_miRNA_filt &lt;- as.data.frame(Apul_miRNA[which(rownames(Apul_miRNA) %in% mi.keep),])  #How many rows do we have before and after filtering? nrow(Apul_miRNA) #Before</code></pre>
<pre><code>[1] 51 </code></pre>
<pre><code>nrow(Apul_miRNA_filt) #After</code></pre>
<pre><code>[1] 43 </code></pre>
<p>Of our original 51 miRNAs, 43 are retained.</p>
</section>
<section id="assign-metadata-and-arrange-order-of-columns" class="level2">
<h2 class="anchored" data-anchor-id="assign-metadata-and-arrange-order-of-columns">2.3 Assign metadata and arrange order of columns</h2>
<p>Order metadata the same as the column order in the gene matrix.</p>
<pre><code>list&lt;-colnames(Apul_genes_filt) list&lt;-as.factor(list)  metadata$Sample&lt;-as.factor(metadata$Sample)  # Re-order the levels metadata$Sample &lt;- factor(as.character(metadata$Sample), levels=list) # Re-order the data.frame metadata_ordered &lt;- metadata[order(metadata$Sample),] metadata_ordered$Sample</code></pre>
<pre><code> [1] 1A1_ACR-173_TP1  1A10_ACR-145_TP4 1A12_ACR-237_TP3 1A2_ACR-244_TP4   [5] 1A8_ACR-186_TP2  1A9_ACR-244_TP2  1B1_ACR-225_TP3  1B10_ACR-150_TP4  [9] 1B5_ACR-229_TP1  1C10_ACR-173_TP4 1C4_ACR-139_TP4  1D10_ACR-265_TP2 [13] 1D3_ACR-225_TP4  1D4_ACR-237_TP4  1D6_ACR-229_TP2  1D8_ACR-237_TP2  [17] 1D9_ACR-229_TP4  1E1_ACR-265_TP3  1E3_ACR-150_TP2  1E5_ACR-139_TP3  [21] 1E9_ACR-237_TP1  1F11_ACR-173_TP2 1F4_ACR-150_TP3  1F8_ACR-145_TP3  [25] 1G5_ACR-244_TP3  1H11_ACR-225_TP1 1H12_ACR-186_TP3 1H6_ACR-225_TP2  [29] 1H7_ACR-229_TP3  1H8_ACR-186_TP4  2B2_ACR-145_TP1  2B3_ACR-139_TP2  [33] 2C1_ACR-244_TP1  2C2_ACR-139_TP1  2D2_ACR-150_TP1  2E2_ACR-186_TP1  [37] 2F1_ACR-265_TP1  2G1_ACR-145_TP2  38 Levels: 1A1_ACR-173_TP1 1A10_ACR-145_TP4 ... 2G1_ACR-145_TP2 </code></pre>
<pre><code># Make sure the miRNA colnames are also in the same order as the gene colnames Apul_miRNA_filt &lt;- Apul_miRNA_filt[, colnames(Apul_genes_filt)]</code></pre>
<p>Metadata and gene count matrix are now ordered the same.</p>
</section>
<section id="conduct-variance-stabilized-transformation" class="level2">
<h2 class="anchored" data-anchor-id="conduct-variance-stabilized-transformation">2.4 Conduct variance stabilized transformation</h2>
<p>VST should be performed on our two input datasets (gene counts and miRNA counts) separately</p>
<section id="genes" class="level3">
<h3 class="anchored" data-anchor-id="genes">2.4.1 Genes:</h3>
<pre><code>#Set DESeq2 design dds_genes &lt;- DESeqDataSetFromMatrix(countData = Apul_genes_filt,                               colData = metadata_ordered,                               design = ~Timepoint+ColonyID)</code></pre>
<p>Check size factors.</p>
<pre><code>SF.dds_genes &lt;- estimateSizeFactors(dds_genes) #estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst print(sizeFactors(SF.dds_genes)) #View size factors</code></pre>
<pre><code> 1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3  1A2_ACR-244_TP4         0.7568024        0.7696399        1.4231584        0.6405377   1A8_ACR-186_TP2  1A9_ACR-244_TP2  1B1_ACR-225_TP3 1B10_ACR-150_TP4         1.1211635        1.2042163        1.4204528        1.4016702   1B5_ACR-229_TP1 1C10_ACR-173_TP4  1C4_ACR-139_TP4 1D10_ACR-265_TP2         1.6052144        0.7137948        1.1899017        1.1365146   1D3_ACR-225_TP4  1D4_ACR-237_TP4  1D6_ACR-229_TP2  1D8_ACR-237_TP2         0.6729713        1.0536139        1.0899755        0.8696891   1D9_ACR-229_TP4  1E1_ACR-265_TP3  1E3_ACR-150_TP2  1E5_ACR-139_TP3         0.6693270        1.0722064        1.1788615        1.2212146   1E9_ACR-237_TP1 1F11_ACR-173_TP2  1F4_ACR-150_TP3  1F8_ACR-145_TP3         1.0404211        1.0438667        1.4019603        0.7945692   1G5_ACR-244_TP3 1H11_ACR-225_TP1 1H12_ACR-186_TP3  1H6_ACR-225_TP2         1.6112366        1.4231584        0.6115323        0.7945692   1H7_ACR-229_TP3  1H8_ACR-186_TP4  2B2_ACR-145_TP1  2B3_ACR-139_TP2         1.3289756        1.2189223        1.1023879        1.4414683   2C1_ACR-244_TP1  2C2_ACR-139_TP1  2D2_ACR-150_TP1  2E2_ACR-186_TP1         0.6642454        1.1948320        0.7798443        0.6226576   2F1_ACR-265_TP1  2G1_ACR-145_TP2         0.9539809        0.8200694  </code></pre>
<pre><code>all(sizeFactors(SF.dds_genes)) &lt; 4</code></pre>
<pre><code>[1] TRUE </code></pre>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<pre><code>vsd_genes &lt;- vst(dds_genes, blind=FALSE) #apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size head(assay(vsd_genes), 3) #view transformed gene count data for the first three genes in the dataset.  </code></pre>
<pre><code>           1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3 1A2_ACR-244_TP4 FUN_002326        6.660702         6.601151         6.296062        6.022911 FUN_002303        7.454351         7.019662         6.664320        6.169453 FUN_002305        7.454351         7.036585         6.800146        6.102559            1A8_ACR-186_TP2 1A9_ACR-244_TP2 1B1_ACR-225_TP3 1B10_ACR-150_TP4 FUN_002326        5.936082        5.926631        6.318421         6.254378 FUN_002303        5.996527        6.034064        6.665234         6.541184 FUN_002305        6.092074        6.077224        6.801173         6.736355            1B5_ACR-229_TP1 1C10_ACR-173_TP4 1C4_ACR-139_TP4 1D10_ACR-265_TP2 FUN_002326        5.825783         6.607816        5.928189         6.232170 FUN_002303        5.942425         7.032182        6.277071         6.617129 FUN_002305        5.891826         6.976191        6.277071         6.834957            1D3_ACR-225_TP4 1D4_ACR-237_TP4 1D6_ACR-229_TP2 1D8_ACR-237_TP2 FUN_002326        6.474013        6.576064        5.859845        6.439541 FUN_002303        6.718366        6.946757        5.939907        6.842014 FUN_002305        6.818777        7.072513        6.001201        7.109262            1D9_ACR-229_TP4 1E1_ACR-265_TP3 1E3_ACR-150_TP2 1E5_ACR-139_TP3 FUN_002326        5.913234        6.142834        5.929410        5.982758 FUN_002303        5.666063        6.527629        6.120940        6.212425 FUN_002305        5.913234        6.696940        6.190595        6.321001            1E9_ACR-237_TP1 1F11_ACR-173_TP2 1F4_ACR-150_TP3 1F8_ACR-145_TP3 FUN_002326        6.473872         6.187513        6.254318        6.341284 FUN_002303        6.855660         6.538906        6.772955        6.685573 FUN_002305        6.870372         6.580167        6.927720        6.731014            1G5_ACR-244_TP3 1H11_ACR-225_TP1 1H12_ACR-186_TP3 1H6_ACR-225_TP2 FUN_002326        5.891405         6.296062         6.031232        6.341284 FUN_002303        6.167920         6.664320         6.112711        6.685573 FUN_002305        6.279189         6.800146         6.181130        6.731014            1H7_ACR-229_TP3 1H8_ACR-186_TP4 2B2_ACR-145_TP1 2B3_ACR-139_TP2 FUN_002326        5.841581        5.925058        6.300492        5.957649 FUN_002303        5.841581        6.148991        6.648931        6.077732 FUN_002305        5.914130        6.181995        6.666283        6.140886            2C1_ACR-244_TP1 2C2_ACR-139_TP1 2D2_ACR-150_TP1 2E2_ACR-186_TP1 FUN_002326        6.016517        5.986221        6.784206        6.027972 FUN_002303        6.094757        6.247838        7.044774        6.027972 FUN_002305        6.094757        6.275828        7.028204        6.108734            2F1_ACR-265_TP1 2G1_ACR-145_TP2 FUN_002326        6.555466        6.163523 FUN_002303        6.889927        6.670217 FUN_002305        6.889927        6.715029 </code></pre>
<section id="pca" class="level4">
<h4 class="anchored" data-anchor-id="pca">2.4.1.1 PCA</h4>
<p>Keep in mind this is of both the genes and miRNAs. since there are vastly more genes than miRNAs, the PCA will be dictated by genes. for miRNas alone, see <code>03.10</code>.</p>
<pre><code>plotPCA(vsd_genes, intgroup = c("ColonyID"))</code></pre>
<pre><code>plotPCA(vsd_genes, intgroup = c("Timepoint"))</code></pre>
</section>
<section id="sample-clustering" class="level4">
<h4 class="anchored" data-anchor-id="sample-clustering">2.4.1.2 Sample clustering</h4>
<pre><code>sampleDists_genes &lt;- dist(t(assay(vsd_genes))) #calculate distance matrix sampleDistMatrix_genes &lt;- as.matrix(sampleDists_genes) #distance matrix rownames(sampleDistMatrix_genes) &lt;- colnames(vsd_genes) #assign row names colnames(sampleDistMatrix_genes) &lt;- NULL #assign col names colors &lt;- colorRampPalette( rev(brewer.pal(9, "Blues")) )(255) #assign colors  pht_genes &lt;- pheatmap(sampleDistMatrix_genes, #plot matrix          clustering_distance_rows=sampleDists_genes, #cluster rows          clustering_distance_cols=sampleDists_genes, #cluster columns          col=colors) #set colors  print(pht_genes)</code></pre>
</section>
</section>
<section id="mirna" class="level3">
<h3 class="anchored" data-anchor-id="mirna">2.4.2 miRNA</h3>
<pre><code>#Set DESeq2 design dds_miRNA &lt;- DESeqDataSetFromMatrix(countData = Apul_miRNA_filt,                               colData = metadata_ordered,                               design = ~Timepoint+ColonyID)</code></pre>
<p>Check size factors.</p>
<pre><code>SF.dds_miRNA &lt;- estimateSizeFactors(dds_miRNA) #estimate size factors to determine if we can use vst  to transform our data. Size factors should be less than 4 for us to use vst print(sizeFactors(SF.dds_miRNA)) #View size factors</code></pre>
<pre><code> 1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3  1A2_ACR-244_TP4         1.4375773        0.4873497        1.1278371        1.3906883   1A8_ACR-186_TP2  1A9_ACR-244_TP2  1B1_ACR-225_TP3 1B10_ACR-150_TP4         1.4576506        3.6175606        0.6314484        0.5933158   1B5_ACR-229_TP1 1C10_ACR-173_TP4  1C4_ACR-139_TP4 1D10_ACR-265_TP2         3.4568168        0.3494818        0.2635332        1.6883200   1D3_ACR-225_TP4  1D4_ACR-237_TP4  1D6_ACR-229_TP2  1D8_ACR-237_TP2         3.3510894        1.6862052        3.0187618        1.6095839   1D9_ACR-229_TP4  1E1_ACR-265_TP3  1E3_ACR-150_TP2  1E5_ACR-139_TP3         1.6452632        0.4710913        2.5273448        0.1018135   1E9_ACR-237_TP1 1F11_ACR-173_TP2  1F4_ACR-150_TP3  1F8_ACR-145_TP3         0.8833733        1.4438548        1.9140909        0.3982620   1G5_ACR-244_TP3 1H11_ACR-225_TP1 1H12_ACR-186_TP3  1H6_ACR-225_TP2         2.2537502        0.8044495        0.4593767        1.8545938   1H7_ACR-229_TP3  1H8_ACR-186_TP4  2B2_ACR-145_TP1  2B3_ACR-139_TP2         1.0932705        0.8296064        0.8877596        1.8683207   2C1_ACR-244_TP1  2C2_ACR-139_TP1  2D2_ACR-150_TP1  2E2_ACR-186_TP1         1.1967504        1.3986634        0.5117454        0.3091478   2F1_ACR-265_TP1  2G1_ACR-145_TP2         0.2926522        1.8710888  </code></pre>
<pre><code>all(sizeFactors(SF.dds_miRNA)) &lt; 4</code></pre>
<pre><code>[1] TRUE </code></pre>
<p>All size factors are less than 4, so we can use VST transformation.</p>
<pre><code>vsd_miRNA &lt;- varianceStabilizingTransformation(dds_miRNA, blind=FALSE) #apply a variance stabilizing transformation to minimize effects of small counts and normalize with respect to library size. Using varianceStabilizingTransformation() instead of vst() because few input genes head(assay(vsd_miRNA), 3) #view transformed gene count data for the first three genes in the dataset.  </code></pre>
<pre><code>             1A1_ACR-173_TP1 1A10_ACR-145_TP4 1A12_ACR-237_TP3 1A2_ACR-244_TP4 Cluster_1819        6.478249         6.557331         5.595735        6.196669 Cluster_1832       10.332441         9.422019         8.660731        9.451348 Cluster_1833        5.492142         5.650442         5.997705        5.263138              1A8_ACR-186_TP2 1A9_ACR-244_TP2 1B1_ACR-225_TP3 1B10_ACR-150_TP4 Cluster_1819        6.241157        6.812541        5.566107         5.341800 Cluster_1832        9.762292        9.276238        9.872929         8.600338 Cluster_1833        4.193715        3.266091        5.918124         4.687096              1B5_ACR-229_TP1 1C10_ACR-173_TP4 1C4_ACR-139_TP4 1D10_ACR-265_TP2 Cluster_1819        6.267787         6.117117        5.794925         6.226234 Cluster_1832       10.028421         9.433650        9.679103         8.588882 Cluster_1833        5.898084         4.582708        6.070238         3.266091              1D3_ACR-225_TP4 1D4_ACR-237_TP4 1D6_ACR-229_TP2 1D8_ACR-237_TP2 Cluster_1819        5.185576        5.368613        6.370127        6.091856 Cluster_1832        9.787300        9.226621        9.904788        8.713369 Cluster_1833        5.374313        6.204218        4.675660        5.725310              1D9_ACR-229_TP4 1E1_ACR-265_TP3 1E3_ACR-150_TP2 1E5_ACR-139_TP3 Cluster_1819        5.851833        5.857390        6.463126        5.183387 Cluster_1832        9.423066        9.183896        9.086751        8.848700 Cluster_1833        4.485634        5.961931        3.266091        3.266091              1E9_ACR-237_TP1 1F11_ACR-173_TP2 1F4_ACR-150_TP3 1F8_ACR-145_TP3 Cluster_1819        5.260586         6.304098        5.539388        6.243558 Cluster_1832        8.430433        10.072455        8.695247        9.120002 Cluster_1833        5.260586         5.047177        4.401214        5.091836              1G5_ACR-244_TP3 1H11_ACR-225_TP1 1H12_ACR-186_TP3 1H6_ACR-225_TP2 Cluster_1819        5.903188         5.294944         6.492645        5.406006 Cluster_1832       10.274857         9.602521         9.928946        9.881625 Cluster_1833        3.266091         5.388645         5.354900        5.218993              1H7_ACR-229_TP3 1H8_ACR-186_TP4 2B2_ACR-145_TP1 2B3_ACR-139_TP2 Cluster_1819        5.989093        5.677605        6.075343        5.752765 Cluster_1832        9.561175       10.065363        8.130532        9.915856 Cluster_1833        4.683765        6.098376        3.266091        4.655510              2C1_ACR-244_TP1 2C2_ACR-139_TP1 2D2_ACR-150_TP1 2E2_ACR-186_TP1 Cluster_1819        6.032448        5.734740        5.923774        6.583587 Cluster_1832        9.404192        9.672986        8.230369        9.454567 Cluster_1833        5.955020        5.072513        4.526078        3.266091              2F1_ACR-265_TP1 2G1_ACR-145_TP2 Cluster_1819        6.182672        5.659509 Cluster_1832        9.236968        9.156409 Cluster_1833        3.266091        4.937878 </code></pre>
<section id="pca-1" class="level4">
<h4 class="anchored" data-anchor-id="pca-1">2.4.2.1 PCA</h4>
<p>Keep in mind this is of both the genes and miRNAs. since there are vastly more genes than miRNAs, the PCA will be dictated by genes. for miRNas alone, see <code>03.10</code>.</p>
<pre><code>plotPCA(vsd_miRNA, intgroup = c("ColonyID"))</code></pre>
<pre><code>plotPCA(vsd_miRNA, intgroup = c("Timepoint"))</code></pre>
</section>
<section id="sample-clustering-1" class="level4">
<h4 class="anchored" data-anchor-id="sample-clustering-1">2.4.2.2 Sample clustering</h4>
<pre><code>sampleDists_miRNA &lt;- dist(t(assay(vsd_miRNA))) #calculate distance matrix sampleDistMatrix_miRNA &lt;- as.matrix(sampleDists_miRNA) #distance matrix rownames(sampleDistMatrix_miRNA) &lt;- colnames(vsd_miRNA) #assign row names colnames(sampleDistMatrix_miRNA) &lt;- NULL #assign col names colors &lt;- colorRampPalette( rev(brewer.pal(9, "Blues")) )(255) #assign colors  pht_miRNA &lt;- pheatmap(sampleDistMatrix_miRNA, #plot matrix          clustering_distance_rows=sampleDists_miRNA, #cluster rows          clustering_distance_cols=sampleDists_miRNA, #cluster columns          col=colors) #set colors  print(pht_miRNA)</code></pre>
</section>
</section>
</section>
<section id="combine-counts-data" class="level2">
<h2 class="anchored" data-anchor-id="combine-counts-data">2.5 Combine counts data</h2>
<pre><code># Extract variance stabilized counts as dataframes datExpr_genes &lt;- as.data.frame(t(assay(vsd_genes))) datExpr_miRNA &lt;- as.data.frame(t(assay(vsd_miRNA)))  # Double check the row names (sample names) are in same order rownames(datExpr_genes) == rownames(datExpr_miRNA)</code></pre>
<pre><code> [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE [16] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE [31] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE </code></pre>
<pre><code># Combine vst gene counts and vst miRNA counts by rows (sample names) datExpr &lt;- cbind(datExpr_genes, datExpr_miRNA)</code></pre>
</section>
</section>
<section id="outlier-checks" class="level1">
<h1>3 Outlier checks</h1>
<p>Look for outliers by examining tree of samples</p>
<pre><code>sampleTree = hclust(dist(datExpr), method = "average"); plot(sampleTree, main = "Sample clustering to detect outliers: genes", sub="", xlab="", cex.lab = 1.5, cex.axis = 1.5, cex.main = 2)</code></pre>
<p>Soft threshold selection. The soft thresholding power (Î²) is the number to which the co-expression similarity is raised to calculate adjacency. The function pickSoftThreshold performs a network topology analysis. The user chooses a set of candidate powers, however the default parameters are suitable values.</p>
<pre><code>allowWGCNAThreads()</code></pre>
<pre><code>Allowing multi-threading with up to 48 threads. </code></pre>
<pre><code># # Choose a set of soft-thresholding powers powers &lt;- c(seq(from = 1, to=19, by=2), c(21:30)) #Create a string of numbers from 1 through 10, and even numbers from 10 through 20 #  # # Call the network topology analysis function sft &lt;- pickSoftThreshold(datExpr, powerVector = powers, verbose = 5)</code></pre>
<pre><code>pickSoftThreshold: will use block size 1903.  pickSoftThreshold: calculating connectivity for given powers...    ..working on genes 1 through 1903 of 23502    ..working on genes 1904 through 3806 of 23502    ..working on genes 3807 through 5709 of 23502    ..working on genes 5710 through 7612 of 23502    ..working on genes 7613 through 9515 of 23502    ..working on genes 9516 through 11418 of 23502    ..working on genes 11419 through 13321 of 23502    ..working on genes 13322 through 15224 of 23502    ..working on genes 15225 through 17127 of 23502    ..working on genes 17128 through 19030 of 23502    ..working on genes 19031 through 20933 of 23502    ..working on genes 20934 through 22836 of 23502    ..working on genes 22837 through 23502 of 23502    Power SFT.R.sq slope truncated.R.sq mean.k. median.k. max.k. 1      1   0.0168  0.36          0.769 5420.00  5.13e+03   9220 2      3   0.8790 -1.48          0.979  865.00  6.27e+02   3320 3      5   0.9670 -1.59          0.994  256.00  1.30e+02   1760 4      7   0.9780 -1.53          0.996  103.00  3.65e+01   1110 5      9   0.9810 -1.48          0.996   50.80  1.22e+01    775 6     11   0.9840 -1.43          0.995   28.40  4.66e+00    581 7     13   0.9830 -1.40          0.993   17.50  1.95e+00    455 8     15   0.9840 -1.37          0.991   11.50  8.88e-01    370 9     17   0.9840 -1.34          0.990    8.04  4.26e-01    308 10    19   0.9890 -1.32          0.993    5.85  2.13e-01    263 11    21   0.9920 -1.30          0.995    4.41  1.12e-01    228 12    22   0.9890 -1.30          0.991    3.87  8.14e-02    213 13    23   0.9880 -1.29          0.989    3.42  5.97e-02    200 14    24   0.9830 -1.29          0.985    3.04  4.39e-02    189 15    25   0.9750 -1.29          0.977    2.71  3.26e-02    178 16    26   0.9760 -1.28          0.978    2.44  2.44e-02    169 17    27   0.9780 -1.27          0.979    2.20  1.83e-02    160 18    28   0.9770 -1.26          0.979    1.99  1.39e-02    152 19    29   0.9740 -1.27          0.978    1.81  1.05e-02    145 20    30   0.9700 -1.26          0.974    1.66  8.01e-03    138 </code></pre>
<p>Plot the results.</p>
<pre><code>sizeGrWindow(9, 5) par(mfrow = c(1,2)); cex1 = 0.9; # # # Scale-free topology fit index as a function of the soft-thresholding power plot(sft$fitIndices[,1], -sign(sft$fitIndices[,3])*sft$fitIndices[,2],       xlab="Soft Threshold (power)",ylab="Scale Free Topology Model Fit,signed R^2",type="n",      main = paste("Scale independence"));  text(sft$fitIndices[,1], -sign(sft$fitIndices[,3])*sft$fitIndices[,2],      labels=powers,cex=cex1,col="red"); # # # this line corresponds to using an R^2 cut-off  abline(h=0.9,col="red") # # # Mean connectivity as a function of the soft-thresholding power  plot(sft$fitIndices[,1], sft$fitIndices[,5],      xlab="Soft Threshold (power)",ylab="Mean Connectivity", type="n",      main = paste("Mean connectivity"))  text(sft$fitIndices[,1], sft$fitIndices[,5], labels=powers, cex=cex1,col="red")</code></pre>
<p>I used a scale-free topology fit index <strong>R^2 of 0.9</strong>. The lowest recommended R^2 by Langfelder and Horvath is 0.8. I chose 0.9 because we want to use the smallest soft thresholding power that maximizes with model fit. It appears that our <strong>soft thresholding power is 5</strong> because it is the lowest power above the R^2=0.9 threshold that maximizes with model fit. I will use a <strong>signed network</strong>.</p>
</section>
<section id="wgcna" class="level1">
<h1>4 WGCNA</h1>
<p>Now we're ready to run WGCNA!</p>
<pre><code>picked_power = 5 temp_cor &lt;- cor        cor &lt;- WGCNA::cor         # Force it to use WGCNA cor function (fix a namespace conflict issue) netwk_Apul &lt;- blockwiseModules(datExpr,                # &lt;= input here                            # == Adjacency Function ==                           power = picked_power,                # &lt;= power here                           networkType = "signed",                            # == Tree and Block Options ==                           deepSplit = 2,                           pamRespectsDendro = F,                           # detectCutHeight = 0.75,                           minModuleSize = 30,                           maxBlockSize = 5000,                            # == Module Adjustments ==                           reassignThreshold = 1e-6,                           mergeCutHeight = 0.15,                            # == TOM == Archive the run results in TOM file (saves time)                           saveTOMs = F,                           saveTOMFileBase = "ER",                            # == Output Options                           numericLabels = T,                           verbose = 3)</code></pre>
<pre><code> Calculating module eigengenes block-wise from all genes    Flagging genes and samples with too many missing values...     ..step 1  ....pre-clustering genes to determine blocks..    Projective K-means:    ..k-means clustering..    ..merging smaller clusters... Block sizes: gBlocks    1    2    3    4    5  4996 4903 4664 4478 4461   ..Working on block 1 .     TOM calculation: adjacency..     ..will use 48 parallel threads.      Fraction of slow calculations: 0.000000     ..connectivity..     ..matrix multiplication (system BLAS)..     ..normalization..     ..done.  ....clustering..  ....detecting modules..  ....calculating module eigengenes..  ....checking kME in modules..      ..removing 24 genes from module 1 because their KME is too low.      ..removing 16 genes from module 2 because their KME is too low.  ..Working on block 2 .     TOM calculation: adjacency..     ..will use 48 parallel threads.      Fraction of slow calculations: 0.000000     ..connectivity..     ..matrix multiplication (system BLAS)..     ..normalization..     ..done.  ....clustering..  ....detecting modules..  ....calculating module eigengenes..  ....checking kME in modules..      ..removing 245 genes from module 1 because their KME is too low.      ..removing 126 genes from module 2 because their KME is too low.      ..removing 14 genes from module 3 because their KME is too low.      ..removing 9 genes from module 4 because their KME is too low.      ..removing 3 genes from module 5 because their KME is too low.      ..removing 21 genes from module 8 because their KME is too low.      ..removing 12 genes from module 9 because their KME is too low.      ..removing 9 genes from module 10 because their KME is too low.      ..removing 12 genes from module 11 because their KME is too low.      ..removing 2 genes from module 12 because their KME is too low.      ..removing 3 genes from module 14 because their KME is too low.      ..removing 1 genes from module 16 because their KME is too low.      ..removing 1 genes from module 17 because their KME is too low.      ..removing 1 genes from module 18 because their KME is too low.  ..Working on block 3 .     TOM calculation: adjacency..     ..will use 48 parallel threads.      Fraction of slow calculations: 0.000000     ..connectivity..     ..matrix multiplication (system BLAS)..     ..normalization..     ..done.  ....clustering..  ....detecting modules..  ....calculating module eigengenes..  ....checking kME in modules..      ..removing 200 genes from module 1 because their KME is too low.      ..removing 174 genes from module 2 because their KME is too low.      ..removing 95 genes from module 3 because their KME is too low.      ..removing 31 genes from module 4 because their KME is too low.      ..removing 2 genes from module 5 because their KME is too low.      ..removing 36 genes from module 7 because their KME is too low.      ..removing 7 genes from module 8 because their KME is too low.      ..removing 4 genes from module 11 because their KME is too low.      ..removing 13 genes from module 12 because their KME is too low.      ..removing 3 genes from module 15 because their KME is too low.  ..Working on block 4 .     TOM calculation: adjacency..     ..will use 48 parallel threads.      Fraction of slow calculations: 0.000000     ..connectivity..     ..matrix multiplication (system BLAS)..     ..normalization..     ..done.  ....clustering..  ....detecting modules..  ....calculating module eigengenes..  ....checking kME in modules..      ..removing 152 genes from module 1 because their KME is too low.      ..removing 106 genes from module 2 because their KME is too low.      ..removing 81 genes from module 3 because their KME is too low.      ..removing 82 genes from module 4 because their KME is too low.      ..removing 9 genes from module 5 because their KME is too low.      ..removing 5 genes from module 6 because their KME is too low.  ..Working on block 5 .     TOM calculation: adjacency..     ..will use 48 parallel threads.      Fraction of slow calculations: 0.000000     ..connectivity..     ..matrix multiplication (system BLAS)..     ..normalization..     ..done.  ....clustering..  ....detecting modules..  ....calculating module eigengenes..  ....checking kME in modules..      ..removing 297 genes from module 1 because their KME is too low.      ..removing 60 genes from module 2 because their KME is too low.      ..removing 38 genes from module 3 because their KME is too low.      ..removing 31 genes from module 4 because their KME is too low.   ..reassigning 40 genes from module 1 to modules with higher KME.   ..reassigning 27 genes from module 2 to modules with higher KME.   ..reassigning 3 genes from module 3 to modules with higher KME.   ..reassigning 2 genes from module 4 to modules with higher KME.   ..reassigning 4 genes from module 5 to modules with higher KME.   ..reassigning 3 genes from module 7 to modules with higher KME.   ..reassigning 1 genes from module 10 to modules with higher KME.   ..reassigning 1 genes from module 13 to modules with higher KME.   ..reassigning 1 genes from module 14 to modules with higher KME.   ..reassigning 7 genes from module 23 to modules with higher KME.   ..reassigning 1 genes from module 24 to modules with higher KME.   ..reassigning 2 genes from module 25 to modules with higher KME.   ..reassigning 1 genes from module 28 to modules with higher KME.   ..reassigning 1 genes from module 29 to modules with higher KME.   ..reassigning 1 genes from module 30 to modules with higher KME.   ..reassigning 1 genes from module 31 to modules with higher KME.   ..reassigning 1 genes from module 36 to modules with higher KME.   ..reassigning 5 genes from module 43 to modules with higher KME.   ..reassigning 11 genes from module 44 to modules with higher KME.   ..reassigning 1 genes from module 45 to modules with higher KME.   ..reassigning 2 genes from module 46 to modules with higher KME.   ..reassigning 1 genes from module 48 to modules with higher KME.   ..reassigning 11 genes from module 50 to modules with higher KME.   ..reassigning 8 genes from module 51 to modules with higher KME.   ..reassigning 1 genes from module 53 to modules with higher KME.  ..merging modules that are too close..      mergeCloseModules: Merging modules whose distance is less than 0.15        Calculating new MEs... </code></pre>
<pre><code>cor &lt;- temp_cor     # Return cor function to original namespace</code></pre>
<p>Take a look at dendrogram.</p>
<pre><code># Convert labels to colors for plotting mergedColors = labels2colors(netwk_Apul$colors) labels = table(netwk_Apul$colors) labels</code></pre>
<pre><code>   0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15  1925 2949 1946 1754 1087  963  939  927  909  879  824  749  700  657  577  402    16   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   374  346  316  304  261  247  233  217  210  208  199  176  168  163  162  155    32   33   34   35   36   37   38   39   40   41   42   43   44   45   46   47   142  138  130  111   92   84   84   82   69   63   62   62   56   56   48   47    48   49   50   51   52   53    46   46   44   41   40   33  </code></pre>
<pre><code># Plot the dendrogram and the module colors underneath  plotDendroAndColors(   netwk_Apul$dendrograms[[1]],   mergedColors[netwk_Apul$blockGenes[[1]]],   "Module colors",   dendroLabels = FALSE,   hang = 0.03,   addGuide = TRUE,   guideHang = 0.05 )</code></pre>
<p>Show module number before and after merging.</p>
<pre><code>length(table(netwk_Apul$unmergedColors))</code></pre>
<pre><code>[1] 56 </code></pre>
<pre><code>length(table(netwk_Apul$colors))</code></pre>
<pre><code>[1] 54 </code></pre>
<p>There are 56 modules before merging to 85% similarity and 54 after.</p>
<pre><code>MEs&lt;-netwk_Apul$MEs moduleLabels&lt;-netwk_Apul$colors moduleColors &lt;- labels2colors(netwk_Apul$colors)</code></pre>
<pre><code># Get Module Eigengenes per cluster # MEs0_Apul &lt;- moduleEigengenes(datExpr, mergedColors)$eigengenes mME_Apul &lt;- moduleEigengenes(datExpr, mergedColors)$eigengenes  # Add treatment names # MEs0_Apul$sample = row.names(MEs0_Apul) mME_Apul$sample = row.names(mME_Apul)  # Join metadata to add timepoint to mME_Apul mME_Apul &lt;- mME_Apul %&gt;%   left_join(metadata, by = c("sample" = "Sample"))  # Order samples by timepoint timepoint_order &lt;- c("TP1", "TP2", "TP3", "TP4") # Specify the desired order of timepoints mME_Apul &lt;- mME_Apul %&gt;%   mutate(sample = factor(sample, levels = metadata$Sample[order(match(metadata$Timepoint, timepoint_order))]))  # Plot heatmap mME_Apul %&gt;%    pivot_longer(cols = -c(sample, Timepoint), # Ensure only eigengenes are reshaped                names_to = "module",                values_to = "value") %&gt;%   ggplot(., aes(x = sample, y = name, fill = value)) +   geom_tile() +   theme_bw() +   scale_fill_gradient2(     low = "blue",     high = "red",     mid = "white",     midpoint = 0,     limit = c(-1,1)   ) +   theme(axis.text.x = element_text(angle = 90)) +   labs(title = "Module-trait Relationships", y = "Modules", fill = "corr")</code></pre>
</section>
<section id="characterize-genemirna-composition-of-modules" class="level1">
<h1>5 Characterize gene/miRNA composition of modules</h1>
<pre><code># Grab gene names and corresponding module colors module_info &lt;- data.frame(   gene = colnames(datExpr),   module = moduleLabels ) #Add ME to all the names module_info$module &lt;- paste0("ME", module_info$module)  head(module_info)</code></pre>
<pre><code>                 gene module FUN_002326 FUN_002326   ME20 FUN_002303 FUN_002303   ME20 FUN_002305 FUN_002305   ME20 FUN_002309 FUN_002309   ME20 FUN_002311 FUN_002311   ME20 FUN_002314 FUN_002314   ME20 </code></pre>
<pre><code># Function to calculate the proportion of mRNAs (genes with "FUN" in ID) calculate_mRNA_proportion &lt;- function(genes) {   total_genes &lt;- length(genes)   mRNA_count &lt;- sum(grepl("FUN", genes))      # Proportion of mRNAs   proportion_mRNA &lt;- mRNA_count / total_genes   return(proportion_mRNA) }  # Since there are so few miRNA, it may be more appropriate to calculate # of miRNA contained in a given module calculate_miRNA_num &lt;- function(genes) {   total_genes &lt;- length(genes)   miRNA_count &lt;- sum(grepl("Cluster", genes))   return(miRNA_count) }  # Apply the functions to each module module_mRNA_proportion &lt;- tapply(module_info$gene,                                   module_info$module,                                   calculate_mRNA_proportion)  module_miRNA_count &lt;- tapply(module_info$gene,                              module_info$module,                              calculate_miRNA_num)  # View the proportions  length(module_miRNA_count[module_miRNA_count &gt; 0])</code></pre>
<pre><code>[1] 19 </code></pre>
<pre><code>module_miRNA_count</code></pre>
<pre><code> ME0  ME1 ME10 ME11 ME12 ME13 ME14 ME15 ME16 ME17 ME18 ME19  ME2 ME20 ME21 ME22    18    2    2    0    1    0    3    0    0    0    0    1    0    1    0    0  ME23 ME24 ME25 ME26 ME27 ME28 ME29  ME3 ME30 ME31 ME32 ME33 ME34 ME35 ME36 ME37     1    0    1    0    0    1    1    1    2    3    0    0    0    1    0    0  ME38 ME39  ME4 ME40 ME41 ME42 ME43 ME44 ME45 ME46 ME47 ME48 ME49  ME5 ME50 ME51     0    0    0    1    0    0    0    0    0    0    0    0    0    1    0    0  ME52 ME53  ME6  ME7  ME8  ME9     0    0    1    1    0    0  </code></pre>
<p>19 of the 54 modules contain miRNA.</p>
<p>Module 0 contains almost half of the miRNA that were retained post-filtering (18/43). Keep in mind that the smaller the module number, the more genes it contains, so ME0 is one of the largest modules of coexpressed genes, and likely represents housekeeping function. It's thus not surprising that many miRNAs also grouped there!</p>
<p>The remaining 25 miRNA were quite spread out, most were the only miRNA in their module, with a handful of modules containing 2-3 coexpressed miRNA.</p>
<p>Plot</p>
<pre><code># Make df of module sizes module_sizes_df&lt;-as.data.frame(labels) colnames(module_sizes_df) &lt;- c("module", "size") module_sizes_df$module&lt;-paste0("ME", module_sizes_df$module)  # df of num. miRNA in each module module_miRNA_count_df &lt;- as.data.frame(module_miRNA_count) module_miRNA_count_df$module &lt;- rownames(module_miRNA_count_df)  # Combine and add column for num of genes in each module module_composition &lt;- left_join(module_sizes_df, module_miRNA_count_df, by="module") module_composition$module_gene_count &lt;- module_composition$size - module_composition$module_miRNA_count  # order by module size module_composition &lt;- module_composition %&gt;%   arrange(desc(size)) %&gt;%   mutate(module = factor(module, levels = module))  # Convert to long format for stacking module_composition_long &lt;- module_composition %&gt;%   pivot_longer(cols = c(module_gene_count, module_miRNA_count),                 names_to = "type",                 values_to = "count") %&gt;%   mutate(type = factor(type, levels = c("module_gene_count", "module_miRNA_count")))  # Order for stacking module_composition$type &lt;- ""  # Plot ggplot(module_composition_long, aes(x = module, y = count, fill = type)) +   geom_bar(stat = "identity") +   geom_text(data = module_composition, aes(x = module, y = size + 60,                                       label = module_miRNA_count), size = 3) +  # Label miRNA count   scale_fill_manual(values = c("module_gene_count" = "steelblue", "module_miRNA_count" = "orange"),                     labels = c("Genes", "miRNAs")) +   labs(x = "Module", y = "Total Module Size", title = "Stacked Barplot of Genes and miRNAs") +   theme_minimal() +   theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.title = element_blank())</code></pre>
<p>Larger modules seem to be more likely to contain miRNA, which makes sense intuitively. However, the low number of total miRNA in comparison to the number of genes present means that miRNA don't make up an appreciable proportion of any module.</p>
</section>
<section id="correlate-modules-to-each-other" class="level1">
<h1>6 Correlate modules to each other</h1>
<p>miRNAs are expected to either facilitate mRNA degradation or repress mRNA translation, both of which would result in a negative miRNA-mRNA relationship (more of an miRNA means less of its target mRNA(s)). WGCNA modules only group genes with similar expression patterns, so these inverse relationships would not be present within a single module. Instead, we need to find modules that are inversely related (have a strong, negative correlation).</p>
<p>Compute correlations between modules</p>
<ul>
<li>which correlation coefficient to use? I think WGCNA is based off of Pearson's correlation coefficientâ€¦</li>
</ul>
<pre><code>btwn_module_cor &lt;- corr.test(MEs, method = "pearson", adjust = "BH")  # Extract correlation values and p-values btwn_module_cor_matrix &lt;- btwn_module_cor$r  # Correlation coefficients btwn_module_p_matrix &lt;- btwn_module_cor$p  # Adjusted p-values</code></pre>
<p>Construct network</p>
<pre><code># Set correlation and significance thresholds cor_threshold &lt;- 0.7  # Adjust based on desired stringency p_threshold &lt;- 0.05  # Convert correlation matrix into an edge list significant_edges &lt;- which(abs(btwn_module_cor_matrix) &gt; cor_threshold &amp; btwn_module_p_matrix &lt; p_threshold, arr.ind = TRUE)  edge_list &lt;- data.frame(   module_A = rownames(btwn_module_cor_matrix)[significant_edges[,1]],   module_B = colnames(btwn_module_cor_matrix)[significant_edges[,2]],   correlation = btwn_module_cor_matrix[significant_edges] )  # Construct network graph network &lt;- graph_from_data_frame(edge_list, directed = FALSE)  # module_mRNA_proportion&lt;-as.data.frame(module_mRNA_proportion) #  # V(apul_network)$prop_mrna &lt;- module_mRNA_proportion$module_mRNA_proportion[match(V(apul_network)$name, rownames(module_mRNA_proportion))]  # Add miRNA presence/absence to the network nodes V(network)$has_miRNA &lt;- ifelse(   module_miRNA_count_df$module %in% V(network)$name &amp; module_miRNA_count_df$module_miRNA_count &gt; 0,    "Yes", "No" )</code></pre>
<p>Plot</p>
<pre><code>plot1&lt;-ggraph(network, layout = "fr") +  # Force-directed layout   geom_edge_link(aes(edge_color = correlation), width = 2, show.legend = TRUE) +   #geom_edge_link(aes(edge_alpha = correlation), show.legend = TRUE, width=2) +   #geom_node_point(aes(colour=prop_mrna), size = 5) +   #scale_colour_gradient(name="Prop. mRNA", low = "purple", high = "cyan3")+   geom_node_point(aes(color = has_miRNA), size = 3) +  # Color nodes based on miRNA presence   scale_edge_color_gradient2(low = "red", mid = "yellow", high = "blue", midpoint = 0, name = "Correlation") +     scale_color_manual(values = c("Yes" = "black", "No" = "grey"), name = "miRNA Present") +   geom_node_text(aes(label = name), repel = TRUE, size = 4) +   theme_void() +   labs(title = "A. pulchra mRNA-CpG Network");plot1</code></pre>
<p>Cool! In the above interaction network plot, each module is shown as a node. Modules that contain miRNA are black nodes, while gene-only modules are in grey. A line between two modules indicates the module eigengenes are significantly correlated, with a correlation coefficient magnitude of at least 0.7. Blue shading indicates positive correlation and red indicates negative correlation.</p>
<p>To look for potential miRNA-target mRNA interactions we're looking for negative correlations where at least one module contains miRNA. I count roughly 20 of these!</p>
</section>
<section id="correlate-to-traits" class="level1">
<h1>7 Correlate to traits</h1>
<p>Ensure we've removed sample from expression data that is not present in physiological data. 1B9</p>
<pre><code>phys&lt;-phys%&gt;%   filter(!Sample=="1B2_ACR-173_TP3")%&gt;%   filter(!Sample=="1B9_ACR-265_TP4")  setdiff(metadata_ordered$Sample, phys$Sample)</code></pre>
<pre><code>character(0) </code></pre>
<pre><code>#all have 38 observations </code></pre>
<p>Create a physiological/factor dataset with sample in rows and phys data in columns (row name = Azenta sample name)</p>
<pre><code># phys$AzentaSampleName&lt;-metadata_ordered$AzentaSampleName[match(phys$Sample, metadata_ordered$Sample)]  traits&lt;-phys%&gt;%   select(Sample, timepoint, site, Host_AFDW.mg.cm2, Sym_AFDW.mg.cm2, Am, Rd, Ik, Ic, AQY, cells.mgAFDW, Total_Chl, Ratio_AFDW.mg.cm2, Total_Chl_cell)  #time point #site traits&lt;-traits%&gt;%   mutate(site=gsub("Mahana", "1", site)) %&gt;%   mutate(site=gsub("Manava", "2", site))%&gt;%   mutate(timepoint=gsub("TP", "", timepoint))  traits$timepoint&lt;-as.numeric(traits$timepoint) traits$site&lt;-as.numeric(traits$site)  traits&lt;-as.data.frame(traits) rownames(traits)&lt;-traits$Sample  datTraits&lt;-traits%&gt;%select(!Sample)  #datTraits&lt;-datTraits%&gt;%select(!Timepoint)</code></pre>
<p>Add in temperature and light information for each time point from physiology manuscript. Note these have already been standardized for use in WGCNA.</p>
<pre><code>env&lt;-read_csv("https://github.com/urol-e5/timeseries/raw/refs/heads/master/time_series_analysis/Output/environment_characteristics_RDA.csv") %&gt;%   select(mean_Temp_mean, mean_solar_rad_kwpm2_mean, cumulative_rainfall_mm_mean, timepoint) %&gt;%   mutate(timepoint=if_else(timepoint=="timepoint1", "1",                            if_else(timepoint=="timepoint2", "2",                                    if_else(timepoint=="timepoint3", "3", "4")))) %&gt;%   mutate(timepoint=as.numeric(timepoint))  #merge into datTraits  datTraits&lt;-left_join(datTraits, env) rownames(datTraits)&lt;-traits$Sample  str(datTraits)</code></pre>
<pre><code>'data.frame':   38 obs. of  16 variables:  $ timepoint                  : num  1 2 3 4 1 2 3 4 1 2 ...  $ site                       : num  2 2 2 2 2 2 2 2 2 2 ...  $ Host_AFDW.mg.cm2           : num  1.759 1.212 0.664 1.133 1.101 ...  $ Sym_AFDW.mg.cm2            : num  0.795 0.545 0.493 0.538 0.312 ...  $ Am                         : num  1.042 0.75 0.53 0.448 0.709 ...  $ Rd                         : num  0.411 0.313 0.344 0.14 0.206 ...  $ Ik                         : num  464 417 330 411 286 ...  $ Ic                         : num  199.1 191.4 281 135 86.9 ...  $ AQY                        : num  0.00225 0.0018 0.00161 0.00109 0.00248 ...  $ cells.mgAFDW               : num  357005 432917 398214 190625 622222 ...  $ Total_Chl                  : num  3.03 1.391 2.295 0.683 2.729 ...  $ Ratio_AFDW.mg.cm2          : num  0.311 0.31 0.426 0.322 0.221 ...  $ Total_Chl_cell             : num  8.49e-06 3.21e-06 5.76e-06 3.58e-06 4.39e-06 ...  $ mean_Temp_mean             : num  -0.217 1.431 -0.898 -0.316 -0.217 ...  $ mean_solar_rad_kwpm2_mean  : num  -0.14 0.36 1.08 -1.3 -0.14 ...  $ cumulative_rainfall_mm_mean: num  0.665 -0.517 -1.142 0.993 0.665 ... </code></pre>
<p>Finally, we want to identify modules that are significantly correlated with timepoint. Since correlation analysis wouldn't identify non-linear relationships, we need to encode timepoint as 4 separate binomial variables (timepoint1 â€“ yes/no?, timepoint2 â€“ yes/no?, etc.)</p>
<pre><code>datTraits &lt;- datTraits %&gt;%   mutate(     timepoint1 = as.integer(timepoint == 1),     timepoint2 = as.integer(timepoint == 2),     timepoint3 = as.integer(timepoint == 3),     timepoint4 = as.integer(timepoint == 4)   ) %&gt;% select(!timepoint)</code></pre>
<pre><code>nGenes = ncol(datExpr) nSamples = nrow(datExpr)  nGenes</code></pre>
<pre><code>[1] 23502 </code></pre>
<pre><code>nSamples</code></pre>
<pre><code>[1] 38 </code></pre>
<p>Generate labels for module eigengenes as numbers.</p>
<pre><code>MEs0 = moduleEigengenes(datExpr, moduleLabels, softPower=5)$eigengenes # Reorder the eigengenes so that similar ones are adjacent MEs = orderMEs(MEs0) names(MEs)</code></pre>
<pre><code> [1] "ME6"  "ME18" "ME33" "ME35" "ME38" "ME43" "ME12" "ME26" "ME13" "ME7"  [11] "ME14" "ME2"  "ME23" "ME36" "ME15" "ME21" "ME51" "ME46" "ME0"  "ME20" [21] "ME47" "ME41" "ME44" "ME11" "ME16" "ME25" "ME34" "ME49" "ME39" "ME48" [31] "ME52" "ME50" "ME31" "ME28" "ME32" "ME40" "ME53" "ME3"  "ME5"  "ME19" [41] "ME27" "ME45" "ME22" "ME30" "ME29" "ME37" "ME24" "ME1"  "ME17" "ME4"  [51] "ME10" "ME42" "ME8"  "ME9"  </code></pre>
<p>Correlations of traits with eigengenes</p>
<pre><code>moduleTraitCor = cor(MEs, datTraits, use = "p"); moduleTraitPvalue = corPvalueStudent(moduleTraitCor, nSamples); Colors=sub("ME","", names(MEs))  moduleTraitTree = hclust(dist(t(moduleTraitCor)), method = "average")  # pdf(file="D-Apul/output/11.00-Apul-WGCNA/ModuleTraitClusterTree.pdf") plot(moduleTraitTree)</code></pre>
<pre><code># dev.off()</code></pre>
<p>Correlations of genes with eigengenes. Calculate correlations between ME's and physiology/environmental variables.</p>
<pre><code>moduleGeneCor=cor(MEs,datExpr) moduleGenePvalue = corPvalueStudent(moduleGeneCor, nSamples);</code></pre>
<p>Calculate kME values (module membership).</p>
<pre><code>datKME = signedKME(datExpr, MEs, outputColumnName = "kME") head(datKME)</code></pre>
<pre><code>                kME6     kME18      kME33      kME35       kME38      kME43 FUN_002326 0.2583283 0.2156291 -0.1570120 -0.5612523 -0.12338187 0.10258740 FUN_002303 0.2132901 0.1511132 -0.2780998 -0.5391163 -0.07989391 0.04627133 FUN_002305 0.1773465 0.1530036 -0.3030477 -0.5807210 -0.12928937 0.05034717 FUN_002309 0.1884754 0.1696723 -0.2955877 -0.5769509 -0.12509871 0.04849489 FUN_002311 0.1770234 0.1320371 -0.3262569 -0.5604463 -0.11152639 0.07847327 FUN_002314 0.2249291 0.1980589 -0.2499234 -0.5998821 -0.14861215 0.05851233                kME12       kME26     kME13         kME7      kME14      kME2 FUN_002326 0.1174550 0.009270817 0.2312550  0.135998381 0.31371919 0.3990954 FUN_002303 0.2039570 0.014172902 0.2212095  0.024377196 0.13838471 0.1997507 FUN_002305 0.2033153 0.047296772 0.1240672  0.015050330 0.07661177 0.1377189 FUN_002309 0.1975374 0.044314259 0.1373691  0.019421357 0.08434848 0.1535856 FUN_002311 0.2349518 0.042425406 0.1202533 -0.006970714 0.04975190 0.1069415 FUN_002314 0.1515615 0.012431873 0.2172321  0.085028079 0.20448014 0.2812469                kME23     kME36      kME15     kME21     kME51     kME46 FUN_002326 0.3905361 0.1691093 0.24286457 0.2051058 0.1566690 0.4614680 FUN_002303 0.2417195 0.2336136 0.14542781 0.1991871 0.1154859 0.4628273 FUN_002305 0.1877159 0.1888757 0.10044193 0.1433232 0.1717918 0.4075874 FUN_002309 0.1976843 0.1629258 0.08986570 0.1185655 0.1579065 0.4188753 FUN_002311 0.1696208 0.2059308 0.08885847 0.1383213 0.1684262 0.3996114 FUN_002314 0.2948833 0.1861392 0.18195855 0.1875840 0.1849925 0.4642949                 kME0     kME20      kME47      kME41      kME44     kME11 FUN_002326 0.4630721 0.9248177 -0.5293279 -0.5666736 -0.3735003 0.2630204 FUN_002303 0.5703850 0.9324223 -0.6216517 -0.5450220 -0.4339203 0.4109935 FUN_002305 0.5468557 0.9328821 -0.6153781 -0.5411724 -0.4329008 0.3904426 FUN_002309 0.5427259 0.9343306 -0.6164971 -0.5469842 -0.4312169 0.3770097 FUN_002311 0.5625078 0.9237108 -0.6542604 -0.5140593 -0.4249934 0.3702812 FUN_002314 0.5352373 0.9534300 -0.5839477 -0.5538538 -0.4184076 0.3392641                    kME16      kME25      kME34      kME49     kME39      kME48 FUN_002326 -0.1449128722 -0.3073671 -0.3775335 -0.2751587 0.2478527 -0.2943203 FUN_002303  0.0007837565 -0.1672681 -0.3481721 -0.2750047 0.2764089 -0.2119715 FUN_002305 -0.0002374199 -0.2014737 -0.3281722 -0.2574489 0.2907387 -0.2030659 FUN_002309 -0.0106002951 -0.1998462 -0.3310817 -0.2409483 0.2860426 -0.2089602 FUN_002311  0.0579307309 -0.1588614 -0.3626532 -0.2819691 0.2696467 -0.2019203 FUN_002314 -0.0684623793 -0.2391020 -0.3638474 -0.2654632 0.2753572 -0.2682380                    kME52      kME50      kME31      kME28      kME32     kME40 FUN_002326 -0.1324597282 -0.3821201 -0.6620980 -0.4756584 -0.1814741 0.5401565 FUN_002303 -0.0185110679 -0.3942205 -0.6737867 -0.3632678 -0.1549630 0.5825502 FUN_002305  0.0004712576 -0.4350240 -0.6896803 -0.3860317 -0.2140152 0.6669638 FUN_002309 -0.0138800334 -0.4188123 -0.6845826 -0.3935239 -0.1993565 0.6507863 FUN_002311  0.0205792506 -0.4748224 -0.6861438 -0.3679979 -0.2098042 0.6742521 FUN_002314 -0.0661164251 -0.4225547 -0.7016264 -0.4531292 -0.2227751 0.5973660                 kME53        kME3        kME5      kME19      kME27       kME45 FUN_002326 0.06131876 -0.27360474 -0.24500584 -0.3346685 0.05895651 -0.04288271 FUN_002303 0.16536594 -0.09029313 -0.13980923 -0.1590198 0.22564947  0.12468402 FUN_002305 0.29272449 -0.03022949 -0.07036092 -0.1275217 0.21951126  0.13986073 FUN_002309 0.26081293 -0.04438078 -0.07743951 -0.1368057 0.22140449  0.13737970 FUN_002311 0.30624069  0.00381524 -0.06167558 -0.1053688 0.24135388  0.16178998 FUN_002314 0.14652976 -0.16215976 -0.17005319 -0.2397911 0.15606284  0.06869516                kME22     kME30      kME29        kME37      kME24       kME1 FUN_002326 0.3942966 0.0556694 -0.1414560 -0.080627415 -0.5924479 -0.4186260 FUN_002303 0.4395832 0.1809235 -0.1934628 -0.085018601 -0.4356039 -0.2331683 FUN_002305 0.5018345 0.2233019 -0.1599139 -0.006766168 -0.4214407 -0.1618433 FUN_002309 0.4888654 0.2071683 -0.1577340 -0.017326770 -0.4370665 -0.1800507 FUN_002311 0.4829996 0.2376146 -0.1928131 -0.026028945 -0.3807216 -0.1320455 FUN_002314 0.4698504 0.1693748 -0.1429564 -0.040719075 -0.5265858 -0.3062592                   kME17       kME4        kME10      kME42       kME8 FUN_002326 -0.231691223 -0.4439713 -0.091462975 -0.2373804 -0.2441547 FUN_002303 -0.030824209 -0.2746445  0.032908887 -0.1038411 -0.1102147 FUN_002305  0.016441367 -0.2352655  0.099422223 -0.1123383 -0.1300766 FUN_002309 -0.003079167 -0.2565547  0.079948252 -0.1171698 -0.1299456 FUN_002311  0.057939135 -0.2209032  0.101402308 -0.1307009 -0.1072340 FUN_002314 -0.126355446 -0.3433712  0.002535808 -0.1655045 -0.1643798                  kME9 FUN_002326 -0.3447660 FUN_002303 -0.2750440 FUN_002305 -0.2177676 FUN_002309 -0.2373911 FUN_002311 -0.2051189 FUN_002314 -0.3040215 </code></pre>
<p>Generate a complex heatmap of module-trait relationships.</p>
<pre><code>#bold sig p-values #dendrogram with WGCNA MEtree cut-off #colored y-axis  #Create list of pvalues for eigengene correlation with specific physiology traits or environmental conditions heatmappval &lt;- signif(moduleTraitPvalue, 1)  #Make list of heatmap row colors htmap.colors &lt;- names(MEs) htmap.colors &lt;- gsub("ME", "", htmap.colors)  row_dend = dendsort(hclust(dist(moduleTraitCor))) col_dend = dendsort(hclust(dist(t(moduleTraitCor))))  #pdf(file = "../output/12-Apul-miRNA-mRNA-WGCNA/Module-trait-relationship-heatmap.pdf", height = 14, width = 8) Heatmap(moduleTraitCor, name = "Eigengene", row_title = "Gene Module", column_title = "Module-Trait Eigengene Correlation",          col = blueWhiteRed(50),          row_names_side = "left",          #row_dend_side = "left",         width = unit(5, "in"),          height = unit(8.5, "in"),          #column_dend_reorder = TRUE,          #cluster_columns = col_dend,         row_dend_reorder = TRUE,         #column_split = 6,         row_split=3,         #column_dend_height = unit(.5, "in"),         #column_order = lifestage_order,          cluster_rows = row_dend,          row_gap = unit(2.5, "mm"),          border = TRUE,         cell_fun = function(j, i, x, y, w, h, col) {         if(heatmappval[i, j] &lt; 0.05) {             grid.text(sprintf("%s", heatmappval[i, j]), x, y, gp = gpar(fontsize = 10, fontface = "bold"))         }         else {             grid.text(sprintf("%s", heatmappval[i, j]), x, y, gp = gpar(fontsize = 10, fontface = "plain"))         }},         column_names_gp =  gpar(fontsize = 12, border=FALSE),         column_names_rot = 35,         row_names_gp = gpar(fontsize = 12, alpha = 0.75, border = FALSE))</code></pre>
<pre><code>#draw(ht) #dev.off()</code></pre>
<p>This plot is cool, but I'm a little skeptical of the results. No modules show significant relationship with timepoint, despite the PCAs showing a pretty clear clustering by timepointâ€¦</p>
<p>Update 3/5/25: Cleared up why timepoint isn't showing significant relationship, has to do with timepoint being a categorical variable that is encoded numerically (1-4) and this correlation analysis not picking up non-linear relationships. However, incorporation of environmental variables (temp, solar, etc.) for each timepoint essentially provides a set of time-dependent continuous variables, and these <em>are</em> showing significant relationships! mean temperature in particular shows significant correlation with <em>10</em> modules, including several <em>highly</em> significant correlations! Super cool!</p>
<p>Update 3/11/25: Encoded timepoints as 4 separate binomial columns, so that should take care of the original issue with numerically encoding timepoint. Interestingly, timepoints 2 and 3 have significantly correlated modules, but timepoints 1 and 4 don't. This suggests the influence of timepoint stems largely from the temperature conditions, since a) timepoints 2 and 3 have the most "extreme" temperatures (in comparison to annual mean), and b) many of their correlated modules are also significantly correlated with temperature. Interestingly, timepoints 2 and 3 (March and September 2020) are actually extreme in opposite directions. March 2020 was the warmest timepoint and September was the coolest. If the two are correlated with very similar sets of gene modules, that suggests very similar expression pathways are used in response to both heat stress and cold stress in A.pulchra!</p>
<pre><code># Extract modules with significant correlations heatmappval_df &lt;- as.data.frame(heatmappval)   # For mean temp MEs_signif_temp &lt;- rownames(heatmappval_df[heatmappval_df$mean_Temp_mean &lt; 0.05,]) # For solar radiation MEs_signif_solar &lt;- rownames(heatmappval_df[heatmappval_df$mean_solar_rad_kwpm2_mean &lt; 0.05,]) # For TP2 MEs_signif_tp2 &lt;- rownames(heatmappval_df[heatmappval_df$timepoint2 &lt; 0.05,]) # For TP3 MEs_signif_tp3 &lt;- rownames(heatmappval_df[heatmappval_df$timepoint3 &lt; 0.05,])</code></pre>
<p>We can also compare to our module interaction plot to find modules that are both correlated with temperature and potentially involved in miRNA-mRNA interactions! Modules 19, 42, 1, 6, 15, 7, 2, are both significantly correlated with temperature <em>and</em> have negative module-module interactions that involve at least 1 module that contains miRNA.</p>
</section>
<section id="plot-eigengene-values" class="level1">
<h1>8 Plot eigengene values</h1>
<p>View module eigengene data and make dataframe for Strader plots.</p>
<pre><code>head(MEs)</code></pre>
<pre><code>                         ME6        ME18        ME33        ME35         ME38 1A1_ACR-173_TP1  -0.02320522 -0.12042746 -0.07570329  0.08953234 -0.002722348 1A10_ACR-145_TP4  0.19459276  0.06843414  0.11466317  0.06011922  0.213671719 1A12_ACR-237_TP3 -0.14575292 -0.05911569 -0.21387865 -0.24197517 -0.187723279 1A2_ACR-244_TP4   0.28771754  0.17589318  0.20427360  0.09090719  0.226119130 1A8_ACR-186_TP2  -0.15984303  0.07920845  0.11766920  0.11913485  0.048951517 1A9_ACR-244_TP2   0.01581373  0.06951923 -0.04830976  0.15858184  0.214966291                         ME43          ME12        ME26        ME13         ME7 1A1_ACR-173_TP1   0.07647616  0.0001754009 -0.05505784  0.20270624  0.07475380 1A10_ACR-145_TP4  0.25109095  0.3641762566  0.42001651  0.16127320 -0.18021071 1A12_ACR-237_TP3 -0.16292788 -0.1051111381 -0.12908986 -0.18316460 -0.03432307 1A2_ACR-244_TP4  -0.11011852 -0.1651400603 -0.19244968 -0.04973101  0.32129475 1A8_ACR-186_TP2  -0.14830315 -0.0591323985  0.18148181 -0.12711065 -0.09629987 1A9_ACR-244_TP2  -0.07962408 -0.0540087297 -0.09729516 -0.12020683 -0.06672186                         ME14         ME2        ME23        ME36       ME15 1A1_ACR-173_TP1   0.19151639  0.12326050  0.07280842 -0.00839479  0.1325807 1A10_ACR-145_TP4 -0.07341621  0.03905688  0.23532090  0.05304861 -0.1689939 1A12_ACR-237_TP3 -0.13138055 -0.18842842 -0.21651217 -0.10499086 -0.1134810 1A2_ACR-244_TP4   0.13508842  0.26675554  0.11447397 -0.15114857  0.1436193 1A8_ACR-186_TP2  -0.14579154 -0.15718931 -0.08731953 -0.07862053 -0.1539886 1A9_ACR-244_TP2  -0.15357031 -0.16064972 -0.19545927 -0.09383841 -0.1216837                         ME21        ME51       ME46         ME0        ME20 1A1_ACR-173_TP1   0.09211440 -0.09982910  0.1175721 -0.04824818  0.20987392 1A10_ACR-145_TP4 -0.13294953  0.09493306  0.1579177  0.31696452  0.22192946 1A12_ACR-237_TP3 -0.12514048  0.04716891 -0.1814525  0.04868518  0.08817237 1A2_ACR-244_TP4  -0.04959862 -0.38878974 -0.1594932 -0.04743781 -0.16872228 1A8_ACR-186_TP2  -0.09072389  0.03283509 -0.1894046 -0.14353345 -0.14754665 1A9_ACR-244_TP2  -0.13871982 -0.36649673 -0.2079307  0.05895101 -0.24372543                         ME47        ME41        ME44        ME11        ME16 1A1_ACR-173_TP1   0.03470736  0.04752115  0.07281498  0.63307914 -0.04035761 1A10_ACR-145_TP4 -0.11675811 -0.12044660 -0.05209080 -0.07558101  0.25921778 1A12_ACR-237_TP3 -0.11194076 -0.06473216 -0.07773079 -0.06226461 -0.08070354 1A2_ACR-244_TP4  -0.07933785 -0.10409693 -0.03243204 -0.08462248 -0.21159566 1A8_ACR-186_TP2   0.32760534 -0.04570318 -0.07259399 -0.13761054 -0.10691635 1A9_ACR-244_TP2  -0.05242313 -0.02000174 -0.01173004 -0.01741715 -0.06278376                           ME25        ME34        ME49        ME39 1A1_ACR-173_TP1   0.1159472355 -0.06459061 -0.07468321  0.06383371 1A10_ACR-145_TP4 -0.0750813705 -0.05125816 -0.08851378 -0.16912272 1A12_ACR-237_TP3 -0.0872307433  0.01192810 -0.07575012  0.18314888 1A2_ACR-244_TP4  -0.1101654964 -0.15904220 -0.01167480  0.24732733 1A8_ACR-186_TP2   0.0080573154  0.49525150  0.31307068 -0.10271779 1A9_ACR-244_TP2  -0.0009325801 -0.02071236 -0.08091096  0.26465366                           ME48        ME52        ME50         ME31        ME28 1A1_ACR-173_TP1  -0.0658781815 -0.08730461  0.01179057  0.004557333  0.07717642 1A10_ACR-145_TP4 -0.1336876621 -0.19541181 -0.06381834 -0.169341137 -0.08401907 1A12_ACR-237_TP3  0.1448092748  0.15603605 -0.09196350 -0.119641364 -0.08583319 1A2_ACR-244_TP4   0.3409308178  0.22329330  0.33550188  0.218071659  0.22096796 1A8_ACR-186_TP2  -0.0005059539 -0.13611068  0.33820532  0.074046403  0.03732140 1A9_ACR-244_TP2   0.5185745804  0.38404362  0.29746511  0.323116554  0.54894087                         ME32        ME40        ME53         ME3          ME5 1A1_ACR-173_TP1   0.17864851 -0.05337631 -0.03600139 -0.13503065 -0.223755857 1A10_ACR-145_TP4 -0.09133273  0.37583510  0.28172083  0.08596743  0.007776691 1A12_ACR-237_TP3 -0.10665896  0.07117197  0.14659280  0.12882554  0.134777655 1A2_ACR-244_TP4   0.48138110 -0.18561751 -0.32888781 -0.10113155 -0.065430560 1A8_ACR-186_TP2  -0.07399301 -0.07487744  0.11510826  0.05956833  0.226768466 1A9_ACR-244_TP2   0.40331322 -0.06600281  0.06067204  0.19030077  0.145800841                          ME19         ME27        ME45          ME22 1A1_ACR-173_TP1  -0.091982279  0.023872131 -0.01161525 -0.0002743876 1A10_ACR-145_TP4  0.007322575  0.160858405  0.13341959 -0.1231854067 1A12_ACR-237_TP3  0.106455939 -0.038011838  0.03199866  0.3041802867 1A2_ACR-244_TP4  -0.289770423 -0.275328177 -0.19354274 -0.1349407520 1A8_ACR-186_TP2   0.198661487  0.024445762  0.06402741 -0.0746400864 1A9_ACR-244_TP2   0.105392045  0.006782823  0.06487262 -0.0885059437                         ME30        ME29        ME37        ME24         ME1 1A1_ACR-173_TP1  -0.05331506 -0.02873108 -0.10947078  0.01920980 -0.12459130 1A10_ACR-145_TP4 -0.13463637 -0.30358237 -0.13749486 -0.16153800 -0.07140414 1A12_ACR-237_TP3  0.24269473  0.14179660  0.24137320  0.01178445  0.21887066 1A2_ACR-244_TP4  -0.18491163  0.14338189 -0.18316296 -0.07899874 -0.24736110 1A8_ACR-186_TP2  -0.08160114  0.06437295  0.07247864  0.02276353  0.17464184 1A9_ACR-244_TP2  -0.09188314  0.08626617 -0.13459586  0.35901222  0.17585632                        ME17         ME4        ME10          ME42          ME8 1A1_ACR-173_TP1   0.0856670 -0.03441632 -0.05343126  0.0007827266  0.039517723 1A10_ACR-145_TP4 -0.1018332 -0.19849086 -0.16888295 -0.1941582931  0.031928914 1A12_ACR-237_TP3  0.2017213  0.15150257  0.32225465  0.1313200046  0.003869344 1A2_ACR-244_TP4  -0.1246587 -0.10018415 -0.09619992  0.0195382875 -0.241098260 1A8_ACR-186_TP2  -0.0523347  0.10579762  0.02369099  0.1380486272  0.084038917 1A9_ACR-244_TP2   0.3239683  0.13531492  0.15630404  0.1255933632  0.022534594                          ME9 1A1_ACR-173_TP1   0.01222597 1A10_ACR-145_TP4 -0.20882238 1A12_ACR-237_TP3  0.19125078 1A2_ACR-244_TP4  -0.21564948 1A8_ACR-186_TP2   0.09944352 1A9_ACR-244_TP2   0.10184144 </code></pre>
<pre><code>names(MEs)</code></pre>
<pre><code> [1] "ME6"  "ME18" "ME33" "ME35" "ME38" "ME43" "ME12" "ME26" "ME13" "ME7"  [11] "ME14" "ME2"  "ME23" "ME36" "ME15" "ME21" "ME51" "ME46" "ME0"  "ME20" [21] "ME47" "ME41" "ME44" "ME11" "ME16" "ME25" "ME34" "ME49" "ME39" "ME48" [31] "ME52" "ME50" "ME31" "ME28" "ME32" "ME40" "ME53" "ME3"  "ME5"  "ME19" [41] "ME27" "ME45" "ME22" "ME30" "ME29" "ME37" "ME24" "ME1"  "ME17" "ME4"  [51] "ME10" "ME42" "ME8"  "ME9"  </code></pre>
<pre><code>Eigen_MEs &lt;- MEs Eigen_MEs$AzentaSampleName &lt;- rownames(Eigen_MEs) head(Eigen_MEs)</code></pre>
<pre><code>                         ME6        ME18        ME33        ME35         ME38 1A1_ACR-173_TP1  -0.02320522 -0.12042746 -0.07570329  0.08953234 -0.002722348 1A10_ACR-145_TP4  0.19459276  0.06843414  0.11466317  0.06011922  0.213671719 1A12_ACR-237_TP3 -0.14575292 -0.05911569 -0.21387865 -0.24197517 -0.187723279 1A2_ACR-244_TP4   0.28771754  0.17589318  0.20427360  0.09090719  0.226119130 1A8_ACR-186_TP2  -0.15984303  0.07920845  0.11766920  0.11913485  0.048951517 1A9_ACR-244_TP2   0.01581373  0.06951923 -0.04830976  0.15858184  0.214966291                         ME43          ME12        ME26        ME13         ME7 1A1_ACR-173_TP1   0.07647616  0.0001754009 -0.05505784  0.20270624  0.07475380 1A10_ACR-145_TP4  0.25109095  0.3641762566  0.42001651  0.16127320 -0.18021071 1A12_ACR-237_TP3 -0.16292788 -0.1051111381 -0.12908986 -0.18316460 -0.03432307 1A2_ACR-244_TP4  -0.11011852 -0.1651400603 -0.19244968 -0.04973101  0.32129475 1A8_ACR-186_TP2  -0.14830315 -0.0591323985  0.18148181 -0.12711065 -0.09629987 1A9_ACR-244_TP2  -0.07962408 -0.0540087297 -0.09729516 -0.12020683 -0.06672186                         ME14         ME2        ME23        ME36       ME15 1A1_ACR-173_TP1   0.19151639  0.12326050  0.07280842 -0.00839479  0.1325807 1A10_ACR-145_TP4 -0.07341621  0.03905688  0.23532090  0.05304861 -0.1689939 1A12_ACR-237_TP3 -0.13138055 -0.18842842 -0.21651217 -0.10499086 -0.1134810 1A2_ACR-244_TP4   0.13508842  0.26675554  0.11447397 -0.15114857  0.1436193 1A8_ACR-186_TP2  -0.14579154 -0.15718931 -0.08731953 -0.07862053 -0.1539886 1A9_ACR-244_TP2  -0.15357031 -0.16064972 -0.19545927 -0.09383841 -0.1216837                         ME21        ME51       ME46         ME0        ME20 1A1_ACR-173_TP1   0.09211440 -0.09982910  0.1175721 -0.04824818  0.20987392 1A10_ACR-145_TP4 -0.13294953  0.09493306  0.1579177  0.31696452  0.22192946 1A12_ACR-237_TP3 -0.12514048  0.04716891 -0.1814525  0.04868518  0.08817237 1A2_ACR-244_TP4  -0.04959862 -0.38878974 -0.1594932 -0.04743781 -0.16872228 1A8_ACR-186_TP2  -0.09072389  0.03283509 -0.1894046 -0.14353345 -0.14754665 1A9_ACR-244_TP2  -0.13871982 -0.36649673 -0.2079307  0.05895101 -0.24372543                         ME47        ME41        ME44        ME11        ME16 1A1_ACR-173_TP1   0.03470736  0.04752115  0.07281498  0.63307914 -0.04035761 1A10_ACR-145_TP4 -0.11675811 -0.12044660 -0.05209080 -0.07558101  0.25921778 1A12_ACR-237_TP3 -0.11194076 -0.06473216 -0.07773079 -0.06226461 -0.08070354 1A2_ACR-244_TP4  -0.07933785 -0.10409693 -0.03243204 -0.08462248 -0.21159566 1A8_ACR-186_TP2   0.32760534 -0.04570318 -0.07259399 -0.13761054 -0.10691635 1A9_ACR-244_TP2  -0.05242313 -0.02000174 -0.01173004 -0.01741715 -0.06278376                           ME25        ME34        ME49        ME39 1A1_ACR-173_TP1   0.1159472355 -0.06459061 -0.07468321  0.06383371 1A10_ACR-145_TP4 -0.0750813705 -0.05125816 -0.08851378 -0.16912272 1A12_ACR-237_TP3 -0.0872307433  0.01192810 -0.07575012  0.18314888 1A2_ACR-244_TP4  -0.1101654964 -0.15904220 -0.01167480  0.24732733 1A8_ACR-186_TP2   0.0080573154  0.49525150  0.31307068 -0.10271779 1A9_ACR-244_TP2  -0.0009325801 -0.02071236 -0.08091096  0.26465366                           ME48        ME52        ME50         ME31        ME28 1A1_ACR-173_TP1  -0.0658781815 -0.08730461  0.01179057  0.004557333  0.07717642 1A10_ACR-145_TP4 -0.1336876621 -0.19541181 -0.06381834 -0.169341137 -0.08401907 1A12_ACR-237_TP3  0.1448092748  0.15603605 -0.09196350 -0.119641364 -0.08583319 1A2_ACR-244_TP4   0.3409308178  0.22329330  0.33550188  0.218071659  0.22096796 1A8_ACR-186_TP2  -0.0005059539 -0.13611068  0.33820532  0.074046403  0.03732140 1A9_ACR-244_TP2   0.5185745804  0.38404362  0.29746511  0.323116554  0.54894087                         ME32        ME40        ME53         ME3          ME5 1A1_ACR-173_TP1   0.17864851 -0.05337631 -0.03600139 -0.13503065 -0.223755857 1A10_ACR-145_TP4 -0.09133273  0.37583510  0.28172083  0.08596743  0.007776691 1A12_ACR-237_TP3 -0.10665896  0.07117197  0.14659280  0.12882554  0.134777655 1A2_ACR-244_TP4   0.48138110 -0.18561751 -0.32888781 -0.10113155 -0.065430560 1A8_ACR-186_TP2  -0.07399301 -0.07487744  0.11510826  0.05956833  0.226768466 1A9_ACR-244_TP2   0.40331322 -0.06600281  0.06067204  0.19030077  0.145800841                          ME19         ME27        ME45          ME22 1A1_ACR-173_TP1  -0.091982279  0.023872131 -0.01161525 -0.0002743876 1A10_ACR-145_TP4  0.007322575  0.160858405  0.13341959 -0.1231854067 1A12_ACR-237_TP3  0.106455939 -0.038011838  0.03199866  0.3041802867 1A2_ACR-244_TP4  -0.289770423 -0.275328177 -0.19354274 -0.1349407520 1A8_ACR-186_TP2   0.198661487  0.024445762  0.06402741 -0.0746400864 1A9_ACR-244_TP2   0.105392045  0.006782823  0.06487262 -0.0885059437                         ME30        ME29        ME37        ME24         ME1 1A1_ACR-173_TP1  -0.05331506 -0.02873108 -0.10947078  0.01920980 -0.12459130 1A10_ACR-145_TP4 -0.13463637 -0.30358237 -0.13749486 -0.16153800 -0.07140414 1A12_ACR-237_TP3  0.24269473  0.14179660  0.24137320  0.01178445  0.21887066 1A2_ACR-244_TP4  -0.18491163  0.14338189 -0.18316296 -0.07899874 -0.24736110 1A8_ACR-186_TP2  -0.08160114  0.06437295  0.07247864  0.02276353  0.17464184 1A9_ACR-244_TP2  -0.09188314  0.08626617 -0.13459586  0.35901222  0.17585632                        ME17         ME4        ME10          ME42          ME8 1A1_ACR-173_TP1   0.0856670 -0.03441632 -0.05343126  0.0007827266  0.039517723 1A10_ACR-145_TP4 -0.1018332 -0.19849086 -0.16888295 -0.1941582931  0.031928914 1A12_ACR-237_TP3  0.2017213  0.15150257  0.32225465  0.1313200046  0.003869344 1A2_ACR-244_TP4  -0.1246587 -0.10018415 -0.09619992  0.0195382875 -0.241098260 1A8_ACR-186_TP2  -0.0523347  0.10579762  0.02369099  0.1380486272  0.084038917 1A9_ACR-244_TP2   0.3239683  0.13531492  0.15630404  0.1255933632  0.022534594                          ME9 AzentaSampleName 1A1_ACR-173_TP1   0.01222597  1A1_ACR-173_TP1 1A10_ACR-145_TP4 -0.20882238 1A10_ACR-145_TP4 1A12_ACR-237_TP3  0.19125078 1A12_ACR-237_TP3 1A2_ACR-244_TP4  -0.21564948  1A2_ACR-244_TP4 1A8_ACR-186_TP2   0.09944352  1A8_ACR-186_TP2 1A9_ACR-244_TP2   0.10184144  1A9_ACR-244_TP2 </code></pre>
<pre><code>plotTraits&lt;-datTraits plotTraits$AzentaSampleName &lt;- rownames(plotTraits)  Eigen_MEs&lt;-Eigen_MEs%&gt;%   droplevels() #drop unused level  dim(Eigen_MEs)</code></pre>
<pre><code>[1] 38 55 </code></pre>
<pre><code>head(Eigen_MEs)</code></pre>
<pre><code>                         ME6        ME18        ME33        ME35         ME38 1A1_ACR-173_TP1  -0.02320522 -0.12042746 -0.07570329  0.08953234 -0.002722348 1A10_ACR-145_TP4  0.19459276  0.06843414  0.11466317  0.06011922  0.213671719 1A12_ACR-237_TP3 -0.14575292 -0.05911569 -0.21387865 -0.24197517 -0.187723279 1A2_ACR-244_TP4   0.28771754  0.17589318  0.20427360  0.09090719  0.226119130 1A8_ACR-186_TP2  -0.15984303  0.07920845  0.11766920  0.11913485  0.048951517 1A9_ACR-244_TP2   0.01581373  0.06951923 -0.04830976  0.15858184  0.214966291                         ME43          ME12        ME26        ME13         ME7 1A1_ACR-173_TP1   0.07647616  0.0001754009 -0.05505784  0.20270624  0.07475380 1A10_ACR-145_TP4  0.25109095  0.3641762566  0.42001651  0.16127320 -0.18021071 1A12_ACR-237_TP3 -0.16292788 -0.1051111381 -0.12908986 -0.18316460 -0.03432307 1A2_ACR-244_TP4  -0.11011852 -0.1651400603 -0.19244968 -0.04973101  0.32129475 1A8_ACR-186_TP2  -0.14830315 -0.0591323985  0.18148181 -0.12711065 -0.09629987 1A9_ACR-244_TP2  -0.07962408 -0.0540087297 -0.09729516 -0.12020683 -0.06672186                         ME14         ME2        ME23        ME36       ME15 1A1_ACR-173_TP1   0.19151639  0.12326050  0.07280842 -0.00839479  0.1325807 1A10_ACR-145_TP4 -0.07341621  0.03905688  0.23532090  0.05304861 -0.1689939 1A12_ACR-237_TP3 -0.13138055 -0.18842842 -0.21651217 -0.10499086 -0.1134810 1A2_ACR-244_TP4   0.13508842  0.26675554  0.11447397 -0.15114857  0.1436193 1A8_ACR-186_TP2  -0.14579154 -0.15718931 -0.08731953 -0.07862053 -0.1539886 1A9_ACR-244_TP2  -0.15357031 -0.16064972 -0.19545927 -0.09383841 -0.1216837                         ME21        ME51       ME46         ME0        ME20 1A1_ACR-173_TP1   0.09211440 -0.09982910  0.1175721 -0.04824818  0.20987392 1A10_ACR-145_TP4 -0.13294953  0.09493306  0.1579177  0.31696452  0.22192946 1A12_ACR-237_TP3 -0.12514048  0.04716891 -0.1814525  0.04868518  0.08817237 1A2_ACR-244_TP4  -0.04959862 -0.38878974 -0.1594932 -0.04743781 -0.16872228 1A8_ACR-186_TP2  -0.09072389  0.03283509 -0.1894046 -0.14353345 -0.14754665 1A9_ACR-244_TP2  -0.13871982 -0.36649673 -0.2079307  0.05895101 -0.24372543                         ME47        ME41        ME44        ME11        ME16 1A1_ACR-173_TP1   0.03470736  0.04752115  0.07281498  0.63307914 -0.04035761 1A10_ACR-145_TP4 -0.11675811 -0.12044660 -0.05209080 -0.07558101  0.25921778 1A12_ACR-237_TP3 -0.11194076 -0.06473216 -0.07773079 -0.06226461 -0.08070354 1A2_ACR-244_TP4  -0.07933785 -0.10409693 -0.03243204 -0.08462248 -0.21159566 1A8_ACR-186_TP2   0.32760534 -0.04570318 -0.07259399 -0.13761054 -0.10691635 1A9_ACR-244_TP2  -0.05242313 -0.02000174 -0.01173004 -0.01741715 -0.06278376                           ME25        ME34        ME49        ME39 1A1_ACR-173_TP1   0.1159472355 -0.06459061 -0.07468321  0.06383371 1A10_ACR-145_TP4 -0.0750813705 -0.05125816 -0.08851378 -0.16912272 1A12_ACR-237_TP3 -0.0872307433  0.01192810 -0.07575012  0.18314888 1A2_ACR-244_TP4  -0.1101654964 -0.15904220 -0.01167480  0.24732733 1A8_ACR-186_TP2   0.0080573154  0.49525150  0.31307068 -0.10271779 1A9_ACR-244_TP2  -0.0009325801 -0.02071236 -0.08091096  0.26465366                           ME48        ME52        ME50         ME31        ME28 1A1_ACR-173_TP1  -0.0658781815 -0.08730461  0.01179057  0.004557333  0.07717642 1A10_ACR-145_TP4 -0.1336876621 -0.19541181 -0.06381834 -0.169341137 -0.08401907 1A12_ACR-237_TP3  0.1448092748  0.15603605 -0.09196350 -0.119641364 -0.08583319 1A2_ACR-244_TP4   0.3409308178  0.22329330  0.33550188  0.218071659  0.22096796 1A8_ACR-186_TP2  -0.0005059539 -0.13611068  0.33820532  0.074046403  0.03732140 1A9_ACR-244_TP2   0.5185745804  0.38404362  0.29746511  0.323116554  0.54894087                         ME32        ME40        ME53         ME3          ME5 1A1_ACR-173_TP1   0.17864851 -0.05337631 -0.03600139 -0.13503065 -0.223755857 1A10_ACR-145_TP4 -0.09133273  0.37583510  0.28172083  0.08596743  0.007776691 1A12_ACR-237_TP3 -0.10665896  0.07117197  0.14659280  0.12882554  0.134777655 1A2_ACR-244_TP4   0.48138110 -0.18561751 -0.32888781 -0.10113155 -0.065430560 1A8_ACR-186_TP2  -0.07399301 -0.07487744  0.11510826  0.05956833  0.226768466 1A9_ACR-244_TP2   0.40331322 -0.06600281  0.06067204  0.19030077  0.145800841                          ME19         ME27        ME45          ME22 1A1_ACR-173_TP1  -0.091982279  0.023872131 -0.01161525 -0.0002743876 1A10_ACR-145_TP4  0.007322575  0.160858405  0.13341959 -0.1231854067 1A12_ACR-237_TP3  0.106455939 -0.038011838  0.03199866  0.3041802867 1A2_ACR-244_TP4  -0.289770423 -0.275328177 -0.19354274 -0.1349407520 1A8_ACR-186_TP2   0.198661487  0.024445762  0.06402741 -0.0746400864 1A9_ACR-244_TP2   0.105392045  0.006782823  0.06487262 -0.0885059437                         ME30        ME29        ME37        ME24         ME1 1A1_ACR-173_TP1  -0.05331506 -0.02873108 -0.10947078  0.01920980 -0.12459130 1A10_ACR-145_TP4 -0.13463637 -0.30358237 -0.13749486 -0.16153800 -0.07140414 1A12_ACR-237_TP3  0.24269473  0.14179660  0.24137320  0.01178445  0.21887066 1A2_ACR-244_TP4  -0.18491163  0.14338189 -0.18316296 -0.07899874 -0.24736110 1A8_ACR-186_TP2  -0.08160114  0.06437295  0.07247864  0.02276353  0.17464184 1A9_ACR-244_TP2  -0.09188314  0.08626617 -0.13459586  0.35901222  0.17585632                        ME17         ME4        ME10          ME42          ME8 1A1_ACR-173_TP1   0.0856670 -0.03441632 -0.05343126  0.0007827266  0.039517723 1A10_ACR-145_TP4 -0.1018332 -0.19849086 -0.16888295 -0.1941582931  0.031928914 1A12_ACR-237_TP3  0.2017213  0.15150257  0.32225465  0.1313200046  0.003869344 1A2_ACR-244_TP4  -0.1246587 -0.10018415 -0.09619992  0.0195382875 -0.241098260 1A8_ACR-186_TP2  -0.0523347  0.10579762  0.02369099  0.1380486272  0.084038917 1A9_ACR-244_TP2   0.3239683  0.13531492  0.15630404  0.1255933632  0.022534594                          ME9 AzentaSampleName 1A1_ACR-173_TP1   0.01222597  1A1_ACR-173_TP1 1A10_ACR-145_TP4 -0.20882238 1A10_ACR-145_TP4 1A12_ACR-237_TP3  0.19125078 1A12_ACR-237_TP3 1A2_ACR-244_TP4  -0.21564948  1A2_ACR-244_TP4 1A8_ACR-186_TP2   0.09944352  1A8_ACR-186_TP2 1A9_ACR-244_TP2   0.10184144  1A9_ACR-244_TP2 </code></pre>
<p>Plot mean module eigengene for each module.</p>
<pre><code>#convert wide format to long format for plotting   #str(Eigen_MEs)  plot_MEs &lt;- Eigen_MEs %&gt;%   pivot_longer(     cols = where(is.numeric),  # Select only numeric columns     names_to = "Module",       # Name for the new column containing the column names     values_to = "Mean"         # Name for the new column containing the values   )  #str(plot_MEs)  #join with phys data  plot_MEs&lt;-left_join(plot_MEs, plotTraits)  plot_MEs %&gt;%   group_by(Module) %&gt;%   ggplot(aes(x=mean_Temp_mean, y=Mean)) +   facet_wrap(~ Module)+   geom_point()+   # geom_smooth(method="lm")+   # The loess method can capture nonlinear trends   geom_smooth(method="loess")+   #ylim(-0.5,1) +   geom_hline(yintercept = 0, linetype="dashed", color = "grey")+   theme_bw() +    theme(axis.text.x=element_text(angle = 45, hjust=1, size = 12), #set x-axis label size         axis.title.x=element_text(size = 14), #set x-axis title size         axis.ticks.x=element_blank(), #No x-label ticks         #axis.title.y=element_blank(), #No y-axis title         axis.text.y=element_text(size = 14), #set y-axis label size,          panel.border = element_rect(color = "black", fill = NA, size = 1), #set border         panel.grid.major = element_blank(), #Set major gridlines         panel.grid.minor = element_blank(), #Set minor gridlines         axis.line = element_line(colour = "black"), #Set axes color         plot.background=element_blank(),         plot.title = element_text(size=22))</code></pre>
<pre><code># Now just plot the modules that are significantly correlated with temp plot_MEs_signif &lt;- function(var.name){      # Isolate modules that are significantly correlated with input variable   MEs_signif &lt;- rownames(heatmappval_df[heatmappval_df[[var.name]] &lt; 0.05,])      if (length(MEs_signif) == 0) {     output &lt;- cat("There are no modules significantly correlated with", var.name)     return(output)   } else {     # Choose appropriate smoothing method     num_x_values &lt;- plot_MEs %&gt;%       filter(Module %in% MEs_signif) %&gt;%       summarise(unique_x = n_distinct(!!sym(var.name))) %&gt;%       pull(unique_x)          # loess can capture non-linear trends, but is only appropriate for more than 2 x-values     smoothing_method &lt;- ifelse(num_x_values &gt; 2, "loess", "lm")          plot_MEs %&gt;%       filter(Module %in% MEs_signif)%&gt;%       group_by(Module) %&gt;%       ggplot(aes_string(x=var.name, y="Mean")) +       facet_wrap(~ Module)+       geom_point()+       geom_smooth(method=smoothing_method)+       #ylim(-0.5,1) +       geom_hline(yintercept = 0, linetype="dashed", color = "grey")+       theme_bw() +        theme(axis.text.x=element_text(angle = 45, hjust=1, size = 12), #set x-axis label size             axis.title.x=element_text(size = 14), #set x-axis title size             axis.ticks.x=element_blank(), #No x-label ticks             #axis.title.y=element_blank(), #No y-axis title             axis.text.y=element_text(size = 14), #set y-axis label size,              panel.border = element_rect(color = "black", fill = NA, size = 1), #set border             panel.grid.major = element_blank(), #Set major gridlines             panel.grid.minor = element_blank(), #Set minor gridlines             axis.line = element_line(colour = "black"), #Set axes color             plot.background=element_blank(),             plot.title = element_text(size=22))   } }  plot_MEs_signif("mean_Temp_mean")</code></pre>
<pre><code># Now just plot the modules that are significantly correlated with solar plot_MEs_signif("mean_solar_rad_kwpm2_mean")</code></pre>
<pre><code># Now just plot the modules that are significantly correlated with rainfall plot_MEs_signif("cumulative_rainfall_mm_mean")</code></pre>
<pre><code># Now just plot the modules that are significantly correlated with TP1 plot_MEs_signif("timepoint1")</code></pre>
<pre><code>There are no modules significantly correlated with timepoint1  NULL </code></pre>
<pre><code># Now just plot the modules that are significantly correlated with TP2 plot_MEs_signif("timepoint2")</code></pre>
<pre><code># Now just plot the modules that are significantly correlated with TP3 plot_MEs_signif("timepoint3")</code></pre>
<pre><code># Now just plot the modules that are significantly correlated with TP4 plot_MEs_signif("timepoint4")</code></pre>
<pre><code>There are no modules significantly correlated with timepoint4  NULL </code></pre>
<p>Interesting! Module 18 is the only significantly correlated module for both solar radiation and rainfall, but shwows inverse patterns of eigengene expression for the two. Module 18 is also one of the modules significantly correlated with TP3. Notably, both solar radiation and rainfall hit "extremes" at TP3 (TP3 represents both the maximum recorded solar radiation and minimum recorded rainfall of our 4 timepoints)</p>
</section>
<section id="save-data-of-interest-for-future-use" class="level1">
<h1>9 Save data of interest for future use</h1>
<pre><code># df that shows which WGCNA module each gene/miRNA is grouped with write.table(module_info, "../output/12-Apul-miRNA-mRNA-WGCNA/WGCNA-module-membership.tab", quote=FALSE, row.names=FALSE, col.names=TRUE, sep="\t")  # df of physiological/environmental variables write.table(plotTraits, "../output/12-Apul-miRNA-mRNA-WGCNA/phys-envir-traits.tab", quote=FALSE, row.names=FALSE, col.names=TRUE, sep="\t")  # df that shows p-values for correlations between each WGCNA module and physiological/environmental variable write.table(heatmappval_df, "../output/12-Apul-miRNA-mRNA-WGCNA/pval-cor-WGCNA_module-phys_envir.tab", quote=FALSE, row.names=FALSE, col.names=TRUE, sep="\t")  # df of module eigengenes write.table(MEs, "../output/12-Apul-miRNA-mRNA-WGCNA/WGCNA-module-eigengenes.tab", quote=FALSE, row.names=FALSE, col.names=TRUE, sep="\t")</code></pre>
</section>
<section id="export-to-cytoscape" class="level1">
<h1>10 Export to Cytoscape</h1>
<p>Export modules of interest for network visualization</p>
<pre><code>MEs_signif_temp</code></pre>
<pre><code> [1] "ME6"  "ME7"  "ME2"  "ME15" "ME34" "ME19" "ME45" "ME1"  "ME42" "ME8"  </code></pre>
<p>Note that, due to the size of many modules, it's probably most practical to export modules individually (unless interested in in connections between modules)</p>
<pre><code># # Recalculate topological overlap if needed # TOM = TOMsimilarityFromExpr(datExpr, power = 5); #   # Read in the annotation file # annot = datTraits; # for(i in seq_along(MEs_signif_temp)) {  #   # Select modules #   modules = MEs_signif_temp[i]; #   # Select module probes #   probes = names(datExpr) #   inModule = is.finite(match(moduleLabels, modules)); #   modProbes = probes[inModule]; #   # modGenes = annot$gene_symbol[match(modProbes, annot$substanceBXH)]; #   # Select the corresponding Topological Overlap #   modTOM = TOM[inModule, inModule]; #   dimnames(modTOM) = list(modProbes, modProbes) #   # Export the network into edge and node list files Cytoscape can read #   cyt = exportNetworkToCytoscape(modTOM, #     edgeFile = paste("CytoscapeInput-edges-", paste(modules, collapse="-"), ".txt", sep=""), #     nodeFile = paste("CytoscapeInput-nodes-", paste(modules, collapse="-"), ".txt", sep=""), #     weighted = TRUE, #     threshold = 0.02, #     nodeNames = modProbes, #     # altNodeNames = modGenes, #     nodeAttr = moduleLabels[inModule]); # }  # Recalculate topological overlap if needed   TOM = TOMsimilarityFromExpr(datExpr, power = 5);</code></pre>
<pre><code>TOM calculation: adjacency.. ..will use 48 parallel threads.  Fraction of slow calculations: 0.000000 ..connectivity.. ..matrix multiplication (system BLAS).. ..normalization.. ..done. </code></pre>
<pre><code>  # Read in the annotation file   annot = datTraits;   # Select modules   modules = "45";   # Select module probes   probes = names(datExpr)   inModule = is.finite(match(moduleLabels, modules));   modProbes = probes[inModule];   # modGenes = annot$gene_symbol[match(modProbes, annot$substanceBXH)];   # Select the corresponding Topological Overlap   modTOM = TOM[inModule, inModule];   dimnames(modTOM) = list(modProbes, modProbes)   # Export the network into edge and node list files Cytoscape can read   cyt = exportNetworkToCytoscape(modTOM,     edgeFile = paste("CytoscapeInput-edges-", paste(modules, collapse="-"), ".txt", sep=""),     nodeFile = paste("CytoscapeInput-nodes-", paste(modules, collapse="-"), ".txt", sep=""),     weighted = TRUE,     threshold = 0.02,     nodeNames = modProbes,     # altNodeNames = modGenes,     nodeAttr = moduleLabels[inModule]);</code></pre>
<pre><code># Move cytoscape files to output directory mv ./CytoscapeInput* ../output/12-Apul-miRNA-mRNA-WGCNA</code></pre>
<p>To load network to Cytoscape:</p>
<ol type="1">
<li><p>File -&gt; Import -&gt; Network from Fileâ€¦</p></li>
<li><p>Select Edges file (created above)</p></li>
<li><p>Assign fromNode to "Source Node," toNode to "Target Node," weight to "Edge Attribute," and direction to "Interaction Type"</p></li>
<li><p>Once netwrok is loaded, can manipulate/style as desired.</p></li>
</ol>
<pre><code># Print session info sessioninfo::session_info()</code></pre>
<pre><code>â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  setting  value  version  R version 4.2.3 (2023-03-15)  os       Ubuntu 18.04.6 LTS  system   x86_64, linux-gnu  ui       X11  language (EN)  collate  en_US.UTF-8  ctype    en_US.UTF-8  tz       America/Los_Angeles  date     2025-03-18  pandoc   2.19.2 @ /usr/lib/rstudio-server/bin/quarto/bin/tools/ (via rmarkdown)  â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  package              * version   date (UTC) lib source  abind                  1.4-5     2016-07-21 [1] CRAN (R 4.2.3)  annotate               1.76.0    2022-11-01 [1] Bioconductor  AnnotationDbi          1.60.2    2023-03-10 [1] Bioconductor  backports              1.5.0     2024-05-23 [2] CRAN (R 4.2.3)  base64enc              0.1-3     2015-07-28 [2] CRAN (R 4.2.3)  Biobase              * 2.58.0    2022-11-01 [1] Bioconductor  BiocGenerics         * 0.44.0    2022-11-01 [1] Bioconductor  BiocParallel           1.32.6    2023-03-17 [1] Bioconductor  Biostrings             2.66.0    2022-11-01 [1] Bioconductor  bit                    4.5.0.1   2024-12-03 [2] CRAN (R 4.2.3)  bit64                  4.5.2     2024-09-22 [2] CRAN (R 4.2.3)  bitops                 1.0-8     2024-07-29 [1] CRAN (R 4.2.3)  blob                   1.2.4     2023-03-17 [2] CRAN (R 4.2.3)  broom                  1.0.6     2024-05-17 [2] CRAN (R 4.2.3)  cachem                 1.1.0     2024-05-16 [2] CRAN (R 4.2.3)  car                    3.1-2     2023-03-30 [1] CRAN (R 4.2.3)  carData                3.0-5     2022-01-06 [1] CRAN (R 4.2.3)  checkmate              2.3.2     2024-07-29 [1] CRAN (R 4.2.3)  circlize               0.4.16    2024-02-20 [1] CRAN (R 4.2.3)  cli                    3.6.3     2024-06-21 [2] CRAN (R 4.2.3)  clue                   0.3-66    2024-11-13 [1] CRAN (R 4.2.3)  cluster                2.1.8     2024-12-11 [2] CRAN (R 4.2.3)  codetools              0.2-20    2024-03-31 [2] CRAN (R 4.2.3)  colorspace             2.1-1     2024-07-26 [2] CRAN (R 4.2.3)  ComplexHeatmap       * 2.14.0    2022-11-01 [1] Bioconductor  crayon                 1.5.3     2024-06-20 [2] CRAN (R 4.2.3)  curl                   5.2.1     2024-03-01 [2] CRAN (R 4.2.3)  data.table             1.15.4    2024-03-30 [2] CRAN (R 4.2.3)  DBI                    1.2.3     2024-06-02 [2] CRAN (R 4.2.3)  DelayedArray           0.24.0    2022-11-01 [1] Bioconductor  dendsort             * 0.3.4     2021-04-20 [1] CRAN (R 4.2.3)  DESeq2               * 1.38.3    2023-01-19 [1] Bioconductor  digest                 0.6.35    2024-03-11 [2] CRAN (R 4.2.3)  doParallel             1.0.17    2022-02-07 [1] CRAN (R 4.2.3)  dplyr                * 1.1.4     2023-11-17 [2] CRAN (R 4.2.3)  dynamicTreeCut       * 1.63-1    2016-03-11 [1] CRAN (R 4.2.3)  evaluate               0.23      2023-11-01 [2] CRAN (R 4.2.3)  factoextra           * 1.0.7     2020-04-01 [1] CRAN (R 4.2.3)  farver                 2.1.2     2024-05-13 [2] CRAN (R 4.2.3)  fastcluster          * 1.2.6     2024-01-12 [1] CRAN (R 4.2.3)  fastmap                1.2.0     2024-05-15 [2] CRAN (R 4.2.3)  forcats              * 1.0.0     2023-01-29 [2] CRAN (R 4.2.3)  foreach                1.5.2     2022-02-02 [1] CRAN (R 4.2.3)  foreign                0.8-87    2024-06-26 [2] CRAN (R 4.2.3)  Formula                1.2-5     2023-02-24 [1] CRAN (R 4.2.3)  genefilter           * 1.80.3    2023-01-19 [1] Bioconductor  geneplotter            1.76.0    2022-11-01 [1] Bioconductor  generics               0.1.3     2022-07-05 [2] CRAN (R 4.2.3)  GenomeInfoDb         * 1.34.9    2023-02-02 [1] Bioconductor  GenomeInfoDbData       1.2.9     2023-10-25 [1] Bioconductor  GenomicRanges        * 1.50.2    2022-12-16 [1] Bioconductor  GetoptLong             1.0.5     2020-12-15 [1] CRAN (R 4.2.3)  ggforce                0.4.2     2024-02-19 [1] CRAN (R 4.2.3)  ggfortify            * 0.4.17    2024-04-17 [1] CRAN (R 4.2.3)  ggplot2              * 3.5.1     2024-04-23 [1] CRAN (R 4.2.3)  ggpubr                 0.6.0     2023-02-10 [1] CRAN (R 4.2.3)  ggraph               * 2.2.1     2024-03-07 [1] CRAN (R 4.2.3)  ggrepel                0.9.5     2024-01-10 [1] CRAN (R 4.2.3)  ggsignif               0.6.4     2022-10-13 [1] CRAN (R 4.2.3)  GlobalOptions          0.1.2     2020-06-10 [1] CRAN (R 4.2.3)  glue                   1.8.0     2024-09-30 [2] CRAN (R 4.2.3)  GO.db                  3.16.0    2024-03-22 [1] Bioconductor  graphlayouts           1.2.2     2025-01-23 [1] CRAN (R 4.2.3)  gridExtra              2.3       2017-09-09 [1] CRAN (R 4.2.3)  gtable                 0.3.5     2024-04-22 [2] CRAN (R 4.2.3)  highr                  0.11      2024-05-26 [2] CRAN (R 4.2.3)  Hmisc                  5.1-3     2024-05-28 [1] CRAN (R 4.2.3)  hms                    1.1.3     2023-03-21 [2] CRAN (R 4.2.3)  htmlTable              2.4.3     2024-07-21 [1] CRAN (R 4.2.3)  htmltools              0.5.8.1   2024-04-04 [1] CRAN (R 4.2.3)  htmlwidgets            1.6.4     2023-12-06 [1] CRAN (R 4.2.3)  httr                   1.4.7     2023-08-15 [2] CRAN (R 4.2.3)  igraph               * 2.0.3     2024-03-13 [1] CRAN (R 4.2.3)  impute                 1.72.3    2023-01-19 [1] Bioconductor  IRanges              * 2.32.0    2022-11-01 [1] Bioconductor  iterators              1.0.14    2022-02-05 [1] CRAN (R 4.2.3)  KEGGREST               1.38.0    2022-11-01 [1] Bioconductor  knitr                * 1.47      2024-05-29 [2] CRAN (R 4.2.3)  labeling               0.4.3     2023-08-29 [2] CRAN (R 4.2.3)  lattice              * 0.22-6    2024-03-20 [2] CRAN (R 4.2.3)  lifecycle              1.0.4     2023-11-07 [2] CRAN (R 4.2.3)  locfit                 1.5-9.10  2024-06-24 [1] CRAN (R 4.2.3)  lubridate            * 1.9.4     2024-12-08 [2] CRAN (R 4.2.3)  magrittr             * 2.0.3     2022-03-30 [2] CRAN (R 4.2.3)  MASS                   7.3-60    2023-05-04 [2] CRAN (R 4.2.3)  Matrix                 1.6-1     2023-08-14 [2] CRAN (R 4.2.3)  MatrixGenerics       * 1.10.0    2022-11-01 [1] Bioconductor  matrixStats          * 1.4.0     2024-09-04 [1] CRAN (R 4.2.3)  memoise                2.0.1     2021-11-26 [2] CRAN (R 4.2.3)  mgcv                   1.9-1     2023-12-21 [2] CRAN (R 4.2.3)  mnormt                 2.1.1     2022-09-26 [1] CRAN (R 4.2.3)  munsell                0.5.1     2024-04-01 [2] CRAN (R 4.2.3)  nlme                   3.1-164   2023-11-27 [2] CRAN (R 4.2.3)  nnet                   7.3-19    2023-05-03 [2] CRAN (R 4.2.3)  permute              * 0.9-7     2022-01-27 [1] CRAN (R 4.2.3)  pheatmap             * 1.0.12    2019-01-04 [1] CRAN (R 4.2.3)  pillar                 1.10.0    2024-12-17 [2] CRAN (R 4.2.3)  pkgconfig              2.0.3     2019-09-22 [2] CRAN (R 4.2.3)  png                    0.1-8     2022-11-29 [1] CRAN (R 4.2.3)  polyclip               1.10-7    2024-07-23 [1] CRAN (R 4.2.3)  preprocessCore         1.60.2    2023-01-19 [1] Bioconductor  psych                * 2.4.12    2024-12-23 [1] CRAN (R 4.2.3)  purrr                * 1.0.2     2023-08-10 [2] CRAN (R 4.2.3)  R6                     2.5.1     2021-08-19 [2] CRAN (R 4.2.3)  RColorBrewer         * 1.1-3     2022-04-03 [2] CRAN (R 4.2.3)  Rcpp                   1.0.13    2024-07-17 [1] CRAN (R 4.2.3)  RCurl                  1.98-1.16 2024-07-11 [1] CRAN (R 4.2.3)  readr                * 2.1.5     2024-01-10 [2] CRAN (R 4.2.3)  rjson                  0.2.21    2022-01-09 [1] CRAN (R 4.2.3)  rlang                  1.1.3     2024-01-10 [2] CRAN (R 4.2.3)  rmarkdown              2.28      2024-08-17 [1] CRAN (R 4.2.3)  rpart                  4.1.23    2023-12-05 [2] CRAN (R 4.2.3)  RSQLite                2.3.7     2024-05-27 [1] CRAN (R 4.2.3)  rstatix                0.7.2     2023-02-01 [1] CRAN (R 4.2.3)  rstudioapi             0.16.0    2024-03-24 [2] CRAN (R 4.2.3)  S4Vectors            * 0.36.2    2023-02-26 [1] Bioconductor  scales                 1.3.0     2023-11-28 [2] CRAN (R 4.2.3)  sessioninfo            1.2.2     2021-12-06 [1] CRAN (R 4.2.3)  shape                  1.4.6.1   2024-02-23 [1] CRAN (R 4.2.3)  stringi                1.8.4     2024-05-06 [2] CRAN (R 4.2.3)  stringr              * 1.5.1     2023-11-14 [2] CRAN (R 4.2.3)  SummarizedExperiment * 1.28.0    2022-11-01 [1] Bioconductor  survival               3.6-4     2024-04-24 [2] CRAN (R 4.2.3)  tibble               * 3.2.1     2023-03-20 [2] CRAN (R 4.2.3)  tidygraph              1.3.1     2024-01-30 [1] CRAN (R 4.2.3)  tidyr                * 1.3.1     2024-01-24 [2] CRAN (R 4.2.3)  tidyselect             1.2.1     2024-03-11 [2] CRAN (R 4.2.3)  tidyverse            * 2.0.0     2023-02-22 [2] CRAN (R 4.2.3)  timechange             0.3.0     2024-01-18 [2] CRAN (R 4.2.3)  tweenr                 2.0.3     2024-02-26 [1] CRAN (R 4.2.3)  tzdb                   0.4.0     2023-05-12 [2] CRAN (R 4.2.3)  vctrs                  0.6.5     2023-12-01 [2] CRAN (R 4.2.3)  vegan                * 2.6-8     2024-08-28 [1] CRAN (R 4.2.3)  viridis                0.6.5     2024-01-29 [1] CRAN (R 4.2.3)  viridisLite            0.4.2     2023-05-02 [2] CRAN (R 4.2.3)  vroom                  1.6.5     2023-12-05 [2] CRAN (R 4.2.3)  WGCNA                * 1.72-5    2023-12-07 [1] CRAN (R 4.2.3)  withr                  3.0.2     2024-10-28 [2] CRAN (R 4.2.3)  xfun                   0.44      2024-05-15 [2] CRAN (R 4.2.3)  XML                    3.99-0.17 2024-06-25 [1] CRAN (R 4.2.3)  xtable                 1.8-4     2019-04-21 [1] CRAN (R 4.2.3)  XVector                0.38.0    2022-11-01 [1] Bioconductor  yaml                   2.3.10    2024-07-26 [2] CRAN (R 4.2.3)  zlibbioc               1.44.0    2022-11-01 [1] Bioconductor   [1] /home/shared/8TB_HDD_02/shedurkin/R/x86_64-pc-linux-gnu-library/4.2  [2] /opt/R/4.2.3/lib/R/library  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</code></pre>


</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_03_11_timeseries_WGCNA.html</guid>
  <pubDate>Tue, 11 Mar 2025 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Deep-dive expression: A.pul miRanda comparisons</title>
  <dc:creator>Kathleen Durkin</dc:creator>
  <link>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_13_deepdive_miRanda_comparisons.html</link>
  <description><![CDATA[ 




<p>Up to this point, our miRNA target prediction has been primarily performed using the tool miRanda, which requires only seed binding, with 3â€™UTR regions as input. However, there is growing evidence that cnidarian miRNA binding functions similarly to plants, requiring near-full complementarity and to act primarily through target cleavage, which can occur at any location in the mRNA sequence (not just the 3â€™UTR). This would mean our current miRanda target predictions are both a) not sufficiently restricted to fll complementarity, and b) incorrectly limited to the 3â€™UTR.</p>
<p>I check what happens when we adjust those parameters</p>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>How does different input and/or complementarity filtering affect # putative interactions:</p>
<table class="table">
<thead>
<tr class="header">
<th>Input</th>
<th>unfiltered</th>
<th>filtered for complementarity</th>
<th>% retained</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3'UTR</td>
<td>6109</td>
<td>13</td>
<td>0.213 %</td>
</tr>
<tr class="even">
<td>full mRNA</td>
<td>19133057</td>
<td>143</td>
<td>0.000747 %</td>
</tr>
</tbody>
</table>
<p>For different filters, how many putative interactions <em>also show significant coexpression</em>?</p>
<table class="table">
<thead>
<tr class="header">
<th>Input</th>
<th>21bp</th>
<th>21bp, &gt;=3 mismatch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3'UTR</td>
<td>58 (3.4% of all 21bp)</td>
<td>0</td>
</tr>
<tr class="even">
<td>full mRNA</td>
<td>3767 (3.7% of all 21bp)</td>
<td>6 (4.2% of all 21bp,&gt;=3mis)</td>
</tr>
</tbody>
</table>
<p>Note that, in general, only ~1/3 of significant coexpressions have a <em>negative</em> relationship (which would support functional target cleavage)</p>
<p>Note also that some putative interactions examined above weren't included in the PCC table</p>
<p>Next steps:</p>
<ul>
<li><p>discuss w team â€“ should we look for both miRNAs that function through target cleavage (full complementary, full coding sequence) <em>and</em> miRNAs that function through "canonical" translational silencing (seed complementarity, 3'UTR)?</p></li>
<li><p>Run same comparison using BLAST and/or RNAhybrid as the tool. I'm still not 100% clear on what sequence features miRanda takes into consideration, and any that <em>are</em> included will have been based on mammalian miRNAs. It may be more appropriate to use a different tool</p></li>
<li><p>if we decide to shift target prediction requirements, need to rerun all target prediction done thus far :(</p></li>
</ul>
<p>Code included below</p>
</section>
<section id="apul-miranda-input-comparisons" class="level1">
<h1><a href="https://github.com/urol-e5/deep-dive-expression/blob/main/D-Apul/code/24-Apul-miRanda-input-comparisons.md">24-Apul-miRanda-input-comparisons</a></h1>
</section>
<section id="mirna-and-full-mrna-coding-sequences" class="level1">
<h1>1 miRNA and full mRNA coding sequences</h1>
<p>Inputs:</p>
<ul>
<li><p>FASTA of A.pulchra mRNA coding sequences</p></li>
<li><p>FASTA of A.pulchra mature miRNAs</p></li>
</ul>
<section id="get-mrna-fasta" class="level2">
<h2 class="anchored" data-anchor-id="get-mrna-fasta">1.1 Get mRNA fasta</h2>
<pre><code>/home/shared/bedtools2/bin/bedtools getfasta \ -fi "../data/Apulchra-genome.fa" \ -bed "../data/Apulcra-genome-mRNA_only.gff" \ -fo "../data/24-Apul-miRanda-input-comparisons/Apul_mRNA_full.fa"</code></pre>
</section>
<section id="run-miranda" class="level2">
<h2 class="anchored" data-anchor-id="run-miranda">1.2 Run miRanda</h2>
<pre><code># Same settings we've been using:  # score cutoff &gt;100 # energy cutoff &lt;-10 # strict binding  /home/shared/miRanda-3.3a/src/miranda \ ../output/17-Apul-miRNA-lncRNA-BLASTs-RNAhybrid/Apul_ShortStack_4.1.0_mature.fasta \ ../data/24-Apul-miRanda-input-comparisons/Apul_mRNA_full.fa \ -sc 100 \ -en -10 \ -strict \ -out ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab</code></pre>
</section>
<section id="summarize-results" class="level2">
<h2 class="anchored" data-anchor-id="summarize-results">1.3 Summarize results</h2>
<p>Let's look at the output</p>
<pre><code>echo "miranda run finished!" echo "Counting number of interacting miRNA-lncRNA pairs"  zgrep -c "Performing Scan" ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab  echo "Parsing output" grep -A 1 "Scores for this hit:" ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab | sort | grep '&gt;' &gt; ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt  echo "counting number of putative interactions predicted (can include multiple interactions between single miRNA-lncRNA pair)" wc -l ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab</code></pre>
<pre><code>## miranda run finished! ## Counting number of interacting miRNA-lncRNA pairs ## 1421433 ## Parsing output ## counting number of putative interactions predicted (can include multiple interactions between single miRNA-lncRNA pair) ## 19133057 ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict_all.tab </code></pre>
<p>This is a lot of putative interactions! Note though, that miRanda only requires complementarity of a 8bp seed region of the miRNA. We instead want to look for binding with full or near-full complementarity. Let's look at how many putative interactions are predicted for a binding length of at least 21 nucleotides (the length of our smallest mature miRNA).</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides ## 101744 ##  ## check some: ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10104556-10114024  154.00  -19.94  2 21    1466 1493   25  68.00%  72.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10104556-10114024  155.00  -21.12  2 21    8084 8107   21  66.67%  76.19% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10351674-10369781  147.00  -17.81  2 21    2265 2289   22  59.09%  72.73% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10392093-10402892  157.00  -20.28  2 21    4608 4632   22  77.27%  77.27% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) ntLink_6:10597160-10611657  159.00  -19.58  2 21    7110 7133   21  71.43%  76.19% </code></pre>
<p>The header for this output is formatted as:</p>
<p>mirna Target Score Energy-Kcal/Mol Query-Aln(start-end) Subject-Al(Start-End) Al-Len Subject-Identity Query-Identity</p>
<p>We can see from the percent identities (last 2 entries) that this number includes alignments with multiple mismatches. Let's filter again to reduce the number of permissible mismatches. Let's say we want no more than 3 mismatches (a gap is counted as a mismatch). For an alignment of 21 nucleotides, this would be an percent identity of (21-3)/21 = 85.7%. The miRNA is our "subject", so we will filter by column 8.</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides, with at most 3 mismatches" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | awk -F'\t' '$8 &gt;= 85' | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt | awk -F'\t' '$8 &gt;= 85' | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides, with at most 3 mismatches ## 143 ##  ## check some: ## &gt;Cluster_10057.mature::ptg000016l:8599884-8599905(-) ptg000017l:7171736-7192592  174.00  -21.36  2 21    13035 13058 21  85.71%  85.71% ## &gt;Cluster_10093.mature::ptg000016l:11751407-11751428(-)   ptg000007l:5326404-5332924  179.00  -25.97  2 21    658 681 21  85.71%  85.71% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) ntLink_8:9921794-9928534    179.00  -26.55  2 22    872 896 22  86.36%  86.36% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) ptg000019l:1503591-1507594  188.00  -31.70  2 22    3554 3577   21  85.71%  95.24% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) ptg000039l:790628-797014    188.00  -25.92  2 22    5693 5716   21  90.48%  90.48% </code></pre>
<p>So filtering for full or near-full complementarity reduced the number of putative interactions between miRNA and full mRNA sequences from 19133057 to 143.</p>
</section>
</section>
<section id="mirna-and-mrna-3utrs" class="level1">
<h1>2 miRNA and mRNA 3'UTRs</h1>
<p>Now let's see how filtering changes the outputs of miRanda run with only the 3'UTR mRNA region (the input we have been using up till now)</p>
<p>Unfiltered:</p>
<pre><code>wc -l ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt</code></pre>
<pre><code>## 6109 ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt </code></pre>
<p>Filter for alignment &gt;=21 nucleotides:</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides ## 1699 ##  ## check some: ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_002849::ntLink_8:6882212-6883212    158.00  -21.97  2 21    278 301 21  66.67%  85.71% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_018974::ptg000012l:15854445-15855445    155.00  -23.11  2 21    894 920 24  62.50%  75.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_019124::ptg000012l:17452953-17453953    147.00  -22.09  2 21    783 810 25  60.00%  68.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_023335::ptg000017l:6446983-6447355  150.00  -22.25  2 21    171 197 24  62.50%  75.00% ## &gt;Cluster_10051.mature::ptg000016l:7795530-7795551(+) FUN_024352::ptg000018l:5339775-5340775  162.00  -20.97  2 21    96 122  24  75.00%  75.00% </code></pre>
<p>Filter again for &lt;=3 mismatches:</p>
<pre><code>echo "number of putative interactions of at least 21 nucleotides, with at most 3 mismatches" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | awk -F'\t' '$8 &gt;= 85' | wc -l echo "" echo "check some:" awk -F'\t' '$7 &gt;= 21' ../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt | awk -F'\t' '$8 &gt;= 85' | head -5</code></pre>
<pre><code>## number of putative interactions of at least 21 nucleotides, with at most 3 mismatches ## 13 ##  ## check some: ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) FUN_022919::ptg000017l:1483036-1484036  183.00  -28.35  2 22    69 94   23  86.96%  86.96% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) FUN_027647::ptg000021l:8285525-8286525  174.00  -25.86  2 21    101 125 21  85.71%  85.71% ## &gt;Cluster_10228.mature::ptg000017l:7471168-7471190(+) FUN_040282::ptg000031l:6265207-6266207  183.00  -30.15  2 21    525 550 22  86.36%  86.36% ## &gt;Cluster_10419.mature::ptg000018l:2286829-2286850(+) FUN_016674::ptg000011l:6193740-6194740  174.00  -21.33  2 21    904 927 21  85.71%  85.71% ## &gt;Cluster_15775.mature::ptg000025l:7472581-7472603(-) FUN_022318::ptg000016l:7511874-7512874  180.00  -21.41  2 22    573 596 21  85.71%  85.71% </code></pre>
<p>When only mRNA 3'UTR regions are used as input, filtering for full/near-full complementarity reduces the number of putative interactions from 6109 to 13.</p>
</section>
<section id="examine-coexpression" class="level1">
<h1>3 Examine coexpression</h1>
<p>Now that we've found putative interactions with high complementarity, we need to validate miRNA function by examining patterns of coexpression. We'd expect a putatively-interacting miRNA-mRNA pair to be highly coexpressed, and we'd expect a negative relationship to indicate target cleavage.</p>
<section id="full-mrna" class="level2">
<h2 class="anchored" data-anchor-id="full-mrna">3.1 full mRNA</h2>
<pre><code>library(readr) library(dplyr)</code></pre>
<pre><code>##  ## Attaching package: 'dplyr'  ## The following objects are masked from 'package:stats': ##  ##     filter, lag  ## The following objects are masked from 'package:base': ##  ##     intersect, setdiff, setequal, union </code></pre>
<pre><code># Read in data  # miRNA-mRNA Pearsons correlation coefficients miRNA_mRNA_PCC &lt;- read.csv("../output/09-Apul-mRNA-miRNA-interactions/Apul-PCC_miRNA_mRNA.csv")  # miRNA-mRNA_full miRanda output miRNA_mRNA_miRanda &lt;- read_delim("../output/24-Apul-miRanda-input-comparisons/Apul-miRanda-mRNA_full-strict-parsed.txt", col_names=FALSE)</code></pre>
<pre><code>## Rows: 617982 Columns: 9  ## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ## Delimiter: "\t" ## chr (6): X1, X2, X5, X6, X8, X9 ## dbl (3): X3, X4, X7 ##  ## â„¹ Use `spec()` to retrieve the full column specification for this data. ## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message. </code></pre>
<pre><code>colnames(miRNA_mRNA_miRanda) &lt;- c("mirna", "Target", "Score", "Energy_Kcal_Mol", "Query_Aln", "Subject_Aln", "Al_Len", "Subject_Identity", "Query_Identity")  # format miRNA and mRNA names geneIDs &lt;- read_delim("../output/15-Apul-annotate-UTRs/Apul-mRNA-FUNids.txt", col_names=FALSE)</code></pre>
<pre><code>## Rows: 36447 Columns: 5 ## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ## Delimiter: "\t" ## chr (5): X1, X2, X3, X4, X5 ##  ## â„¹ Use `spec()` to retrieve the full column specification for this data. ## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message. </code></pre>
<pre><code>geneIDs$X4 &lt;- gsub("Parent=", "", geneIDs$X4)  miRNA_mRNA_miRanda$mirna &lt;- gsub("&gt;", "", miRNA_mRNA_miRanda$mirna) miRNA_mRNA_miRanda$mirna &lt;- gsub("\\..*", "", miRNA_mRNA_miRanda$mirna)  miRNA_mRNA_miRanda &lt;- left_join(miRNA_mRNA_miRanda, geneIDs, by=c("Target" = "X1")) miRNA_mRNA_miRanda &lt;- select(miRNA_mRNA_miRanda, -X2,-X3,-X5)  # Finally, create a column that conatins both the miRNA and interacting mRNA miRNA_mRNA_PCC$interaction &lt;- paste(miRNA_mRNA_PCC$miRNA, "_", miRNA_mRNA_PCC$mRNA) miRNA_mRNA_miRanda$interaction &lt;- paste(miRNA_mRNA_miRanda$mirna, "_", miRNA_mRNA_miRanda$X4)  # Annotate w PCC info  miRNA_mRNA_miRanda &lt;- left_join(miRNA_mRNA_miRanda, miRNA_mRNA_PCC, by="interaction")</code></pre>
<pre><code># Filter to high complementarity putative targets target_21bp &lt;- miRNA_mRNA_miRanda[miRNA_mRNA_miRanda$Al_Len &gt; 20,] target_21bp_3mis &lt;- target_21bp[target_21bp$Subject_Identity&gt;85,]  # How many w significant correlation? nrow(target_21bp %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 3787 </code></pre>
<pre><code>nrow(target_21bp %&gt;% filter(p_value &lt; 0.05))/nrow(target_21bp)</code></pre>
<pre><code>## [1] 0.03722087 </code></pre>
<pre><code>nrow(target_21bp_3mis %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 6 </code></pre>
<pre><code>nrow(target_21bp_3mis %&gt;% filter(p_value &lt; 0.05))/nrow(target_21bp_3mis)</code></pre>
<pre><code>## [1] 0.04195804 </code></pre>
<pre><code># Plot correlation values hist(target_21bp$PCC.cor)</code></pre>
<pre><code>hist(target_21bp[target_21bp$p_value &lt; 0.05,]$PCC.cor)</code></pre>
<pre><code>hist(target_21bp_3mis$PCC.cor)</code></pre>
<pre><code>hist(target_21bp_3mis[target_21bp_3mis$p_value &lt; 0.05,]$PCC.cor)</code></pre>
</section>
<section id="utr" class="level2">
<h2 class="anchored" data-anchor-id="utr">3.2 3'UTR</h2>
<pre><code># Read in data  # miRNA-mRNA_full miRanda output miRNA_3UTR_miRanda &lt;- read_delim("../output/09-Apul-mRNA-miRNA-interactions/miranda_strict_all_1kb_parsed_apul_updated.txt", col_names=FALSE)</code></pre>
<pre><code>## Rows: 6109 Columns: 9 ## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ## Delimiter: "\t" ## chr (6): X1, X2, X5, X6, X8, X9 ## dbl (3): X3, X4, X7 ##  ## â„¹ Use `spec()` to retrieve the full column specification for this data. ## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message. </code></pre>
<pre><code>colnames(miRNA_3UTR_miRanda) &lt;- c("mirna", "Target", "Score", "Energy_Kcal_Mol", "Query_Aln", "Subject_Aln", "Al_Len", "Subject_Identity", "Query_Identity")  miRNA_3UTR_miRanda$mirna &lt;- gsub("&gt;", "", miRNA_3UTR_miRanda$mirna) miRNA_3UTR_miRanda$mirna &lt;- gsub("\\..*", "", miRNA_3UTR_miRanda$mirna) miRNA_3UTR_miRanda$Target &lt;- gsub("::.*", "", miRNA_3UTR_miRanda$Target)  # Finally, create a column that conatins both the miRNA and interacting mRNA miRNA_3UTR_miRanda$interaction &lt;- paste(miRNA_3UTR_miRanda$mirna, "_", miRNA_3UTR_miRanda$Target)  # Annotate w PCC info  miRNA_3UTR_miRanda &lt;- left_join(miRNA_3UTR_miRanda, miRNA_mRNA_PCC, by="interaction")</code></pre>
<pre><code># Filter to high complementarity putative targets target_3UTR_21bp &lt;- miRNA_3UTR_miRanda[miRNA_3UTR_miRanda$Al_Len &gt; 20,] target_3UTR_21bp_3mis &lt;- target_3UTR_21bp[target_3UTR_21bp$Subject_Identity&gt;85,]  # How many w significant correlation? nrow(target_3UTR_21bp %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 58 </code></pre>
<pre><code>nrow(target_3UTR_21bp %&gt;% filter(p_value &lt; 0.05))/nrow(target_3UTR_21bp)</code></pre>
<pre><code>## [1] 0.03413773 </code></pre>
<pre><code>nrow(target_3UTR_21bp_3mis %&gt;% filter(p_value &lt; 0.05))</code></pre>
<pre><code>## [1] 0 </code></pre>
<pre><code>nrow(target_3UTR_21bp_3mis %&gt;% filter(p_value &lt; 0.05))/nrow(target_3UTR_21bp_3mis)</code></pre>
<pre><code>## [1] 0 </code></pre>
<pre><code># Plot correlation values hist(target_3UTR_21bp$PCC.cor)</code></pre>
<pre><code>hist(target_3UTR_21bp[target_3UTR_21bp$p_value &lt; 0.05,]$PCC.cor)</code></pre>
<pre><code># hist(target_3UTR_21bp_3mis$PCC.cor) # hist(target_3UTR_21bp_3mis[target_3UTR_21bp_3mis$p_value &lt; 0.05,]$PCC.cor)</code></pre>


</section>
</section>

 ]]></description>
  <category>E5-coral</category>
  <guid>https://shedurkin.github.io/Roberts-LabNotebook/posts/projects/E5_coral/2025_02_13_deepdive_miRanda_comparisons.html</guid>
  <pubDate>Thu, 13 Feb 2025 08:00:00 GMT</pubDate>
</item>
</channel>
</rss>
